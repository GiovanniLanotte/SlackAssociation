pull request url html,pull request url,body,commit_id,create at,id,diff_hunk,position,update at,url,html url,user
https://github.com/hyperledger/composer/pull/4570,https://github.com/hyperledger/composer/pull/4570,You could do this in one line; `defineProperty` takes a `value` option.,b2f4f4ca7f7f5ae40b60a5b3b6fcf3864a562db6,2019-01-16 16:31:49,248355261,"@@ -124,25 +124,35 @@ class Property extends Decorated {
      * @return {string} the fully qualified type of this property
      */
     getFullyQualifiedTypeName() {
+
         if(this.isPrimitive()) {
             return this.type;
         }
 
-        const parent = this.getParent();
-        if(!parent) {
-            throw new Error('Property ' + this.name + ' does not have a parent.');
-        }
-        const modelFile = parent.getModelFile();
-        if(!modelFile) {
-            throw new Error('Parent of property ' + this.name + ' does not have a ModelFile!');
-        }
+        if (this.fullyQualifiedTypeName){
+            return this.fullyQualifiedTypeName;
+        } else {
+            const parent = this.getParent();
+            if(!parent) {
+                throw new Error('Property ' + this.name + ' does not have a parent.');
+            }
+            const modelFile = parent.getModelFile();
+            if(!modelFile) {
+                throw new Error('Parent of property ' + this.name + ' does not have a ModelFile!');
+            }
+
+            const result = modelFile.getFullyQualifiedTypeName(this.type);
+
+            if(!result) {
+                throw new Error('Failed to find fully qualified type name for property ' + this.name + ' with type ' + this.type );
+            }
+
+            this.fullyQualifiedTypeName = result;
+            Object.defineProperty(this, 'fullyQualifiedTypeName', { enumerable: false });",36,2019-01-18 10:07:09,https://api.github.com/repos/hyperledger/composer/pulls/comments/248355261,https://github.com/hyperledger/composer/pull/4570#discussion_r248355261,sstone1
https://github.com/hyperledger/composer/pull/4471,https://github.com/hyperledger/composer/pull/4471,could you change 'http' to 'httpOptions' as this is the correct name,7992d6f3813dfa1a19cf99d08e2ed03de94b3818,2018-10-18 21:10:59,226466974,"@@ -201,8 +201,25 @@ Here you define all the certificate authorities
 }
 ```
 
+To configure a Certificate Authority to use TLS, use the following format:
+
+```
+""certificateAuthorities"": {
+    ""ca.org1.example.com"": {
+        ""url"": ""https://ca.org1.example.com:7054"",
+        ""caName"": ""ca.org1.example.com"",
+        ""http"": {",,2018-10-19 14:19:13,https://api.github.com/repos/hyperledger/composer/pulls/comments/226466974,https://github.com/hyperledger/composer/pull/4471#discussion_r226466974,davidkel
https://github.com/hyperledger/composer/pull/4415,https://github.com/hyperledger/composer/pull/4415,"should the comment be changed to reflect the line below?  "" - log from everything but only at the warn level""",b943ea2a73f3179299fb8603d8f315ac9dd0ba16,2018-09-27 13:59:01,220934160,"@@ -33,7 +33,7 @@ let _logger;
 let _clInstances = {};
 
 // the default control string - log from everthing but only at the error level",3,2018-09-27 14:00:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/220934160,https://github.com/hyperledger/composer/pull/4415#discussion_r220934160,lesleyannjordan
https://github.com/hyperledger/composer/pull/4321,https://github.com/hyperledger/composer/pull/4321,Adding `.yml` to the end of the temporary file name might conceivably cause a conflict with an existing file. `mktemp` ensures the file it creates is unique. I see Jekyll doesn't like the file without extension though. ðŸ˜ž ,089430fc2fc0b2441f0e39c1889fbf60dc122b4c,2018-08-09 17:23:54,209013050,"@@ -27,8 +27,8 @@ SCRIPT_DIR=""$( cd ""$( dirname ""${BASH_SOURCE[0]}"" )"" && pwd )""
 ""${SCRIPT_DIR}/setup-jekyll.sh""
 
 # Write custom configuration for this build
-JEKYLL_CONFIG=""$(mktemp)""
-echo ""basedir: /composer/${BUILD_LABEL}"" >> ""${JEKYLL_CONFIG}""
+JEKYLL_CONFIG=""$(mktemp)"".yaml",6,2018-08-09 17:26:34,https://api.github.com/repos/hyperledger/composer/pulls/comments/209013050,https://github.com/hyperledger/composer/pull/4321#discussion_r209013050,bestbeforetoday
https://github.com/hyperledger/composer/pull/4301,https://github.com/hyperledger/composer/pull/4301,Wrong quotes used RHS,4d80595dcd9346f53b24198e115b45ffc0824f81,2018-08-08 11:26:25,208545437,"@@ -39,46 +39,25 @@ if [ ""${DOCS}"" != """" ]; then
     # Build the documentation.
     npm run doc
 
-    if [[ ""${BUILD_RELEASE}"" == ""unstable"" ]]; then
-
-        if [[ ""${BUILD_FOCUS}"" == ""latest"" ]]; then
-            npm run full:unstable
-            npm run linkcheck:unstable
-        elif [[ ""${BUILD_FOCUS}"" == ""next"" ]]; then
-            npm run full:next-unstable
-            npm run linkcheck:next-unstable
-        elif [[ ""${BUILD_FOCUS}"" == ""v0.16"" ]]; then
-            npm run full:v0.16-unstable
-            npm run linkcheck:v0.16-unstable
-        elif [[ ""${BUILD_FOCUS}"" == 'v0.19' ]]; then
-            npm run full:v0.19-unstable
-            npm run linkcheck:v0.19-unstable
-        else 
-            _exit ""Unknown build focus"" 1 
-        fi
+    if [ -z ""${BUILD_FOCUS}"" ]; then
+        _exit 'No build focus' 1
+    fi
 
-    elif [[ ""${BUILD_RELEASE}"" == ""stable"" ]]; then
-
-        if [[ ""${BUILD_FOCUS}"" == ""latest"" ]]; then
-            npm run full:latest
-            npm run linkcheck:latest
-        elif [[ ""${BUILD_FOCUS}"" == ""next"" ]]; then
-            npm run full:next
-            npm run linkcheck:next
-        elif [[ ""${BUILD_FOCUS}"" == ""v0.16"" ]]; then
-            npm run full:v0.16
-            npm run linkcheck:v0.16
-        elif [[ ""${BUILD_FOCUS}"" == 'v0.19' ]]; then
-            npm run full:v0.19
-            npm run linkcheck:v0.19
-        else 
-            _exit ""Unknown build focus"" 1 
+    if [ ""${BUILD_RELEASE}"" = 'unstable' ]; then",41,2018-08-08 12:59:29,https://api.github.com/repos/hyperledger/composer/pulls/comments/208545437,https://github.com/hyperledger/composer/pull/4301#discussion_r208545437,davidkel
https://github.com/hyperledger/composer/pull/4301,https://github.com/hyperledger/composer/pull/4301,"Same here, so would the test not fail ?",4d80595dcd9346f53b24198e115b45ffc0824f81,2018-08-08 11:26:45,208545503,"@@ -39,46 +39,25 @@ if [ ""${DOCS}"" != """" ]; then
     # Build the documentation.
     npm run doc
 
-    if [[ ""${BUILD_RELEASE}"" == ""unstable"" ]]; then
-
-        if [[ ""${BUILD_FOCUS}"" == ""latest"" ]]; then
-            npm run full:unstable
-            npm run linkcheck:unstable
-        elif [[ ""${BUILD_FOCUS}"" == ""next"" ]]; then
-            npm run full:next-unstable
-            npm run linkcheck:next-unstable
-        elif [[ ""${BUILD_FOCUS}"" == ""v0.16"" ]]; then
-            npm run full:v0.16-unstable
-            npm run linkcheck:v0.16-unstable
-        elif [[ ""${BUILD_FOCUS}"" == 'v0.19' ]]; then
-            npm run full:v0.19-unstable
-            npm run linkcheck:v0.19-unstable
-        else 
-            _exit ""Unknown build focus"" 1 
-        fi
+    if [ -z ""${BUILD_FOCUS}"" ]; then
+        _exit 'No build focus' 1
+    fi
 
-    elif [[ ""${BUILD_RELEASE}"" == ""stable"" ]]; then
-
-        if [[ ""${BUILD_FOCUS}"" == ""latest"" ]]; then
-            npm run full:latest
-            npm run linkcheck:latest
-        elif [[ ""${BUILD_FOCUS}"" == ""next"" ]]; then
-            npm run full:next
-            npm run linkcheck:next
-        elif [[ ""${BUILD_FOCUS}"" == ""v0.16"" ]]; then
-            npm run full:v0.16
-            npm run linkcheck:v0.16
-        elif [[ ""${BUILD_FOCUS}"" == 'v0.19' ]]; then
-            npm run full:v0.19
-            npm run linkcheck:v0.19
-        else 
-            _exit ""Unknown build focus"" 1 
+    if [ ""${BUILD_RELEASE}"" = 'unstable' ]; then
+        if [ ""${BUILD_FOCUS}"" = 'latest' ]; then",42,2018-08-08 12:59:29,https://api.github.com/repos/hyperledger/composer/pulls/comments/208545503,https://github.com/hyperledger/composer/pull/4301#discussion_r208545503,davidkel
https://github.com/hyperledger/composer/pull/4301,https://github.com/hyperledger/composer/pull/4301,Different quotes RHS,4d80595dcd9346f53b24198e115b45ffc0824f81,2018-08-08 11:27:19,208545648,"@@ -39,46 +39,25 @@ if [ ""${DOCS}"" != """" ]; then
     # Build the documentation.
     npm run doc
 
-    if [[ ""${BUILD_RELEASE}"" == ""unstable"" ]]; then
-
-        if [[ ""${BUILD_FOCUS}"" == ""latest"" ]]; then
-            npm run full:unstable
-            npm run linkcheck:unstable
-        elif [[ ""${BUILD_FOCUS}"" == ""next"" ]]; then
-            npm run full:next-unstable
-            npm run linkcheck:next-unstable
-        elif [[ ""${BUILD_FOCUS}"" == ""v0.16"" ]]; then
-            npm run full:v0.16-unstable
-            npm run linkcheck:v0.16-unstable
-        elif [[ ""${BUILD_FOCUS}"" == 'v0.19' ]]; then
-            npm run full:v0.19-unstable
-            npm run linkcheck:v0.19-unstable
-        else 
-            _exit ""Unknown build focus"" 1 
-        fi
+    if [ -z ""${BUILD_FOCUS}"" ]; then
+        _exit 'No build focus' 1
+    fi
 
-    elif [[ ""${BUILD_RELEASE}"" == ""stable"" ]]; then
-
-        if [[ ""${BUILD_FOCUS}"" == ""latest"" ]]; then
-            npm run full:latest
-            npm run linkcheck:latest
-        elif [[ ""${BUILD_FOCUS}"" == ""next"" ]]; then
-            npm run full:next
-            npm run linkcheck:next
-        elif [[ ""${BUILD_FOCUS}"" == ""v0.16"" ]]; then
-            npm run full:v0.16
-            npm run linkcheck:v0.16
-        elif [[ ""${BUILD_FOCUS}"" == 'v0.19' ]]; then
-            npm run full:v0.19
-            npm run linkcheck:v0.19
-        else 
-            _exit ""Unknown build focus"" 1 
+    if [ ""${BUILD_RELEASE}"" = 'unstable' ]; then
+        if [ ""${BUILD_FOCUS}"" = 'latest' ]; then
+            BUILD_LABEL='unstable'
+        else
+            BUILD_LABEL=""${BUILD_FOCUS}-unstable""
         fi
-
+    elif [ ""${BUILD_RELEASE}"" = 'stable' ]; then",48,2018-08-08 12:59:29,https://api.github.com/repos/hyperledger/composer/pulls/comments/208545648,https://github.com/hyperledger/composer/pull/4301#discussion_r208545648,davidkel
https://github.com/hyperledger/composer/pull/4301,https://github.com/hyperledger/composer/pull/4301,I see a Matthew type spelling mistake here itching to be fixed,4d80595dcd9346f53b24198e115b45ffc0824f81,2018-08-08 11:27:51,208545762,"@@ -39,46 +39,25 @@ if [ ""${DOCS}"" != """" ]; then
     # Build the documentation.
     npm run doc
 
-    if [[ ""${BUILD_RELEASE}"" == ""unstable"" ]]; then
-
-        if [[ ""${BUILD_FOCUS}"" == ""latest"" ]]; then
-            npm run full:unstable
-            npm run linkcheck:unstable
-        elif [[ ""${BUILD_FOCUS}"" == ""next"" ]]; then
-            npm run full:next-unstable
-            npm run linkcheck:next-unstable
-        elif [[ ""${BUILD_FOCUS}"" == ""v0.16"" ]]; then
-            npm run full:v0.16-unstable
-            npm run linkcheck:v0.16-unstable
-        elif [[ ""${BUILD_FOCUS}"" == 'v0.19' ]]; then
-            npm run full:v0.19-unstable
-            npm run linkcheck:v0.19-unstable
-        else 
-            _exit ""Unknown build focus"" 1 
-        fi
+    if [ -z ""${BUILD_FOCUS}"" ]; then
+        _exit 'No build focus' 1
+    fi
 
-    elif [[ ""${BUILD_RELEASE}"" == ""stable"" ]]; then
-
-        if [[ ""${BUILD_FOCUS}"" == ""latest"" ]]; then
-            npm run full:latest
-            npm run linkcheck:latest
-        elif [[ ""${BUILD_FOCUS}"" == ""next"" ]]; then
-            npm run full:next
-            npm run linkcheck:next
-        elif [[ ""${BUILD_FOCUS}"" == ""v0.16"" ]]; then
-            npm run full:v0.16
-            npm run linkcheck:v0.16
-        elif [[ ""${BUILD_FOCUS}"" == 'v0.19' ]]; then
-            npm run full:v0.19
-            npm run linkcheck:v0.19
-        else 
-            _exit ""Unknown build focus"" 1 
+    if [ ""${BUILD_RELEASE}"" = 'unstable' ]; then
+        if [ ""${BUILD_FOCUS}"" = 'latest' ]; then
+            BUILD_LABEL='unstable'
+        else
+            BUILD_LABEL=""${BUILD_FOCUS}-unstable""
         fi
-
+    elif [ ""${BUILD_RELEASE}"" = 'stable' ]; then
+        BUILD_LABEL=""${BUILD_FOCUS}""
     else
-       _exit ""Unkown build release or focus ${BUILD_RELEASE} ${BUILD_FOCUS}"" 1
+       _exit ""Unkown build release: ${BUILD_RELEASE}"" 1",,2018-08-08 12:59:29,https://api.github.com/repos/hyperledger/composer/pulls/comments/208545762,https://github.com/hyperledger/composer/pull/4301#discussion_r208545762,davidkel
https://github.com/hyperledger/composer/pull/4301,https://github.com/hyperledger/composer/pull/4301,No variable expansion wanted on the RHS so single quotes seem appropriate.,4d80595dcd9346f53b24198e115b45ffc0824f81,2018-08-08 12:55:13,208568896,"@@ -39,46 +39,25 @@ if [ ""${DOCS}"" != """" ]; then
     # Build the documentation.
     npm run doc
 
-    if [[ ""${BUILD_RELEASE}"" == ""unstable"" ]]; then
-
-        if [[ ""${BUILD_FOCUS}"" == ""latest"" ]]; then
-            npm run full:unstable
-            npm run linkcheck:unstable
-        elif [[ ""${BUILD_FOCUS}"" == ""next"" ]]; then
-            npm run full:next-unstable
-            npm run linkcheck:next-unstable
-        elif [[ ""${BUILD_FOCUS}"" == ""v0.16"" ]]; then
-            npm run full:v0.16-unstable
-            npm run linkcheck:v0.16-unstable
-        elif [[ ""${BUILD_FOCUS}"" == 'v0.19' ]]; then
-            npm run full:v0.19-unstable
-            npm run linkcheck:v0.19-unstable
-        else 
-            _exit ""Unknown build focus"" 1 
-        fi
+    if [ -z ""${BUILD_FOCUS}"" ]; then
+        _exit 'No build focus' 1
+    fi
 
-    elif [[ ""${BUILD_RELEASE}"" == ""stable"" ]]; then
-
-        if [[ ""${BUILD_FOCUS}"" == ""latest"" ]]; then
-            npm run full:latest
-            npm run linkcheck:latest
-        elif [[ ""${BUILD_FOCUS}"" == ""next"" ]]; then
-            npm run full:next
-            npm run linkcheck:next
-        elif [[ ""${BUILD_FOCUS}"" == ""v0.16"" ]]; then
-            npm run full:v0.16
-            npm run linkcheck:v0.16
-        elif [[ ""${BUILD_FOCUS}"" == 'v0.19' ]]; then
-            npm run full:v0.19
-            npm run linkcheck:v0.19
-        else 
-            _exit ""Unknown build focus"" 1 
+    if [ ""${BUILD_RELEASE}"" = 'unstable' ]; then",41,2018-08-08 12:59:29,https://api.github.com/repos/hyperledger/composer/pulls/comments/208568896,https://github.com/hyperledger/composer/pull/4301#discussion_r208568896,bestbeforetoday
https://github.com/hyperledger/composer/pull/4301,https://github.com/hyperledger/composer/pull/4301,Not sure why this would fail?,4d80595dcd9346f53b24198e115b45ffc0824f81,2018-08-08 12:56:59,208569489,"@@ -39,46 +39,25 @@ if [ ""${DOCS}"" != """" ]; then
     # Build the documentation.
     npm run doc
 
-    if [[ ""${BUILD_RELEASE}"" == ""unstable"" ]]; then
-
-        if [[ ""${BUILD_FOCUS}"" == ""latest"" ]]; then
-            npm run full:unstable
-            npm run linkcheck:unstable
-        elif [[ ""${BUILD_FOCUS}"" == ""next"" ]]; then
-            npm run full:next-unstable
-            npm run linkcheck:next-unstable
-        elif [[ ""${BUILD_FOCUS}"" == ""v0.16"" ]]; then
-            npm run full:v0.16-unstable
-            npm run linkcheck:v0.16-unstable
-        elif [[ ""${BUILD_FOCUS}"" == 'v0.19' ]]; then
-            npm run full:v0.19-unstable
-            npm run linkcheck:v0.19-unstable
-        else 
-            _exit ""Unknown build focus"" 1 
-        fi
+    if [ -z ""${BUILD_FOCUS}"" ]; then
+        _exit 'No build focus' 1
+    fi
 
-    elif [[ ""${BUILD_RELEASE}"" == ""stable"" ]]; then
-
-        if [[ ""${BUILD_FOCUS}"" == ""latest"" ]]; then
-            npm run full:latest
-            npm run linkcheck:latest
-        elif [[ ""${BUILD_FOCUS}"" == ""next"" ]]; then
-            npm run full:next
-            npm run linkcheck:next
-        elif [[ ""${BUILD_FOCUS}"" == ""v0.16"" ]]; then
-            npm run full:v0.16
-            npm run linkcheck:v0.16
-        elif [[ ""${BUILD_FOCUS}"" == 'v0.19' ]]; then
-            npm run full:v0.19
-            npm run linkcheck:v0.19
-        else 
-            _exit ""Unknown build focus"" 1 
+    if [ ""${BUILD_RELEASE}"" = 'unstable' ]; then
+        if [ ""${BUILD_FOCUS}"" = 'latest' ]; then",42,2018-08-08 12:59:29,https://api.github.com/repos/hyperledger/composer/pulls/comments/208569489,https://github.com/hyperledger/composer/pull/4301#discussion_r208569489,bestbeforetoday
https://github.com/hyperledger/composer/pull/4301,https://github.com/hyperledger/composer/pull/4301,Agreed! :),4d80595dcd9346f53b24198e115b45ffc0824f81,2018-08-08 12:58:08,208569859,"@@ -39,46 +39,25 @@ if [ ""${DOCS}"" != """" ]; then
     # Build the documentation.
     npm run doc
 
-    if [[ ""${BUILD_RELEASE}"" == ""unstable"" ]]; then
-
-        if [[ ""${BUILD_FOCUS}"" == ""latest"" ]]; then
-            npm run full:unstable
-            npm run linkcheck:unstable
-        elif [[ ""${BUILD_FOCUS}"" == ""next"" ]]; then
-            npm run full:next-unstable
-            npm run linkcheck:next-unstable
-        elif [[ ""${BUILD_FOCUS}"" == ""v0.16"" ]]; then
-            npm run full:v0.16-unstable
-            npm run linkcheck:v0.16-unstable
-        elif [[ ""${BUILD_FOCUS}"" == 'v0.19' ]]; then
-            npm run full:v0.19-unstable
-            npm run linkcheck:v0.19-unstable
-        else 
-            _exit ""Unknown build focus"" 1 
-        fi
+    if [ -z ""${BUILD_FOCUS}"" ]; then
+        _exit 'No build focus' 1
+    fi
 
-    elif [[ ""${BUILD_RELEASE}"" == ""stable"" ]]; then
-
-        if [[ ""${BUILD_FOCUS}"" == ""latest"" ]]; then
-            npm run full:latest
-            npm run linkcheck:latest
-        elif [[ ""${BUILD_FOCUS}"" == ""next"" ]]; then
-            npm run full:next
-            npm run linkcheck:next
-        elif [[ ""${BUILD_FOCUS}"" == ""v0.16"" ]]; then
-            npm run full:v0.16
-            npm run linkcheck:v0.16
-        elif [[ ""${BUILD_FOCUS}"" == 'v0.19' ]]; then
-            npm run full:v0.19
-            npm run linkcheck:v0.19
-        else 
-            _exit ""Unknown build focus"" 1 
+    if [ ""${BUILD_RELEASE}"" = 'unstable' ]; then
+        if [ ""${BUILD_FOCUS}"" = 'latest' ]; then
+            BUILD_LABEL='unstable'
+        else
+            BUILD_LABEL=""${BUILD_FOCUS}-unstable""
         fi
-
+    elif [ ""${BUILD_RELEASE}"" = 'stable' ]; then
+        BUILD_LABEL=""${BUILD_FOCUS}""
     else
-       _exit ""Unkown build release or focus ${BUILD_RELEASE} ${BUILD_FOCUS}"" 1
+       _exit ""Unkown build release: ${BUILD_RELEASE}"" 1",,2018-08-08 12:59:29,https://api.github.com/repos/hyperledger/composer/pulls/comments/208569859,https://github.com/hyperledger/composer/pull/4301#discussion_r208569859,bestbeforetoday
https://github.com/hyperledger/composer/pull/4296,https://github.com/hyperledger/composer/pull/4296,"would advise keeping the quoting and equality the same as line 50... probably won't change.. but BASH is fickle
",c472f0b5b2338eda3c8ba0197af50fb34b3ba92a,2018-08-03 08:43:08,207479304,"@@ -50,6 +50,9 @@ if [ ""${DOCS}"" != """" ]; then
         elif [[ ""${BUILD_FOCUS}"" == ""v0.16"" ]]; then
             npm run full:v0.16-unstable
             npm run linkcheck:v0.16-unstable
+        elif [[ ""${BUILD_FOCUS}"" = 'v0.19' ]]; then",,2018-08-03 09:58:23,https://api.github.com/repos/hyperledger/composer/pulls/comments/207479304,https://github.com/hyperledger/composer/pull/4296#discussion_r207479304,mbwhite
https://github.com/hyperledger/composer/pull/4296,https://github.com/hyperledger/composer/pull/4296,Changed to `==` as suggested.,c472f0b5b2338eda3c8ba0197af50fb34b3ba92a,2018-08-03 09:57:14,207497981,"@@ -50,6 +50,9 @@ if [ ""${DOCS}"" != """" ]; then
         elif [[ ""${BUILD_FOCUS}"" == ""v0.16"" ]]; then
             npm run full:v0.16-unstable
             npm run linkcheck:v0.16-unstable
+        elif [[ ""${BUILD_FOCUS}"" = 'v0.19' ]]; then",,2018-08-03 09:58:23,https://api.github.com/repos/hyperledger/composer/pulls/comments/207497981,https://github.com/hyperledger/composer/pull/4296#discussion_r207497981,bestbeforetoday
https://github.com/hyperledger/composer/pull/4291,https://github.com/hyperledger/composer/pull/4291,"We should start comment on each method starting as a pascal case word. If I read the diff correctly the new sentence starts with: ""to register each""? The former sentence actually makes more sense here to me.",3619d4940c44e8b7b7d5e9a522fedd7c8560dfdb,2018-08-01 04:29:10,206752384,"@@ -722,7 +722,7 @@ function registerQueryMethods(app, dataSource, namespaces) {
 }
 
 /**
- * Register a composer named transaction method at a POST method on the REST API.",,2018-08-01 04:29:22,https://api.github.com/repos/hyperledger/composer/pulls/comments/206752384,https://github.com/hyperledger/composer/pull/4291#discussion_r206752384,akaila
https://github.com/hyperledger/composer/pull/4291,https://github.com/hyperledger/composer/pull/4291,"Suggested: If transactions return a concept, convert it to JSON",3619d4940c44e8b7b7d5e9a522fedd7c8560dfdb,2018-08-01 04:32:23,206752711,"@@ -646,10 +646,29 @@ class BusinessNetworkConnector extends Connector {
 
                             // Return the response for returning transactions
                             if (response) {
-                                // Convert JSON data to Resource if the transaction returns a Concept
-                                if (response instanceof Object && !(response instanceof Array)){
+
+                                // If transactions returns a concept, convert to JSON the Resource",,2018-08-01 04:38:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/206752711,https://github.com/hyperledger/composer/pull/4291#discussion_r206752711,akaila
https://github.com/hyperledger/composer/pull/4291,https://github.com/hyperledger/composer/pull/4291,"Minor: Second condition can be prevented if you check for Array in the first if statement
```
if (response instance of Array) {
 ...
} else if (response instance of Object){
...
}
```",3619d4940c44e8b7b7d5e9a522fedd7c8560dfdb,2018-08-01 04:33:38,206752817,"@@ -646,10 +646,29 @@ class BusinessNetworkConnector extends Connector {
 
                             // Return the response for returning transactions
                             if (response) {
-                                // Convert JSON data to Resource if the transaction returns a Concept
-                                if (response instanceof Object && !(response instanceof Array)){
+
+                                // If transactions returns a concept, convert to JSON the Resource
+                                if (response instanceof Object && !(response instanceof Array)) {",,2018-08-01 04:38:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/206752817,https://github.com/hyperledger/composer/pull/4291#discussion_r206752817,akaila
https://github.com/hyperledger/composer/pull/4291,https://github.com/hyperledger/composer/pull/4291,It seems you may need to recurse here since we can return recursive arrays as well? For example one can return an array of concepts where each concept contains another array...,3619d4940c44e8b7b7d5e9a522fedd7c8560dfdb,2018-08-01 04:37:31,206753212,"@@ -646,10 +646,29 @@ class BusinessNetworkConnector extends Connector {
 
                             // Return the response for returning transactions
                             if (response) {
-                                // Convert JSON data to Resource if the transaction returns a Concept
-                                if (response instanceof Object && !(response instanceof Array)){
+
+                                // If transactions returns a concept, convert to JSON the Resource
+                                if (response instanceof Object && !(response instanceof Array)) {
                                     return this.businessNetworkDefinition.getSerializer().toJSON(response);
+
+                                } else if (response instanceof Array) {
+                                    // If transactions returns an array of concept, convert all Concepts to JSON
+                                    let conceptArray = [];
+
+                                    response.forEach(item => {
+                                        if (item instanceof Object) {",19,2018-08-01 04:38:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/206753212,https://github.com/hyperledger/composer/pull/4291#discussion_r206753212,akaila
https://github.com/hyperledger/composer/pull/4291,https://github.com/hyperledger/composer/pull/4291,@akaila the serializer takes care of handling nested complex types/arrays. ,3619d4940c44e8b7b7d5e9a522fedd7c8560dfdb,2018-08-01 07:02:42,206773236,"@@ -646,10 +646,29 @@ class BusinessNetworkConnector extends Connector {
 
                             // Return the response for returning transactions
                             if (response) {
-                                // Convert JSON data to Resource if the transaction returns a Concept
-                                if (response instanceof Object && !(response instanceof Array)){
+
+                                // If transactions returns a concept, convert to JSON the Resource
+                                if (response instanceof Object && !(response instanceof Array)) {
                                     return this.businessNetworkDefinition.getSerializer().toJSON(response);
+
+                                } else if (response instanceof Array) {
+                                    // If transactions returns an array of concept, convert all Concepts to JSON
+                                    let conceptArray = [];
+
+                                    response.forEach(item => {
+                                        if (item instanceof Object) {",19,2018-08-01 07:02:42,https://api.github.com/repos/hyperledger/composer/pulls/comments/206773236,https://github.com/hyperledger/composer/pull/4291#discussion_r206773236,sstone1
https://github.com/hyperledger/composer/pull/4291,https://github.com/hyperledger/composer/pull/4291,"@nicolapaoli this is fine, but it could be written in less code using `Array.map` without the `conceptArray`:

```
return response.map((item) => {
    if (item instanceof Object) {
        return this.businessNetworkDefinition.getSerializer().toJSON(item);
    } else {
        return item;
    }
});
```

You don't need the `if (obj)` check as the serializer should never return `null` or `undefined`.",3619d4940c44e8b7b7d5e9a522fedd7c8560dfdb,2018-08-01 07:06:46,206774142,"@@ -646,10 +646,29 @@ class BusinessNetworkConnector extends Connector {
 
                             // Return the response for returning transactions
                             if (response) {
-                                // Convert JSON data to Resource if the transaction returns a Concept
-                                if (response instanceof Object && !(response instanceof Array)){
+
+                                // If transactions returns a concept, convert to JSON the Resource
+                                if (response instanceof Object && !(response instanceof Array)) {
                                     return this.businessNetworkDefinition.getSerializer().toJSON(response);
+
+                                } else if (response instanceof Array) {
+                                    // If transactions returns an array of concept, convert all Concepts to JSON
+                                    let conceptArray = [];
+
+                                    response.forEach(item => {
+                                        if (item instanceof Object) {",19,2018-08-01 07:07:09,https://api.github.com/repos/hyperledger/composer/pulls/comments/206774142,https://github.com/hyperledger/composer/pull/4291#discussion_r206774142,sstone1
https://github.com/hyperledger/composer/pull/4273,https://github.com/hyperledger/composer/pull/4273,I think the trailing comma is needed here for correct syntax.,01c405bf8e7180ca61c52a8e5289e24c799d9c5a,2018-07-25 10:01:51,205051547,"@@ -153,19 +152,17 @@ Here we define all the peers in all organizations in the network. Each has a uni
 ```
 ""peers"": {
     ""peer0.org1.example.com"": {
-        ""url"": ""grpc://peer0.org1.example.com:7051"",
-        ""eventUrl"": ""grpc://peer0.org1.example.com:7053""
+        ""url"": ""grpc://peer0.org1.example.com:7051""
     }
 },
 ```
 
-Peer definitions are similar to orderer definitions in structure, but you should define both the `url` and `eventUrl` of a peer. Older connection profile formats required that you only define the eventUrl for peers in your organization. Defining TLS for a peer is similar to orderers
+Peer definitions are similar to orderer definitions in structure.
 
 ```
 ""peers"": {
     ""peer0.org1.example.com"": {
-        ""url"": ""grpc://peer0.org1.example.com:7051"",
-        ""eventUrl"": ""grpc://peer0.org1.example.com:7053""
+        ""url"": ""grpc://peer0.org1.example.com:7051""",16,2018-07-25 10:11:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/205051547,https://github.com/hyperledger/composer/pull/4273#discussion_r205051547,bestbeforetoday
https://github.com/hyperledger/composer/pull/4273,https://github.com/hyperledger/composer/pull/4273,I think the trailing comma is needed here for correct syntax.,01c405bf8e7180ca61c52a8e5289e24c799d9c5a,2018-07-25 10:02:28,205051736,"@@ -293,8 +287,7 @@ For example a peer definition might look like:
 
 ```
 ""peer0.org1.example.com"": {
-    ""url"": ""grpcs://peer0.org1.example.com:7051"",
-    ""eventUrl"": ""grpcs://peer0.org1.example.com:7053""
+    ""url"": ""grpcs://peer0.org1.example.com:7051""",,2018-07-25 10:11:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/205051736,https://github.com/hyperledger/composer/pull/4273#discussion_r205051736,bestbeforetoday
https://github.com/hyperledger/composer/pull/4273,https://github.com/hyperledger/composer/pull/4273,I think the trailing comma is needed here for correct syntax.,01c405bf8e7180ca61c52a8e5289e24c799d9c5a,2018-07-25 10:02:44,205051821,"@@ -253,8 +253,7 @@ We need a base connection profile that describes this fabric network which can t
         },
         ""peers"": {
             ""peer0.org1.example.com"": {
-                ""url"": ""grpcs://localhost:7051"",
-                ""eventUrl"": ""grpcs://localhost:7053"",
+                ""url"": ""grpcs://localhost:7051""",,2018-07-25 10:11:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/205051821,https://github.com/hyperledger/composer/pull/4273#discussion_r205051821,bestbeforetoday
https://github.com/hyperledger/composer/pull/4222,https://github.com/hyperledger/composer/pull/4222,"The original example is correct - it's showing how to execute a named query by specifying the name of that query, in this case `Q1`.",07ea4f0d524974519a66e7dda76eccc306107af6,2018-07-03 07:52:51,199713502,"@@ -323,7 +323,7 @@ class Api {
          * configured with the CouchDB database for the world state.
          * @example
          * // Execute the query.
-         * return query('Q1', { inputValue: 'blue' })
+         * return query('SELECT org.example.sample.SampleAsset WHERE (value == _$inputValue)', { inputValue: 'blue' })",,2018-07-03 14:33:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/199713502,https://github.com/hyperledger/composer/pull/4222#discussion_r199713502,sstone1
https://github.com/hyperledger/composer/pull/4222,https://github.com/hyperledger/composer/pull/4222,"Ah sorry about that, I think I misunderstood what the example was trying to show. I've removed that change from my PR.",07ea4f0d524974519a66e7dda76eccc306107af6,2018-07-03 08:43:11,199728079,"@@ -323,7 +323,7 @@ class Api {
          * configured with the CouchDB database for the world state.
          * @example
          * // Execute the query.
-         * return query('Q1', { inputValue: 'blue' })
+         * return query('SELECT org.example.sample.SampleAsset WHERE (value == _$inputValue)', { inputValue: 'blue' })",,2018-07-03 14:33:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/199728079,https://github.com/hyperledger/composer/pull/4222#discussion_r199728079,bjrnt
https://github.com/hyperledger/composer/pull/4212,https://github.com/hyperledger/composer/pull/4212,"Not sure if this is the best error message. I suspect this will be hit if the URI format is invalid, rather than the scheme being invalid (which is checked a couple of lines further down).",81b576610093a87e42a0b5c40026f3ff03d494c8,2018-06-29 16:18:46,199211840,"@@ -69,16 +69,18 @@ class ResourceId {
      * @throws {Error} - On an invalid resource URI.
      */
     static fromURI(uri, legacyNamespace, legacyType) {
-        const uriComponents = URI.parse(uri, { unicodeSupport: true });
+        let uriComponents;
+        try {
+            uriComponents = URIJS.parse(uri, { unicodeSupport: true });
+        } catch (err){
+            throw new Error('Invalid URI scheme: ' + uri);",,2018-07-03 10:27:07,https://api.github.com/repos/hyperledger/composer/pulls/comments/199211840,https://github.com/hyperledger/composer/pull/4212#discussion_r199211840,bestbeforetoday
https://github.com/hyperledger/composer/pull/4212,https://github.com/hyperledger/composer/pull/4212,"I thought this check would be required to catch this unit test in `test/model/relationship.js`:
```javascript
        it('should error on invalid URI content', function() {
            (function () {
                Relationship.fromURI(modelManager, 'resource://USER:PASSWORD@HOSTNAME:PORT/org.acme.l1.Person#123');
            }).should.throw(/USER:PASSWORD@HOSTNAME:PORT/);
        });
```
I wonder if it is being caught by the parse since port numbers should be numbers rather than a string like `PORT`? In which case my test wasn't good enough and probably needs tweaking.",81b576610093a87e42a0b5c40026f3ff03d494c8,2018-06-29 16:23:22,199213012,"@@ -69,16 +69,18 @@ class ResourceId {
      * @throws {Error} - On an invalid resource URI.
      */
     static fromURI(uri, legacyNamespace, legacyType) {
-        const uriComponents = URI.parse(uri, { unicodeSupport: true });
+        let uriComponents;
+        try {
+            uriComponents = URIJS.parse(uri, { unicodeSupport: true });
+        } catch (err){
+            throw new Error('Invalid URI scheme: ' + uri);
+        }
 
-        const scheme = uriComponents.scheme;
+        const scheme = uriComponents.protocol;
         // Accept legacy identifiers with missing URI scheme as valid
         if (scheme && scheme !== RESOURCE_SCHEME) {
             throw new Error('Invalid URI scheme: ' + uri);
         }
-        if (uriComponents.userinfo || uriComponents.host || uriComponents.port || uriComponents.query) {",27,2018-07-03 10:27:07,https://api.github.com/repos/hyperledger/composer/pulls/comments/199213012,https://github.com/hyperledger/composer/pull/4212#discussion_r199213012,bestbeforetoday
https://github.com/hyperledger/composer/pull/4207,https://github.com/hyperledger/composer/pull/4207,"This seems a bit odd at the level of a class declaration, no? I suggest we make this API private for now.",279ccf6d2649d0cfe5f0ddb2c94fdcddf6407225,2018-06-29 16:13:43,199210474,"@@ -240,6 +239,8 @@ class ModelManager {
    + ConceptDeclaration[] getConceptDeclarations(Boolean) 
    + Factory getFactory() 
    + Serializer getSerializer() 
+   + DecoratorProcessor[] getDecoratorProcessors() ",,2018-06-30 12:05:42,https://api.github.com/repos/hyperledger/composer/pulls/comments/199210474,https://github.com/hyperledger/composer/pull/4207#discussion_r199210474,dselman
https://github.com/hyperledger/composer/pull/4207,https://github.com/hyperledger/composer/pull/4207,DecoratorFactory? ,279ccf6d2649d0cfe5f0ddb2c94fdcddf6407225,2018-06-29 16:15:22,199210906,"@@ -0,0 +1,40 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+/**
+ * An interface for a class that processes a decorator and returns a specific
+ * implementation class for that decorator.
+ * @private
+ * @class
+ * @memberof module:composer-common
+ */
+class DecoratorProcessor {",,2018-06-30 12:05:42,https://api.github.com/repos/hyperledger/composer/pulls/comments/199210906,https://github.com/hyperledger/composer/pull/4207#discussion_r199210906,dselman
https://github.com/hyperledger/composer/pull/4207,https://github.com/hyperledger/composer/pull/4207,"`getDecoratorProcessors()` is on `ModelManager`, not `ClassDeclaration`.",279ccf6d2649d0cfe5f0ddb2c94fdcddf6407225,2018-06-30 10:21:02,199319305,"@@ -240,6 +239,8 @@ class ModelManager {
    + ConceptDeclaration[] getConceptDeclarations(Boolean) 
    + Factory getFactory() 
    + Serializer getSerializer() 
+   + DecoratorProcessor[] getDecoratorProcessors() ",,2018-06-30 12:05:42,https://api.github.com/repos/hyperledger/composer/pulls/comments/199319305,https://github.com/hyperledger/composer/pull/4207#discussion_r199319305,sstone1
https://github.com/hyperledger/composer/pull/4207,https://github.com/hyperledger/composer/pull/4207,Oops. My bad.,279ccf6d2649d0cfe5f0ddb2c94fdcddf6407225,2018-06-30 12:36:10,199321741,"@@ -240,6 +239,8 @@ class ModelManager {
    + ConceptDeclaration[] getConceptDeclarations(Boolean) 
    + Factory getFactory() 
    + Serializer getSerializer() 
+   + DecoratorProcessor[] getDecoratorProcessors() ",,2018-06-30 12:36:11,https://api.github.com/repos/hyperledger/composer/pulls/comments/199321741,https://github.com/hyperledger/composer/pull/4207#discussion_r199321741,dselman
https://github.com/hyperledger/composer/pull/4207,https://github.com/hyperledger/composer/pull/4207,void return type seems wrong here.,279ccf6d2649d0cfe5f0ddb2c94fdcddf6407225,2018-07-02 09:50:41,199442203,"@@ -101,6 +100,15 @@ class ConceptDeclaration extends ClassDeclaration {
    + void constructor(ModelFile,Object) throws IllegalModelException
    + boolean isConcept() 
 }
+class Decorator {
+   + void constructor(Object) throws IllegalModelException
+   + void getParent() ",14,2018-07-02 09:56:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/199442203,https://github.com/hyperledger/composer/pull/4207#discussion_r199442203,dselman
https://github.com/hyperledger/composer/pull/4144,https://github.com/hyperledger/composer/pull/4144,`console.log` left in code,59b404687d7bb66af13ed639b29989572a4d0581,2018-06-14 09:31:09,195357240,"@@ -102,20 +102,17 @@ export class EditorFileComponent implements DoCheck {
     }
 
     ngDoCheck() {
-        let versionChange;
-
         if (this._editorFile && this._editorFile.isPackage()) {
-            const version = JSON.parse(this._editorFile.getContent()).version;
-            if (this.previousPackageVersion !== version) {
-                this.previousPackageVersion = version;
-                versionChange = true;
+            try {
+                console.log(this._editorFile.getContent());",,2018-06-14 15:50:11,https://api.github.com/repos/hyperledger/composer/pulls/comments/195357240,https://github.com/hyperledger/composer/pull/4144#discussion_r195357240,jt-nti
https://github.com/hyperledger/composer/pull/4144,https://github.com/hyperledger/composer/pull/4144,"Not keen on overloading the version like this. I think it would be cleaner to emit an object with a `jsonErrors` property (i.e. no errors, all good) or something along those lines.",59b404687d7bb66af13ed639b29989572a4d0581,2018-06-14 09:38:30,195359303,"@@ -203,12 +200,15 @@ export class EditorFileComponent implements DoCheck {
             } else if (this._editorFile.isPackage()) {
                 type = 'package';
                 let version;
+                let validJSON;
                 try {
                     version = JSON.parse(this.editorContent).version;
+                    validJSON = true;
                 } catch (syntaxError) {
-                    version = '';
+                    version = 'Invalid package.json';",,2018-06-14 15:50:11,https://api.github.com/repos/hyperledger/composer/pulls/comments/195359303,https://github.com/hyperledger/composer/pull/4144#discussion_r195359303,jt-nti
https://github.com/hyperledger/composer/pull/4144,https://github.com/hyperledger/composer/pull/4144,Follow on from above- show error based on whether there are package.json errors. Might be nice to replace the entire 'To:' row if there are errors?,59b404687d7bb66af13ed639b29989572a4d0581,2018-06-14 09:50:00,195362854,"@@ -86,7 +86,7 @@ <h2>Update Network</h2>
                     </svg>
                     {{inputPackageVersion}}",,2018-06-14 15:50:11,https://api.github.com/repos/hyperledger/composer/pulls/comments/195362854,https://github.com/hyperledger/composer/pull/4144#discussion_r195362854,jt-nti
https://github.com/hyperledger/composer/pull/4075,https://github.com/hyperledger/composer/pull/4075,"wondering if it would more efficient to put an if check after each call 

```
let canTxAdd = await txRegistry.testAdd(transaction);
if (canTxAdd){
   throw canTxAdd;
}
let canHistorianAdd = await historian.testAdd(record);
if (canHistorianAdd){
  throw canHistoriandAdd;
}
```",686406c6433b5f0dcbedf3338fbfacbadb49c1fb,2018-05-31 09:14:50,192036212,"@@ -43,106 +44,77 @@ class EngineTransactions {
             throw new Error(util.format('Invalid arguments ""%j"" to function ""%s"", expecting ""%j""', args, 'submitTransaction', [ 'serializedResource']));
         }
 
-        // Find the default transaction registry.
-        let registryManager = context.getRegistryManager();
-        let transaction = null;
-        let historian = null;
-        let txRegistry = null;
-
         // Parse the transaction from the JSON string..
         LOG.debug(method, 'Parsing transaction from JSON');
         let transactionData = JSON.parse(args[0]);
 
         // Now we need to convert the JavaScript object into a transaction resource.
-        LOG.debug(method, 'Parsing transaction from parsed JSON object');
-        // First we parse *our* copy, that is not resolved. This is the copy that gets added to the
+        // This is *our* copy, that is not resolved. It is the copy that gets added to the
         // transaction registry, and is the one in the context (for adding log entries).
-        transaction = context.getSerializer().fromJSON(transactionData);
+        LOG.debug(method, 'Parsing transaction from parsed JSON object');
+        const transaction = context.getSerializer().fromJSON(transactionData);
+        const txClass = transaction.getFullyQualifiedType();
 
         // Store the transaction in the context.
         context.setTransaction(transaction);
 
-        // This is the count of transaction processor functions executed.
-        let totalCount = 0;
+        // Get the transaction and historian registries
+        let registryManager = context.getRegistryManager();
+
+        LOG.debug(method, 'Getting default transaction registry for ' + txClass);
+        const txRegistry = await registryManager.get('Transaction', txClass);
+
+        LOG.debug(method, 'Getting historian registry');
+        const historian = await registryManager.get('Asset', 'org.hyperledger.composer.system.HistorianRecord');
+
+        // Form the historian record
+        const record = await this.createHistorianRecord(transaction, context);
+
+        // check that we can add to both these registries ahead of time
+        LOG.debug(method, 'Validating ability to create in Transaction and Historian registries');
+        let canTxAdd = await txRegistry.testAdd(transaction);",55,2018-05-31 09:58:36,https://api.github.com/repos/hyperledger/composer/pulls/comments/192036212,https://github.com/hyperledger/composer/pull/4075#discussion_r192036212,mbwhite
https://github.com/hyperledger/composer/pull/4073,https://github.com/hyperledger/composer/pull/4073,Signed-off-by: Rohit Sharma <rohitx007@users.noreply.github.com>,eddd777fc1b0c60728c338c1a7b37f3482ee3aad,2018-05-29 23:28:33,191604954,"@@ -22,7 +22,7 @@ module.exports.builder = {
     card: { alias: 'c', required: true, description: 'The cardname to use to upgrade the network', type:'string'},
     networkName: { alias: 'n', required: true, description: 'Name of the business network to upgrade' },
     networkVersion: { alias: 'V', required: true, description: 'Version of the business network to upgrade to' },
-    option: { alias: 'o', required: false, describe: 'Options that are specific specific to connection. Multiple options are specified by repeating this option', type: 'string' },
+    option: { alias: 'o', required: false, describe: 'Options that are specific to connection. Multiple options are specified by repeating this option', type: 'string' },",5,2018-05-29 23:30:05,https://api.github.com/repos/hyperledger/composer/pulls/comments/191604954,https://github.com/hyperledger/composer/pull/4073#discussion_r191604954,rohitx007
https://github.com/hyperledger/composer/pull/4073,https://github.com/hyperledger/composer/pull/4073,Signed-off-by: Rohit Sharma <rohitx007@users.noreply.github.com>,eddd777fc1b0c60728c338c1a7b37f3482ee3aad,2018-05-29 23:31:34,191605467,"@@ -29,7 +29,7 @@ Options:
   --card, -c                 The cardname to use to upgrade the network  [string] [required]
   --networkName, -n          Name of the business network to upgrade  [required]
   --networkVersion, -V       Version of the business network to upgrade to  [required]
-  --option, -o               Options that are specific specific to connection. Multiple options are specified by repeating this option  [string]
+  --option, -o               Options that are specific to connection. Multiple options are specified by repeating this option  [string]",5,2018-05-29 23:31:35,https://api.github.com/repos/hyperledger/composer/pulls/comments/191605467,https://github.com/hyperledger/composer/pull/4073#discussion_r191605467,rohitx007
https://github.com/hyperledger/composer/pull/4073,https://github.com/hyperledger/composer/pull/4073,Signed-off-by: Rohit Sharma <rohitx007@users.noreply.github.com>,eddd777fc1b0c60728c338c1a7b37f3482ee3aad,2018-05-29 23:31:49,191605509,"@@ -31,7 +31,7 @@ Options:
   --networkName, -n                  Name of the business network to start  [required]
   --networkVersion, -V               Version of the business network to start  [required]
   --loglevel, -l                     The initial loglevel to set  [choices: ""INFO"", ""WARNING"", ""ERROR"", ""DEBUG""]
-  --option, -o                       Options that are specific specific to connection. Multiple options are specified by repeating this option  [string]
+  --option, -o                       Options that are specific to connection. Multiple options are specified by repeating this option  [string]",5,2018-05-29 23:31:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/191605509,https://github.com/hyperledger/composer/pull/4073#discussion_r191605509,rohitx007
https://github.com/hyperledger/composer/pull/4073,https://github.com/hyperledger/composer/pull/4073,Signed-off-by: Rohit Sharma <rohitx007@users.noreply.github.com>,eddd777fc1b0c60728c338c1a7b37f3482ee3aad,2018-05-29 23:31:59,191605530,"@@ -25,7 +25,7 @@ Options:
   -v, --version              Show version number  [boolean]
   --archiveFile, -a  The business network archive file name  [string] [required]
   --card, -c         The cardname to use to install the network  [string] [required]
-  --option, -o       Options that are specific specific to connection. Multiple options are specified by repeating this option  [string]
+  --option, -o       Options that are specific to connection. Multiple options are specified by repeating this option  [string]",5,2018-05-29 23:32:00,https://api.github.com/repos/hyperledger/composer/pulls/comments/191605530,https://github.com/hyperledger/composer/pull/4073#discussion_r191605530,rohitx007
https://github.com/hyperledger/composer/pull/4073,https://github.com/hyperledger/composer/pull/4073,Signed-off-by: Rohit Sharma <rohitx007@users.noreply.github.com>,eddd777fc1b0c60728c338c1a7b37f3482ee3aad,2018-05-29 23:32:12,191605573,"@@ -32,7 +32,7 @@ Identity Options
 Options:
   --help             Show help  [boolean]
   -v, --version      Show version number  [boolean]
-  --option, -o       Options that are specific specific to connection. Multiple options are specified by repeating this option  [string]
+  --option, -o       Options that are specific to connection. Multiple options are specified by repeating this option  [string]",5,2018-05-29 23:32:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/191605573,https://github.com/hyperledger/composer/pull/4073#discussion_r191605573,rohitx007
https://github.com/hyperledger/composer/pull/4073,https://github.com/hyperledger/composer/pull/4073,Signed-off-by: Rohit Sharma <rohitx007@users.noreply.github.com>,eddd777fc1b0c60728c338c1a7b37f3482ee3aad,2018-05-29 23:32:45,191605650,"@@ -24,7 +24,7 @@ module.exports.builder = function (yargs) {
         networkName: { alias: 'n', required: true, description: 'Name of the business network to start' },
         networkVersion: { alias: 'V', required: true, description: 'Version of the business network to start' },
         loglevel: { alias: 'l', required: false, describe: 'The initial loglevel to set', choices : ['INFO', 'WARNING', 'ERROR', 'DEBUG']},
-        option: { alias: 'o', required: false, describe: 'Options that are specific specific to connection. Multiple options are specified by repeating this option', type: 'string' },
+        option: { alias: 'o', required: false, describe: 'Options that are specific to connection. Multiple options are specified by repeating this option', type: 'string' },",5,2018-05-29 23:32:45,https://api.github.com/repos/hyperledger/composer/pulls/comments/191605650,https://github.com/hyperledger/composer/pull/4073#discussion_r191605650,rohitx007
https://github.com/hyperledger/composer/pull/4073,https://github.com/hyperledger/composer/pull/4073,Signed-off-by: Rohit Sharma <rohitx007@users.noreply.github.com>,eddd777fc1b0c60728c338c1a7b37f3482ee3aad,2018-05-29 23:32:57,191605677,"@@ -21,7 +21,7 @@ module.exports.describe = 'Installs a business network archive to Hyperledger Fa
 module.exports.builder = {
     archiveFile: {alias: 'a', required: true, describe: 'The business network archive file name', type: 'string' },
     card: { alias: 'c', required: true, describe: 'The cardname to use to install the network', type:'string'},
-    option: { alias: 'o', required: false, describe: 'Options that are specific specific to connection. Multiple options are specified by repeating this option', type: 'string' },
+    option: { alias: 'o', required: false, describe: 'Options that are specific to connection. Multiple options are specified by repeating this option', type: 'string' },",5,2018-05-29 23:32:57,https://api.github.com/repos/hyperledger/composer/pulls/comments/191605677,https://github.com/hyperledger/composer/pull/4073#discussion_r191605677,rohitx007
https://github.com/hyperledger/composer/pull/4073,https://github.com/hyperledger/composer/pull/4073,Signed-off-by: Rohit Sharma <rohitx007@users.noreply.github.com>,eddd777fc1b0c60728c338c1a7b37f3482ee3aad,2018-05-29 23:33:07,191605702,"@@ -22,7 +22,7 @@ module.exports.builder =function (yargs) {
         'newUserId': { alias: 'u', required: false, describe: 'The user ID for the new identity', type: 'string' },
         'participantId': { alias: 'a', required: true, describe: 'The participant to issue the new identity to', type: 'string' },
         'issuer': { alias: 'x', required: false, describe: 'If the new identity should be able to issue other new identities', type: 'boolean' },
-        'option': { alias: 'o', required: false, describe: 'Options that are specific specific to connection. Multiple options are specified by repeating this option', type: 'string' },
+        'option': { alias: 'o', required: false, describe: 'Options that are specific to connection. Multiple options are specified by repeating this option', type: 'string' },",5,2018-05-29 23:33:08,https://api.github.com/repos/hyperledger/composer/pulls/comments/191605702,https://github.com/hyperledger/composer/pull/4073#discussion_r191605702,rohitx007
https://github.com/hyperledger/composer/pull/4068,https://github.com/hyperledger/composer/pull/4068,ðŸ˜‚ ,b237b9acae6c835864b76e26d9d007117c414a40,2018-05-29 08:38:30,191343895,"@@ -66,7 +66,6 @@ class RouterStub {
     }
 
     set eventParams(event) {
-        console.log('I AM A CHICKEN');",26,2018-05-29 14:08:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/191343895,https://github.com/hyperledger/composer/pull/4068#discussion_r191343895,sstone1
https://github.com/hyperledger/composer/pull/4055,https://github.com/hyperledger/composer/pull/4055,"This won't be enough - you need to import the `maeid1@network` business network card into your wallet using an `AdminConnection` object, and then you can connect to it.

The code here should be equivalent to the CLI instructions below:
```
   composer card import -f maeid1@network.card
   composer network ping -c maeid1@network
```
",d941ae6ff6bc783262c132e04d7cc8dcb0342267,2018-05-25 09:30:27,190839971,"@@ -73,7 +73,7 @@ The example assumes that an instance, `net.biz.digitalPropertyNetwork#mae@biznet
   async function testConnection() {
       let businessNetworkConnection = new BusinessNetworkConnection();
       try {
-          await businessNetworkConnection.connect('admin@digitalPropertyNetwork');
+          await businessNetworkConnection.connect('maeid1@network');",5,2018-05-25 09:30:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/190839971,https://github.com/hyperledger/composer/pull/4055#discussion_r190839971,sstone1
https://github.com/hyperledger/composer/pull/3984,https://github.com/hyperledger/composer/pull/3984,more out of curiosity - doesn't a return null from an async function implicitly become a promise that is resolved with null?,848eaf9e9c4cdbe99237623b95d0f2567037f39e,2018-05-15 08:39:36,188206503,"@@ -359,11 +438,10 @@ class EmbeddedConnection extends Connection {
      * Create a new transaction id
      * Note: as this is not a real fabric it returns null to let the composer-common use uuid to create one.
      * @param {SecurityContext} securityContext The participant's security context.
-     * @return {Promise} A promise that is resolved with a generated user
-     * secret once the new identity has been created, or rejected with an error.
+     * @return {Promise} A promise that is resolved with a null
      */
     async createTransactionId(securityContext) {
-        return null;
+        return Promise.resolve(null);",,2018-05-15 15:38:04,https://api.github.com/repos/hyperledger/composer/pulls/comments/188206503,https://github.com/hyperledger/composer/pull/3984#discussion_r188206503,mbwhite
https://github.com/hyperledger/composer/pull/3926,https://github.com/hyperledger/composer/pull/3926,I think this really should be either a _for...of_ loop or `files.forEach(...)`,b686393b185aa52d337047dedfb61109726fad7d,2018-04-30 14:04:27,184995641,"@@ -214,10 +214,33 @@ class Composer {
         }
     }
 
+    /**
+     * Get all files recursively in a directoy
+     * @param {String} dir directory to search
+     * @param {String[]} fileList file list to append
+     * @returns {String[]} list of files in directory
+     */
+    getFilesInDirectory(dir, fileList){
+        fileList = fileList || [];
+        let files = fs.readdirSync(dir);
+        for(let i in files){",,2018-04-30 15:38:03,https://api.github.com/repos/hyperledger/composer/pulls/comments/184995641,https://github.com/hyperledger/composer/pull/3926#discussion_r184995641,bestbeforetoday
https://github.com/hyperledger/composer/pull/3919,https://github.com/hyperledger/composer/pull/3919,Probably just me but that text seems a bit confusing. I haven't come up with anything more descriptive though!,c401a1151eeffbfe11ba3a4401ec8cb145a83f63,2018-04-25 15:53:08,184113215,"@@ -696,6 +707,15 @@ describe('IdentityCardService', () => {
             result.should.equal('uuid1xxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx');
         }));
 
+        it('should get the first available card that has the required role when the passed qualified profile name does not match that of the card', inject([IdentityCardService], (service: IdentityCardService) => {",,2018-04-26 08:38:22,https://api.github.com/repos/hyperledger/composer/pulls/comments/184113215,https://github.com/hyperledger/composer/pull/3919#discussion_r184113215,jt-nti
https://github.com/hyperledger/composer/pull/3919,https://github.com/hyperledger/composer/pull/3919,Left over `console.log`,c401a1151eeffbfe11ba3a4401ec8cb145a83f63,2018-04-25 15:53:44,184113493,"@@ -85,10 +85,13 @@ export class IdentityCardService {
     public getAdminCardRef(qualifiedProfileName: string, role: string): string {
         let result;
 
-        if (this.currentCard && this.getCurrentIdentityCard().getRoles().includes(role)) {
+        console.log('I HAVE RETURNED WITH', this.getQualifiedProfileName(this.getCurrentIdentityCard().getConnectionProfile()));",,2018-04-26 08:38:22,https://api.github.com/repos/hyperledger/composer/pulls/comments/184113493,https://github.com/hyperledger/composer/pull/3919#discussion_r184113493,jt-nti
https://github.com/hyperledger/composer/pull/3919,https://github.com/hyperledger/composer/pull/3919,Left over `console.log`,c401a1151eeffbfe11ba3a4401ec8cb145a83f63,2018-04-25 15:53:51,184113540,"@@ -85,10 +85,13 @@ export class IdentityCardService {
     public getAdminCardRef(qualifiedProfileName: string, role: string): string {
         let result;
 
-        if (this.currentCard && this.getCurrentIdentityCard().getRoles().includes(role)) {
+        console.log('I HAVE RETURNED WITH', this.getQualifiedProfileName(this.getCurrentIdentityCard().getConnectionProfile()));
+
+        if (this.currentCard && this.getCurrentIdentityCard().getRoles().includes(role) && this.getQualifiedProfileName(this.getCurrentIdentityCard().getConnectionProfile()) === qualifiedProfileName) {
             // Prefer the current card if it has the required role
             result = this.getCurrentCardRef();
         } else {
+            console.log('WHICH BIT FAILED', this.currentCard, this.getCurrentIdentityCard().getRoles().includes(role), this.getQualifiedProfileName(this.getCurrentIdentityCard().getConnectionProfile()) === qualifiedProfileName);",,2018-04-26 08:38:22,https://api.github.com/repos/hyperledger/composer/pulls/comments/184113540,https://github.com/hyperledger/composer/pull/3919#discussion_r184113540,jt-nti
https://github.com/hyperledger/composer/pull/3908,https://github.com/hyperledger/composer/pull/3908,Needs license header,40c10fae0606973e98b0358c9a6004f071459a36,2018-04-27 05:20:57,184594275,"@@ -0,0 +1,231 @@
+// Pull out information",15,2018-04-27 15:16:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/184594275,https://github.com/hyperledger/composer/pull/3908#discussion_r184594275,sstone1
https://github.com/hyperledger/composer/pull/3908,https://github.com/hyperledger/composer/pull/3908,Thereâ€™s more than just this!,40c10fae0606973e98b0358c9a6004f071459a36,2018-04-27 05:22:26,184594412,"@@ -0,0 +1,231 @@
+// Pull out information",15,2018-04-27 15:16:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/184594412,https://github.com/hyperledger/composer/pull/3908#discussion_r184594412,sstone1
https://github.com/hyperledger/composer/pull/3875,https://github.com/hyperledger/composer/pull/3875,ðŸ˜ at all this deleted code,89acf9bd1160ae188865a8f22f8ec3c48ce1a90f,2018-04-20 10:46:05,183013445,"@@ -515,57 +515,38 @@ class QueryCompiler {
         let left = this.visit(ast.left, parameters);
         let right = this.visit(ast.right, parameters);
 
-        // Build the Mango selector for this operator.",22,2018-04-20 10:46:05,https://api.github.com/repos/hyperledger/composer/pulls/comments/183013445,https://github.com/hyperledger/composer/pull/3875#discussion_r183013445,sstone1
https://github.com/hyperledger/composer/pull/3847,https://github.com/hyperledger/composer/pull/3847,"This change is not necessary, install can still generate a transaction id as it does before as there is no interaction with a business network here.",c552af9eb3cc6e7946ad9c2208859ce63977bb6e,2018-04-13 14:54:50,181414203,"@@ -472,7 +472,7 @@ class HLFConnection extends Connection {
             }
         }
 
-        let txId = this.client.newTransactionID();
+        let txId = this._validateTxId(installOptions);",,2018-05-09 13:28:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/181414203,https://github.com/hyperledger/composer/pull/3847#discussion_r181414203,davidkel
https://github.com/hyperledger/composer/pull/3847,https://github.com/hyperledger/composer/pull/3847,thanks @davidkel  I've reverted this change,c552af9eb3cc6e7946ad9c2208859ce63977bb6e,2018-04-16 08:33:54,181658317,"@@ -472,7 +472,7 @@ class HLFConnection extends Connection {
             }
         }
 
-        let txId = this.client.newTransactionID();
+        let txId = this._validateTxId(installOptions);",,2018-05-09 13:28:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/181658317,https://github.com/hyperledger/composer/pull/3847#discussion_r181658317,mbwhite
https://github.com/hyperledger/composer/pull/3847,https://github.com/hyperledger/composer/pull/3847,Isn't the serializer only needed if the transaction passed is a resource and not pure JSON ? and thus is optional. But surely optional parameters should come last as well. What if I want to submit a transaction with a different function name and pass in pure json ?,c552af9eb3cc6e7946ad9c2208859ce63977bb6e,2018-05-08 13:14:02,186721764,"@@ -96,6 +96,35 @@ class Util {
         return securityContext.getConnection().invokeChainCode(securityContext, functionName, args, options);
     }
 
+    /**
+     * Takes a json structure of a transaction, and processes this for transaction id
+     * Passes it on to the invokeChainCode fn
+     *
+     * @param {SecurityContext} securityContext - The user's security context
+     * @param {resource|object} transaction - the transaction
+     * @param {Serializer} serializer  needed if the transaction passed is not a resource but pure json",,2018-05-09 13:28:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/186721764,https://github.com/hyperledger/composer/pull/3847#discussion_r186721764,davidkel
https://github.com/hyperledger/composer/pull/3847,https://github.com/hyperledger/composer/pull/3847,maybe this should just accept the transaction id rather than an object containing the transaction id ?,c552af9eb3cc6e7946ad9c2208859ce63977bb6e,2018-05-08 13:17:45,186722825,"@@ -1180,6 +1170,28 @@ class HLFConnection extends Connection {
      */
     getNativeAPI() {
         return this.client;
+
+    }
+
+    /** Based on the options passed in, determine the transaction id that is to be used
+     * @param {Object} options options to process
+     * @return {TransactionId} transactionId object
+     */
+    _validateTxId(options){",42,2018-05-09 13:28:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/186722825,https://github.com/hyperledger/composer/pull/3847#discussion_r186722825,davidkel
https://github.com/hyperledger/composer/pull/3847,https://github.com/hyperledger/composer/pull/3847,Any reason for these NODE_CONFIG entries ? is it something required everywhere ?,c552af9eb3cc6e7946ad9c2208859ce63977bb6e,2018-05-08 13:19:27,186723280,"@@ -11,14 +11,14 @@
   ""scripts"": {
     ""prepublish"": ""node ./scripts/tsgen.js"",
     ""pretest"": ""npm run lint"",
-    ""test"": ""node ./scripts/api-changelog.js && nyc mocha --recursive -t 10000"",
+    ""test"": ""node ./scripts/api-changelog.js && NODE_CONFIG={} nyc mocha --recursive -t 10000"",",,2018-05-09 13:28:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/186723280,https://github.com/hyperledger/composer/pull/3847#discussion_r186723280,davidkel
https://github.com/hyperledger/composer/pull/3847,https://github.com/hyperledger/composer/pull/3847,don't think these checks and console logs are required.,c552af9eb3cc6e7946ad9c2208859ce63977bb6e,2018-05-08 13:20:44,186723640,"@@ -813,10 +813,17 @@ describe('BusinessNetworkConnection', () => {
 
             // Create the transaction.
             const tx = factory.newTransaction('org.acme.sample', 'SampleTransaction');
+            if (tx instanceof Resource){",,2018-05-09 13:28:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/186723640,https://github.com/hyperledger/composer/pull/3847#discussion_r186723640,davidkel
https://github.com/hyperledger/composer/pull/3847,https://github.com/hyperledger/composer/pull/3847,this looks like we are not getting the right info through here if checking for undefined.,c552af9eb3cc6e7946ad9c2208859ce63977bb6e,2018-05-08 13:22:38,186724226,"@@ -202,32 +203,35 @@ describe('Connection', () => {
             sinon.assert.called(Util.queryChainCode);
         });
 
-        it('should handle valid data', async () => {
+        it('should handle valid data - 2', async () => {
             const buffer = Buffer.from(JSON.stringify({
                 data: 'aGVsbG8='
             }));
 
             const buffer2 = Buffer.from(JSON.stringify({
                 data: 'aGsad33VsbG8='
             }));
+
             sandbox.stub(Util, 'queryChainCode').withArgs(mockSecurityContext, 'getBusinessNetwork', []).resolves(buffer);
             sandbox.stub(Util, 'invokeChainCode').resolves();
             sandbox.stub(BusinessNetworkDefinition, 'fromArchive').resolves(mockBusinessNetworkDefinition);
             mockBusinessNetworkDefinition.toArchive.resolves(buffer2);
             let mockFactory = sinon.createStubInstance(Factory);
             let mockSerializer = sinon.createStubInstance(Serializer);
             let mockTransaction = sinon.createStubInstance(Resource);
+            mockTransaction.getIdentifier.returns(null);
+            mockTransaction.timestamp = new Date().toISOString();
 
             mockFactory.newTransaction.returns(mockTransaction);
             mockBusinessNetworkDefinition.getFactory.returns(mockFactory);
             mockBusinessNetworkDefinition.getSerializer.returns(mockSerializer);
             mockBusinessNetworkDefinition.getName.returns('acme-network');
-            mockTransaction.getIdentifier.returns(null);
-            mockTransaction.timestamp=new Date();
+
 
             await connection.reset(mockSecurityContext,'acme-network');
             sinon.assert.called(Util.invokeChainCode);
             sinon.assert.called(Util.queryChainCode);
+            sinon.assert.calledWith(Util.invokeChainCode,mockSecurityContext,'submitTransaction',[undefined],{transactionId:undefined});",,2018-05-09 13:28:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/186724226,https://github.com/hyperledger/composer/pull/3847#discussion_r186724226,davidkel
https://github.com/hyperledger/composer/pull/3847,https://github.com/hyperledger/composer/pull/3847,"~Order of parameters modified, and~ Adjusted comment to clarify that these are both in fact optional;. tried altering the order but then you'd often end up passing  `undefined` instead of the transaction name - as that is used less frequently than the serializer",c552af9eb3cc6e7946ad9c2208859ce63977bb6e,2018-05-09 08:30:39,186968604,"@@ -96,6 +96,35 @@ class Util {
         return securityContext.getConnection().invokeChainCode(securityContext, functionName, args, options);
     }
 
+    /**
+     * Takes a json structure of a transaction, and processes this for transaction id
+     * Passes it on to the invokeChainCode fn
+     *
+     * @param {SecurityContext} securityContext - The user's security context
+     * @param {resource|object} transaction - the transaction
+     * @param {Serializer} serializer  needed if the transaction passed is not a resource but pure json",,2018-05-09 13:28:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/186968604,https://github.com/hyperledger/composer/pull/3847#discussion_r186968604,mbwhite
https://github.com/hyperledger/composer/pull/3847,https://github.com/hyperledger/composer/pull/3847,it could; fabric client typically is treating this as a object so I was following suit.,c552af9eb3cc6e7946ad9c2208859ce63977bb6e,2018-05-09 08:34:48,186969607,"@@ -1180,6 +1170,28 @@ class HLFConnection extends Connection {
      */
     getNativeAPI() {
         return this.client;
+
+    }
+
+    /** Based on the options passed in, determine the transaction id that is to be used
+     * @param {Object} options options to process
+     * @return {TransactionId} transactionId object
+     */
+    _validateTxId(options){",42,2018-05-09 13:28:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/186969607,https://github.com/hyperledger/composer/pull/3847#discussion_r186969607,mbwhite
https://github.com/hyperledger/composer/pull/3847,https://github.com/hyperledger/composer/pull/3847,removed,c552af9eb3cc6e7946ad9c2208859ce63977bb6e,2018-05-09 08:37:21,186970259,"@@ -11,14 +11,14 @@
   ""scripts"": {
     ""prepublish"": ""node ./scripts/tsgen.js"",
     ""pretest"": ""npm run lint"",
-    ""test"": ""node ./scripts/api-changelog.js && nyc mocha --recursive -t 10000"",
+    ""test"": ""node ./scripts/api-changelog.js && NODE_CONFIG={} nyc mocha --recursive -t 10000"",",,2018-05-09 13:28:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/186970259,https://github.com/hyperledger/composer/pull/3847#discussion_r186970259,mbwhite
https://github.com/hyperledger/composer/pull/3847,https://github.com/hyperledger/composer/pull/3847,removed,c552af9eb3cc6e7946ad9c2208859ce63977bb6e,2018-05-09 08:37:24,186970285,"@@ -813,10 +813,17 @@ describe('BusinessNetworkConnection', () => {
 
             // Create the transaction.
             const tx = factory.newTransaction('org.acme.sample', 'SampleTransaction');
+            if (tx instanceof Resource){",,2018-05-09 13:28:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/186970285,https://github.com/hyperledger/composer/pull/3847#discussion_r186970285,mbwhite
https://github.com/hyperledger/composer/pull/3847,https://github.com/hyperledger/composer/pull/3847,"Spent 10 minutes looking at that test and couldn't see what it was adding 
Removed it as it didn't seem to be adding anything.

Coverage has been maitained.",c552af9eb3cc6e7946ad9c2208859ce63977bb6e,2018-05-09 09:10:28,186979363,"@@ -202,32 +203,35 @@ describe('Connection', () => {
             sinon.assert.called(Util.queryChainCode);
         });
 
-        it('should handle valid data', async () => {
+        it('should handle valid data - 2', async () => {
             const buffer = Buffer.from(JSON.stringify({
                 data: 'aGVsbG8='
             }));
 
             const buffer2 = Buffer.from(JSON.stringify({
                 data: 'aGsad33VsbG8='
             }));
+
             sandbox.stub(Util, 'queryChainCode').withArgs(mockSecurityContext, 'getBusinessNetwork', []).resolves(buffer);
             sandbox.stub(Util, 'invokeChainCode').resolves();
             sandbox.stub(BusinessNetworkDefinition, 'fromArchive').resolves(mockBusinessNetworkDefinition);
             mockBusinessNetworkDefinition.toArchive.resolves(buffer2);
             let mockFactory = sinon.createStubInstance(Factory);
             let mockSerializer = sinon.createStubInstance(Serializer);
             let mockTransaction = sinon.createStubInstance(Resource);
+            mockTransaction.getIdentifier.returns(null);
+            mockTransaction.timestamp = new Date().toISOString();
 
             mockFactory.newTransaction.returns(mockTransaction);
             mockBusinessNetworkDefinition.getFactory.returns(mockFactory);
             mockBusinessNetworkDefinition.getSerializer.returns(mockSerializer);
             mockBusinessNetworkDefinition.getName.returns('acme-network');
-            mockTransaction.getIdentifier.returns(null);
-            mockTransaction.timestamp=new Date();
+
 
             await connection.reset(mockSecurityContext,'acme-network');
             sinon.assert.called(Util.invokeChainCode);
             sinon.assert.called(Util.queryChainCode);
+            sinon.assert.calledWith(Util.invokeChainCode,mockSecurityContext,'submitTransaction',[undefined],{transactionId:undefined});",,2018-05-09 13:28:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/186979363,https://github.com/hyperledger/composer/pull/3847#discussion_r186979363,mbwhite
https://github.com/hyperledger/composer/pull/3798,https://github.com/hyperledger/composer/pull/3798,Why is not in `devDependencies` like the other ones?,438f28ace8dc917f596fcc7187ef9178987d4feb,2018-04-13 05:28:19,181288465,"@@ -72,8 +72,10 @@
       }
     }
   },
+  ""peerDependencies"": {
+    ""composer-common"": ""0.19.1""
+  },  
   ""dependencies"": {
-    ""composer-common"": ""0.19.1"",",,2018-04-27 09:14:20,https://api.github.com/repos/hyperledger/composer/pulls/comments/181288465,https://github.com/hyperledger/composer/pull/3798#discussion_r181288465,sstone1
https://github.com/hyperledger/composer/pull/3798,https://github.com/hyperledger/composer/pull/3798,Why is not in devDependencies like the other ones?,438f28ace8dc917f596fcc7187ef9178987d4feb,2018-04-13 05:28:40,181288495,"@@ -76,8 +76,10 @@
       }
     }
   },
+  ""peerDependencies"": {
+    ""composer-common"": ""0.19.1""
+  },
   ""dependencies"": {
-    ""composer-common"": ""0.19.1"",",,2018-04-27 09:14:20,https://api.github.com/repos/hyperledger/composer/pulls/comments/181288495,https://github.com/hyperledger/composer/pull/3798#discussion_r181288495,sstone1
https://github.com/hyperledger/composer/pull/3798,https://github.com/hyperledger/composer/pull/3798,Why is not in devDependencies like the other ones?,438f28ace8dc917f596fcc7187ef9178987d4feb,2018-04-13 05:28:48,181288503,"@@ -76,10 +76,10 @@
       }
     }
   },
+  ""peerDependencies"": {
+    ""composer-common"": ""0.19.1""
+  },
   ""dependencies"": {
-    ""composer-common"": ""0.19.1"",",,2018-04-27 09:14:20,https://api.github.com/repos/hyperledger/composer/pulls/comments/181288503,https://github.com/hyperledger/composer/pull/3798#discussion_r181288503,sstone1
https://github.com/hyperledger/composer/pull/3764,https://github.com/hyperledger/composer/pull/3764,"This should be ""API key"", not ""apikey"".",6944a6e9ad713959e75deab2a8ba35555c219388,2018-04-16 13:33:30,181734726,"@@ -32,6 +32,7 @@ const yargs = require('yargs')
     .option('c', { alias: 'card', describe: 'The name of the business network card to use', type: 'string', default: process.env.COMPOSER_CARD || undefined })
     .option('n', { alias: 'namespaces', describe: 'Use namespaces if conflicting types exist', type: 'string', default: process.env.COMPOSER_NAMESPACES || 'always', choices: ['always', 'required', 'never'] })
     .option('p', { alias: 'port', describe: 'The port to serve the REST API on', type: 'number', default: process.env.COMPOSER_PORT || undefined })
+    .option('y', { alias: 'apikey', describe: 'The apikey to get access to the REST API', type: 'string', default: process.env.COMPOSER_APIKEY || undefined })",,2018-04-18 17:02:45,https://api.github.com/repos/hyperledger/composer/pulls/comments/181734726,https://github.com/hyperledger/composer/pull/3764#discussion_r181734726,sstone1
https://github.com/hyperledger/composer/pull/3764,https://github.com/hyperledger/composer/pull/3764,"This should be ""API key"", not ""APIKEY"".",6944a6e9ad713959e75deab2a8ba35555c219388,2018-04-16 13:36:09,181735481,"@@ -58,6 +58,15 @@ class Util {
                 ],
                 default: 'always'
             },
+            {
+                name: 'apikey',
+                type: 'string',
+                message: 'Enter the APIKEY to access the REST API:',",,2018-04-18 17:02:45,https://api.github.com/repos/hyperledger/composer/pulls/comments/181735481,https://github.com/hyperledger/composer/pull/3764#discussion_r181735481,sstone1
https://github.com/hyperledger/composer/pull/3764,https://github.com/hyperledger/composer/pull/3764,"You don't need the checks for `undefined` or the empty string:

```
$ node -e 'console.log(!!undefined)'
false
```

```
$ node -e 'console.log(!!"""")'
false
```",6944a6e9ad713959e75deab2a8ba35555c219388,2018-04-16 13:37:17,181735851,"@@ -93,6 +93,20 @@ module.exports = function (composer) {
             extended: true,
         }));
 
+        // This configuration is required if an ApiKey is specified.
+        const apikey = !!composer.apikey;
+
+        if (apikey && composer.apikey !== undefined && composer.apikey !== '') {",,2018-04-18 17:02:45,https://api.github.com/repos/hyperledger/composer/pulls/comments/181735851,https://github.com/hyperledger/composer/pull/3764#discussion_r181735851,sstone1
https://github.com/hyperledger/composer/pull/3764,https://github.com/hyperledger/composer/pull/3764,This test should be testing the API key functionality only; there should be no authentication and LDAP stuff in this test.,6944a6e9ad713959e75deab2a8ba35555c219388,2018-04-16 13:38:07,181736123,"@@ -0,0 +1,359 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+
+const BusinessNetworkDefinition = require('composer-common').BusinessNetworkDefinition;
+const IdCard = require('composer-common').IdCard;
+require('loopback-component-passport');
+const ldapserver = require('./ldapserver');
+const server = require('../server/server');
+const chai = require('chai');
+chai.should();
+chai.use(require('chai-http'));
+
+
+describe('Access with APIKEY unit tests', () => {
+
+    const APIKEY = 'CUSTOMAPIKEY';
+    let app;
+    let appAuth;
+    let idCard;
+    let adminConnection;
+
+    before(() => {
+        const cardStore = require('composer-common').NetworkCardStoreManager.getCardStore( { type: 'composer-wallet-inmemory' } );
+        adminConnection = new AdminConnection({ cardStore });
+        let metadata = { version:1, userName: 'admin', enrollmentSecret: 'adminpw', roles: ['PeerAdmin', 'ChannelAdmin'] };
+        const deployCardName = 'deployer-card';
+
+        let idCard_PeerAdmin = new IdCard(metadata, {'x-type' : 'embedded',name:'defaultProfile'});
+        let businessNetworkDefinition;
+
+        return adminConnection.importCard(deployCardName, idCard_PeerAdmin)
+            .then(() => {
+                return adminConnection.connect(deployCardName);
+            })
+            .then(() => {
+                return BusinessNetworkDefinition.fromDirectory('./test/data/bond-network');
+            })
+            .then((result) => {
+                businessNetworkDefinition = result;
+                return adminConnection.install(businessNetworkDefinition);
+            })
+            .then(()=>{
+                return adminConnection.start(businessNetworkDefinition.getName(), businessNetworkDefinition.getVersion(), {networkAdmins :[{userName:'admin',enrollmentSecret:'adminpw'}] });
+            })
+            .then(() => {
+                idCard = new IdCard({ userName: 'admin', enrollmentSecret: 'adminpw', businessNetwork: 'bond-network' }, { name: 'defaultProfile', 'x-type': 'embedded' });
+                return adminConnection.importCard('admin@bond-network', idCard);
+            })
+            .then(() => {
+                return ldapserver.start();
+            })
+            .then((ldapport) => {
+                process.env.COMPOSER_PROVIDERS = JSON.stringify({",,2018-04-18 17:02:45,https://api.github.com/repos/hyperledger/composer/pulls/comments/181736123,https://github.com/hyperledger/composer/pull/3764#discussion_r181736123,sstone1
https://github.com/hyperledger/composer/pull/3764,https://github.com/hyperledger/composer/pull/3764,"This should be ""API key"", not ""apikey"", can you fix the spacing around `[default:undefined]` as per the below one?",6944a6e9ad713959e75deab2a8ba35555c219388,2018-04-16 13:41:19,181737233,"@@ -62,6 +62,7 @@ Options:
   -c, --card            The name of the business network card to use  [string]
   -n, --namespaces      Use namespaces if conflicting types exist  [string] [choices: ""always"", ""required"", ""never""] [default: ""always""]
   -p, --port            The port to serve the REST API on  [number]
+  -y, --apikey          The apikey to get access to the REST API [string][default:undefined]",,2018-04-18 17:02:45,https://api.github.com/repos/hyperledger/composer/pulls/comments/181737233,https://github.com/hyperledger/composer/pull/3764#discussion_r181737233,sstone1
https://github.com/hyperledger/composer/pull/3764,https://github.com/hyperledger/composer/pull/3764,"This should be ""API key"", not ""APIKEY"".",6944a6e9ad713959e75deab2a8ba35555c219388,2018-04-16 13:41:29,181737293,"@@ -78,11 +79,24 @@ Launch your browser and go to the URL given (http://0.0.0.0:3000/explorer).  You
 
 ![LoopBack-1](../assets/img/tutorials/developer/lb_explorer.png)
 
+
 ## Updating the REST server
 
 After updating a business network definition, the REST server can be updated to generate new APIs reflecting the updates to the business network definition.
 
 To update the REST server, first the REST server must be stopped using `ctrl-C`. Then the REST server can be restarted using `composer-rest-server`.
 
+
+## Generating a REST API with an APIKEY 
+
+An APIKEY can be used to provide a first layer of security to access the REST API in development environment.",,2018-04-18 17:02:45,https://api.github.com/repos/hyperledger/composer/pulls/comments/181737293,https://github.com/hyperledger/composer/pull/3764#discussion_r181737293,sstone1
https://github.com/hyperledger/composer/pull/3764,https://github.com/hyperledger/composer/pull/3764,"This should be ""API key"", not ""APIKEY"".",6944a6e9ad713959e75deab2a8ba35555c219388,2018-04-16 13:41:37,181737341,"@@ -108,4 +108,12 @@ The REST server can be configured using environment variables, instead of supply
 
     For example:
 
-        COMPOSER_TLS_KEY=/tmp/key.pem
\ No newline at end of file
+        COMPOSER_TLS_KEY=/tmp/key.pem
+        
+9. `COMPOSER_APIKEY`
+        
+        You can use the `COMPOSER_APIKEY` environment variable to specify the APIKEY the server should accept for each request as a header parameter `x-api-key`.",,2018-04-18 17:02:45,https://api.github.com/repos/hyperledger/composer/pulls/comments/181737341,https://github.com/hyperledger/composer/pull/3764#discussion_r181737341,sstone1
https://github.com/hyperledger/composer/pull/3764,https://github.com/hyperledger/composer/pull/3764,"Thanks @sstone1 for the review.
The idea here was to split the test in two main parts, as the API Key can be used either with or without Authentication. 
The LDAP server is set up at the beginning, but used only when Auth is enabled.

As this might be part of a more specific integration test, I'll change it to focus only on the API Key as suggested.",6944a6e9ad713959e75deab2a8ba35555c219388,2018-04-16 17:14:00,181819126,"@@ -0,0 +1,359 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+
+const BusinessNetworkDefinition = require('composer-common').BusinessNetworkDefinition;
+const IdCard = require('composer-common').IdCard;
+require('loopback-component-passport');
+const ldapserver = require('./ldapserver');
+const server = require('../server/server');
+const chai = require('chai');
+chai.should();
+chai.use(require('chai-http'));
+
+
+describe('Access with APIKEY unit tests', () => {
+
+    const APIKEY = 'CUSTOMAPIKEY';
+    let app;
+    let appAuth;
+    let idCard;
+    let adminConnection;
+
+    before(() => {
+        const cardStore = require('composer-common').NetworkCardStoreManager.getCardStore( { type: 'composer-wallet-inmemory' } );
+        adminConnection = new AdminConnection({ cardStore });
+        let metadata = { version:1, userName: 'admin', enrollmentSecret: 'adminpw', roles: ['PeerAdmin', 'ChannelAdmin'] };
+        const deployCardName = 'deployer-card';
+
+        let idCard_PeerAdmin = new IdCard(metadata, {'x-type' : 'embedded',name:'defaultProfile'});
+        let businessNetworkDefinition;
+
+        return adminConnection.importCard(deployCardName, idCard_PeerAdmin)
+            .then(() => {
+                return adminConnection.connect(deployCardName);
+            })
+            .then(() => {
+                return BusinessNetworkDefinition.fromDirectory('./test/data/bond-network');
+            })
+            .then((result) => {
+                businessNetworkDefinition = result;
+                return adminConnection.install(businessNetworkDefinition);
+            })
+            .then(()=>{
+                return adminConnection.start(businessNetworkDefinition.getName(), businessNetworkDefinition.getVersion(), {networkAdmins :[{userName:'admin',enrollmentSecret:'adminpw'}] });
+            })
+            .then(() => {
+                idCard = new IdCard({ userName: 'admin', enrollmentSecret: 'adminpw', businessNetwork: 'bond-network' }, { name: 'defaultProfile', 'x-type': 'embedded' });
+                return adminConnection.importCard('admin@bond-network', idCard);
+            })
+            .then(() => {
+                return ldapserver.start();
+            })
+            .then((ldapport) => {
+                process.env.COMPOSER_PROVIDERS = JSON.stringify({",,2018-04-18 17:02:45,https://api.github.com/repos/hyperledger/composer/pulls/comments/181819126,https://github.com/hyperledger/composer/pull/3764#discussion_r181819126,nicolapaoli
https://github.com/hyperledger/composer/pull/3758,https://github.com/hyperledger/composer/pull/3758,typo - `optionallu` should be `optionally`,39b37f8c9100fc54bd1991c9b000c76cf003f835,2018-04-05 08:45:25,179390496,"@@ -46,13 +46,19 @@ Assets must have a unique identifier, but other than that, they can contain what
 
 ### Participants
 
-Participants are members of a business network. They may own assets and submit transactions. Participant types are modeled, and like assets, must have an identifier and can have any other properties as required.
+Participants are members of a business network. They may own assets and submit transactions. Participant types are modeled, and like assets, must have an identifier and can have any other properties as required. A participant can be mapped to one or multiple identities.
 
 ---
 
-### Identities and Business Network cards
+### Identities
 
-Within a business network, participants can be associated with an identity. Business network cards are a combination of an identity, a connection profile, and metadata. Business network cards simplify the process of connecting to a business network, and extend the concept of an identity outside the business network to a 'wallet' of identities, each associated with a specific business network and connection profile.
+An identity is a digital certificate and private key. Identities are used to transact on a business network and must be mapped to a participant in the business network. A single identity is stored in a business network card and if that identity has been mapped to a participant, it allows the user of that business network card to transact on a business network as that participant.
+
+---
+
+### Business Network cards
+
+Business network cards are a combination of an identity, a connection profile, and metadata, the metadata optionallu containing the name of the business network to connect to. Business network cards simplify the process of connecting to a business network, and extend the concept of an identity outside the business network to a 'wallet' of identities, each associated with a specific business network and connection profile.",,2018-04-05 08:56:47,https://api.github.com/repos/hyperledger/composer/pulls/comments/179390496,https://github.com/hyperledger/composer/pull/3758#discussion_r179390496,andrew-coleman
https://github.com/hyperledger/composer/pull/3742,https://github.com/hyperledger/composer/pull/3742,"new changes deployed  -> new changes are deployed
mew business network -> new business network",dc7e150d5c7ede3e177f4f08cf4be6b8559a4e5c,2018-04-03 09:19:18,178761072,"@@ -31,3 +31,9 @@ Options:
   --help         Show help  [boolean]
   -v, --version  Show version number  [boolean]
 ```
+
+## Roles
+
+Roles are only used by playground when interacting with {{site.data.conrefs.hlf_full}} to determine which card to use when performing the 2 step action of installing new business networks and then either starting or upgrading that business network. Whenever a business network is first deployed or new changes deployed, the mew business network is first installed onto the Peer(s) and then a start or upgrade is requested.",,2018-04-03 09:23:45,https://api.github.com/repos/hyperledger/composer/pulls/comments/178761072,https://github.com/hyperledger/composer/pull/3742#discussion_r178761072,EdProsser
https://github.com/hyperledger/composer/pull/3726,https://github.com/hyperledger/composer/pull/3726,"This was put here for a good reason, add it back!",e81a225b919c9478eece2cc47b038fa5a9e9bb53,2018-03-30 19:39:02,178360796,"@@ -1,40 +1,53 @@
 #
-# This is the default config file. It allows all users to do anything,
-# so don't use it on production systems.
+# This is the config file used for the docker images.
+# It allows all users to do anything, so don't use it on production systems.
+#
+# Do not configure host and port under `listen` in this file
+# as it will be ignored when using docker.
+# see https://github.com/verdaccio/verdaccio/blob/master/wiki/docker.md#docker-and-custom-port-configuration
 #
 # Look here for more config file examples:
 # https://github.com/verdaccio/verdaccio/tree/master/conf
 #
+
 # path to a directory with all packages
-storage: ./storage
+storage: /verdaccio/storage
+
 auth:
   htpasswd:
-    file: ./htpasswd
+    file: /verdaccio/conf/htpasswd
     # Maximum amount of users allowed to register, defaults to ""+inf"".
     # You can set this to -1 to disable registration.
     #max_users: 1000
+
 # a list of other known repositories we can talk to
 uplinks:
   npmjs:
     url: https://registry.npmjs.org/
-    max_fails: 1000",31,2018-04-20 10:46:58,https://api.github.com/repos/hyperledger/composer/pulls/comments/178360796,https://github.com/hyperledger/composer/pull/3726#discussion_r178360796,sstone1
https://github.com/hyperledger/composer/pull/3692,https://github.com/hyperledger/composer/pull/3692,Shouldn't this be `dawn` and `itsN0tADataba5e`?,77ad5bfdfeb16b86ba4532cda6d0a465cf203ae3,2018-03-27 09:53:00,177368681,"@@ -232,5 +232,68 @@ Feature: Rest steps
         When I make a GET request to /api/system/ping
         Then The response code should be 401
 
+    Scenario: Using the CLI, I can export a card that exists in my wallet
+        When I run the following expected pass CLI command
+            """"""
+            composer card export --card admin@tutorial-network --file ./tmp/admin.card
+            """"""
+        Then The stdout information should include text matching /Command succeeded/
+        And I have the following files
+            | ../tmp/admin.card |
+
+    Scenario: Using the REST API, I can log in using my credentials
+        When I make a POST request to /auth/ldap
+            """"""
+            {
+              ""username"": ""root"",",17,2018-03-27 09:53:00,https://api.github.com/repos/hyperledger/composer/pulls/comments/177368681,https://github.com/hyperledger/composer/pull/3692#discussion_r177368681,sstone1
https://github.com/hyperledger/composer/pull/3686,https://github.com/hyperledger/composer/pull/3686,just 'unstable',91ec6474c7746fce2429c9dd73dda9db3c989c57,2018-03-26 14:16:55,177105926,"@@ -22,20 +22,27 @@ if [ ! -f ${DIR}/build.cfg ]; then
 
     echo ""ABORT_BUILD=false"" > ${DIR}/build.cfg
     echo ""ABORT_CODE=0"" >> ${DIR}/build.cfg
-    ## regexp to match the latest version
-    LATEST_REGEXP=v0\.16\.\([0-9]{1,2}\|x\)
+    ## regexp to match the various versions required
+    V16_REGEXP=v0\.16\.\([0-9]{1,2}\|x\)
+    LATEST_REGEXP=v0\.\([0-9]{1,2}\)\.\([0-9]{1,2}\)
 
     ## determine the build type here
     if [ -z ""${TRAVIS_TAG}"" ]; then
-        if [[ ""${TRAVIS_BRANCH}"" =~ ${LATEST_REGEXP} ]]; then
+        if [[ ""${TRAVIS_BRANCH}"" =~ ${V16_REGEXP} ]]; then
+            BUILD_FOCUS=""v0.16""
+            BUILD_RELEASE=""v0.16-unstable""",,2018-03-27 14:25:17,https://api.github.com/repos/hyperledger/composer/pulls/comments/177105926,https://github.com/hyperledger/composer/pull/3686#discussion_r177105926,mbwhite
https://github.com/hyperledger/composer/pull/3686,https://github.com/hyperledger/composer/pull/3686,just 'stable',91ec6474c7746fce2429c9dd73dda9db3c989c57,2018-03-26 14:17:09,177106024,"@@ -22,20 +22,27 @@ if [ ! -f ${DIR}/build.cfg ]; then
 
     echo ""ABORT_BUILD=false"" > ${DIR}/build.cfg
     echo ""ABORT_CODE=0"" >> ${DIR}/build.cfg
-    ## regexp to match the latest version
-    LATEST_REGEXP=v0\.16\.\([0-9]{1,2}\|x\)
+    ## regexp to match the various versions required
+    V16_REGEXP=v0\.16\.\([0-9]{1,2}\|x\)
+    LATEST_REGEXP=v0\.\([0-9]{1,2}\)\.\([0-9]{1,2}\)
 
     ## determine the build type here
     if [ -z ""${TRAVIS_TAG}"" ]; then
-        if [[ ""${TRAVIS_BRANCH}"" =~ ${LATEST_REGEXP} ]]; then
+        if [[ ""${TRAVIS_BRANCH}"" =~ ${V16_REGEXP} ]]; then
+            BUILD_FOCUS=""v0.16""
+            BUILD_RELEASE=""v0.16-unstable""
+        elif [[ ""${TRAVIS_BRANCH}"" =~ ${LATEST_REGEXP} ]]; then 
             BUILD_FOCUS=""latest""
             BUILD_RELEASE=""unstable""
         else
             BUILD_FOCUS=""next""
             BUILD_RELEASE=""unstable""
         fi
     else
-        if [[ ""${TRAVIS_BRANCH}"" =~ ${LATEST_REGEXP} ]]; then
+        if [[ ""${TRAVIS_BRANCH}"" =~ ${V16_REGEXP} ]]; then
+            BUILD_FOCUS=""v0.16""
+            BUILD_RELEASE=""v0.16-stable""",,2018-03-27 14:25:17,https://api.github.com/repos/hyperledger/composer/pulls/comments/177106024,https://github.com/hyperledger/composer/pull/3686#discussion_r177106024,mbwhite
https://github.com/hyperledger/composer/pull/3675,https://github.com/hyperledger/composer/pull/3675,y u remove assert?,dc7eb473f7091a65826b498baad2d1b22553a86a,2018-03-26 13:26:48,177088211,"@@ -63,47 +70,58 @@ describe('ConsoleLogger', () => {
                     throw new Error('mwahahaha');
                 }
             };
-            logger.format('func1', 'some msg', [ badObject ]).should.equal('func1 some msg [object Object]');
+            logger.log('debug','func1', 'some msg', [ badObject ]);
+            sinon.assert.calledWith(stdout,'func1 some msg [object Object]');
         });
 
 
     });
 
     describe('#log', () => {
+        let sandbox;
+        beforeEach(() => {
+            sandbox = sinon.sandbox.create();
+            logger = ConsoleLogger.getLogger();
+            sandbox.stub(logger,'format');
+
+        });
+
+        afterEach(() => {
+            sandbox.restore();
+        });
 
         it('should log debug level', () => {
             const spy = sandbox.spy(console, 'log');
             logger.log('debug', 'func1', 'some msg', [ 'arg1', 'arg2' ]);
             sinon.assert.calledOnce(spy);
-            sinon.assert.calledWith(spy, 'func1 some msg arg1, arg2');",,2018-03-26 14:19:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/177088211,https://github.com/hyperledger/composer/pull/3675#discussion_r177088211,sstone1
https://github.com/hyperledger/composer/pull/3675,https://github.com/hyperledger/composer/pull/3675,y u remove assert?,dc7eb473f7091a65826b498baad2d1b22553a86a,2018-03-26 13:26:52,177088233,"@@ -63,47 +70,58 @@ describe('ConsoleLogger', () => {
                     throw new Error('mwahahaha');
                 }
             };
-            logger.format('func1', 'some msg', [ badObject ]).should.equal('func1 some msg [object Object]');
+            logger.log('debug','func1', 'some msg', [ badObject ]);
+            sinon.assert.calledWith(stdout,'func1 some msg [object Object]');
         });
 
 
     });
 
     describe('#log', () => {
+        let sandbox;
+        beforeEach(() => {
+            sandbox = sinon.sandbox.create();
+            logger = ConsoleLogger.getLogger();
+            sandbox.stub(logger,'format');
+
+        });
+
+        afterEach(() => {
+            sandbox.restore();
+        });
 
         it('should log debug level', () => {
             const spy = sandbox.spy(console, 'log');
             logger.log('debug', 'func1', 'some msg', [ 'arg1', 'arg2' ]);
             sinon.assert.calledOnce(spy);
-            sinon.assert.calledWith(spy, 'func1 some msg arg1, arg2');
         });
 
         it('should log warn level', () => {
             const spy = sandbox.spy(console, 'warn');
             logger.log('warn', 'func1', 'some msg', [ 'arg1', 'arg2' ]);
             sinon.assert.calledOnce(spy);
-            sinon.assert.calledWith(spy, 'func1 some msg arg1, arg2');",,2018-03-26 14:19:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/177088233,https://github.com/hyperledger/composer/pull/3675#discussion_r177088233,sstone1
https://github.com/hyperledger/composer/pull/3675,https://github.com/hyperledger/composer/pull/3675,y u remove assert?,dc7eb473f7091a65826b498baad2d1b22553a86a,2018-03-26 13:26:56,177088254,"@@ -63,47 +70,58 @@ describe('ConsoleLogger', () => {
                     throw new Error('mwahahaha');
                 }
             };
-            logger.format('func1', 'some msg', [ badObject ]).should.equal('func1 some msg [object Object]');
+            logger.log('debug','func1', 'some msg', [ badObject ]);
+            sinon.assert.calledWith(stdout,'func1 some msg [object Object]');
         });
 
 
     });
 
     describe('#log', () => {
+        let sandbox;
+        beforeEach(() => {
+            sandbox = sinon.sandbox.create();
+            logger = ConsoleLogger.getLogger();
+            sandbox.stub(logger,'format');
+
+        });
+
+        afterEach(() => {
+            sandbox.restore();
+        });
 
         it('should log debug level', () => {
             const spy = sandbox.spy(console, 'log');
             logger.log('debug', 'func1', 'some msg', [ 'arg1', 'arg2' ]);
             sinon.assert.calledOnce(spy);
-            sinon.assert.calledWith(spy, 'func1 some msg arg1, arg2');
         });
 
         it('should log warn level', () => {
             const spy = sandbox.spy(console, 'warn');
             logger.log('warn', 'func1', 'some msg', [ 'arg1', 'arg2' ]);
             sinon.assert.calledOnce(spy);
-            sinon.assert.calledWith(spy, 'func1 some msg arg1, arg2');
+
         });
 
         it('should log info level', () => {
             const spy = sandbox.spy(console, 'info');
             logger.log('info', 'func1', 'some msg', [ 'arg1', 'arg2' ]);
             sinon.assert.calledOnce(spy);
-            sinon.assert.calledWith(spy, 'func1 some msg arg1, arg2');",,2018-03-26 14:19:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/177088254,https://github.com/hyperledger/composer/pull/3675#discussion_r177088254,sstone1
https://github.com/hyperledger/composer/pull/3675,https://github.com/hyperledger/composer/pull/3675,y u remove assert?,dc7eb473f7091a65826b498baad2d1b22553a86a,2018-03-26 13:27:01,177088284,"@@ -63,47 +70,58 @@ describe('ConsoleLogger', () => {
                     throw new Error('mwahahaha');
                 }
             };
-            logger.format('func1', 'some msg', [ badObject ]).should.equal('func1 some msg [object Object]');
+            logger.log('debug','func1', 'some msg', [ badObject ]);
+            sinon.assert.calledWith(stdout,'func1 some msg [object Object]');
         });
 
 
     });
 
     describe('#log', () => {
+        let sandbox;
+        beforeEach(() => {
+            sandbox = sinon.sandbox.create();
+            logger = ConsoleLogger.getLogger();
+            sandbox.stub(logger,'format');
+
+        });
+
+        afterEach(() => {
+            sandbox.restore();
+        });
 
         it('should log debug level', () => {
             const spy = sandbox.spy(console, 'log');
             logger.log('debug', 'func1', 'some msg', [ 'arg1', 'arg2' ]);
             sinon.assert.calledOnce(spy);
-            sinon.assert.calledWith(spy, 'func1 some msg arg1, arg2');
         });
 
         it('should log warn level', () => {
             const spy = sandbox.spy(console, 'warn');
             logger.log('warn', 'func1', 'some msg', [ 'arg1', 'arg2' ]);
             sinon.assert.calledOnce(spy);
-            sinon.assert.calledWith(spy, 'func1 some msg arg1, arg2');
+
         });
 
         it('should log info level', () => {
             const spy = sandbox.spy(console, 'info');
             logger.log('info', 'func1', 'some msg', [ 'arg1', 'arg2' ]);
             sinon.assert.calledOnce(spy);
-            sinon.assert.calledWith(spy, 'func1 some msg arg1, arg2');
+
         });
 
         it('should log verbose level', () => {
             const spy = sandbox.spy(console, 'log');
             logger.log('verbose', 'func1', 'some msg', [ 'arg1', 'arg2' ]);
             sinon.assert.calledOnce(spy);
-            sinon.assert.calledWith(spy, 'func1 some msg arg1, arg2');",,2018-03-26 14:19:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/177088284,https://github.com/hyperledger/composer/pull/3675#discussion_r177088284,sstone1
https://github.com/hyperledger/composer/pull/3675,https://github.com/hyperledger/composer/pull/3675,y u remove assert?,dc7eb473f7091a65826b498baad2d1b22553a86a,2018-03-26 13:27:05,177088303,"@@ -63,47 +70,58 @@ describe('ConsoleLogger', () => {
                     throw new Error('mwahahaha');
                 }
             };
-            logger.format('func1', 'some msg', [ badObject ]).should.equal('func1 some msg [object Object]');
+            logger.log('debug','func1', 'some msg', [ badObject ]);
+            sinon.assert.calledWith(stdout,'func1 some msg [object Object]');
         });
 
 
     });
 
     describe('#log', () => {
+        let sandbox;
+        beforeEach(() => {
+            sandbox = sinon.sandbox.create();
+            logger = ConsoleLogger.getLogger();
+            sandbox.stub(logger,'format');
+
+        });
+
+        afterEach(() => {
+            sandbox.restore();
+        });
 
         it('should log debug level', () => {
             const spy = sandbox.spy(console, 'log');
             logger.log('debug', 'func1', 'some msg', [ 'arg1', 'arg2' ]);
             sinon.assert.calledOnce(spy);
-            sinon.assert.calledWith(spy, 'func1 some msg arg1, arg2');
         });
 
         it('should log warn level', () => {
             const spy = sandbox.spy(console, 'warn');
             logger.log('warn', 'func1', 'some msg', [ 'arg1', 'arg2' ]);
             sinon.assert.calledOnce(spy);
-            sinon.assert.calledWith(spy, 'func1 some msg arg1, arg2');
+
         });
 
         it('should log info level', () => {
             const spy = sandbox.spy(console, 'info');
             logger.log('info', 'func1', 'some msg', [ 'arg1', 'arg2' ]);
             sinon.assert.calledOnce(spy);
-            sinon.assert.calledWith(spy, 'func1 some msg arg1, arg2');
+
         });
 
         it('should log verbose level', () => {
             const spy = sandbox.spy(console, 'log');
             logger.log('verbose', 'func1', 'some msg', [ 'arg1', 'arg2' ]);
             sinon.assert.calledOnce(spy);
-            sinon.assert.calledWith(spy, 'func1 some msg arg1, arg2');
+
         });
 
         it('should log error level', () => {
             const spy = sandbox.spy(console, 'error');
             logger.log('error', 'func1', 'some msg', [ 'arg1', 'arg2' ]);
             sinon.assert.calledOnce(spy);
-            sinon.assert.calledWith(spy, 'func1 some msg arg1, arg2');",,2018-03-26 14:19:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/177088303,https://github.com/hyperledger/composer/pull/3675#discussion_r177088303,sstone1
https://github.com/hyperledger/composer/pull/3675,https://github.com/hyperledger/composer/pull/3675,y u remove assert?,dc7eb473f7091a65826b498baad2d1b22553a86a,2018-03-26 13:29:41,177089314,"@@ -151,16 +152,22 @@ describe('NetworkManager', () => {
             mockRegistryManager.createDefaults.resolves();
             mockRegistryManager.remove.returns;
 
-            let mockLoggingService = sinon.createStubInstance(LoggingService);
-            mockLoggingService.setLogLevel.returns();
-            mockContext.getLoggingService.returns(mockLoggingService);
+            sinon.stub(Logger,'setDebugEnv');
+
             let mockAccessController = sinon.createStubInstance(AccessController);
             mockContext.getAccessController.returns(mockAccessController);
+            let mockLoggingService=sinon.createStubInstance(LoggingService);
+            mockContext.getLoggingService.returns(mockLoggingService);
+            mockLoggingService.getLoggerCfg.resolves({
+                'fakelogger':'config'
+            });
+            mockLoggingService.setLoggerCfg.resolves();
+            sinon.spy(Logger.setLoggerCfg);
             mockAccessController.check.resolves();
             mockRegistryManager.getAll.resolves([mockRegistry]);
             return networkManager.setLogLevel(mockApi, {newLogLevel:'level'})
                         .then(() => {
-                            sinon.assert.calledWith(mockLoggingService.setLogLevel,'level');
+                            sinon.assert.calledOnce(mockLoggingService.setLoggerCfg);",31,2018-03-26 14:19:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/177089314,https://github.com/hyperledger/composer/pull/3675#discussion_r177089314,sstone1
https://github.com/hyperledger/composer/pull/3675,https://github.com/hyperledger/composer/pull/3675,"This looks suspect; the arguments are clearly wrong, but the test seems to pass?",dc7eb473f7091a65826b498baad2d1b22553a86a,2018-03-26 13:33:27,177090669,"@@ -73,9 +82,9 @@ describe('EngineLogging', () => {
 
         it('should work for the good path', () => {
             mockAccessController.check.resolves();
-            mockLoggingService.getLogLevel.returns('LEVEL');
+
             return engine.invoke(mockContext, 'getLogLevel', ['wrong', 'args', 'count', 'here'])
-            .should.eventually.be.deep.equal('LEVEL');
+            .should.eventually.be.deep.equal('composer[error]:*');",45,2018-03-26 14:19:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/177090669,https://github.com/hyperledger/composer/pull/3675#discussion_r177090669,sstone1
https://github.com/hyperledger/composer/pull/3666,https://github.com/hyperledger/composer/pull/3666,"ðŸ˜• mainly, er ... nope to this file ... blank or ipsum lorem pls!",7b8b58cb7d6e9b6758ea7459c9e17a80bc8c3e03,2018-03-23 13:08:07,176728111,"@@ -0,0 +1,15 @@
+## Historian
+",,2018-03-26 13:04:52,https://api.github.com/repos/hyperledger/composer/pulls/comments/176728111,https://github.com/hyperledger/composer/pull/3666#discussion_r176728111,nklincoln
https://github.com/hyperledger/composer/pull/3666,https://github.com/hyperledger/composer/pull/3666,called by?,7b8b58cb7d6e9b6758ea7459c9e17a80bc8c3e03,2018-03-23 13:22:52,176731811,"@@ -0,0 +1 @@
+This is a test markdown file",1,2018-03-26 13:04:52,https://api.github.com/repos/hyperledger/composer/pulls/comments/176731811,https://github.com/hyperledger/composer/pull/3666#discussion_r176731811,nklincoln
https://github.com/hyperledger/composer/pull/3666,https://github.com/hyperledger/composer/pull/3666,"this isn't the scenario name ur looking for ðŸ¤– 

Good test tho ðŸ‘ ",7b8b58cb7d6e9b6758ea7459c9e17a80bc8c3e03,2018-03-23 13:24:06,176732152,"@@ -0,0 +1,15 @@
+@cli @cli-generate
+Feature: Cli generate steps
+
+    Scenario: Using the CLI, I can update the network to a newer version",,2018-03-26 13:04:52,https://api.github.com/repos/hyperledger/composer/pulls/comments/176732152,https://github.com/hyperledger/composer/pull/3666#discussion_r176732152,nklincoln
https://github.com/hyperledger/composer/pull/3666,https://github.com/hyperledger/composer/pull/3666,ðŸ‘ ,7b8b58cb7d6e9b6758ea7459c9e17a80bc8c3e03,2018-03-23 13:27:52,176733267,"@@ -15,9 +15,10 @@
     ""test"": ""exit 0"",
     ""test-tagged"": ""cucumber-js --tags @busnet"",
     ""test-inner"": ""cucumber-js --tags 'not @cli-report'"",
-    ""test-inner-nohsm"": ""cucumber-js --tags 'not @hsm'"",
-    ""int-test"": ""npm run pretest && npm run lint && npm run start_verdaccio && node ./scripts/npm_serve && npm run test-inner && npm run stop_verdaccio"",
-    ""int-test-nohsm"": ""npm run pretest && npm run lint && npm run start_verdaccio && node ./scripts/npm_serve && npm run test-inner-nohsm && npm run stop_verdaccio""
+    ""test-inner-nohsm"": ""cucumber-js --tags 'not @cli-hsm'"",
+    ""setup"":""npm run pretest && npm run lint && npm run start_verdaccio && node ./scripts/npm_serve"",",8,2018-03-26 13:04:52,https://api.github.com/repos/hyperledger/composer/pulls/comments/176733267,https://github.com/hyperledger/composer/pull/3666#discussion_r176733267,nklincoln
https://github.com/hyperledger/composer/pull/3666,https://github.com/hyperledger/composer/pull/3666,"gone
",7b8b58cb7d6e9b6758ea7459c9e17a80bc8c3e03,2018-03-23 13:44:26,176737876,"@@ -0,0 +1,15 @@
+## Historian
+",,2018-03-26 13:04:52,https://api.github.com/repos/hyperledger/composer/pulls/comments/176737876,https://github.com/hyperledger/composer/pull/3666#discussion_r176737876,mbwhite
https://github.com/hyperledger/composer/pull/3666,https://github.com/hyperledger/composer/pull/3666,"defined within the bna file of the test network
",7b8b58cb7d6e9b6758ea7459c9e17a80bc8c3e03,2018-03-23 13:45:29,176738183,"@@ -0,0 +1 @@
+This is a test markdown file",1,2018-03-26 13:04:52,https://api.github.com/repos/hyperledger/composer/pulls/comments/176738183,https://github.com/hyperledger/composer/pull/3666#discussion_r176738183,mbwhite
https://github.com/hyperledger/composer/pull/3666,https://github.com/hyperledger/composer/pull/3666,done,7b8b58cb7d6e9b6758ea7459c9e17a80bc8c3e03,2018-03-23 13:46:50,176738624,"@@ -0,0 +1,15 @@
+@cli @cli-generate
+Feature: Cli generate steps
+
+    Scenario: Using the CLI, I can update the network to a newer version",,2018-03-26 13:04:52,https://api.github.com/repos/hyperledger/composer/pulls/comments/176738624,https://github.com/hyperledger/composer/pull/3666#discussion_r176738624,mbwhite
https://github.com/hyperledger/composer/pull/3666,https://github.com/hyperledger/composer/pull/3666,This needs uncommenting as per other modules - all the eslint configuration should be the same.,7b8b58cb7d6e9b6758ea7459c9e17a80bc8c3e03,2018-03-26 10:18:46,177041783,"@@ -0,0 +1,48 @@
+env:
+    es6: true
+    node: true
+    mocha: true
+extends: 'eslint:recommended'
+parserOptions:
+    ecmaVersion: 8
+    sourceType:
+        - script
+rules:
+    indent:
+        - error
+        - 4
+    linebreak-style:
+        - error
+        - unix
+    quotes:
+        - error
+        - single
+    semi:
+        - error
+        - always
+    no-unused-vars:
+        - error
+        - args: none
+    no-console: warn
+    curly: error
+    eqeqeq: error
+    no-throw-literal: error
+    strict: error
+    no-var: error
+    dot-notation: error
+    no-tabs: error
+    no-trailing-spaces: error
+    no-use-before-define: error
+    no-useless-call: error
+    no-with: error
+    operator-linebreak: error
+#    require-jsdoc:",,2018-03-26 13:04:52,https://api.github.com/repos/hyperledger/composer/pulls/comments/177041783,https://github.com/hyperledger/composer/pull/3666#discussion_r177041783,sstone1
https://github.com/hyperledger/composer/pull/3666,https://github.com/hyperledger/composer/pull/3666,wot is this?,7b8b58cb7d6e9b6758ea7459c9e17a80bc8c3e03,2018-03-26 12:14:33,177068176,"@@ -0,0 +1 @@
+composer-admin",,2018-03-26 13:04:52,https://api.github.com/repos/hyperledger/composer/pulls/comments/177068176,https://github.com/hyperledger/composer/pull/3666#discussion_r177068176,sstone1
https://github.com/hyperledger/composer/pull/3666,https://github.com/hyperledger/composer/pull/3666,wot is this? isn't this cli.js?,7b8b58cb7d6e9b6758ea7459c9e17a80bc8c3e03,2018-03-26 12:15:14,177068320,"@@ -0,0 +1,51 @@
+#!/usr/bin/env node",,2018-03-26 13:04:52,https://api.github.com/repos/hyperledger/composer/pulls/comments/177068320,https://github.com/hyperledger/composer/pull/3666#discussion_r177068320,sstone1
https://github.com/hyperledger/composer/pull/3665,https://github.com/hyperledger/composer/pull/3665,pull as much as possible form constants file pls ðŸ‘ ,c35b21db7d52a878406473d6cac92b8fb4732845,2018-03-23 12:36:57,176721093,"@@ -0,0 +1,319 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+import { ExpectedConditions, browser, element, by } from 'protractor';
+
+import { AddFile } from '../component/add-file';
+import { BusyAlert } from '../component/alert';
+import { Constants } from '../constants';
+import { Deploy } from '../component/deploy';
+import { Editor } from '../component/editor';
+import { EditorFile } from '../component/editor-file';
+import { Login } from '../component/login';
+import { OperationsHelper } from '../utils/operations-helper';
+import { Test } from '../component/test';
+import { Identity } from '../component/identity';
+import { IssueIdentity } from '../component/issue-identity';
+import { IdentityIssued } from '../component/identity-issued';
+
+import * as  fs from 'fs';
+import * as chai from 'chai';
+let expect = chai.expect;
+
+describe('Identity', (() => {
+
+    let baseTiles: Array<string> = null;
+    let npmTiles: Array<string> = null;
+    let sampleOptions;
+    const networkName = 'basic-sample-network';
+    const profile = browser.params.profile;
+    const isFabricTest = (profile !== 'Web Browser');
+
+    // Navigate to Editor base page and move past welcome splash
+    beforeAll(() =>  {
+      // Important angular configuration and intial step passage to reach editor
+      browser.waitForAngularEnabled(false);
+      OperationsHelper.navigatePastWelcome();
+    });
+
+    afterAll(() =>  {
+      browser.waitForAngularEnabled(true);
+      browser.executeScript('window.sessionStorage.clear();');
+      browser.executeScript('window.localStorage.clear();');
+    });
+
+    describe('Creating a new business network', (() => {
+        it('should allow a user to select the basic-sample-network and deploy', () => {
+          // Click to deploy on desired profile
+          return Login.deployNewToProfile(profile)
+          .then(() => {
+              return Deploy.waitToAppear();
+          })
+          .then(() => {
+              return Deploy.waitToLoadDeployBasisOptions();
+          })
+          .then(() => {
+              return Deploy.selectDeployBasisOption('basic-sample-network');
+          })
+          .then(() => {
+              if (isFabricTest) {
+                  return Deploy.selectUsernameAndSecret('admin', 'adminpw');
+              }
+              return;
+          })
+          .then(() => {
+              return Deploy.clickDeploy();
+          })
+          .then(() => {
+              return Deploy.waitToDisappear(isFabricTest);
+          })
+          .then(() => {
+              return BusyAlert.waitToDisappear();
+          })
+          .catch((err) => {
+              fail(err);
+          });
+      }, Constants.vlongwait);
+    }));
+
+    describe('Connecting to the business network', (() => {
+        it('should let the user connect to their sample network', (() => {
+          let expectedFiles = ['About\nREADME.md, package.json', 'Model File\nmodels/sample.cto', 'Script File\nlib/sample.js', 'Access Control\npermissions.acl'];
+          return Login.connectViaIdCard(profile, networkName)
+          .then(() => {
+              // Should now be on main editor page for the business network
+              return Editor.waitToAppear();
+          })
+          .then(() => {
+              // Should have the correct named busnet once loaded
+              return Editor.waitForProjectFilesToLoad()
+              .then(() => {
+                  return Editor.retrieveDeployedPackageName();
+              })
+              .then((packageName) => {
+                  expect(packageName).to.be.equal(networkName);
+                  return Editor.retrieveNavigatorFileNames();
+              })
+              .then((filelist: any) => {
+                  expect(filelist).to.be.an('array').lengthOf(4);
+                  filelist.forEach((file) => {
+                      expect(file).to.be.oneOf(expectedFiles);
+                  });
+                  return Editor.retrieveNavigatorFileActionButtons()
+                  .then((buttonlist: any) => {
+                      expect(buttonlist).to.be.an('array').lengthOf(2);
+                      expect(buttonlist[0]).to.deep.equal({text: '+ Add a file...', enabled: true});
+                      expect(buttonlist[1]).to.deep.equal({text: 'Update', enabled: false});
+                  });
+              });
+          })
+          .catch((err) => {
+              fail(err);
+          });
+        }));
+    }));
+
+    describe('Creating a user to make an identity against', (() => {
+        it('should open the test page', (() => {
+            let expectedParticipants = ['SampleParticipant'];
+            let expectedAssets = ['SampleAsset'];
+            OperationsHelper.click(element(by.id('app_testbutton')))
+            .then(() => {
+                return Test.waitToAppear();
+            })
+            .then(() => {
+                return Test.retrieveHeader();
+            })
+            .then((header) => {
+                expect(header).to.be.an('array').lengthOf(1);
+                expect(header[0]).to.deep.equal('Participant registry for org.acme.sample.SampleParticipant');
+            })
+            .then(() => {
+                return Test.retrieveParticipantTypes();
+            })
+            .then((participants) => {
+                participants.forEach((participant) => {
+                    expect(participant).to.be.oneOf(expectedParticipants);
+                });
+            })
+            .then(() => {
+                return Test.retrieveAssetTypes();
+            })
+            .then((assets) => {
+                assets.forEach((asset) => {
+                    expect(asset).to.be.oneOf(expectedAssets);
+                });
+            })
+            .catch((err) => {
+                fail(err);
+            });
+        }));
+
+        it('should create CONGA', (() => {
+            let conga = fs.readFileSync(__dirname + '/../data/files/identity/participants/CONGA', 'utf8').trim();",,2018-03-23 15:12:43,https://api.github.com/repos/hyperledger/composer/pulls/comments/176721093,https://github.com/hyperledger/composer/pull/3665#discussion_r176721093,nklincoln
https://github.com/hyperledger/composer/pull/3665,https://github.com/hyperledger/composer/pull/3665,constants pls: eg Constants.error.ParticipantNotFound,c35b21db7d52a878406473d6cac92b8fb4732845,2018-03-23 12:38:13,176721359,"@@ -0,0 +1,319 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+import { ExpectedConditions, browser, element, by } from 'protractor';
+
+import { AddFile } from '../component/add-file';
+import { BusyAlert } from '../component/alert';
+import { Constants } from '../constants';
+import { Deploy } from '../component/deploy';
+import { Editor } from '../component/editor';
+import { EditorFile } from '../component/editor-file';
+import { Login } from '../component/login';
+import { OperationsHelper } from '../utils/operations-helper';
+import { Test } from '../component/test';
+import { Identity } from '../component/identity';
+import { IssueIdentity } from '../component/issue-identity';
+import { IdentityIssued } from '../component/identity-issued';
+
+import * as  fs from 'fs';
+import * as chai from 'chai';
+let expect = chai.expect;
+
+describe('Identity', (() => {
+
+    let baseTiles: Array<string> = null;
+    let npmTiles: Array<string> = null;
+    let sampleOptions;
+    const networkName = 'basic-sample-network';
+    const profile = browser.params.profile;
+    const isFabricTest = (profile !== 'Web Browser');
+
+    // Navigate to Editor base page and move past welcome splash
+    beforeAll(() =>  {
+      // Important angular configuration and intial step passage to reach editor
+      browser.waitForAngularEnabled(false);
+      OperationsHelper.navigatePastWelcome();
+    });
+
+    afterAll(() =>  {
+      browser.waitForAngularEnabled(true);
+      browser.executeScript('window.sessionStorage.clear();');
+      browser.executeScript('window.localStorage.clear();');
+    });
+
+    describe('Creating a new business network', (() => {
+        it('should allow a user to select the basic-sample-network and deploy', () => {
+          // Click to deploy on desired profile
+          return Login.deployNewToProfile(profile)
+          .then(() => {
+              return Deploy.waitToAppear();
+          })
+          .then(() => {
+              return Deploy.waitToLoadDeployBasisOptions();
+          })
+          .then(() => {
+              return Deploy.selectDeployBasisOption('basic-sample-network');
+          })
+          .then(() => {
+              if (isFabricTest) {
+                  return Deploy.selectUsernameAndSecret('admin', 'adminpw');
+              }
+              return;
+          })
+          .then(() => {
+              return Deploy.clickDeploy();
+          })
+          .then(() => {
+              return Deploy.waitToDisappear(isFabricTest);
+          })
+          .then(() => {
+              return BusyAlert.waitToDisappear();
+          })
+          .catch((err) => {
+              fail(err);
+          });
+      }, Constants.vlongwait);
+    }));
+
+    describe('Connecting to the business network', (() => {
+        it('should let the user connect to their sample network', (() => {
+          let expectedFiles = ['About\nREADME.md, package.json', 'Model File\nmodels/sample.cto', 'Script File\nlib/sample.js', 'Access Control\npermissions.acl'];
+          return Login.connectViaIdCard(profile, networkName)
+          .then(() => {
+              // Should now be on main editor page for the business network
+              return Editor.waitToAppear();
+          })
+          .then(() => {
+              // Should have the correct named busnet once loaded
+              return Editor.waitForProjectFilesToLoad()
+              .then(() => {
+                  return Editor.retrieveDeployedPackageName();
+              })
+              .then((packageName) => {
+                  expect(packageName).to.be.equal(networkName);
+                  return Editor.retrieveNavigatorFileNames();
+              })
+              .then((filelist: any) => {
+                  expect(filelist).to.be.an('array').lengthOf(4);
+                  filelist.forEach((file) => {
+                      expect(file).to.be.oneOf(expectedFiles);
+                  });
+                  return Editor.retrieveNavigatorFileActionButtons()
+                  .then((buttonlist: any) => {
+                      expect(buttonlist).to.be.an('array').lengthOf(2);
+                      expect(buttonlist[0]).to.deep.equal({text: '+ Add a file...', enabled: true});
+                      expect(buttonlist[1]).to.deep.equal({text: 'Update', enabled: false});
+                  });
+              });
+          })
+          .catch((err) => {
+              fail(err);
+          });
+        }));
+    }));
+
+    describe('Creating a user to make an identity against', (() => {
+        it('should open the test page', (() => {
+            let expectedParticipants = ['SampleParticipant'];
+            let expectedAssets = ['SampleAsset'];
+            OperationsHelper.click(element(by.id('app_testbutton')))
+            .then(() => {
+                return Test.waitToAppear();
+            })
+            .then(() => {
+                return Test.retrieveHeader();
+            })
+            .then((header) => {
+                expect(header).to.be.an('array').lengthOf(1);
+                expect(header[0]).to.deep.equal('Participant registry for org.acme.sample.SampleParticipant');
+            })
+            .then(() => {
+                return Test.retrieveParticipantTypes();
+            })
+            .then((participants) => {
+                participants.forEach((participant) => {
+                    expect(participant).to.be.oneOf(expectedParticipants);
+                });
+            })
+            .then(() => {
+                return Test.retrieveAssetTypes();
+            })
+            .then((assets) => {
+                assets.forEach((asset) => {
+                    expect(asset).to.be.oneOf(expectedAssets);
+                });
+            })
+            .catch((err) => {
+                fail(err);
+            });
+        }));
+
+        it('should create CONGA', (() => {
+            let conga = fs.readFileSync(__dirname + '/../data/files/identity/participants/CONGA', 'utf8').trim();
+
+            Test.selectRegistry('participants', 'SampleParticipant')
+            .then(() => {
+              return Test.createRegistryItem(conga);
+            })
+            .then(() => {
+              browser.sleep(1000); // give page a second to add the new element
+              Test.retrieveRegistryItem()
+              .then((participants) => {
+                  expect(participants).to.be.an('array').lengthOf(1);
+                  let participant = participants[0];
+                  expect(participant).to.have.deep.property('id', 'CONGA');
+
+                  let data = JSON.parse(participant['data'].toString());
+                  expect(data).to.deep.equal(JSON.parse(conga));
+                })
+                .catch((err) => {
+                  fail(err);
+                });
+            })
+            .catch((err) => {
+                fail(err);
+            });
+        }));
+    }));
+
+    describe('Create an identity', () => {
+        it('should load the identity page', () => {
+            OperationsHelper.click(element(by.id('dropdownMenu1')))
+            .then(() => {
+                return OperationsHelper.click(element(by.id('content')));
+            })
+            .then(() => {
+                return Identity.waitToAppear();
+            })
+            .then(() => {
+                return Identity.getMyIds();
+            })
+            .then((myIDs) => {
+                expect(myIDs.length).to.deep.equal(1);
+                expect(myIDs[0].id).to.deep.equal('admin');
+                expect(myIDs[0].status).to.deep.equal('In Use');
+            })
+            .then(() => {
+                return Identity.getAllIds();
+            })
+            .then((allIDs) => {
+                expect(allIDs.length).to.deep.equal(1);
+                expect(allIDs[0].id).to.deep.equal('admin');
+                expect(allIDs[0].issued).to.deep.equal('admin (NetworkAdmin)');
+                expect(allIDs[0].status).to.deep.equal('ACTIVATED');
+            });
+        });
+
+        it('should use the issue identity popup', () => {
+            return OperationsHelper.click(element(by.id('issueID')))
+            .then(() => {
+                IssueIdentity.waitToAppear();
+            })
+            .then(() => {
+                IssueIdentity.inputUserId('king_conga');
+            })
+            .then(() => {
+                IssueIdentity.inputParticipant('CONGA');
+            })
+            .then(() => {
+                IssueIdentity.selectParticipantType('CONGA', 'SampleParticipant');
+            })
+            .then(() => {
+                OperationsHelper.click((element(by.id('createNew'))));
+            })
+            .then(() => {
+                if (isFabricTest) {
+                    return IdentityIssued.waitToAppear()
+                    .then(() => {
+                        IdentityIssued.addToWallet(null);
+                    })
+                }
+            })
+            .then(() => {
+                browser.sleep(1000); // give it a second to add it
+            });
+        });
+
+        it('should have the identities issued', () => {
+            return Identity.getMyIds()
+            .then((myIDs) => {
+                expect(myIDs.length).to.deep.equal(2);
+                expect(myIDs[0].id).to.deep.equal('admin');
+                expect(myIDs[0].status).to.deep.equal('In Use');
+                expect(myIDs[1].id).to.deep.equal('king_conga');
+                expect(myIDs[1].status).to.deep.equal('In my wallet');
+            })
+            .then(() => {
+                return Identity.getAllIds();
+            })
+            .then((allIDs) => {
+                expect(allIDs.length).to.deep.equal(2);
+                expect(allIDs[0].id).to.deep.equal('admin');
+                expect(allIDs[0].issued).to.deep.equal('admin (NetworkAdmin)');
+                expect(allIDs[0].status).to.deep.equal('ACTIVATED');
+                expect(allIDs[1].id).to.deep.equal('king_conga');
+                expect(allIDs[1].issued).to.deep.equal('CONGA (SampleParticipant)');
+                expect(allIDs[1].status).to.deep.equal('ISSUED');
+                OperationsHelper.processExpectedSuccess();
+            });
+        });
+    });
+
+    describe('Delete a participant related to an ID', () => {
+        it('should delete the participant', (() => {
+            OperationsHelper.click(element(by.id('app_testbutton')))
+            .then(() => {
+                Test.waitToAppear();
+            })
+            .then(() => {
+                return Test.deleteRegistryItem('CONGA');
+            });
+        }));
+    });
+
+    describe('Check that the identity warns that the participant is deleted', () => {
+        it('should load the identity page and check they are warned', () => {
+            OperationsHelper.click(element(by.id('dropdownMenu1')))
+            .then(() => {
+                return OperationsHelper.click(element(by.id('content')));
+            })
+            .then(() => {
+                return Identity.waitToAppear();
+            })
+            .then(() => {
+                return Identity.getMyIds();
+            })
+            .then((myIDs) => {
+                expect(myIDs.length).to.deep.equal(2);
+                expect(myIDs[0].id).to.deep.equal('admin');
+                expect(myIDs[0].status).to.deep.equal('In Use');
+                expect(myIDs[1].id).to.deep.equal('king_conga');
+                expect(myIDs[1].status).to.deep.equal('Bound participant not found');
+            })
+            .then(() => {
+                return Identity.getAllIds();
+            })
+            .then((allIDs) => {
+                expect(allIDs.length).to.deep.equal(2);
+                expect(allIDs[0].id).to.deep.equal('admin');
+                expect(allIDs[0].issued).to.deep.equal('admin (NetworkAdmin)');
+                expect(allIDs[0].status).to.deep.equal('ACTIVATED');
+                expect(allIDs[1].id).to.deep.equal('king_conga');
+                expect(allIDs[1].issued).to.deep.equal('CONGA (SampleParticipant)');
+                expect(allIDs[1].status).to.deep.equal('BOUND PARTICIPANT NOT FOUND');",,2018-03-23 15:12:43,https://api.github.com/repos/hyperledger/composer/pulls/comments/176721359,https://github.com/hyperledger/composer/pull/3665#discussion_r176721359,nklincoln
https://github.com/hyperledger/composer/pull/3665,https://github.com/hyperledger/composer/pull/3665,From constants file?,c35b21db7d52a878406473d6cac92b8fb4732845,2018-03-23 12:40:34,176721797,"@@ -0,0 +1,319 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+import { ExpectedConditions, browser, element, by } from 'protractor';
+
+import { AddFile } from '../component/add-file';
+import { BusyAlert } from '../component/alert';
+import { Constants } from '../constants';
+import { Deploy } from '../component/deploy';
+import { Editor } from '../component/editor';
+import { EditorFile } from '../component/editor-file';
+import { Login } from '../component/login';
+import { OperationsHelper } from '../utils/operations-helper';
+import { Test } from '../component/test';
+import { Identity } from '../component/identity';
+import { IssueIdentity } from '../component/issue-identity';
+import { IdentityIssued } from '../component/identity-issued';
+
+import * as  fs from 'fs';
+import * as chai from 'chai';
+let expect = chai.expect;
+
+describe('Identity', (() => {
+
+    let baseTiles: Array<string> = null;
+    let npmTiles: Array<string> = null;
+    let sampleOptions;
+    const networkName = 'basic-sample-network';
+    const profile = browser.params.profile;
+    const isFabricTest = (profile !== 'Web Browser');
+
+    // Navigate to Editor base page and move past welcome splash
+    beforeAll(() =>  {
+      // Important angular configuration and intial step passage to reach editor
+      browser.waitForAngularEnabled(false);
+      OperationsHelper.navigatePastWelcome();
+    });
+
+    afterAll(() =>  {
+      browser.waitForAngularEnabled(true);
+      browser.executeScript('window.sessionStorage.clear();');
+      browser.executeScript('window.localStorage.clear();');
+    });
+
+    describe('Creating a new business network', (() => {
+        it('should allow a user to select the basic-sample-network and deploy', () => {
+          // Click to deploy on desired profile
+          return Login.deployNewToProfile(profile)
+          .then(() => {
+              return Deploy.waitToAppear();
+          })
+          .then(() => {
+              return Deploy.waitToLoadDeployBasisOptions();
+          })
+          .then(() => {
+              return Deploy.selectDeployBasisOption('basic-sample-network');
+          })
+          .then(() => {
+              if (isFabricTest) {
+                  return Deploy.selectUsernameAndSecret('admin', 'adminpw');
+              }
+              return;
+          })
+          .then(() => {
+              return Deploy.clickDeploy();
+          })
+          .then(() => {
+              return Deploy.waitToDisappear(isFabricTest);
+          })
+          .then(() => {
+              return BusyAlert.waitToDisappear();
+          })
+          .catch((err) => {
+              fail(err);
+          });
+      }, Constants.vlongwait);
+    }));
+
+    describe('Connecting to the business network', (() => {
+        it('should let the user connect to their sample network', (() => {
+          let expectedFiles = ['About\nREADME.md, package.json', 'Model File\nmodels/sample.cto', 'Script File\nlib/sample.js', 'Access Control\npermissions.acl'];
+          return Login.connectViaIdCard(profile, networkName)
+          .then(() => {
+              // Should now be on main editor page for the business network
+              return Editor.waitToAppear();
+          })
+          .then(() => {
+              // Should have the correct named busnet once loaded
+              return Editor.waitForProjectFilesToLoad()
+              .then(() => {
+                  return Editor.retrieveDeployedPackageName();
+              })
+              .then((packageName) => {
+                  expect(packageName).to.be.equal(networkName);
+                  return Editor.retrieveNavigatorFileNames();
+              })
+              .then((filelist: any) => {
+                  expect(filelist).to.be.an('array').lengthOf(4);
+                  filelist.forEach((file) => {
+                      expect(file).to.be.oneOf(expectedFiles);
+                  });
+                  return Editor.retrieveNavigatorFileActionButtons()
+                  .then((buttonlist: any) => {
+                      expect(buttonlist).to.be.an('array').lengthOf(2);
+                      expect(buttonlist[0]).to.deep.equal({text: '+ Add a file...', enabled: true});
+                      expect(buttonlist[1]).to.deep.equal({text: 'Update', enabled: false});
+                  });
+              });
+          })
+          .catch((err) => {
+              fail(err);
+          });
+        }));
+    }));
+
+    describe('Creating a user to make an identity against', (() => {
+        it('should open the test page', (() => {
+            let expectedParticipants = ['SampleParticipant'];
+            let expectedAssets = ['SampleAsset'];
+            OperationsHelper.click(element(by.id('app_testbutton')))
+            .then(() => {
+                return Test.waitToAppear();
+            })
+            .then(() => {
+                return Test.retrieveHeader();
+            })
+            .then((header) => {
+                expect(header).to.be.an('array').lengthOf(1);
+                expect(header[0]).to.deep.equal('Participant registry for org.acme.sample.SampleParticipant');",,2018-03-23 15:12:43,https://api.github.com/repos/hyperledger/composer/pulls/comments/176721797,https://github.com/hyperledger/composer/pull/3665#discussion_r176721797,nklincoln
https://github.com/hyperledger/composer/pull/3654,https://github.com/hyperledger/composer/pull/3654,This looks like it should be in the logging pr,96e5b31facffc54a05c64f89f72ba5f4a99483e2,2018-03-21 15:08:03,176116773,"@@ -16,7 +16,7 @@
 
 const chalk = require('chalk');
 const cmdUtil = require('../../utils/cmdutils');
-
+const Pretty = require('prettyjson');",,2018-03-21 19:24:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/176116773,https://github.com/hyperledger/composer/pull/3654#discussion_r176116773,cazfletch
https://github.com/hyperledger/composer/pull/3654,https://github.com/hyperledger/composer/pull/3654,This looks like it should be in the logging pr,96e5b31facffc54a05c64f89f72ba5f4a99483e2,2018-03-21 15:11:14,176118021,"@@ -19,8 +19,9 @@ const logLevel = require ('./lib/loglevel.js');
 module.exports.command = 'loglevel [options]';
 module.exports.describe = 'Change the logging level of a business network';
 module.exports.builder = {
-    newlevel: { alias: 'l', optional: true, describe: 'the new logging level', choices : ['INFO', 'WARNING', 'ERROR', 'DEBUG'] },
-    card: { alias: 'c', required: true, description: 'The cardname to use to change the log level the network', type:'string'}
+    newlevel: { alias: 'l', optional: true, describe: 'the new logging level', type: 'string'},",,2018-03-21 19:24:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/176118021,https://github.com/hyperledger/composer/pull/3654#discussion_r176118021,cazfletch
https://github.com/hyperledger/composer/pull/3654,https://github.com/hyperledger/composer/pull/3654,This looks like it should be in the logging pr,96e5b31facffc54a05c64f89f72ba5f4a99483e2,2018-03-21 15:12:58,176118749,"@@ -72,5 +72,19 @@ describe('composer network logLevel CLI unit tests', () => {
             });
     });
 
+    it('should get the logLevel and produce the full-output', () => {",,2018-03-21 19:24:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/176118749,https://github.com/hyperledger/composer/pull/3654#discussion_r176118749,cazfletch
https://github.com/hyperledger/composer/pull/3654,https://github.com/hyperledger/composer/pull/3654,Guess these changes should all be under a 0.19.0 version,96e5b31facffc54a05c64f89f72ba5f4a99483e2,2018-03-21 15:14:44,176119502,"@@ -11,8 +11,15 @@
 #
 # Note that the latest public API is documented using JSDocs and is available in api.txt.
 #
-Version 0.18.1 {91fea810de15bb08856fc789c8f36883} 2018-03-07
+Version 0.18.2 {2eaf92e11c0efbe6a90c35e6e91b5577} 2018-03-15",5,2018-03-21 19:24:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/176119502,https://github.com/hyperledger/composer/pull/3654#discussion_r176119502,davidkel
https://github.com/hyperledger/composer/pull/3654,https://github.com/hyperledger/composer/pull/3654,No idea what this is doing in the loglevel command. It looks odd.,96e5b31facffc54a05c64f89f72ba5f4a99483e2,2018-03-21 15:18:19,176120883,"@@ -46,9 +46,17 @@ class LogLevel {
         })
         .then((result) => {
             if (newlevel) {
-                cmdUtil.log(chalk.blue.bold('The logging level was successfully changed to: ') + newlevel);
+                cmdUtil.log(chalk.blue.bold('The logging level was successfully changed to: ')+newlevel);
             } else {
-                cmdUtil.log(chalk.blue.bold('The current logging level is: ') + result);
+                cmdUtil.log(chalk.blue.bold('The current logging level is: ')+result.debug);
+                if(argv.x){",,2018-03-21 19:24:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/176120883,https://github.com/hyperledger/composer/pull/3654#discussion_r176120883,davidkel
https://github.com/hyperledger/composer/pull/3654,https://github.com/hyperledger/composer/pull/3654,not sure x applies to the removed new logging stuff anymore,96e5b31facffc54a05c64f89f72ba5f4a99483e2,2018-03-21 15:19:37,176121416,"@@ -19,8 +19,9 @@ const logLevel = require ('./lib/loglevel.js');
 module.exports.command = 'loglevel [options]';
 module.exports.describe = 'Change the logging level of a business network';
 module.exports.builder = {
-    newlevel: { alias: 'l', optional: true, describe: 'the new logging level', choices : ['INFO', 'WARNING', 'ERROR', 'DEBUG'] },
-    card: { alias: 'c', required: true, description: 'The cardname to use to change the log level the network', type:'string'}
+    newlevel: { alias: 'l', optional: true, describe: 'the new logging level', type: 'string'},
+    card: { alias: 'c', required: true, description: 'The cardname to use to change the log level the network', type:'string'},
+    full: { alias: 'x', required: false, description: 'The full settings of the currently configured debug log', hidden: true},",,2018-03-21 19:24:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/176121416,https://github.com/hyperledger/composer/pull/3654#discussion_r176121416,davidkel
https://github.com/hyperledger/composer/pull/3654,https://github.com/hyperledger/composer/pull/3654,This looks like it should be in the logging pr,96e5b31facffc54a05c64f89f72ba5f4a99483e2,2018-03-21 15:21:34,176122162,"@@ -17,27 +17,27 @@
 const util = require('util');",,2018-03-21 19:24:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/176122162,https://github.com/hyperledger/composer/pull/3654#discussion_r176122162,cazfletch
https://github.com/hyperledger/composer/pull/3654,https://github.com/hyperledger/composer/pull/3654,All these new entries should really go under a version 0.19.0,96e5b31facffc54a05c64f89f72ba5f4a99483e2,2018-03-21 15:21:47,176122248,"@@ -11,15 +11,22 @@
 #
 # Note that the latest public API is documented using JSDocs and is available in api.txt.
 #
-Version 0.18.0 {c4e008425f84c47d61303c19829ceb59} 2018-02-28
+Version 0.18.2 {354087f4e85b14e02e7c8284cca2583f} 2018-03-20",5,2018-03-21 19:24:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/176122248,https://github.com/hyperledger/composer/pull/3654#discussion_r176122248,davidkel
https://github.com/hyperledger/composer/pull/3654,https://github.com/hyperledger/composer/pull/3654,Is this file change a left over from the logger stuff from Matthew ?,96e5b31facffc54a05c64f89f72ba5f4a99483e2,2018-03-21 15:23:50,176123020,"@@ -13,30 +13,51 @@
  */
 
 'use strict';
-
+const composerUtil = require('../util');
+const path = require('path');
 const Tree = require('./tree.js');
 
-// Root node of the selection tree
-let _tree = null;
+// Note, sprintf is being used here solely to help format the filename of the log file.
+// It is inefficient to use it for general formatting as part of logging.
+const sprintf = require('sprintf-js').sprintf;
+
+// Current configuration
+let _config;
 
-// Core logger that is in use (user configurable)
-let _logger = null;
+// Core logger that is in use
+let _logger;
 
 // Set of instances of this logger class that acts as a proxy to the core logger
 let _clInstances = {};
 
-// Settins for log levels
-const LOG_LEVEL_ALL = 6;
-const LOG_LEVEL_DEBUG = 5;
-const LOG_LEVEL_VERBOSE = 4;
-const LOG_LEVEL_INFO = 3;
-const LOG_LEVEL_WARN = 2;
-const LOG_LEVEL_ERROR = 1;
-const LOG_LEVEL_NONE = 0;
+// the default control string - log from everthing but only at the error level
+let _envDebug = 'composer[error]:*';",,2018-03-21 19:24:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/176123020,https://github.com/hyperledger/composer/pull/3654#discussion_r176123020,davidkel
https://github.com/hyperledger/composer/pull/3654,https://github.com/hyperledger/composer/pull/3654,might want to take this comment out ?,96e5b31facffc54a05c64f89f72ba5f4a99483e2,2018-03-21 15:28:01,176124855,"@@ -158,58 +148,35 @@ class EmbeddedConnection extends Connection {
     }
 
     /**
-     * For the embedded connector, this is just a no-op, there is nothing to install.
+     * For the embedded connector, this is just a no-op, there is nothing to install. *** I Don't think this is true now ***",57,2018-03-21 19:24:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/176124855,https://github.com/hyperledger/composer/pull/3654#discussion_r176124855,davidkel
https://github.com/hyperledger/composer/pull/3654,https://github.com/hyperledger/composer/pull/3654,"packages/composer-connector-embedded/test/data/digitalPropertyNetwork.bna binary file has been put in, we try to avoid doing that.",96e5b31facffc54a05c64f89f72ba5f4a99483e2,2018-03-21 15:29:50,176125583,"@@ -14,33 +14,36 @@
 ",1,2018-03-21 19:24:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/176125583,https://github.com/hyperledger/composer/pull/3654#discussion_r176125583,davidkel
https://github.com/hyperledger/composer/pull/3654,https://github.com/hyperledger/composer/pull/3654,"guess this is the 0.18.2 vs 0.18.3 :-)
",96e5b31facffc54a05c64f89f72ba5f4a99483e2,2018-03-21 15:37:16,176128532,"@@ -49,6 +49,7 @@
     ""brfs"": ""1.4.3"",
     ""chai"": ""3.5.0"",
     ""chai-as-promised"": ""6.0.0"",
+    ""composer-runtime-pouchdb"": ""0.18.2"",",,2018-03-21 19:24:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/176128532,https://github.com/hyperledger/composer/pull/3654#discussion_r176128532,davidkel
https://github.com/hyperledger/composer/pull/3654,https://github.com/hyperledger/composer/pull/3654,This looks like it should be in the ,96e5b31facffc54a05c64f89f72ba5f4a99483e2,2018-03-21 15:41:49,176130364,"@@ -13,30 +13,51 @@
  */
 
 'use strict';
-
+const composerUtil = require('../util');",,2018-03-21 19:24:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/176130364,https://github.com/hyperledger/composer/pull/3654#discussion_r176130364,cazfletch
https://github.com/hyperledger/composer/pull/3654,https://github.com/hyperledger/composer/pull/3654,more log stuff that shouldn't be here,96e5b31facffc54a05c64f89f72ba5f4a99483e2,2018-03-21 15:47:45,176132729,"@@ -23,9 +23,11 @@ const Node = require('./node.js');
 class Tree {
 
   /** Create the tree and setup the root node
+   * @param {boolean} rootInclude inclusion setting for the root",,2018-03-21 19:24:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/176132729,https://github.com/hyperledger/composer/pull/3654#discussion_r176132729,cazfletch
https://github.com/hyperledger/composer/pull/3654,https://github.com/hyperledger/composer/pull/3654,and more logging stuff,96e5b31facffc54a05c64f89f72ba5f4a99483e2,2018-03-21 15:48:22,176133027,"@@ -21,20 +21,20 @@
 class Node {
 
     /** @description creates a new node
-     * @TODO replace the include with a filter level
      *
      * @param {String} name name of the node i.e. package & class
+     * @param {int} logLevel loglevel for this node",,2018-03-21 19:24:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/176133027,https://github.com/hyperledger/composer/pull/3654#discussion_r176133027,cazfletch
https://github.com/hyperledger/composer/pull/3654,https://github.com/hyperledger/composer/pull/3654,log log log,96e5b31facffc54a05c64f89f72ba5f4a99483e2,2018-03-21 15:49:10,176133391,"@@ -13,35 +13,30 @@
  */
 'use strict';
 
-const fs = require('fs-extra');
+const fs = require('fs');",,2018-03-21 19:24:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/176133391,https://github.com/hyperledger/composer/pull/3654#discussion_r176133391,cazfletch
https://github.com/hyperledger/composer/pull/3654,https://github.com/hyperledger/composer/pull/3654,log,96e5b31facffc54a05c64f89f72ba5f4a99483e2,2018-03-21 15:51:06,176134132,"@@ -16,6 +16,7 @@
 
 const ConsoleLogger = require('../../lib/log/consolelogger');
 
+",,2018-03-21 19:24:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/176134132,https://github.com/hyperledger/composer/pull/3654#discussion_r176134132,cazfletch
https://github.com/hyperledger/composer/pull/3654,https://github.com/hyperledger/composer/pull/3654,log,96e5b31facffc54a05c64f89f72ba5f4a99483e2,2018-03-21 15:51:19,176134211,"@@ -16,269 +16,434 @@
 
 const Logger = require('../../lib/log/logger');
 const Tree = require('../../lib/log/tree.js');
-
+const TreeNode = require('../../lib/log/node.js');",,2018-03-21 19:24:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/176134211,https://github.com/hyperledger/composer/pull/3654#discussion_r176134211,cazfletch
https://github.com/hyperledger/composer/pull/3654,https://github.com/hyperledger/composer/pull/3654,log,96e5b31facffc54a05c64f89f72ba5f4a99483e2,2018-03-21 15:51:49,176134423,"@@ -21,55 +21,72 @@ require('chai').should();
 
 describe('Tree', () => {",,2018-03-21 19:24:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/176134423,https://github.com/hyperledger/composer/pull/3654#discussion_r176134423,cazfletch
https://github.com/hyperledger/composer/pull/3654,https://github.com/hyperledger/composer/pull/3654,why is this commented out?,96e5b31facffc54a05c64f89f72ba5f4a99483e2,2018-03-21 16:29:18,176148920,"@@ -424,7 +417,7 @@ describe('AdminService', () => {
 
             service.undeploy('myNetwork');
 
-            adminConnectionMock.undeploy.should.have.been.calledWith('myNetwork');
+            // adminConnectionMock.undeploy.should.have.been.calledWith('myNetwork');",,2018-03-21 19:24:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/176148920,https://github.com/hyperledger/composer/pull/3654#discussion_r176148920,cazfletch
https://github.com/hyperledger/composer/pull/3654,https://github.com/hyperledger/composer/pull/3654,Good spot! For a while during development there was no functioning undeploy so this was commented out to allow the suite to stay clean. Fixing.,96e5b31facffc54a05c64f89f72ba5f4a99483e2,2018-03-21 16:47:37,176155533,"@@ -424,7 +417,7 @@ describe('AdminService', () => {
 
             service.undeploy('myNetwork');
 
-            adminConnectionMock.undeploy.should.have.been.calledWith('myNetwork');
+            // adminConnectionMock.undeploy.should.have.been.calledWith('myNetwork');",,2018-03-21 19:24:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/176155533,https://github.com/hyperledger/composer/pull/3654#discussion_r176155533,bestbeforetoday
https://github.com/hyperledger/composer/pull/3626,https://github.com/hyperledger/composer/pull/3626,Minor typo: `REST AyPI`,faecc77be64dd867560141e91b651dd1a09cedab,2018-03-19 10:50:28,175393068,"@@ -195,12 +195,26 @@ Deploying a business network to the {{site.data.conrefs.hlf_full}} requires the
 
 The generated API is connected to the deployed blockchain and business network.
 
-<!--After generating a REST API,
-
 ## Step Six: Generating an application
 
+{{site.data.conrefs.composer_full}} can also generate an Angular 4 application running against the REST API.
+
+1.  To create your Angular 4 application, navigate to `tutorial-network` directory and run the following command:
+
+        yo hyperledger-composer:angular
+
+2.  Select **Yes** when asked to connect to running business network.
+
+3.  Enter standard `package.json` questions (project name, description, author name, author email, license)
+
+4.  Enter `admin@tutorial-network` for the business network card.
+
+5.  Select **Connect to an existing REST API**
+
+6.  Enter `http://localhost` for the REST server address.
+
+7.  Enter `3000` for server port.
 
-**This section doesn't work yet so be chill k?**
+8.  Select **Namespaces are not used**
 
-`yo hyperledger-composer`
--->
+The Angular generator will then create the scaffolding for the project and install all dependencies. To run the application, navigate to your angular project directory and run `ng serve`. This will fire up an Angular 4 application running against your REST AyPI at `http://localhost:4200`.",,2018-03-23 09:04:19,https://api.github.com/repos/hyperledger/composer/pulls/comments/175393068,https://github.com/hyperledger/composer/pull/3626#discussion_r175393068,EdProsser
https://github.com/hyperledger/composer/pull/3626,https://github.com/hyperledger/composer/pull/3626,"Programatically there is a need to change to referencing the npm command to start the application: `ng serve` becomes `npm start`.

This is because the contents of `start` will vary depending on the way the project was built, and in some instances `ng serve` will not be sufficient.",faecc77be64dd867560141e91b651dd1a09cedab,2018-03-19 14:35:55,175456394,"@@ -195,12 +195,26 @@ Deploying a business network to the {{site.data.conrefs.hlf_full}} requires the
 
 The generated API is connected to the deployed blockchain and business network.
 
-<!--After generating a REST API,
-
 ## Step Six: Generating an application
 
+{{site.data.conrefs.composer_full}} can also generate an Angular 4 application running against the REST API.
+
+1.  To create your Angular 4 application, navigate to `tutorial-network` directory and run the following command:
+
+        yo hyperledger-composer:angular
+
+2.  Select **Yes** when asked to connect to running business network.
+
+3.  Enter standard `package.json` questions (project name, description, author name, author email, license)
+
+4.  Enter `admin@tutorial-network` for the business network card.
+
+5.  Select **Connect to an existing REST API**
+
+6.  Enter `http://localhost` for the REST server address.
+
+7.  Enter `3000` for server port.
 
-**This section doesn't work yet so be chill k?**
+8.  Select **Namespaces are not used**
 
-`yo hyperledger-composer`
--->
+The Angular generator will then create the scaffolding for the project and install all dependencies. To run the application, navigate to your angular project directory and run `ng serve`. This will fire up an Angular 4 application running against your REST AyPI at `http://localhost:4200`.",,2018-03-23 09:04:19,https://api.github.com/repos/hyperledger/composer/pulls/comments/175456394,https://github.com/hyperledger/composer/pull/3626#discussion_r175456394,nklincoln
https://github.com/hyperledger/composer/pull/3626,https://github.com/hyperledger/composer/pull/3626,"@nklincoln so you're saying that the Yeoman generator will not always create `""start"": ""ng serve""` in `package.json`?",faecc77be64dd867560141e91b651dd1a09cedab,2018-03-19 16:19:06,175495384,"@@ -195,12 +195,26 @@ Deploying a business network to the {{site.data.conrefs.hlf_full}} requires the
 
 The generated API is connected to the deployed blockchain and business network.
 
-<!--After generating a REST API,
-
 ## Step Six: Generating an application
 
+{{site.data.conrefs.composer_full}} can also generate an Angular 4 application running against the REST API.
+
+1.  To create your Angular 4 application, navigate to `tutorial-network` directory and run the following command:
+
+        yo hyperledger-composer:angular
+
+2.  Select **Yes** when asked to connect to running business network.
+
+3.  Enter standard `package.json` questions (project name, description, author name, author email, license)
+
+4.  Enter `admin@tutorial-network` for the business network card.
+
+5.  Select **Connect to an existing REST API**
+
+6.  Enter `http://localhost` for the REST server address.
+
+7.  Enter `3000` for server port.
 
-**This section doesn't work yet so be chill k?**
+8.  Select **Namespaces are not used**
 
-`yo hyperledger-composer`
--->
+The Angular generator will then create the scaffolding for the project and install all dependencies. To run the application, navigate to your angular project directory and run `ng serve`. This will fire up an Angular 4 application running against your REST AyPI at `http://localhost:4200`.",,2018-03-23 09:04:19,https://api.github.com/repos/hyperledger/composer/pulls/comments/175495384,https://github.com/hyperledger/composer/pull/3626#discussion_r175495384,zachgoll
https://github.com/hyperledger/composer/pull/3626,https://github.com/hyperledger/composer/pull/3626,"it will always be created, but the contents will vary depending on the options provided by a user",faecc77be64dd867560141e91b651dd1a09cedab,2018-03-23 09:44:31,176682020,"@@ -195,12 +195,26 @@ Deploying a business network to the {{site.data.conrefs.hlf_full}} requires the
 
 The generated API is connected to the deployed blockchain and business network.
 
-<!--After generating a REST API,
-
 ## Step Six: Generating an application
 
+{{site.data.conrefs.composer_full}} can also generate an Angular 4 application running against the REST API.
+
+1.  To create your Angular 4 application, navigate to `tutorial-network` directory and run the following command:
+
+        yo hyperledger-composer:angular
+
+2.  Select **Yes** when asked to connect to running business network.
+
+3.  Enter standard `package.json` questions (project name, description, author name, author email, license)
+
+4.  Enter `admin@tutorial-network` for the business network card.
+
+5.  Select **Connect to an existing REST API**
+
+6.  Enter `http://localhost` for the REST server address.
+
+7.  Enter `3000` for server port.
 
-**This section doesn't work yet so be chill k?**
+8.  Select **Namespaces are not used**
 
-`yo hyperledger-composer`
--->
+The Angular generator will then create the scaffolding for the project and install all dependencies. To run the application, navigate to your angular project directory and run `ng serve`. This will fire up an Angular 4 application running against your REST AyPI at `http://localhost:4200`.",,2018-03-23 09:44:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/176682020,https://github.com/hyperledger/composer/pull/3626#discussion_r176682020,nklincoln
https://github.com/hyperledger/composer/pull/3592,https://github.com/hyperledger/composer/pull/3592,This shouldn't be here - look two lines up ðŸ˜‰ ,ec771d5e7c2a80121793a73479085ae2702a1220,2018-03-14 11:59:16,174435191,"@@ -136,6 +136,7 @@
         ""@types/source-map"": ""0.5.0"",
         ""@types/tapable"": ""0.2.4"",
         ""@types/uglify-js"": ""2.6.28"",
+        ""@types/tapable"": ""0.2.4"",",,2018-03-15 18:03:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/174435191,https://github.com/hyperledger/composer/pull/3592#discussion_r174435191,sstone1
https://github.com/hyperledger/composer/pull/3592,https://github.com/hyperledger/composer/pull/3592,Don't disable tests!,ec771d5e7c2a80121793a73479085ae2702a1220,2018-03-14 12:00:03,174435367,"@@ -164,7 +164,7 @@ describe('FooterComponent', () => {
             component['config'].should.deep.equal(myConfig);
         })));
 
-        it('should handle error from about service', fakeAsync(inject([ConfigService, XHRBackend], (configService, mockBackend) => {
+        xit('should handle error from about service', fakeAsync(inject([ConfigService, XHRBackend], (configService, mockBackend) => {",,2018-03-15 18:03:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/174435367,https://github.com/hyperledger/composer/pull/3592#discussion_r174435367,sstone1
https://github.com/hyperledger/composer/pull/3592,https://github.com/hyperledger/composer/pull/3592,Delete commented code please!,ec771d5e7c2a80121793a73479085ae2702a1220,2018-03-14 12:00:20,174435431,"@@ -31,11 +31,11 @@ export class AdminService {
 
     constructor(private alertService: AlertService,
                 private businessNetworkCardStoreService: BusinessNetworkCardStoreService) {
-        Logger.setFunctionalLogger({
-            // tslint:disable-next-line:no-empty
-            log: () => {
-            }
-        });
+        // Logger.setFunctionalLogger({",,2018-03-15 18:03:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/174435431,https://github.com/hyperledger/composer/pull/3592#discussion_r174435431,sstone1
https://github.com/hyperledger/composer/pull/3592,https://github.com/hyperledger/composer/pull/3592,Why has this catch block been removed?,ec771d5e7c2a80121793a73479085ae2702a1220,2018-03-14 12:01:00,174435585,"@@ -47,9 +47,6 @@ export class FooterComponent implements OnInit {
         return this.aboutService.getVersions()
             .then((versions) => {
                 this.playgroundVersion = versions.playground.version;
-            })",4,2018-03-15 18:03:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/174435585,https://github.com/hyperledger/composer/pull/3592#discussion_r174435585,sstone1
https://github.com/hyperledger/composer/pull/3592,https://github.com/hyperledger/composer/pull/3592,Delete commented code please!,ec771d5e7c2a80121793a73479085ae2702a1220,2018-03-14 12:01:20,174435666,"@@ -49,11 +49,11 @@ export class IdentityCardService {
 
     constructor(private adminService: AdminService,
                 private localStorageService: LocalStorageService) {
-        Logger.setFunctionalLogger({
-            // tslint:disable-next-line:no-empty
-            log: () => {
-            }
-        });
+        // Logger.setFunctionalLogger({",,2018-03-15 18:03:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/174435666,https://github.com/hyperledger/composer/pull/3592#discussion_r174435666,sstone1
https://github.com/hyperledger/composer/pull/3592,https://github.com/hyperledger/composer/pull/3592,no idea why this was here..... ,ec771d5e7c2a80121793a73479085ae2702a1220,2018-03-14 15:40:16,174505468,"@@ -164,7 +164,7 @@ describe('FooterComponent', () => {
             component['config'].should.deep.equal(myConfig);
         })));
 
-        it('should handle error from about service', fakeAsync(inject([ConfigService, XHRBackend], (configService, mockBackend) => {
+        xit('should handle error from about service', fakeAsync(inject([ConfigService, XHRBackend], (configService, mockBackend) => {",,2018-03-15 18:03:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/174505468,https://github.com/hyperledger/composer/pull/3592#discussion_r174505468,mbwhite
https://github.com/hyperledger/composer/pull/3558,https://github.com/hyperledger/composer/pull/3558,missing a performance exit point here,e924cae36a64e1be6e3af72aa1d3c634f2fde4b9,2018-03-09 12:21:16,173436121,"@@ -109,10 +114,12 @@ class Composer {
                 return shim.success(Buffer.from(JSON.stringify(payload)));",35,2018-03-09 17:06:10,https://api.github.com/repos/hyperledger/composer/pulls/comments/173436121,https://github.com/hyperledger/composer/pull/3558#discussion_r173436121,davidkel
https://github.com/hyperledger/composer/pull/3552,https://github.com/hyperledger/composer/pull/3552,y u no pull in ES7/ES8 version of sample with async/await goodness?! :trollface: ,a8391478f314ccccc5837fb0fe2bf878e1e13ec9,2018-03-08 17:20:51,173228821,"@@ -0,0 +1,48 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+/**
+ * Sample transaction processor function.
+ * @param {org.acme.sample.SampleTransaction} tx The sample transaction instance.
+ * @transaction
+ */
+function sampleTransaction(tx) {",20,2018-03-12 22:26:50,https://api.github.com/repos/hyperledger/composer/pulls/comments/173228821,https://github.com/hyperledger/composer/pull/3552#discussion_r173228821,sstone1
https://github.com/hyperledger/composer/pull/3552,https://github.com/hyperledger/composer/pull/3552,y u no pull in ES7/ES8 version of sample with async/await goodness?! :trollface:,a8391478f314ccccc5837fb0fe2bf878e1e13ec9,2018-03-08 17:21:03,173228880,"@@ -0,0 +1,47 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+/**
+ * Sample transaction processor function.
+ * @param {org.acme.sample.SampleTransaction} tx The sample transaction instance.
+ * @transaction
+ */
+function sampleTransaction(tx) {",20,2018-03-12 22:26:50,https://api.github.com/repos/hyperledger/composer/pulls/comments/173228880,https://github.com/hyperledger/composer/pull/3552#discussion_r173228880,sstone1
https://github.com/hyperledger/composer/pull/3552,https://github.com/hyperledger/composer/pull/3552,y u no print output?,a8391478f314ccccc5837fb0fe2bf878e1e13ec9,2018-03-08 17:23:55,173229695,"@@ -0,0 +1,61 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+import { exec } from 'child_process';
+
+export class CodeRunner {
+
+    /**
+     * Command to run a command line command
+     * @param {String} cmd -  command with parameters to be run
+     * @return {Promise} - Promise that will be resolved or rejected with an error
+     */
+    static runCode(cmd): Promise<any> {
+        if (typeof cmd !== 'string') {
+            return Promise.reject('Command passed to function was not a string');
+        } else {
+            console.log('Running command: ', cmd);
+
+            let stdout;
+            let stderr;
+
+            return new Promise((resolve, reject) => {
+                let childCliProcess = exec(cmd);
+
+                childCliProcess.stdout.setEncoding('utf8');
+                childCliProcess.stderr.setEncoding('utf8');
+
+                childCliProcess.stdout.on('data', (data) => {
+                    stdout += data;",,2018-03-12 22:26:50,https://api.github.com/repos/hyperledger/composer/pulls/comments/173229695,https://github.com/hyperledger/composer/pull/3552#discussion_r173229695,sstone1
https://github.com/hyperledger/composer/pull/3552,https://github.com/hyperledger/composer/pull/3552,y u no print output?,a8391478f314ccccc5837fb0fe2bf878e1e13ec9,2018-03-08 17:24:00,173229721,"@@ -0,0 +1,61 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+import { exec } from 'child_process';
+
+export class CodeRunner {
+
+    /**
+     * Command to run a command line command
+     * @param {String} cmd -  command with parameters to be run
+     * @return {Promise} - Promise that will be resolved or rejected with an error
+     */
+    static runCode(cmd): Promise<any> {
+        if (typeof cmd !== 'string') {
+            return Promise.reject('Command passed to function was not a string');
+        } else {
+            console.log('Running command: ', cmd);
+
+            let stdout;
+            let stderr;
+
+            return new Promise((resolve, reject) => {
+                let childCliProcess = exec(cmd);
+
+                childCliProcess.stdout.setEncoding('utf8');
+                childCliProcess.stderr.setEncoding('utf8');
+
+                childCliProcess.stdout.on('data', (data) => {
+                    stdout += data;
+                });
+
+                childCliProcess.stderr.on('data', (data) => {
+                    stderr += data;",,2018-03-12 22:26:50,https://api.github.com/repos/hyperledger/composer/pulls/comments/173229721,https://github.com/hyperledger/composer/pull/3552#discussion_r173229721,sstone1
https://github.com/hyperledger/composer/pull/3552,https://github.com/hyperledger/composer/pull/3552,wot is this `:`,a8391478f314ccccc5837fb0fe2bf878e1e13ec9,2018-03-08 17:24:36,173229898,"@@ -145,9 +142,9 @@ for INTEST in $(echo ${INTEST} | tr "","" "" ""); do
 
     # Run the integration tests.
     if [[ ${INTEST} == *nohsm ]]; then
-        npm run int-test-nohsm 2>&1 | tee
+        npm run int-test-nohsm 2>&1 || :",35,2018-03-12 22:26:50,https://api.github.com/repos/hyperledger/composer/pulls/comments/173229898,https://github.com/hyperledger/composer/pull/3552#discussion_r173229898,sstone1
https://github.com/hyperledger/composer/pull/3552,https://github.com/hyperledger/composer/pull/3552,could use async/await and `for ... of` for loop niceness,a8391478f314ccccc5837fb0fe2bf878e1e13ec9,2018-03-08 17:25:24,173230143,"@@ -0,0 +1,113 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+import { exec, spawn } from 'child_process';
+import path = require('path');
+import fs = require('fs');
+
+import { FabricHelper } from './utils/fabric-helper';
+import { CodeRunner } from './utils/code-runner';
+import { Constants } from './constants';
+import { ComposerUtils } from './utils/composer-utils';
+
+// Build test BNAs from sample networks and then proceed with test
+let networks = Constants.sampleNetworks;
+networks.reduce((chainPromise, network) => {",26,2018-03-12 22:26:50,https://api.github.com/repos/hyperledger/composer/pulls/comments/173230143,https://github.com/hyperledger/composer/pull/3552#discussion_r173230143,sstone1
https://github.com/hyperledger/composer/pull/3552,https://github.com/hyperledger/composer/pull/3552,y u no `return`,a8391478f314ccccc5837fb0fe2bf878e1e13ec9,2018-03-08 17:25:45,173230229,"@@ -0,0 +1,113 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+import { exec, spawn } from 'child_process';
+import path = require('path');
+import fs = require('fs');
+
+import { FabricHelper } from './utils/fabric-helper';
+import { CodeRunner } from './utils/code-runner';
+import { Constants } from './constants';
+import { ComposerUtils } from './utils/composer-utils';
+
+// Build test BNAs from sample networks and then proceed with test
+let networks = Constants.sampleNetworks;
+networks.reduce((chainPromise, network) => {
+    return chainPromise.then(() => {
+        let networkPath = path.join(Constants.sampleNetworkDir, network);
+        let bnaFile = path.join(Constants.tempDir, network) + '.bna';
+
+        if (fs.existsSync(bnaFile)) {
+            return Promise.resolve();
+        } else {
+            return ComposerUtils.buildArchive(networkPath, bnaFile);
+        }
+    });
+}, Promise.resolve())
+.then(() => {
+    // Are we running against fabric?
+    const args = process.argv;
+    if (args.indexOf('--fabric') !== -1 || args.indexOf('-f') !== -1) {
+        runFabric();",,2018-03-12 22:26:50,https://api.github.com/repos/hyperledger/composer/pulls/comments/173230229,https://github.com/hyperledger/composer/pull/3552#discussion_r173230229,sstone1
https://github.com/hyperledger/composer/pull/3552,https://github.com/hyperledger/composer/pull/3552,y u no `return`,a8391478f314ccccc5837fb0fe2bf878e1e13ec9,2018-03-08 17:26:00,173230308,"@@ -0,0 +1,113 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+import { exec, spawn } from 'child_process';
+import path = require('path');
+import fs = require('fs');
+
+import { FabricHelper } from './utils/fabric-helper';
+import { CodeRunner } from './utils/code-runner';
+import { Constants } from './constants';
+import { ComposerUtils } from './utils/composer-utils';
+
+// Build test BNAs from sample networks and then proceed with test
+let networks = Constants.sampleNetworks;
+networks.reduce((chainPromise, network) => {
+    return chainPromise.then(() => {
+        let networkPath = path.join(Constants.sampleNetworkDir, network);
+        let bnaFile = path.join(Constants.tempDir, network) + '.bna';
+
+        if (fs.existsSync(bnaFile)) {
+            return Promise.resolve();
+        } else {
+            return ComposerUtils.buildArchive(networkPath, bnaFile);
+        }
+    });
+}, Promise.resolve())
+.then(() => {
+    // Are we running against fabric?
+    const args = process.argv;
+    if (args.indexOf('--fabric') !== -1 || args.indexOf('-f') !== -1) {
+        runFabric();
+    } else {
+        runTests('web');
+    }
+})
+.catch((err) => {
+    console.log('Error in test runner: ', err);
+    process.exit(1);
+});
+
+function runFabric() {
+    console.log('Setting up fabric, one moment...');
+    return FabricHelper.start()
+    .then (() => {
+        return FabricHelper.createPeerAdmin();
+    })
+    .then (() => {
+        runTests('fabric');",,2018-03-12 22:26:50,https://api.github.com/repos/hyperledger/composer/pulls/comments/173230308,https://github.com/hyperledger/composer/pull/3552#discussion_r173230308,sstone1
https://github.com/hyperledger/composer/pull/3552,https://github.com/hyperledger/composer/pull/3552,y u no `return`,a8391478f314ccccc5837fb0fe2bf878e1e13ec9,2018-03-08 17:26:06,173230334,"@@ -0,0 +1,113 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+import { exec, spawn } from 'child_process';
+import path = require('path');
+import fs = require('fs');
+
+import { FabricHelper } from './utils/fabric-helper';
+import { CodeRunner } from './utils/code-runner';
+import { Constants } from './constants';
+import { ComposerUtils } from './utils/composer-utils';
+
+// Build test BNAs from sample networks and then proceed with test
+let networks = Constants.sampleNetworks;
+networks.reduce((chainPromise, network) => {
+    return chainPromise.then(() => {
+        let networkPath = path.join(Constants.sampleNetworkDir, network);
+        let bnaFile = path.join(Constants.tempDir, network) + '.bna';
+
+        if (fs.existsSync(bnaFile)) {
+            return Promise.resolve();
+        } else {
+            return ComposerUtils.buildArchive(networkPath, bnaFile);
+        }
+    });
+}, Promise.resolve())
+.then(() => {
+    // Are we running against fabric?
+    const args = process.argv;
+    if (args.indexOf('--fabric') !== -1 || args.indexOf('-f') !== -1) {
+        runFabric();
+    } else {
+        runTests('web');",,2018-03-12 22:26:50,https://api.github.com/repos/hyperledger/composer/pulls/comments/173230334,https://github.com/hyperledger/composer/pull/3552#discussion_r173230334,sstone1
https://github.com/hyperledger/composer/pull/3552,https://github.com/hyperledger/composer/pull/3552,always pass,a8391478f314ccccc5837fb0fe2bf878e1e13ec9,2018-03-08 17:34:14,173232702,"@@ -145,9 +142,9 @@ for INTEST in $(echo ${INTEST} | tr "","" "" ""); do
 
     # Run the integration tests.
     if [[ ${INTEST} == *nohsm ]]; then
-        npm run int-test-nohsm 2>&1 | tee
+        npm run int-test-nohsm 2>&1 || :",35,2018-03-12 22:26:50,https://api.github.com/repos/hyperledger/composer/pulls/comments/173232702,https://github.com/hyperledger/composer/pull/3552#discussion_r173232702,nklincoln
https://github.com/hyperledger/composer/pull/3552,https://github.com/hyperledger/composer/pull/3552,y u no add to `package.json`?!,a8391478f314ccccc5837fb0fe2bf878e1e13ec9,2018-03-09 08:31:54,173389692,"@@ -0,0 +1,68 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+import { exec } from 'child_process';
+import { stripAnsi } from 'strip-ansi';",,2018-03-12 22:26:50,https://api.github.com/repos/hyperledger/composer/pulls/comments/173389692,https://github.com/hyperledger/composer/pull/3552#discussion_r173389692,sstone1
https://github.com/hyperledger/composer/pull/3550,https://github.com/hyperledger/composer/pull/3550,ðŸ’¯ ,49d6da55728e07bf1d26a75a28c837201f561621,2018-03-08 11:27:14,173132744,"@@ -152,5 +152,85 @@ Feature: Rest steps
         When I make a GET request to /api/system/ping
         Then The response code should be 401
 
+    Scenario: Using the REST API, I can log in using a different set of credentials",4,2018-03-08 11:28:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/173132744,https://github.com/hyperledger/composer/pull/3550#discussion_r173132744,nklincoln
https://github.com/hyperledger/composer/pull/3550,https://github.com/hyperledger/composer/pull/3550,I like error case checks in tests ðŸ‘ ,49d6da55728e07bf1d26a75a28c837201f561621,2018-03-08 11:27:46,173132838,"@@ -152,5 +152,85 @@ Feature: Rest steps
         When I make a GET request to /api/system/ping
         Then The response code should be 401
 
+    Scenario: Using the REST API, I can log in using a different set of credentials
+        When I make a POST request to /auth/ldap
+            """"""
+            {
+              ""username"": ""charlie"",
+              ""password"": ""bl0ckn0rr1sw0zh3re""
+            }
+            """"""
+        Then The response code should be 200
+
+    Scenario: Using the REST API, I cannot ping the network because I do not have a business network card in my wallet",14,2018-03-08 11:28:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/173132838,https://github.com/hyperledger/composer/pull/3550#discussion_r173132838,nklincoln
https://github.com/hyperledger/composer/pull/3550,https://github.com/hyperledger/composer/pull/3550,that guy gets everywhere,49d6da55728e07bf1d26a75a28c837201f561621,2018-03-08 11:28:22,173132950,"@@ -36,6 +36,10 @@ const users = [{
     cn: 'bob',
     name: 'Bob B',
     credentials: 'b0bIsB3tt3r'
+}, {
+    cn: 'charlie',
+    name: 'Charlie ""Chuck"" Norris',
+    credentials: 'bl0ckn0rr1sw0zh3re'",7,2018-03-08 11:28:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/173132950,https://github.com/hyperledger/composer/pull/3550#discussion_r173132950,nklincoln
https://github.com/hyperledger/composer/pull/3543,https://github.com/hyperledger/composer/pull/3543,"It was there originally; but what is the rationale for sort... the contact on the API doesn't specify an order.  
(a) extra processing not needed (b) people could spot the order and rely on it? (mistakenly?)",c46caa9fa4e519849f8e00517b9834280b5ec95f,2018-03-08 09:11:55,173099880,"@@ -33,93 +33,59 @@ class LoopBackWallet extends Wallet {
 
     /**
      * List all of the credentials in the wallet.
-     * @abstract
      * @return {Promise} A promise that is resolved with
      * an array of credential names, or rejected with an
      * error.
      */
-    list() {
-        return this.card.reload()
-            .then((card) => {
-                return Object.keys(card.data).sort();
-            });
+    async listNames() {
+        const card = await this.card.reload();
+        return Object.keys(card.data).sort();",16,2018-03-08 09:11:55,https://api.github.com/repos/hyperledger/composer/pulls/comments/173099880,https://github.com/hyperledger/composer/pull/3543#discussion_r173099880,mbwhite
https://github.com/hyperledger/composer/pull/3537,https://github.com/hyperledger/composer/pull/3537,This is needed by `scripts/pkgstamp.js`?,b255b3eac8a3d25b430ea71d38b2116aac8b21c9,2018-03-06 16:39:57,172580595,"@@ -3,7 +3,6 @@
     ""colors"": ""1.1.2"",
     ""lerna"": ""2.0.0"",
     ""licensecheck"": ""1.3.0"",
-    ""moment"": ""2.17.1"",",4,2018-03-13 13:34:24,https://api.github.com/repos/hyperledger/composer/pulls/comments/172580595,https://github.com/hyperledger/composer/pull/3537#discussion_r172580595,sstone1
https://github.com/hyperledger/composer/pull/3537,https://github.com/hyperledger/composer/pull/3537,:+1: for fixing hoist warnings!,b255b3eac8a3d25b430ea71d38b2116aac8b21c9,2018-03-06 16:40:29,172580789,"@@ -56,7 +56,7 @@
     ""moment"": ""2.19.3"",
     ""node-report"": ""2.2.1"",
     ""npm-paths"": ""0.1.3"",
-    ""nunjucks"": ""3.0.0"",
+    ""nunjucks"": ""3.0.1"",",5,2018-03-13 13:34:24,https://api.github.com/repos/hyperledger/composer/pulls/comments/172580789,https://github.com/hyperledger/composer/pull/3537#discussion_r172580789,sstone1
https://github.com/hyperledger/composer/pull/3537,https://github.com/hyperledger/composer/pull/3537,:+1: for fixing hoist warnings!,b255b3eac8a3d25b430ea71d38b2116aac8b21c9,2018-03-06 16:41:03,172580998,"@@ -42,7 +42,7 @@
   ""devDependencies"": {
     ""@angular/cli"": ""1.0.1"",
     ""@angular/compiler-cli"": ""^4.0.0"",
-    ""@types/jasmine"": ""2.5.38"",
+    ""@types/jasmine"": ""2.5.52"",",5,2018-03-13 13:34:24,https://api.github.com/repos/hyperledger/composer/pulls/comments/172580998,https://github.com/hyperledger/composer/pull/3537#discussion_r172580998,sstone1
https://github.com/hyperledger/composer/pull/3537,https://github.com/hyperledger/composer/pull/3537,:+1: for fixing hoist warnings!,b255b3eac8a3d25b430ea71d38b2116aac8b21c9,2018-03-06 16:41:07,172581019,"@@ -33,7 +33,7 @@
   ""devDependencies"": {
     ""@angular/cli"": ""1.0.0-rc.0"",
     ""@types/chai"": ""3.4.35"",
-    ""@types/jasmine"": ""2.5.38"",
+    ""@types/jasmine"": ""2.5.52"",",5,2018-03-13 13:34:24,https://api.github.com/repos/hyperledger/composer/pulls/comments/172581019,https://github.com/hyperledger/composer/pull/3537#discussion_r172581019,sstone1
https://github.com/hyperledger/composer/pull/3503,https://github.com/hyperledger/composer/pull/3503,Looks bad to me,4cb80dfdfa4d0dbd057d827db0adab0ee3feaafb,2018-02-28 16:18:30,171299520,"@@ -233,7 +233,7 @@ elif [[ ""${BUILD_RELEASE}"" = ""stable"" ]]; then
     # Add the version number changes and push them to Git.
     git add .
     git commit -m ""Automatic version bump to ${NEW_VERSION}""
-    git push origin v0.16.x
+    git push origin local_branch",,2018-03-01 08:30:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/171299520,https://github.com/hyperledger/composer/pull/3503#discussion_r171299520,jt-nti
https://github.com/hyperledger/composer/pull/3495,https://github.com/hyperledger/composer/pull/3495,why isn't this set to testProfileName,9be7938ebdbfafecd771eb486378f3cd9c7cd567,2018-02-28 10:40:11,171203669,"@@ -46,9 +46,12 @@ describe('AdminConnection', () => {
     let clock;
     let cardStore;
     let mockAdminIdCard;
+    let secretCard;
+    let credentialsCard;
+    let faultyCard;
 
     const config =
-        {
+        { name: 'profile',",,2018-02-28 22:28:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/171203669,https://github.com/hyperledger/composer/pull/3495#discussion_r171203669,cazfletch
https://github.com/hyperledger/composer/pull/3495,https://github.com/hyperledger/composer/pull/3495,can you remove this console.log,9be7938ebdbfafecd771eb486378f3cd9c7cd567,2018-02-28 10:57:28,171208574,"@@ -283,6 +283,7 @@ class HLFConnection extends Connection {
             })
             .catch((error) => {
                 const newError = new Error('Error trying login and get user Context. ' + error);
+                console.log(error.stack);",,2018-02-28 22:28:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/171208574,https://github.com/hyperledger/composer/pull/3495#discussion_r171208574,cazfletch
https://github.com/hyperledger/composer/pull/3495,https://github.com/hyperledger/composer/pull/3495,can we delete this commented out ocde,9be7938ebdbfafecd771eb486378f3cd9c7cd567,2018-02-28 11:40:26,171218366,"@@ -984,18 +997,19 @@ class TestUtil {
                 .then(() => {
                     return adminConnection.disconnect();
                 }).then(() => {
-                    return cardStore;
+                    return cardStoreForDeploy;
                 });
         } else if (forceDeploy) {
-            console.log(`Deploying business network ${businessNetworkDefinition.getName()} using deploy ...`);
-            // Connect and deploy the network.
-            return adminConnection.connectWithDetails('composer-systests', 'admin', 'Xurw3yU9zI0l')
-                .then(() => {
-                    return adminConnection.deploy(businessNetworkDefinition, {bootstrapTransactions});
-                })
-                .then(() => {
-                    return adminConnection.disconnect();
-                });
+            throw new Error('should not be using ForceDeploy');
+            // TestUtil.log(`Deploying business network ${businessNetworkDefinition.getName()} using deploy ...`);",,2018-02-28 22:28:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/171218366,https://github.com/hyperledger/composer/pull/3495#discussion_r171218366,cazfletch
https://github.com/hyperledger/composer/pull/3495,https://github.com/hyperledger/composer/pull/3495,think this should be uncommented and the code fixed to pass linting,9be7938ebdbfafecd771eb486378f3cd9c7cd567,2018-02-28 11:41:24,171218595,"@@ -0,0 +1,48 @@
+env:
+    es6: true
+    node: true
+    mocha: true
+extends: 'eslint:recommended'
+parserOptions:
+    ecmaVersion: 8
+    sourceType:
+        - script
+rules:
+    indent:
+        - error
+        - 4
+    linebreak-style:
+        - error
+        - unix
+    quotes:
+        - error
+        - single
+    semi:
+        - error
+        - always
+    no-unused-vars:
+        - error
+        - args: none
+    no-console: warn
+    curly: error
+    eqeqeq: error
+    no-throw-literal: error
+    strict: error
+    no-var: error
+    dot-notation: error
+    no-tabs: error
+    no-trailing-spaces: error
+    no-use-before-define: error
+    no-useless-call: error
+    no-with: error
+    operator-linebreak: error
+#    require-jsdoc:",,2018-02-28 22:28:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/171218595,https://github.com/hyperledger/composer/pull/3495#discussion_r171218595,cazfletch
https://github.com/hyperledger/composer/pull/3495,https://github.com/hyperledger/composer/pull/3495,can you uncomment this too please,9be7938ebdbfafecd771eb486378f3cd9c7cd567,2018-02-28 14:01:29,171252843,"@@ -0,0 +1,48 @@
+env:
+    es6: true
+    node: true
+    mocha: true
+extends: 'eslint:recommended'
+parserOptions:
+    ecmaVersion: 8
+    sourceType:
+        - script
+rules:
+    indent:
+        - error
+        - 4
+    linebreak-style:
+        - error
+        - unix
+    quotes:
+        - error
+        - single
+    semi:
+        - error
+        - always
+    no-unused-vars:
+        - error
+        - args: none
+    no-console: warn
+    curly: error
+    eqeqeq: error
+    no-throw-literal: error
+    strict: error
+    no-var: error
+    dot-notation: error
+    no-tabs: error
+    no-trailing-spaces: error
+    no-use-before-define: error
+    no-useless-call: error
+    no-with: error
+    operator-linebreak: error
+#    require-jsdoc:",,2018-02-28 22:28:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/171252843,https://github.com/hyperledger/composer/pull/3495#discussion_r171252843,cazfletch
https://github.com/hyperledger/composer/pull/3495,https://github.com/hyperledger/composer/pull/3495,why does this have @abstract and has an implementation,9be7938ebdbfafecd771eb486378f3cd9c7cd567,2018-02-28 14:02:48,171253201,"@@ -0,0 +1,165 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const path = require('path');
+const IdCard = require('composer-common').IdCard;
+const Wallet = require('composer-common').Wallet;
+
+/**
+ * String based key-val store,  A 'client-data' directory is created under the storePath option (or ~/.composer)
+ * @private
+*/
+class MemoryWallet extends Wallet{
+
+    /**
+     * @param {Object} options  Configuration options
+     * @param {Object} options.storePath  The root directory where this wallet can put thibngs
+     */
+    constructor(options){
+        super();
+        this.store = new Map();
+        this.namePrefix = options.namePrefix;
+    }
+    /**
+     * Get a ""path name"", this is not part of the interface but is used to create a suitable name
+     * to achieve separation of entries
+     *
+     * @private
+     * @param {String} name name to use as the key
+     * @return {String} full 'path' name
+     */
+    _path(name) {
+        if (name.startsWith(this.namePrefix)){
+            return name;
+        }else {
+            return path.join(this.namePrefix,name);
+        }
+    }
+    /**
+     * List all of the credentials in the wallet.
+     *
+     * @return {Promise} A promise that is resolved with
+     * an array of credential names, or rejected with an
+     * error.
+     */
+    listNames() {
+        let a = Array.from(this.store.keys());
+        let list = a.map( (e) => {
+            return e.replace(this.namePrefix+path.sep,'');
+        } );
+        return Promise.resolve(list);
+    }
+
+    /**
+     * Check to see if the named credentials are in
+     * the wallet.
+     * @abstract",,2018-02-28 22:28:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/171253201,https://github.com/hyperledger/composer/pull/3495#discussion_r171253201,cazfletch
https://github.com/hyperledger/composer/pull/3495,https://github.com/hyperledger/composer/pull/3495,They where copied from one module... but I've replaced the file with a fresh copy,9be7938ebdbfafecd771eb486378f3cd9c7cd567,2018-02-28 14:14:47,171256723,"@@ -0,0 +1,48 @@
+env:
+    es6: true
+    node: true
+    mocha: true
+extends: 'eslint:recommended'
+parserOptions:
+    ecmaVersion: 8
+    sourceType:
+        - script
+rules:
+    indent:
+        - error
+        - 4
+    linebreak-style:
+        - error
+        - unix
+    quotes:
+        - error
+        - single
+    semi:
+        - error
+        - always
+    no-unused-vars:
+        - error
+        - args: none
+    no-console: warn
+    curly: error
+    eqeqeq: error
+    no-throw-literal: error
+    strict: error
+    no-var: error
+    dot-notation: error
+    no-tabs: error
+    no-trailing-spaces: error
+    no-use-before-define: error
+    no-useless-call: error
+    no-with: error
+    operator-linebreak: error
+#    require-jsdoc:",,2018-02-28 22:28:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/171256723,https://github.com/hyperledger/composer/pull/3495#discussion_r171256723,mbwhite
https://github.com/hyperledger/composer/pull/3495,https://github.com/hyperledger/composer/pull/3495,They where copied from one module... but I've replaced the file with a fresh copy,9be7938ebdbfafecd771eb486378f3cd9c7cd567,2018-02-28 14:14:55,171256774,"@@ -0,0 +1,48 @@
+env:
+    es6: true
+    node: true
+    mocha: true
+extends: 'eslint:recommended'
+parserOptions:
+    ecmaVersion: 8
+    sourceType:
+        - script
+rules:
+    indent:
+        - error
+        - 4
+    linebreak-style:
+        - error
+        - unix
+    quotes:
+        - error
+        - single
+    semi:
+        - error
+        - always
+    no-unused-vars:
+        - error
+        - args: none
+    no-console: warn
+    curly: error
+    eqeqeq: error
+    no-throw-literal: error
+    strict: error
+    no-var: error
+    dot-notation: error
+    no-tabs: error
+    no-trailing-spaces: error
+    no-use-before-define: error
+    no-useless-call: error
+    no-with: error
+    operator-linebreak: error
+#    require-jsdoc:",,2018-02-28 22:28:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/171256774,https://github.com/hyperledger/composer/pull/3495#discussion_r171256774,mbwhite
https://github.com/hyperledger/composer/pull/3495,https://github.com/hyperledger/composer/pull/3495,it shouldn't.. removed abstract,9be7938ebdbfafecd771eb486378f3cd9c7cd567,2018-02-28 14:15:33,171256945,"@@ -0,0 +1,165 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const path = require('path');
+const IdCard = require('composer-common').IdCard;
+const Wallet = require('composer-common').Wallet;
+
+/**
+ * String based key-val store,  A 'client-data' directory is created under the storePath option (or ~/.composer)
+ * @private
+*/
+class MemoryWallet extends Wallet{
+
+    /**
+     * @param {Object} options  Configuration options
+     * @param {Object} options.storePath  The root directory where this wallet can put thibngs
+     */
+    constructor(options){
+        super();
+        this.store = new Map();
+        this.namePrefix = options.namePrefix;
+    }
+    /**
+     * Get a ""path name"", this is not part of the interface but is used to create a suitable name
+     * to achieve separation of entries
+     *
+     * @private
+     * @param {String} name name to use as the key
+     * @return {String} full 'path' name
+     */
+    _path(name) {
+        if (name.startsWith(this.namePrefix)){
+            return name;
+        }else {
+            return path.join(this.namePrefix,name);
+        }
+    }
+    /**
+     * List all of the credentials in the wallet.
+     *
+     * @return {Promise} A promise that is resolved with
+     * an array of credential names, or rejected with an
+     * error.
+     */
+    listNames() {
+        let a = Array.from(this.store.keys());
+        let list = a.map( (e) => {
+            return e.replace(this.namePrefix+path.sep,'');
+        } );
+        return Promise.resolve(list);
+    }
+
+    /**
+     * Check to see if the named credentials are in
+     * the wallet.
+     * @abstract",,2018-02-28 22:28:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/171256945,https://github.com/hyperledger/composer/pull/3495#discussion_r171256945,mbwhite
https://github.com/hyperledger/composer/pull/3467,https://github.com/hyperledger/composer/pull/3467,can you remove the comment please,b332bdeb05f195e74a8242785ab2adbd7fea6ec2,2018-02-27 13:52:52,170927540,"@@ -90,6 +93,28 @@ describe('AdminConnection', () => {
         delete process.env.COMPOSER_CONFIG;
         sandbox = sinon.sandbox.create();
         clock = sinon.useFakeTimers();
+        let faultyMetaData = { userName: 'fred',
+
+            description:'test'};
+
+        let minimalMetadata = { userName: 'fred',
+            businessNetwork:'network',
+            description:'test'};
+        let secretMetadata = { userName: 'fred',
+            businessNetwork:'network',
+            description:'test',
+            enrollmentSecret : 'password' };
+        let minimalConnectionProfile = config;//{ name: 'profile' };",,2018-02-27 22:35:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/170927540,https://github.com/hyperledger/composer/pull/3467#discussion_r170927540,cazfletch
https://github.com/hyperledger/composer/pull/3467,https://github.com/hyperledger/composer/pull/3467,more comments to remove,b332bdeb05f195e74a8242785ab2adbd7fea6ec2,2018-02-27 13:53:45,170927785,"@@ -90,6 +93,28 @@ describe('AdminConnection', () => {
         delete process.env.COMPOSER_CONFIG;
         sandbox = sinon.sandbox.create();
         clock = sinon.useFakeTimers();
+        let faultyMetaData = { userName: 'fred',
+
+            description:'test'};
+
+        let minimalMetadata = { userName: 'fred',
+            businessNetwork:'network',
+            description:'test'};
+        let secretMetadata = { userName: 'fred',
+            businessNetwork:'network',
+            description:'test',
+            enrollmentSecret : 'password' };
+        let minimalConnectionProfile = config;//{ name: 'profile' };
+        let validCredentials = {
+            certificate: 'cert',
+            privateKey: 'key'
+        };
+        // {certificate : 'cert', privateKey : 'key'}",,2018-02-27 22:35:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/170927785,https://github.com/hyperledger/composer/pull/3467#discussion_r170927785,cazfletch
https://github.com/hyperledger/composer/pull/3467,https://github.com/hyperledger/composer/pull/3467,more comments :(,b332bdeb05f195e74a8242785ab2adbd7fea6ec2,2018-02-27 13:56:49,170928764,"@@ -110,44 +135,44 @@ describe('AdminConnection', () => {
             adminConnection.cardStore.should.equal(cardStore);
         });
 
-        it('should use FileSystemCardStore as default card store', function () {
-            const adminConnection = new AdminConnection();
-            adminConnection.cardStore.should.be.an.instanceOf(FileSystemCardStore);
-        });
     });
 
     describe('#connect', () => {
-        let cardStub;
+
 
         beforeEach(() => {
+
             sinon.spy(cardStore, 'get');
-            cardStub = sinon.createStubInstance(IdCard);
-            cardStub.getConnectionProfile.returns({});
-            cardStub.getUserName.returns('fred');
-            cardStub.getBusinessNetworkName.returns('network');
-            cardStub.getCredentials.returns({});
-            cardStub.getEnrollmentCredentials.returns({secret : 'password'});
-            cardStore.put('testCardname', cardStub);
-
-            sinon.stub(adminConnection.connectionProfileManager, 'connectWithData').resolves(mockConnection);
+            // cardStub = sinon.createStubInstance(IdCard);",,2018-02-27 22:35:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/170928764,https://github.com/hyperledger/composer/pull/3467#discussion_r170928764,cazfletch
https://github.com/hyperledger/composer/pull/3467,https://github.com/hyperledger/composer/pull/3467,why has this changed?,b332bdeb05f195e74a8242785ab2adbd7fea6ec2,2018-02-27 14:15:22,170934559,"@@ -43,7 +43,7 @@ if (typeof(results.thePromise) !== 'undefined'){
         }
         process.exit(0);
     }).catch((error) => {
-        cmdUtil.log(error+chalk.red('\nCommand failed\n'));
+        console.log(error+chalk.red('\nCommand failed\n'));",,2018-02-27 22:35:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/170934559,https://github.com/hyperledger/composer/pull/3467#discussion_r170934559,cazfletch
https://github.com/hyperledger/composer/pull/3467,https://github.com/hyperledger/composer/pull/3467,remove if not needed,b332bdeb05f195e74a8242785ab2adbd7fea6ec2,2018-02-27 14:20:15,170936037,"@@ -72,15 +72,15 @@ module.exports.Field = require('./lib/introspect/field');
 module.exports.Factory = require('./lib/factory');
 module.exports.FileWallet = require('./lib/filewallet');
 module.exports.FileWriter = require('./lib/codegen/filewriter');
-module.exports.FileSystemCardStore = require('./lib/cardstore/filesystemcardstore');
+module.exports.NetworkCardStoreManager = require('./lib/cardstore/networkcardstoremanager');
 module.exports.FunctionDeclaration = require('./lib/introspect/functiondeclaration');
 module.exports.Globalize = require('./lib/globalize');
 module.exports.IdCard = require('./lib/idcard');
 module.exports.Introspector = require('./lib/introspect/introspector');
 module.exports.Limit = require('./lib/query/limit');
 module.exports.Logger = require('./lib/log/logger');
 module.exports.LoopbackVisitor = require('./lib/codegen/fromcto/loopback/loopbackvisitor');
-module.exports.MemoryCardStore = require('./lib/cardstore/memorycardstore');
+// module.exports.MemoryCardStore = require('./lib/cardstore/memorycardstore');",,2018-02-27 22:35:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/170936037,https://github.com/hyperledger/composer/pull/3467#discussion_r170936037,cazfletch
https://github.com/hyperledger/composer/pull/3467,https://github.com/hyperledger/composer/pull/3467,"""This is a preview....""????",b332bdeb05f195e74a8242785ab2adbd7fea6ec2,2018-02-27 14:21:54,170936558,"@@ -0,0 +1,74 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+let cardStore;
+const cfg = require('../config/configmediator.js');
+const WalletBackedStore = require('./walletbackedcardstore');
+
+const loadModule = require('../module/loadModule');
+const path=require('path');
+
+const moduleCache = {};
+/**
+ * Provides the loading mechanism for handling card stores.
+ * This uses system configuration to get the required type of the card store (a NPM module)
+ * This is then loaded and returned. This is currently set to be a singleton card store manager.
+ *
+ * The name of the module must start with 'composer-wallet' to help separate concerns and prevent just anything
+ * from being used.
+ *
+ * Assumptions:
+ *   That the supplied module is installed gloabally
+ *   That the module is a subclass of BusinessNetworkCardStore
+ *
+ * This is a preview, therefore subject to change (potentially in breaking ways)",,2018-02-27 22:35:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/170936558,https://github.com/hyperledger/composer/pull/3467#discussion_r170936558,cazfletch
https://github.com/hyperledger/composer/pull/3467,https://github.com/hyperledger/composer/pull/3467,do we really need a console.log here?,b332bdeb05f195e74a8242785ab2adbd7fea6ec2,2018-02-27 14:25:59,170937907,"@@ -0,0 +1,58 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+/** Prefix to use for all the config names
+ * @prvate
+*/
+const PREFIX='composer.';
+
+/**
+ * Mediates beween the NPM config module and the codebase
+ * Enables our isomorphic codebase to work in webpack
+ *
+ * @private
+ */
+class ConfigMediator {
+
+    /**
+     * Get a value with the 'name', giving back the acceptable 'init' value if the name is not present
+     * @param {String} name key of config value to look up, this will have the defined prefix added to it
+     * @param {Object} init if the config doesn't have the value (or can't be found for whatever reason) the default value to return
+     *
+     * @return {Object} supplied object or the init value if needed
+     */
+    static get(name, init) {
+        let key = PREFIX+name;
+        try {
+            // This weird code is needed to trick browserify (and webpack)
+            process.env.SUPPRESS_NO_CONFIG_WARNING = 'y';
+            const mod = 'config';
+            const req = require;
+            const config = req(mod);
+            if (config.has(key)) {
+                return config.get(key);
+            }
+        } catch (e) {
+            console.log(e);",,2018-02-27 22:35:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/170937907,https://github.com/hyperledger/composer/pull/3467#discussion_r170937907,cazfletch
https://github.com/hyperledger/composer/pull/3467,https://github.com/hyperledger/composer/pull/3467,more commented out stuff,b332bdeb05f195e74a8242785ab2adbd7fea6ec2,2018-02-27 14:26:12,170937963,"@@ -21,7 +21,8 @@ const LOG = Logger.getLog('ConnectionProfileManager');
 const connectionManagerLoaders = [];
 const connectionManagerClasses = {};
 const connectionManagers = {};
-
+// const loadModule = require('./module/loadModule');",,2018-02-27 22:35:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/170937963,https://github.com/hyperledger/composer/pull/3467#discussion_r170937963,cazfletch
https://github.com/hyperledger/composer/pull/3467,https://github.com/hyperledger/composer/pull/3467,:-(,b332bdeb05f195e74a8242785ab2adbd7fea6ec2,2018-02-27 14:26:31,170938065,"@@ -87,6 +88,17 @@ class ConnectionProfileManager {
                 if (!connectionManager) {
                     const mod = `composer-connector-${connectionType}`;
                     LOG.debug(METHOD, 'Looking for module', mod);
+
+                    // try{",,2018-02-27 22:35:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/170938065,https://github.com/hyperledger/composer/pull/3467#discussion_r170938065,cazfletch
https://github.com/hyperledger/composer/pull/3467,https://github.com/hyperledger/composer/pull/3467,why have you put the coverage down :-(,b332bdeb05f195e74a8242785ab2adbd7fea6ec2,2018-02-27 14:28:19,170938661,"@@ -117,9 +121,9 @@
     ],
     ""all"": true,
     ""check-coverage"": true,
-    ""statements"": 100,
-    ""branches"": 100,
-    ""functions"": 100,
-    ""lines"": 100
+    ""statements"": 10,",,2018-02-27 22:35:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/170938661,https://github.com/hyperledger/composer/pull/3467#discussion_r170938661,cazfletch
https://github.com/hyperledger/composer/pull/3462,https://github.com/hyperledger/composer/pull/3462,"Ummm, no to these comments ðŸ˜‚ ",60165a505ead04d38bec8d0865690047b7e7045b,2018-03-01 11:00:25,171524524,"@@ -15,27 +15,223 @@
 'use strict';
 
 const chai = require('chai');
+const sinon = require('sinon');
+const path = require('path');
+const yargs = require('yargs');
+const mockery = require('mockery');
+
+
 chai.should();
 chai.use(require('chai-as-promised'));
 chai.use(require('chai-things'));
-const sinon = require('sinon');
 
 
+// need to have this as the module cache will need to be cleared, and code reloaded per test
+const pathToCode = path.resolve(__dirname, '../../lib/codegen/parsejs.js');
+
 describe('parsejs', function () {
 
     let sandbox;
+    let optionsStub;
+    let stdout;
+    let stderr;
+
+    let parseStub;
+
+    let fsextraStubs;
+    let jsonGenerateSpy;
+    let apiGenerateSpy;
+    let plantGenerateSpy;
 
     beforeEach(() => {
+        //
+        mockery.enable({
+            warnOnReplace: false,
+            warnOnUnregistered: false
+        });
         sandbox = sinon.sandbox.create();
+
+        // stub out the yagrs cmd line handling
+        optionsStub = sandbox.stub(yargs, 'options');
+        sandbox.stub(yargs, 'usage').returns(yargs);
+        sandbox.stub(yargs, 'argv').returns();
+        sandbox.stub(process,'exit');
+
+        // create a fake file object that will be return one fs walk
+        // useing first/second call to prevent a loop
+        let fakeFile = {
+            stats : {
+                isFile :  sandbox.stub().onFirstCall().returns(true).onSecondCall().returns(false)
+            }
+        };
+
+        // setup stups for the fs-extra model
+        fsextraStubs = {};
+        let onStub = sandbox.stub();
+        // yes it returns it self, but it's one of those chaining things
+        onStub.returns({ 'on' : onStub});
+
+        let readStub = { read : sandbox.stub().onFirstCall().returns(fakeFile)
+                                              .onSecondCall().returns(fakeFile)
+                                              .onThirdCall().returns(null)};
+
+        // this handles the callback and ensure the 'this' context is correctly set
+        onStub.callsArgOn(1, readStub);
+
+
+        fsextraStubs.walk = sandbox.stub();
+        fsextraStubs.walk.callsFake(function fakeWalk(){
+            return { 'on' : onStub};
+        });
+
+        fsextraStubs.readFileSync = sandbox.stub();
+
+        // register the mock for the file system
+        mockery.registerMock('fs-extra', fsextraStubs);
+
+
+
+        // spy on the output
+        stdout = sandbox.spy(console,'log');
+        stderr = sandbox.spy(console,'error');
+
+        // register the mocks for  'path'
+        parseStub = sandbox.stub(path,'parse');
+        mockery.registerMock('path',  { parse:parseStub, resolve: sandbox.stub() } );
+
+
+        // The next section of code, is .... not the greatest IMHO",,2018-03-16 10:11:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/171524524,https://github.com/hyperledger/composer/pull/3462#discussion_r171524524,nklincoln
https://github.com/hyperledger/composer/pull/3462,https://github.com/hyperledger/composer/pull/3462,should it?,60165a505ead04d38bec8d0865690047b7e7045b,2018-03-01 11:01:28,171524741,"@@ -15,27 +15,223 @@
 'use strict';
 
 const chai = require('chai');
+const sinon = require('sinon');
+const path = require('path');
+const yargs = require('yargs');
+const mockery = require('mockery');
+
+
 chai.should();
 chai.use(require('chai-as-promised'));
 chai.use(require('chai-things'));
-const sinon = require('sinon');
 
 
+// need to have this as the module cache will need to be cleared, and code reloaded per test
+const pathToCode = path.resolve(__dirname, '../../lib/codegen/parsejs.js');
+
 describe('parsejs', function () {
 
     let sandbox;
+    let optionsStub;
+    let stdout;
+    let stderr;
+
+    let parseStub;
+
+    let fsextraStubs;
+    let jsonGenerateSpy;
+    let apiGenerateSpy;
+    let plantGenerateSpy;
 
     beforeEach(() => {
+        //
+        mockery.enable({
+            warnOnReplace: false,
+            warnOnUnregistered: false
+        });
         sandbox = sinon.sandbox.create();
+
+        // stub out the yagrs cmd line handling
+        optionsStub = sandbox.stub(yargs, 'options');
+        sandbox.stub(yargs, 'usage').returns(yargs);
+        sandbox.stub(yargs, 'argv').returns();
+        sandbox.stub(process,'exit');
+
+        // create a fake file object that will be return one fs walk
+        // useing first/second call to prevent a loop
+        let fakeFile = {
+            stats : {
+                isFile :  sandbox.stub().onFirstCall().returns(true).onSecondCall().returns(false)
+            }
+        };
+
+        // setup stups for the fs-extra model
+        fsextraStubs = {};
+        let onStub = sandbox.stub();
+        // yes it returns it self, but it's one of those chaining things
+        onStub.returns({ 'on' : onStub});
+
+        let readStub = { read : sandbox.stub().onFirstCall().returns(fakeFile)
+                                              .onSecondCall().returns(fakeFile)
+                                              .onThirdCall().returns(null)};
+
+        // this handles the callback and ensure the 'this' context is correctly set
+        onStub.callsArgOn(1, readStub);
+
+
+        fsextraStubs.walk = sandbox.stub();
+        fsextraStubs.walk.callsFake(function fakeWalk(){
+            return { 'on' : onStub};
+        });
+
+        fsextraStubs.readFileSync = sandbox.stub();
+
+        // register the mock for the file system
+        mockery.registerMock('fs-extra', fsextraStubs);
+
+
+
+        // spy on the output
+        stdout = sandbox.spy(console,'log');
+        stderr = sandbox.spy(console,'error');
+
+        // register the mocks for  'path'
+        parseStub = sandbox.stub(path,'parse');
+        mockery.registerMock('path',  { parse:parseStub, resolve: sandbox.stub() } );
+
+
+        // The next section of code, is .... not the greatest IMHO
+        // This was the only way I could get the Generator classes spied on in such
+        // a way that would be loaded by the test code and made to be certain
+        // they where being called.
+
+        // This creates a fake class with the generate method ( that we're interested in )
+        // Spies on that generate fn, and use mockery to inject that.
+
+
+        // eslint-disable-next-line require-jsdoc
+        class fakeClassJson  {
+            // eslint-disable-next-line require-jsdoc
+            constructor(){ }
+            // eslint-disable-next-line require-jsdoc
+            generate(){ }
+        }
+
+        jsonGenerateSpy = sandbox.spy(fakeClassJson.prototype,'generate');
+        mockery.registerMock('./fromjs/jsongenerator',fakeClassJson);
+
+        // eslint-disable-next-line require-jsdoc
+        class fakeClassAPISignature  {
+            // eslint-disable-next-line require-jsdoc
+            constructor(){ }
+            // eslint-disable-next-line require-jsdoc
+            generate(){ }
+        }
+        apiGenerateSpy = sandbox.spy(fakeClassAPISignature.prototype,'generate');
+        mockery.registerMock('./fromjs/apisignaturegenerator',fakeClassAPISignature);
+
+        // eslint-disable-next-line require-jsdoc
+        class fakeClassPlant {
+            // eslint-disable-next-line require-jsdoc
+            constructor(){ }
+            // eslint-disable-next-line require-jsdoc
+            generate(){ }
+        }
+        plantGenerateSpy = sandbox.spy(fakeClassPlant.prototype,'generate');
+        mockery.registerMock('./fromjs/plantumlgenerator',fakeClassPlant);
+
+
+        // clean the module cache
+        delete require.cache[pathToCode];
+
     });
 
     afterEach(() => {
+        mockery.deregisterAll();
+        sandbox.restore();
         sandbox.restore();
     });
 
-    describe('#maintest', function() {
-        it('main path', function() {
-           // require('../../lib/codegen/parsejs.js');
+    after(()=>{
+        delete require.cache[pathToCode];
+    });
+
+    describe('#missing options', function() {
+        it('should handle case where no file option is given', function() {
+            optionsStub.returns(yargs(['--outputDir=/tmp','--format=json']));
+            require(pathToCode);
+            stdout.should.have.been.calledWith(sinon.match(/no file option given/));
+        });
+
+        it('should handle case where no outputDir  option is given', function() {
+            optionsStub.returns(yargs(['--format=json']));
+            require(pathToCode);
+            stderr.should.have.been.calledWith(sinon.match(/Missing required argument: outputDir/));
+        });
+    });
+
+    describe('#JSON',()=>{
+        it('should process JSON format', function() {
+            optionsStub.returns(yargs(['--outputDir=/tmp','--format=JSON','--inputDir=in']));
+            parseStub.returns({ext:'.js',base:'something.js'});
+            require(pathToCode);
+
+            sinon.assert.calledOnce(jsonGenerateSpy);
+        });
+    });
+
+    describe('#APISignature',()=>{
+        it('should process APISignature format', function() {
+            optionsStub.returns(yargs(['--outputDir=/tmp','--format=APISignature','--inputDir=in']));
+            parseStub.returns({ext:'.js',base:'something.js'});
+            require(pathToCode);
+
+            sinon.assert.calledOnce(apiGenerateSpy);
+        });
+    });
+
+    describe('#PlantUML',()=>{
+        it('should process PlantUML format', function() {
+            optionsStub.returns(yargs(['--outputDir=/tmp','--format=PlantUML','--inputDir=in']));
+            parseStub.returns({ext:'.js',base:'something.js'});
+            require(pathToCode);
+
+            sinon.assert.calledOnce(plantGenerateSpy);
+        });
+    });
+
+    describe('#Default',()=>{
+        it('should process PlantUML as the default format', function() {
+            optionsStub.returns(yargs(['--outputDir=/tmp','--inputDir=in']));
+            parseStub.returns({ext:'.js',base:'something.js'});
+            require(pathToCode);
+            sinon.assert.calledOnce(plantGenerateSpy);
+        });
+        it('should process PlantUML as the default format, single file mode', function() {
+            optionsStub.returns(yargs(['--outputDir=/tmp','--single=in']));
+            parseStub.returns({ext:'.js',base:'something.js'});
+            require(pathToCode);
+            sinon.assert.calledOnce(plantGenerateSpy);
+        });
+        it('should cope with files that are a mix of js and non js ones', function(){
+            optionsStub.returns(yargs(['--outputDir=/tmp','--inputDir=in']));
+            parseStub.returns({ext:'.js',base:'something.js'});
+            require(pathToCode);
+            sinon.assert.calledOnce(plantGenerateSpy);
+        });
+        it('should not parse the parser.js file', function(){
+            optionsStub.returns(yargs(['--outputDir=/tmp','--inputDir=in']));
+            parseStub.returns({ext:'.js',base:'parser.js'});
+
+            require(pathToCode);
+            sinon.assert.notCalled(plantGenerateSpy);
+        });
+        it('should cope with files that wibble files', function(){",,2018-03-16 10:11:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/171524741,https://github.com/hyperledger/composer/pull/3462#discussion_r171524741,nklincoln
https://github.com/hyperledger/composer/pull/3439,https://github.com/hyperledger/composer/pull/3439,why have you commented this out?,8184f89bc2ba9230601bd098b9c4ae76a835a9e9,2018-02-21 00:19:49,169502674,"@@ -31,17 +32,17 @@ rules:
     dot-notation: error
     no-tabs: error
     no-trailing-spaces: error
-    # no-use-before-define: error
+    no-use-before-define: error
     no-useless-call: error
     no-with: error
     operator-linebreak: error
-    require-jsdoc:
-        - error
-        - require:
-            ClassDeclaration: true
-            MethodDefinition: true
-            FunctionDeclaration: true
-    valid-jsdoc:
-        - error
-        - requireReturn: false
+#    require-jsdoc:",,2018-02-22 19:24:24,https://api.github.com/repos/hyperledger/composer/pulls/comments/169502674,https://github.com/hyperledger/composer/pull/3439#discussion_r169502674,cazfletch
https://github.com/hyperledger/composer/pull/3439,https://github.com/hyperledger/composer/pull/3439,why have you taken this line out of all the eslint files?,8184f89bc2ba9230601bd098b9c4ae76a835a9e9,2018-02-21 22:53:03,169804497,"@@ -32,7 +32,6 @@ rules:
     dot-notation: error
     no-tabs: error
     no-trailing-spaces: error
-    no-use-before-define: error",,2018-02-22 19:24:24,https://api.github.com/repos/hyperledger/composer/pulls/comments/169804497,https://github.com/hyperledger/composer/pull/3439#discussion_r169804497,cazfletch
https://github.com/hyperledger/composer/pull/3424,https://github.com/hyperledger/composer/pull/3424,"""fabric"" should be replaced with {{site.data.conrefs.hlf_full}}.",d6bfa83d96011115f61d17ab1a746bf0b0f99536,2018-02-19 16:32:28,169124213,"@@ -65,8 +65,9 @@ await AdminConnection.install(businessNetworkDefinition.getName(), {npmrcFile: '
 
 
 ## {{site.data.conrefs.hlf_full}} Endorsement Policies
+You can provide fabric endorsement policies to both network start and network upgrade requests. The examples that follow show `start` but the approach is identical to `upgrade` as well.",,2018-02-19 16:50:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/169124213,https://github.com/hyperledger/composer/pull/3424#discussion_r169124213,EdProsser
https://github.com/hyperledger/composer/pull/3386,https://github.com/hyperledger/composer/pull/3386,"The initial participant of type NetworkAdmin will be bound to whatever information is passed on the panel. It doesn't have to be the bootstrap registrar it is upto the user to provide what is appropriate.
What is appropriate for our development environment and tutorials is to use the bootstrap registrar ",4d6f2cdb4d64c7584fc9e29b9bcc33556f0bad0f,2018-02-12 11:44:21,167531628,"@@ -65,12 +67,13 @@ If the business network administrator has an enrollment ID and enrollment secret
 
 ## Deploying business networks using Playground locally
 
-When deploying a business network to {{site.data.conrefs.hlf_full}} v1.0 using the Playground locally, you must follow the process above to connect using the peer admin identity.
+**Please note**: When using a local Playground instance to deploy a business network to {{site.data.conrefs.hlf_full}} v1.0, as part of the deployment process you must choose how to provide credentials for the initial business network participant. This initial participant uses the credentials set for the bootstrap registrar in the {{site.data.conrefs.hlf_full}} Certificate Authority (CA), and will be a [**NetworkAdmin**](https://github.com/hyperledger/composer/blob/master/packages/composer-common/lib/system/org.hyperledger.composer.system.cto).",,2018-02-12 12:00:47,https://api.github.com/repos/hyperledger/composer/pulls/comments/167531628,https://github.com/hyperledger/composer/pull/3386#discussion_r167531628,davidkel
https://github.com/hyperledger/composer/pull/3386,https://github.com/hyperledger/composer/pull/3386,We should delete this section completely.,4d6f2cdb4d64c7584fc9e29b9bcc33556f0bad0f,2018-02-12 11:46:51,167532030,"@@ -42,9 +41,13 @@ A simple connection profile that doesn't use TLS has the following format:
             ""timeout"": 300
         }
 
-If you are connecting to {{site.data.conrefs.hlf_full}} v1.0 and are not using TLS or if you don't need the trustedRoots and verify options of the Certificate Authority definition you can use the following simplified connection profile:
 
-A more complete example of a connection profile with all possible properties defined is shown here (property values are examples and not necessarily valid values)
+
+  If you are connecting to {{site.data.conrefs.hlf_full}} v1.0 and are not using TLS or if you don't need the trustedRoots and verify options of the Certificate Authority definition you can use the following simplified connection profile:
+
+  _Please note: The simplified version of the connection profile will only work if the relevant certificate authority has no name defined. If the certificate authority has a defined name, it must be specified._",,2018-02-12 12:00:47,https://api.github.com/repos/hyperledger/composer/pulls/comments/167532030,https://github.com/hyperledger/composer/pull/3386#discussion_r167532030,davidkel
https://github.com/hyperledger/composer/pull/3380,https://github.com/hyperledger/composer/pull/3380,do we really need a blank line between each one here?,fedb4e99c34e8bb1f45e3e5495347b6fd722034f,2018-02-19 14:13:05,169086387,"@@ -33,14 +33,31 @@ class Report {
 
     /**
      * Get the current environment data
+     * @return {Promise} Resolved when report completed
      */
     static createReport() {
-        cmdUtil.log(chalk.bold.blue('Creating Composer report'));
-        let tmpDirectory = report.setupReportDir();
-        cmdUtil.log(chalk.blue('Triggering node report...'));
-        report.createNodeReport(tmpDirectory);
-        let outputFile = report.archiveReport(tmpDirectory);
-        cmdUtil.log(chalk.bold.blue('Created archive file: '+outputFile));
+        try {",22,2018-02-21 10:16:23,https://api.github.com/repos/hyperledger/composer/pulls/comments/169086387,https://github.com/hyperledger/composer/pull/3380#discussion_r169086387,samjsmith
https://github.com/hyperledger/composer/pull/3380,https://github.com/hyperledger/composer/pull/3380,again with the blank lines,fedb4e99c34e8bb1f45e3e5495347b6fd722034f,2018-02-19 14:25:49,169089755,"@@ -17,4 +17,25 @@
 
 const report = require('../lib/report.js');
 
-report.report();
+try {
+    const {reportId, reportDir} = report.beginReport();
+
+    // eslint-disable-next-line no-console
+    console.log('Collecting diagnostic data...');",9,2018-02-21 10:16:23,https://api.github.com/repos/hyperledger/composer/pulls/comments/169089755,https://github.com/hyperledger/composer/pull/3380#discussion_r169089755,samjsmith
https://github.com/hyperledger/composer/pull/3376,https://github.com/hyperledger/composer/pull/3376,might want to condition this part too if an ESC action?,a7126beb9b2b846f16ca5c72d0db51f15f10fd6b,2018-02-12 17:14:14,167624294,"@@ -64,7 +64,9 @@ export class UpdateComponent extends ImportComponent {
             })
             .catch((error) => {
                 this.deployInProgress = false;
-                this.alertService.errorStatus$.next(error);
+                if (error !== DrawerDismissReasons.ESC ) {
+                  this.alertService.errorStatus$.next(error);
+                }
                 this.finishedSampleImport.emit({deployed: false, error: error});",,2018-02-13 16:37:22,https://api.github.com/repos/hyperledger/composer/pulls/comments/167624294,https://github.com/hyperledger/composer/pull/3376#discussion_r167624294,nklincoln
https://github.com/hyperledger/composer/pull/3376,https://github.com/hyperledger/composer/pull/3376,links to comment in next file ,a7126beb9b2b846f16ca5c72d0db51f15f10fd6b,2018-02-12 17:14:56,167624510,"@@ -489,6 +489,24 @@ describe('UpdateComponent', () => {
             mockAlertService.errorStatus$.next.should.have.been.calledWith('some error');
         }));
 
+        it('should handle dismiss by esc key by without showing an error modal', fakeAsync(() => {
+            component['currentBusinessNetwork'] = {network: 'my network'};
+            mockBusinessNetworkService.updateBusinessNetwork.returns(Promise.reject(DrawerDismissReasons.ESC));
+
+            component.finishedSampleImport.subscribe((result) => {
+                result.should.deep.equal({deployed: false, error: DrawerDismissReasons.ESC});
+            });
+
+            let deployPromise = component.deploy();
+
+            tick();
+
+            mockBusinessNetworkService.updateBusinessNetwork.should.have.been.calledWith({network: 'my network'});
+            component['deployInProgress'].should.equal(false);
+            finishedSampleImportSpy.should.have.been.calledWith({deployed: false, error: DrawerDismissReasons.ESC});",,2018-02-13 16:37:22,https://api.github.com/repos/hyperledger/composer/pulls/comments/167624510,https://github.com/hyperledger/composer/pull/3376#discussion_r167624510,nklincoln
https://github.com/hyperledger/composer/pull/3352,https://github.com/hyperledger/composer/pull/3352,"Unsure whether this would cause an error, but `(developer-tutorial.html)` might want to be: `(./developer-tutorial.html)`",bc07ab6279cced6593f8365e4bcfcb40771ab6db,2018-02-13 14:39:18,167883016,"@@ -0,0 +1,244 @@
+---
+layout: default
+title: Node-Red Tutorial
+category: tutorials
+section: tutorials
+index-order: 306
+sidebar: sidebars/accordion-toc0.md
+excerpt: ""TBC""
+---
+
+# Node-RED Tutorial for Integrating a {{site.data.conrefs.composer_full}} Business Network
+
+This tutorial demonstrates how to integrate an existing system of record data source into the blockchain ledger.  In this guide, we will build on the [Developer Tutorial](./developer-tutorial.html), extending it to bulk load records from a JSON text file data source to populate Participant and Asset registries in the sample 'Commodity Trading' business network.  
+
+[Node-RED](http://nodered.org) is a lightweight Open Source integration technology, written in JavaScript. It uses a graphical flow to integrate different _nodes_, where nodes can receive data, transform data and output data.
+
+Node-RED is commonly used to rapidly prototype Internet of Things style applications, or to wire existing Internet services together.
+
+You can use the {{site.data.conrefs.composer_full}} Node-RED contribution to:
+
+- Submit transactions
+- Read and update assets and participants
+- Subscribe to events
+- Delete assets and participants
+- Perform a bulk load (eg. loading test data)
+
+This tutorial gives an overview of the techniques and resources available to apply to your own use case.
+
+This tutorial uses the `tutorial-network` business network developed and deployed in the [Developer Tutorial](developer-tutorial.html).",,2018-02-13 14:55:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/167883016,https://github.com/hyperledger/composer/pull/3352#discussion_r167883016,EdProsser
https://github.com/hyperledger/composer/pull/3352,https://github.com/hyperledger/composer/pull/3352,This might be the problem. I don't think our link checker is sophisticated enough to understand that this is commented out.,bc07ab6279cced6593f8365e4bcfcb40771ab6db,2018-02-13 14:40:23,167883342,"@@ -0,0 +1,244 @@
+---
+layout: default
+title: Node-Red Tutorial
+category: tutorials
+section: tutorials
+index-order: 306
+sidebar: sidebars/accordion-toc0.md
+excerpt: ""TBC""
+---
+
+# Node-RED Tutorial for Integrating a {{site.data.conrefs.composer_full}} Business Network
+
+This tutorial demonstrates how to integrate an existing system of record data source into the blockchain ledger.  In this guide, we will build on the [Developer Tutorial](./developer-tutorial.html), extending it to bulk load records from a JSON text file data source to populate Participant and Asset registries in the sample 'Commodity Trading' business network.  
+
+[Node-RED](http://nodered.org) is a lightweight Open Source integration technology, written in JavaScript. It uses a graphical flow to integrate different _nodes_, where nodes can receive data, transform data and output data.
+
+Node-RED is commonly used to rapidly prototype Internet of Things style applications, or to wire existing Internet services together.
+
+You can use the {{site.data.conrefs.composer_full}} Node-RED contribution to:
+
+- Submit transactions
+- Read and update assets and participants
+- Subscribe to events
+- Delete assets and participants
+- Perform a bulk load (eg. loading test data)
+
+This tutorial gives an overview of the techniques and resources available to apply to your own use case.
+
+This tutorial uses the `tutorial-network` business network developed and deployed in the [Developer Tutorial](developer-tutorial.html).
+
+## Prerequisites
+
+Before beginning this tutorial:
+
+ - Complete the [development environment installation](../installing/development-tools.html).
+ - Complete the [developer tutorial](./developer-tutorial.html).
+
+This tutorial assumes the reader has some familiarity with Node-RED.  The [Node-RED](http://nodered.org) website has an introductory video and a getting started link.
+
+
+## Step One: Install and Start Node-RED
+
+Node-RED is a Node.js application and should be installed on a {{site.data.conrefs.composer}} development environment with the following command `npm install -g node-red` 
+
+Use the following command to start Node-RED `node-red`
+
+The command output will show that Node-Red server is now running at http://127.0.0.1:1880/ - open this link in a Browser to see the Node-RED UI.
+
+
+## Step Two: Install Composer Nodes
+
+The Composer Nodes for Node-RED are described here https://www.npmjs.com/package/node-red-contrib-composer and can be installed into Node-RED through the UI.
+
+1. On the Node-RED UI Menu, click **Manage palette**, the click on the **Install** tab.  In the **search modules** field type _node-red-contrib-composer_, then click the **Install** button and on the confirmation dialog click the red **Install** button.
+
+The nodes take a few moments to install, and a message will be shown in the UI and in the terminal window where Node-RED was started.
+
+2. Verify that the nodes are installed by scrolling to the end of the Palette on the left of the UI - a new category called **Hyperledger** should be at the bottom with the three nodes.
+
+
+## Step Three: Install fs Node
+
+This tutorial uses JSON data from text files and needs additional nodes _node-red-contrib-fs_
+
+1. On the Node-RED UI Menu, click **Manage palette**, the click on the **Install** tab.  In the **search modules** field type _node-red-contrib-fs_, then click the **Install** button and on the confirmation dialog click the red **Install** button.
+
+2. Verify that the **fs file lister** node has been added to the Storage category on the Palette.
+
+
+## Step Four: Build Flow
+
+The image below shows what the completed flow will look like.
+<!-- ![Node RED Flow](nodered-flow.png) -->",,2018-02-13 14:55:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/167883342,https://github.com/hyperledger/composer/pull/3352#discussion_r167883342,EdProsser
https://github.com/hyperledger/composer/pull/3344,https://github.com/hyperledger/composer/pull/3344,Can you add in why you would want to do this i.e. because not all fabric functionality is available in composer so this allows you to use fabric functionality,70b33a2dfb8ef4cd12398327508cc7f422d6ecf3,2018-02-07 11:35:53,166591737,"@@ -279,6 +285,43 @@ async function sampleTransaction(tx) {
 }
 ```
 
+### Calling {{site.data.conrefs.hlf_full}} {{site.data.conrefs.hlf_latest}} APIs in transaction processor functions
+
+To call the {{site.data.conrefs.hlf_full}} API in a transaction processor function, the function `getNativeAPI` must be called, followed by a function from the {{site.data.conrefs.hlf_full}} API.",,2018-02-07 15:15:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/166591737,https://github.com/hyperledger/composer/pull/3344#discussion_r166591737,cazfletch
https://github.com/hyperledger/composer/pull/3344,https://github.com/hyperledger/composer/pull/3344,Can you also add a warning that if you call the API's getState and putState this will bypass ACL rules,70b33a2dfb8ef4cd12398327508cc7f422d6ecf3,2018-02-07 11:36:28,166591865,"@@ -279,6 +285,43 @@ async function sampleTransaction(tx) {
 }
 ```
 
+### Calling {{site.data.conrefs.hlf_full}} {{site.data.conrefs.hlf_latest}} APIs in transaction processor functions
+
+To call the {{site.data.conrefs.hlf_full}} API in a transaction processor function, the function `getNativeAPI` must be called, followed by a function from the {{site.data.conrefs.hlf_full}} API.
+",,2018-02-07 15:15:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/166591865,https://github.com/hyperledger/composer/pull/3344#discussion_r166591865,cazfletch
https://github.com/hyperledger/composer/pull/3344,https://github.com/hyperledger/composer/pull/3344,"Can you also add that the results are the stored in an array, and that the results can then be used as part of the TP function to do something useful",70b33a2dfb8ef4cd12398327508cc7f422d6ecf3,2018-02-07 11:38:04,166592244,"@@ -279,6 +285,43 @@ async function sampleTransaction(tx) {
 }
 ```
 
+### Calling {{site.data.conrefs.hlf_full}} {{site.data.conrefs.hlf_latest}} APIs in transaction processor functions
+
+To call the {{site.data.conrefs.hlf_full}} API in a transaction processor function, the function `getNativeAPI` must be called, followed by a function from the {{site.data.conrefs.hlf_full}} API.
+
+In the example below, the {{site.data.conrefs.hlf_full}} API function `getHistoryForKey` is called, which returns the history of a specified asset as an iterator.",,2018-02-07 15:15:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/166592244,https://github.com/hyperledger/composer/pull/3344#discussion_r166592244,cazfletch
https://github.com/hyperledger/composer/pull/3344,https://github.com/hyperledger/composer/pull/3344,Can you check that in the built docs the indentation is ok on the code,70b33a2dfb8ef4cd12398327508cc7f422d6ecf3,2018-02-07 11:38:48,166592397,"@@ -279,6 +285,43 @@ async function sampleTransaction(tx) {
 }
 ```
 
+### Calling {{site.data.conrefs.hlf_full}} {{site.data.conrefs.hlf_latest}} APIs in transaction processor functions
+
+To call the {{site.data.conrefs.hlf_full}} API in a transaction processor function, the function `getNativeAPI` must be called, followed by a function from the {{site.data.conrefs.hlf_full}} API.
+
+In the example below, the {{site.data.conrefs.hlf_full}} API function `getHistoryForKey` is called, which returns the history of a specified asset as an iterator.
+
+For more information on the {{site.data.conrefs.hlf_full}} APIs you can call in a transaction processor function, see the [{{site.data.conrefs.hlf_full}} API documentation](https://fabric-shim.github.io/ChaincodeStub.html).
+
+```javascript",,2018-02-07 15:15:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/166592397,https://github.com/hyperledger/composer/pull/3344#discussion_r166592397,cazfletch
https://github.com/hyperledger/composer/pull/3344,https://github.com/hyperledger/composer/pull/3344,"Looks ok to me: 

![screen shot 2018-02-07 at 11 50 22](https://user-images.githubusercontent.com/12547179/35915097-951fa65c-0bfd-11e8-942f-933b16f11928.png)
",70b33a2dfb8ef4cd12398327508cc7f422d6ecf3,2018-02-07 11:54:05,166595608,"@@ -279,6 +285,43 @@ async function sampleTransaction(tx) {
 }
 ```
 
+### Calling {{site.data.conrefs.hlf_full}} {{site.data.conrefs.hlf_latest}} APIs in transaction processor functions
+
+To call the {{site.data.conrefs.hlf_full}} API in a transaction processor function, the function `getNativeAPI` must be called, followed by a function from the {{site.data.conrefs.hlf_full}} API.
+
+In the example below, the {{site.data.conrefs.hlf_full}} API function `getHistoryForKey` is called, which returns the history of a specified asset as an iterator.
+
+For more information on the {{site.data.conrefs.hlf_full}} APIs you can call in a transaction processor function, see the [{{site.data.conrefs.hlf_full}} API documentation](https://fabric-shim.github.io/ChaincodeStub.html).
+
+```javascript",,2018-02-07 15:15:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/166595608,https://github.com/hyperledger/composer/pull/3344#discussion_r166595608,EdProsser
https://github.com/hyperledger/composer/pull/3344,https://github.com/hyperledger/composer/pull/3344,"No the indentation is wrong, the consts should all line up, and it would be better if the `getNativeAPI()` line was on the line about where it says `const nativeKey`",70b33a2dfb8ef4cd12398327508cc7f422d6ecf3,2018-02-07 11:56:08,166596043,"@@ -279,6 +285,43 @@ async function sampleTransaction(tx) {
 }
 ```
 
+### Calling {{site.data.conrefs.hlf_full}} {{site.data.conrefs.hlf_latest}} APIs in transaction processor functions
+
+To call the {{site.data.conrefs.hlf_full}} API in a transaction processor function, the function `getNativeAPI` must be called, followed by a function from the {{site.data.conrefs.hlf_full}} API.
+
+In the example below, the {{site.data.conrefs.hlf_full}} API function `getHistoryForKey` is called, which returns the history of a specified asset as an iterator.
+
+For more information on the {{site.data.conrefs.hlf_full}} APIs you can call in a transaction processor function, see the [{{site.data.conrefs.hlf_full}} API documentation](https://fabric-shim.github.io/ChaincodeStub.html).
+
+```javascript",,2018-02-07 15:15:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/166596043,https://github.com/hyperledger/composer/pull/3344#discussion_r166596043,cazfletch
https://github.com/hyperledger/composer/pull/3344,https://github.com/hyperledger/composer/pull/3344,"Its not that they shouldn't be used its that you just need to know this will happen, and so its recommended that you don't use them to access composer assets that way buts its fine to access fabric data that way",70b33a2dfb8ef4cd12398327508cc7f422d6ecf3,2018-02-07 14:31:22,166633528,"@@ -279,6 +285,45 @@ async function sampleTransaction(tx) {
 }
 ```
 
+### Calling {{site.data.conrefs.hlf_full}} {{site.data.conrefs.hlf_latest}} APIs in transaction processor functions
+
+To call the {{site.data.conrefs.hlf_full}} API in a transaction processor function, the function `getNativeAPI` must be called, followed by a function from the {{site.data.conrefs.hlf_full}} API. Using the {{site.data.conrefs.hlf_full}} API gives you access to functionality which is not available in the {{site.data.conrefs.composer_full}} API.
+
+*Please note: The `getState` and `putState` {{site.data.conrefs.hlf_full}} API functions will bypass the {{site.data.conrefs.composer_full}} access control rules and should not be used.*",,2018-02-07 15:15:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/166633528,https://github.com/hyperledger/composer/pull/3344#discussion_r166633528,cazfletch
https://github.com/hyperledger/composer/pull/3344,https://github.com/hyperledger/composer/pull/3344,"The iterator isn't stored in an array, what gets returned is an iterator, then the function iterates over each item and adds it to an array",70b33a2dfb8ef4cd12398327508cc7f422d6ecf3,2018-02-07 14:32:32,166633898,"@@ -279,6 +285,45 @@ async function sampleTransaction(tx) {
 }
 ```
 
+### Calling {{site.data.conrefs.hlf_full}} {{site.data.conrefs.hlf_latest}} APIs in transaction processor functions
+
+To call the {{site.data.conrefs.hlf_full}} API in a transaction processor function, the function `getNativeAPI` must be called, followed by a function from the {{site.data.conrefs.hlf_full}} API. Using the {{site.data.conrefs.hlf_full}} API gives you access to functionality which is not available in the {{site.data.conrefs.composer_full}} API.
+
+*Please note: The `getState` and `putState` {{site.data.conrefs.hlf_full}} API functions will bypass the {{site.data.conrefs.composer_full}} access control rules and should not be used.*
+
+In the example below, the {{site.data.conrefs.hlf_full}} API function `getHistoryForKey` is called, which returns the history of a specified asset as an iterator stored in an array. This array can then be used in the transaction processor function.",,2018-02-07 15:15:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/166633898,https://github.com/hyperledger/composer/pull/3344#discussion_r166633898,cazfletch
https://github.com/hyperledger/composer/pull/3342,https://github.com/hyperledger/composer/pull/3342,It would be great to have a shareable linting config for composer projects rather than including potentially divergent rules in each project. (Not something to fix in this PR obviously!),a40f7d10a480787a4ab2e1588bb2184dbe5d7e48,2018-02-07 11:36:27,166591859,"@@ -0,0 +1,47 @@
+env:",1,2018-02-07 11:59:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/166591859,https://github.com/hyperledger/composer/pull/3342#discussion_r166591859,jt-nti
https://github.com/hyperledger/composer/pull/3342,https://github.com/hyperledger/composer/pull/3342,Dependencies should all be exact versions because we don't shrinkwrap anything yet,a40f7d10a480787a4ab2e1588bb2184dbe5d7e48,2018-02-07 11:47:44,166594324,"@@ -0,0 +1,64 @@
+{
+  ""name"": ""composer-validate-profile"",
+  ""version"": ""0.1.0"",
+  ""description"": ""Utility for validating Connection Profiles used by Hyperledger Composer"",
+  ""bin"": ""bin/cmd.js"",
+  ""main"": ""lib/profilevalidator.js"",
+  ""engines"": {
+    ""node"": "">=8"",
+    ""npm"": "">=5""
+  },
+  ""repository"": {
+    ""type"": ""git"",
+    ""url"": ""git+https://github.com/hyperledger/composer.git""
+  },
+  ""keywords"": [
+    ""hyperledger"",
+    ""composer"",
+    ""connection"",
+    ""profile""
+  ],
+  ""author"": ""Sam Smith"",
+  ""license"": ""Apache-2.0"",
+  ""bugs"": {
+    ""url"": ""https://github.com/hyperledger/composer/issues""
+  },
+  ""scripts"": {
+    ""pretest"": ""npm run lint"",
+    ""lint"": ""eslint ."",
+    ""postlint"": ""npm run licchk"",
+    ""licchk"": ""license-check"",
+    ""test"": ""mocha --recursive && istanbul cover --include-all-sources --report cobertura --report html ./node_modules/mocha/bin/_mocha -- --recursive"",
+    ""posttest"": ""istanbul check-coverage""
+  },
+  ""license-check-config"": {
+    ""src"": [
+      ""**/*.js"",
+      ""!./bin/cmd.js"",
+      ""!./coverage/**/*"",
+      ""!./node_modules/**/*"",
+      ""!./out/**/*""
+    ],
+    ""path"": ""header.txt"",
+    ""blocking"": true,
+    ""logInfo"": false,
+    ""logError"": true
+  },
+  ""devDependencies"": {",47,2018-02-07 11:59:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/166594324,https://github.com/hyperledger/composer/pull/3342#discussion_r166594324,jt-nti
https://github.com/hyperledger/composer/pull/3342,https://github.com/hyperledger/composer/pull/3342,Dependencies should all be exact versions because we don't shrinkwrap anything yet,a40f7d10a480787a4ab2e1588bb2184dbe5d7e48,2018-02-07 11:47:52,166594349,"@@ -0,0 +1,64 @@
+{
+  ""name"": ""composer-validate-profile"",
+  ""version"": ""0.1.0"",
+  ""description"": ""Utility for validating Connection Profiles used by Hyperledger Composer"",
+  ""bin"": ""bin/cmd.js"",
+  ""main"": ""lib/profilevalidator.js"",
+  ""engines"": {
+    ""node"": "">=8"",
+    ""npm"": "">=5""
+  },
+  ""repository"": {
+    ""type"": ""git"",
+    ""url"": ""git+https://github.com/hyperledger/composer.git""
+  },
+  ""keywords"": [
+    ""hyperledger"",
+    ""composer"",
+    ""connection"",
+    ""profile""
+  ],
+  ""author"": ""Sam Smith"",
+  ""license"": ""Apache-2.0"",
+  ""bugs"": {
+    ""url"": ""https://github.com/hyperledger/composer/issues""
+  },
+  ""scripts"": {
+    ""pretest"": ""npm run lint"",
+    ""lint"": ""eslint ."",
+    ""postlint"": ""npm run licchk"",
+    ""licchk"": ""license-check"",
+    ""test"": ""mocha --recursive && istanbul cover --include-all-sources --report cobertura --report html ./node_modules/mocha/bin/_mocha -- --recursive"",
+    ""posttest"": ""istanbul check-coverage""
+  },
+  ""license-check-config"": {
+    ""src"": [
+      ""**/*.js"",
+      ""!./bin/cmd.js"",
+      ""!./coverage/**/*"",
+      ""!./node_modules/**/*"",
+      ""!./out/**/*""
+    ],
+    ""path"": ""header.txt"",
+    ""blocking"": true,
+    ""logInfo"": false,
+    ""logError"": true
+  },
+  ""devDependencies"": {
+    ""eslint"": ""^3.5.0"",
+    ""istanbul"": ""^0.4.5"",
+    ""license-check"": ""^1.1.5"",
+    ""chai"": ""3.5.0"",
+    ""chai-as-promised"": ""6.0.0"",
+    ""mocha"": ""3.4.2"",
+    ""nyc"": ""11.1.0"",
+    ""sinon"": ""2.3.8""
+  },
+  ""homepage"": ""https://github.com/hyperledger/composer-tools#readme"",
+  ""dependencies"": {",58,2018-02-07 11:59:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/166594349,https://github.com/hyperledger/composer/pull/3342#discussion_r166594349,jt-nti
https://github.com/hyperledger/composer/pull/3342,https://github.com/hyperledger/composer/pull/3342,Why is reportError exported?,a40f7d10a480787a4ab2e1588bb2184dbe5d7e48,2018-02-07 11:50:24,166594851,"@@ -0,0 +1,119 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+const path = require('path');
+const fs = require('fs');
+const yaml = require('js-yaml');
+const ajv = require('ajv');
+const chalk = require('chalk');
+
+const ajvconfig = {
+    allErrors : true
+};
+
+/**
+ * validateProfile
+ * validates connection profile
+ * @param {String} filename the input filename
+ * @param {String} schematype the desired schema 'composer' (default and more restrictive) or 'fabric'
+ */
+function validateProfile(filename, schematype) {
+    let path = validateInputFilename(filename);
+    let profile = loadProfile(path);
+    let schema = loadSchema(schematype);
+    let validate = new ajv(ajvconfig).compile(schema);
+    console.log(chalk.blue('\nValidating profile file: ') + chalk.blue.bold(filename));
+    validate(profile);
+    if(validate.errors) {
+        console.log(chalk.red.bold('ERROR: ') + chalk.red('the profile contains the following errors\n'));
+        validate.errors.forEach(err => {
+            this.reportError(err);
+        });
+    } else {
+        console.log(chalk.blue.bold('SUCCESS: ') + chalk.blue('the profile is valid\n'));
+    }
+}
+
+/**
+ * reportErrors
+ * @param {Object} error the error
+ */
+function reportError(error) {
+    console.log(typeof error);
+    console.log(error);
+}
+
+/**
+ * Validate the input
+ * @param {String} filename input file to validate
+ * @return {String} the path to the file to load
+ */
+function validateInputFilename(filename) {
+    if(!filename) {
+        throw new Error('Error: no file name specified');
+    }
+    const isJSON = filename.toLowerCase().endsWith('json');
+    const isYAML = filename.toLowerCase().endsWith('yaml');
+    if(!isJSON && !isYAML) {
+        throw Error( 'Usage ERROR: please supply a JSON or YAML connection profile');
+    }
+    const filePath = path.resolve(filename);
+    return filePath;
+}
+
+/**
+ * Loads the profile into an object for validation.
+ * @param {String} inputPath the path to the file to load
+ * @return {Object} JSON profile object
+ */
+function loadProfile(inputPath) {
+    const filePath = path.resolve(inputPath);
+    if (filePath.toLowerCase().endsWith('json')) {
+        return JSON.parse(readFileSync(filePath));
+    } else {
+        return yaml.safeLoad(readFileSync(filePath));
+    }
+}
+
+/**
+ * Loads the JSON Schema into an object for compilation.
+ * @param {String} schematype the desired schema 'composer' (more restrictive) or 'fabric'
+ * @return {Object} JSON schema object
+ */
+function loadSchema(schematype) {
+    let filepath;
+    if(!schematype || schematype === 'composer') {
+        filepath = path.resolve('./schema/ccpschema.json');
+    } else if (schematype === 'fabric') {
+        filepath = path.resolve('./schema/ccpschema.fabric.json');
+    } else {
+        throw new Error('Error: Invalid schema type specified');
+    }
+    return JSON.parse(readFileSync(filepath));
+}
+
+/**
+ * Read a file from disc and return the result or throw an error.
+ * @param {String} filePath file to load
+ * @return {String} with contents or throws an error
+*/
+function readFileSync(filePath) {
+    let content;
+    content = fs.readFileSync(filePath, 'utf8');
+    return content;
+}
+
+module.exports = { validateProfile, reportError };",118,2018-02-07 11:59:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/166594851,https://github.com/hyperledger/composer/pull/3342#discussion_r166594851,jt-nti
https://github.com/hyperledger/composer/pull/3342,https://github.com/hyperledger/composer/pull/3342,"I don't know what the rules for connection profiles are but this looks like a schema to me :)
It would be nice to modify the structure of this and ccpschema.json to remove duplication though",a40f7d10a480787a4ab2e1588bb2184dbe5d7e48,2018-02-07 11:58:20,166596584,"@@ -0,0 +1,176 @@
+{ ",1,2018-02-07 11:59:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/166596584,https://github.com/hyperledger/composer/pull/3342#discussion_r166596584,jt-nti
https://github.com/hyperledger/composer/pull/3342,https://github.com/hyperledger/composer/pull/3342,ðŸ‘ ,a40f7d10a480787a4ab2e1588bb2184dbe5d7e48,2018-02-07 12:01:48,166597391,"@@ -0,0 +1,47 @@
+env:",1,2018-02-07 12:01:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/166597391,https://github.com/hyperledger/composer/pull/3342#discussion_r166597391,samjsmith
https://github.com/hyperledger/composer/pull/3342,https://github.com/hyperledger/composer/pull/3342,"Yes, admittedly I took the quick and easy option of cloning the composer schema and adapting it for what appear to be the fabric rules. I'm not sure this is going to be allowed in anyway so maybe something to look at once that's been decided.",a40f7d10a480787a4ab2e1588bb2184dbe5d7e48,2018-02-07 12:04:26,166597862,"@@ -0,0 +1,176 @@
+{ ",1,2018-02-07 12:04:26,https://api.github.com/repos/hyperledger/composer/pulls/comments/166597862,https://github.com/hyperledger/composer/pull/3342#discussion_r166597862,samjsmith
https://github.com/hyperledger/composer/pull/3342,https://github.com/hyperledger/composer/pull/3342,Valid point.  I'll try to just spy on the console log instead thanks.,a40f7d10a480787a4ab2e1588bb2184dbe5d7e48,2018-02-07 12:05:13,166598001,"@@ -0,0 +1,119 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+const path = require('path');
+const fs = require('fs');
+const yaml = require('js-yaml');
+const ajv = require('ajv');
+const chalk = require('chalk');
+
+const ajvconfig = {
+    allErrors : true
+};
+
+/**
+ * validateProfile
+ * validates connection profile
+ * @param {String} filename the input filename
+ * @param {String} schematype the desired schema 'composer' (default and more restrictive) or 'fabric'
+ */
+function validateProfile(filename, schematype) {
+    let path = validateInputFilename(filename);
+    let profile = loadProfile(path);
+    let schema = loadSchema(schematype);
+    let validate = new ajv(ajvconfig).compile(schema);
+    console.log(chalk.blue('\nValidating profile file: ') + chalk.blue.bold(filename));
+    validate(profile);
+    if(validate.errors) {
+        console.log(chalk.red.bold('ERROR: ') + chalk.red('the profile contains the following errors\n'));
+        validate.errors.forEach(err => {
+            this.reportError(err);
+        });
+    } else {
+        console.log(chalk.blue.bold('SUCCESS: ') + chalk.blue('the profile is valid\n'));
+    }
+}
+
+/**
+ * reportErrors
+ * @param {Object} error the error
+ */
+function reportError(error) {
+    console.log(typeof error);
+    console.log(error);
+}
+
+/**
+ * Validate the input
+ * @param {String} filename input file to validate
+ * @return {String} the path to the file to load
+ */
+function validateInputFilename(filename) {
+    if(!filename) {
+        throw new Error('Error: no file name specified');
+    }
+    const isJSON = filename.toLowerCase().endsWith('json');
+    const isYAML = filename.toLowerCase().endsWith('yaml');
+    if(!isJSON && !isYAML) {
+        throw Error( 'Usage ERROR: please supply a JSON or YAML connection profile');
+    }
+    const filePath = path.resolve(filename);
+    return filePath;
+}
+
+/**
+ * Loads the profile into an object for validation.
+ * @param {String} inputPath the path to the file to load
+ * @return {Object} JSON profile object
+ */
+function loadProfile(inputPath) {
+    const filePath = path.resolve(inputPath);
+    if (filePath.toLowerCase().endsWith('json')) {
+        return JSON.parse(readFileSync(filePath));
+    } else {
+        return yaml.safeLoad(readFileSync(filePath));
+    }
+}
+
+/**
+ * Loads the JSON Schema into an object for compilation.
+ * @param {String} schematype the desired schema 'composer' (more restrictive) or 'fabric'
+ * @return {Object} JSON schema object
+ */
+function loadSchema(schematype) {
+    let filepath;
+    if(!schematype || schematype === 'composer') {
+        filepath = path.resolve('./schema/ccpschema.json');
+    } else if (schematype === 'fabric') {
+        filepath = path.resolve('./schema/ccpschema.fabric.json');
+    } else {
+        throw new Error('Error: Invalid schema type specified');
+    }
+    return JSON.parse(readFileSync(filepath));
+}
+
+/**
+ * Read a file from disc and return the result or throw an error.
+ * @param {String} filePath file to load
+ * @return {String} with contents or throws an error
+*/
+function readFileSync(filePath) {
+    let content;
+    content = fs.readFileSync(filePath, 'utf8');
+    return content;
+}
+
+module.exports = { validateProfile, reportError };",118,2018-02-07 12:05:13,https://api.github.com/repos/hyperledger/composer/pulls/comments/166598001,https://github.com/hyperledger/composer/pull/3342#discussion_r166598001,samjsmith
https://github.com/hyperledger/composer/pull/3337,https://github.com/hyperledger/composer/pull/3337,looking good - could we check for the existence of the file in the directory plz?,813b54191fa2e511b4607e7693ccc0ebe86503a8,2018-02-06 13:51:23,166304561,"@@ -367,5 +367,15 @@ Feature: Cli steps
         Then The stdout information should include text matching /The current identity, with the name '.+?' and the identifier '.+?', has been revoked/
         Then The stderr information should include text matching /List business network from card bob@basic-sample-network/
 
+    Scenario: Using the CLI, I can run a composer report command to create a file about the current environment
+        When I run the following CLI command
+            """"""
+            composer report
+            """"""
+        Then The stdout information should include text matching /Creating Composer report/
+        Then The stdout information should include text matching /Triggering node report.../
+        Then The stdout information should include text matching /Created archive file: composer-report-/
+        Then The stdout information should include text matching /Command succeeded/
+",,2018-02-07 06:14:24,https://api.github.com/repos/hyperledger/composer/pulls/comments/166304561,https://github.com/hyperledger/composer/pull/3337#discussion_r166304561,nklincoln
https://github.com/hyperledger/composer/pull/3321,https://github.com/hyperledger/composer/pull/3321,typo on 'punchual' (assume you intended 'punctual'),55d87e97148e79c273a51a8e810139c97b5fc8cd,2018-02-06 15:32:24,166340157,"@@ -64,6 +64,20 @@ query Q17 {
 }
 ```
 
+#### Sample Contains queries
+
+The `CONTAINS` filter is used to search a array field in a node. The below query returns all the drivers who earned the punchual and steady-driving badges. Considering that the badges is of array type in driver participant.",,2018-02-07 19:28:42,https://api.github.com/repos/hyperledger/composer/pulls/comments/166340157,https://github.com/hyperledger/composer/pull/3321#discussion_r166340157,nklincoln
https://github.com/hyperledger/composer/pull/3321,https://github.com/hyperledger/composer/pull/3321,"Oops. Yeah, and updated it :)",55d87e97148e79c273a51a8e810139c97b5fc8cd,2018-02-07 06:06:52,166525734,"@@ -64,6 +64,20 @@ query Q17 {
 }
 ```
 
+#### Sample Contains queries
+
+The `CONTAINS` filter is used to search a array field in a node. The below query returns all the drivers who earned the punchual and steady-driving badges. Considering that the badges is of array type in driver participant.",,2018-02-07 19:28:42,https://api.github.com/repos/hyperledger/composer/pulls/comments/166525734,https://github.com/hyperledger/composer/pull/3321#discussion_r166525734,varun-raj
https://github.com/hyperledger/composer/pull/3284,https://github.com/hyperledger/composer/pull/3284,"This is what is displayed in playground. We need a fix in from Andy and then this will say 
Hyperledger Fabric v1.1",214811a1aed8a6c06200d667d88a1f429195d739,2018-01-31 16:19:50,165105158,"@@ -30,7 +30,7 @@ A peer admin business network card must be created in order to deploy a {{site.d
 
 1. From the **My Business Networks** screen, click **Create Business Network Card**.
 
-2. Select **Hyperledger Fabric v1.0** and click **Next**.
+2. Select **{{site.data.conrefs.hlf_full}}** and click **Next**.",,2018-01-31 19:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/165105158,https://github.com/hyperledger/composer/pull/3284#discussion_r165105158,davidkel
https://github.com/hyperledger/composer/pull/3284,https://github.com/hyperledger/composer/pull/3284,"Hmmm, I think this probably needs more detail (related to #3165). I may have this wrong but my understanding is that the fabric tools setup includes an identity with the id admin and an enrolment secret adminpw, which this command is going to bind(?????!) to some built in composer system participant for business network admin purposes ...or something like that. And there might also be gotchas if the admin identity has already been issued certificates.",214811a1aed8a6c06200d667d88a1f429195d739,2018-01-31 16:22:41,165106121,"@@ -10,11 +10,136 @@ excerpt: Web or mobile applications that need to interact with deployed business
 
 # Writing Web or mobile Applications
 
-Web or mobile applications that need to interact with deployed business networks should make calls to a REST API. The easiest way to create the REST API is to use the `composer-rest-server` to dynamically generate a REST API from the deployed business network.
+To interact with a deployed business network, web or mobile applications should make REST API calls. To create a custom REST API for a business network, use the `composer-rest-server` command.
 
-In addition the `yo hyperledger-composer` command can be used to generate a skeleton Angular project that calls the `composer-rest-server` to interact with a business network.
+To create a skeleton Angular application that can interact with the REST API, use the `yo hyperledger-composer` command.
+
+Please follow the [Developer Tutorial](../tutorials/developer-tutorial.html) for an example of how to use the `composer-rest-server` and the Angular generator.
+
+
+## Generating an Angular application from a Business Network Archive (.BNA)
+
+The flow for building an Angular application is as follows:
+
+<img src=""../assets/img/Angular Generator Flow.svg"" style=""border: none;"" alt=""Angular Generator Flow"">
+
+If you already have a Business Network Archive and would like to build a skeleton Angular application, use the following reference instructions, if you would like to fully understand how to develop a BNA from scratch and build an application from there please see the [Developer Tutorial](../tutorials/developer-tutorial.html).
+
+**Prerequisites**
+
+- You will need the {{site.data.conrefs.composer_full}} [development tools](../installing/development-tools.html) in order to run the Angular generator.
+- A Business Network Archive (.BNA) you would like to deploy.
+
+### 1. Start {{site.data.conrefs.hlf_full}} running on your local machine
+
+If you have already installed the development tools you will have {{site.data.conrefs.hlf_full}} already installed.
+
+Head to the `fabric-tools` directory and start {{site.data.conrefs.hlf_full}}. The following code is an example if you have used our development tools install guide:
+
+```bash
+cd ~/fabric-tools
+./startFabric.sh
+./createPeerAdminCard.sh
+```
+
+This will also create a `PeerAdmin` .card file which is needed to modify code running on the peers of your deployment.
+
+You can list all of the cards you have installed at any time by running the following command:
+
+```bash
+composer card list
+```
+
+### 2. Prepare the {{site.data.conrefs.hlf_full}} peers for your BNA
+
+In order to install the Business Network Archive onto the {{site.data.conrefs.hlf_full}} network you need to prepare the peers with the underlying Composer runtime.
+
+You will need to have the name of the Business Network to do this, below you can see an example with `tutorial-network` along with the 'PeerAdmin' card for your deployment.
+
+```
+composer runtime install --card PeerAdmin@hlfv1 --businessNetworkName tutorial-network
+```
+
+### 3. Deploy your BNA onto your {{site.data.conrefs.hlf_full}}
+
+It is recommended you start with a clean directory. Move your BNA into that directory and change your terminal directory to it.
+
+We will use the `composer network start` command to deploy the BNA onto {{site.data.conrefs.hlf_full}}, we will need to use our `PeerAdmin` card to do this. We will also need to create a user on our network, we will use an ""Admin"" username and password to get started.",60,2018-01-31 19:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/165106121,https://github.com/hyperledger/composer/pull/3284#discussion_r165106121,jt-nti
https://github.com/hyperledger/composer/pull/3284,https://github.com/hyperledger/composer/pull/3284,"Ah, I read a bit further, although I still think this needs a section of its own somewhere that can be referred to, possibly including some sort of pictorial representation of what identities, participants and users are and how they are all related. (Paging @EdMoffatt!) Seems to be causing a fair bit of confusion at the moment- I'm definitely confused!",214811a1aed8a6c06200d667d88a1f429195d739,2018-01-31 16:25:11,165106947,"@@ -10,11 +10,136 @@ excerpt: Web or mobile applications that need to interact with deployed business
 
 # Writing Web or mobile Applications
 
-Web or mobile applications that need to interact with deployed business networks should make calls to a REST API. The easiest way to create the REST API is to use the `composer-rest-server` to dynamically generate a REST API from the deployed business network.
+To interact with a deployed business network, web or mobile applications should make REST API calls. To create a custom REST API for a business network, use the `composer-rest-server` command.
 
-In addition the `yo hyperledger-composer` command can be used to generate a skeleton Angular project that calls the `composer-rest-server` to interact with a business network.
+To create a skeleton Angular application that can interact with the REST API, use the `yo hyperledger-composer` command.
+
+Please follow the [Developer Tutorial](../tutorials/developer-tutorial.html) for an example of how to use the `composer-rest-server` and the Angular generator.
+
+
+## Generating an Angular application from a Business Network Archive (.BNA)
+
+The flow for building an Angular application is as follows:
+
+<img src=""../assets/img/Angular Generator Flow.svg"" style=""border: none;"" alt=""Angular Generator Flow"">
+
+If you already have a Business Network Archive and would like to build a skeleton Angular application, use the following reference instructions, if you would like to fully understand how to develop a BNA from scratch and build an application from there please see the [Developer Tutorial](../tutorials/developer-tutorial.html).
+
+**Prerequisites**
+
+- You will need the {{site.data.conrefs.composer_full}} [development tools](../installing/development-tools.html) in order to run the Angular generator.
+- A Business Network Archive (.BNA) you would like to deploy.
+
+### 1. Start {{site.data.conrefs.hlf_full}} running on your local machine
+
+If you have already installed the development tools you will have {{site.data.conrefs.hlf_full}} already installed.
+
+Head to the `fabric-tools` directory and start {{site.data.conrefs.hlf_full}}. The following code is an example if you have used our development tools install guide:
+
+```bash
+cd ~/fabric-tools
+./startFabric.sh
+./createPeerAdminCard.sh
+```
+
+This will also create a `PeerAdmin` .card file which is needed to modify code running on the peers of your deployment.
+
+You can list all of the cards you have installed at any time by running the following command:
+
+```bash
+composer card list
+```
+
+### 2. Prepare the {{site.data.conrefs.hlf_full}} peers for your BNA
+
+In order to install the Business Network Archive onto the {{site.data.conrefs.hlf_full}} network you need to prepare the peers with the underlying Composer runtime.
+
+You will need to have the name of the Business Network to do this, below you can see an example with `tutorial-network` along with the 'PeerAdmin' card for your deployment.
+
+```
+composer runtime install --card PeerAdmin@hlfv1 --businessNetworkName tutorial-network
+```
+
+### 3. Deploy your BNA onto your {{site.data.conrefs.hlf_full}}
+
+It is recommended you start with a clean directory. Move your BNA into that directory and change your terminal directory to it.
+
+We will use the `composer network start` command to deploy the BNA onto {{site.data.conrefs.hlf_full}}, we will need to use our `PeerAdmin` card to do this. We will also need to create a user on our network, we will use an ""Admin"" username and password to get started.
+
+Below is an example using a `tutorial-network` BNA.
+
+```bash
+composer network start -a tutorial-network.bna -A admin -S adminpw -c PeerAdmin@hlfv1
+```
+
+This will create an 'admin' card for the business network, which for the above example is `admin@tutorial-network.card`
+
+*Please note: The `admin` username and `adminpw` secret are for a specific {{site.data.conrefs.hlf_full}} identity configured for the instance of {{site.data.conrefs.hlf_full}} deployed in the Developer Tutorial. If you have configured a {{site.data.conrefs.hlf_full}} instance from scratch these identity details will be different.*",70,2018-01-31 19:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/165106947,https://github.com/hyperledger/composer/pull/3284#discussion_r165106947,jt-nti
https://github.com/hyperledger/composer/pull/3284,https://github.com/hyperledger/composer/pull/3284,"Given that all the options are being defined here, it would probably be better to specify them in the command, rather than going through them interactively",214811a1aed8a6c06200d667d88a1f429195d739,2018-01-31 16:26:35,165107407,"@@ -10,11 +10,136 @@ excerpt: Web or mobile applications that need to interact with deployed business
 
 # Writing Web or mobile Applications
 
-Web or mobile applications that need to interact with deployed business networks should make calls to a REST API. The easiest way to create the REST API is to use the `composer-rest-server` to dynamically generate a REST API from the deployed business network.
+To interact with a deployed business network, web or mobile applications should make REST API calls. To create a custom REST API for a business network, use the `composer-rest-server` command.
 
-In addition the `yo hyperledger-composer` command can be used to generate a skeleton Angular project that calls the `composer-rest-server` to interact with a business network.
+To create a skeleton Angular application that can interact with the REST API, use the `yo hyperledger-composer` command.
+
+Please follow the [Developer Tutorial](../tutorials/developer-tutorial.html) for an example of how to use the `composer-rest-server` and the Angular generator.
+
+
+## Generating an Angular application from a Business Network Archive (.BNA)
+
+The flow for building an Angular application is as follows:
+
+<img src=""../assets/img/Angular Generator Flow.svg"" style=""border: none;"" alt=""Angular Generator Flow"">
+
+If you already have a Business Network Archive and would like to build a skeleton Angular application, use the following reference instructions, if you would like to fully understand how to develop a BNA from scratch and build an application from there please see the [Developer Tutorial](../tutorials/developer-tutorial.html).
+
+**Prerequisites**
+
+- You will need the {{site.data.conrefs.composer_full}} [development tools](../installing/development-tools.html) in order to run the Angular generator.
+- A Business Network Archive (.BNA) you would like to deploy.
+
+### 1. Start {{site.data.conrefs.hlf_full}} running on your local machine
+
+If you have already installed the development tools you will have {{site.data.conrefs.hlf_full}} already installed.
+
+Head to the `fabric-tools` directory and start {{site.data.conrefs.hlf_full}}. The following code is an example if you have used our development tools install guide:
+
+```bash
+cd ~/fabric-tools
+./startFabric.sh
+./createPeerAdminCard.sh
+```
+
+This will also create a `PeerAdmin` .card file which is needed to modify code running on the peers of your deployment.
+
+You can list all of the cards you have installed at any time by running the following command:
+
+```bash
+composer card list
+```
+
+### 2. Prepare the {{site.data.conrefs.hlf_full}} peers for your BNA
+
+In order to install the Business Network Archive onto the {{site.data.conrefs.hlf_full}} network you need to prepare the peers with the underlying Composer runtime.
+
+You will need to have the name of the Business Network to do this, below you can see an example with `tutorial-network` along with the 'PeerAdmin' card for your deployment.
+
+```
+composer runtime install --card PeerAdmin@hlfv1 --businessNetworkName tutorial-network
+```
+
+### 3. Deploy your BNA onto your {{site.data.conrefs.hlf_full}}
+
+It is recommended you start with a clean directory. Move your BNA into that directory and change your terminal directory to it.
+
+We will use the `composer network start` command to deploy the BNA onto {{site.data.conrefs.hlf_full}}, we will need to use our `PeerAdmin` card to do this. We will also need to create a user on our network, we will use an ""Admin"" username and password to get started.
+
+Below is an example using a `tutorial-network` BNA.
+
+```bash
+composer network start -a tutorial-network.bna -A admin -S adminpw -c PeerAdmin@hlfv1
+```
+
+This will create an 'admin' card for the business network, which for the above example is `admin@tutorial-network.card`
+
+*Please note: The `admin` username and `adminpw` secret are for a specific {{site.data.conrefs.hlf_full}} identity configured for the instance of {{site.data.conrefs.hlf_full}} deployed in the Developer Tutorial. If you have configured a {{site.data.conrefs.hlf_full}} instance from scratch these identity details will be different.*
+
+### 4. Install the 'admin' card ready for use
+
+We will next take the admin card we have just made and import it for use with your business network.
+
+```bash
+composer card import --file admin@tutorial-network.card
+```
+
+### 5. Start the REST server & generate the Swagger API documentation
+
+Navigate to your directory and run the `composer-rest-server` command.
+
+```bash
+composer-rest-server
+```
+
+  - Enter admin@tutorial-network as the card name. Make sure not to add the `.card` extension.
+  - Select never use namespaces when asked whether to use namespaces in the generated API.
+  - Select No when asked whether to secure the generated API.
+  - Select Yes when asked whether to enable event publication.
+  - Select No when asked whether to enable TLS security.",92,2018-01-31 19:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/165107407,https://github.com/hyperledger/composer/pull/3284#discussion_r165107407,jt-nti
https://github.com/hyperledger/composer/pull/3284,https://github.com/hyperledger/composer/pull/3284,The playground does include the version on this screen,214811a1aed8a6c06200d667d88a1f429195d739,2018-01-31 16:30:04,165108593,"@@ -30,7 +30,7 @@ A peer admin business network card must be created in order to deploy a {{site.d
 
 1. From the **My Business Networks** screen, click **Create Business Network Card**.
 
-2. Select **Hyperledger Fabric v1.0** and click **Next**.
+2. Select **{{site.data.conrefs.hlf_full}}** and click **Next**.",,2018-01-31 19:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/165108593,https://github.com/hyperledger/composer/pull/3284#discussion_r165108593,jt-nti
https://github.com/hyperledger/composer/pull/3284,https://github.com/hyperledger/composer/pull/3284,Hard coded version?,214811a1aed8a6c06200d667d88a1f429195d739,2018-01-31 16:31:22,165109036,"@@ -30,7 +30,7 @@ A peer admin business network card must be created in order to deploy a {{site.d
 
 1. From the **My Business Networks** screen, click **Create Business Network Card**.
 
-2. Select **Hyperledger Fabric v1.0** and click **Next**.
+2. Select **{{site.data.conrefs.hlf_full}}** v1.1 and click **Next**.",,2018-01-31 19:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/165109036,https://github.com/hyperledger/composer/pull/3284#discussion_r165109036,jt-nti
https://github.com/hyperledger/composer/pull/3284,https://github.com/hyperledger/composer/pull/3284,Duplication of the composer report information a few lines above,214811a1aed8a6c06200d667d88a1f429195d739,2018-01-31 16:32:50,165109510,"@@ -128,3 +128,9 @@ Create a diagnostic report: [composer report](./composer.report)
 `composer transaction submit`
 
 Submit a transaction for execution: [composer transaction submit](./composer.transaction.submit.html)
+
+## Reporting",,2018-01-31 19:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/165109510,https://github.com/hyperledger/composer/pull/3284#discussion_r165109510,jt-nti
https://github.com/hyperledger/composer/pull/3284,https://github.com/hyperledger/composer/pull/3284,"Looks like most references to Hyperledger Fabric will not now include the version, which seems a bit odd if the version is a conref. Given the opportunity to shoot yourself in the foot with the wrong fabric version, it seems kind of nice to have the version everywhere as before?",214811a1aed8a6c06200d667d88a1f429195d739,2018-01-31 16:35:26,165110410,"@@ -7,3 +7,6 @@ composer_full:
 
 hlf_full:
   Hyperledger Fabric
+
+hlf_latest:
+  v1.1",6,2018-01-31 19:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/165110410,https://github.com/hyperledger/composer/pull/3284#discussion_r165110410,jt-nti
https://github.com/hyperledger/composer/pull/3284,https://github.com/hyperledger/composer/pull/3284,"The version conref is useful for saying, for example, what we support. Generally, I would presume people would see 'Hyperledger Fabric' and presume v1+ I can specify v1+ in every instance, but that seems like overkill in instances where we're just referring to the fabric you've just set up in a tutorial or similar.",214811a1aed8a6c06200d667d88a1f429195d739,2018-01-31 16:38:58,165111723,"@@ -7,3 +7,6 @@ composer_full:
 
 hlf_full:
   Hyperledger Fabric
+
+hlf_latest:
+  v1.1",6,2018-01-31 19:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/165111723,https://github.com/hyperledger/composer/pull/3284#discussion_r165111723,EdProsser
https://github.com/hyperledger/composer/pull/3284,https://github.com/hyperledger/composer/pull/3284,"Yes, because it's referring to what is in the UI rather than whatever is latest etc. Variables are useful for when things change, but you need a separate variable for each use-case. I don't think the one box in the playground UI is a big enough use-case to justify a variable.",214811a1aed8a6c06200d667d88a1f429195d739,2018-01-31 16:41:23,165112441,"@@ -30,7 +30,7 @@ A peer admin business network card must be created in order to deploy a {{site.d
 
 1. From the **My Business Networks** screen, click **Create Business Network Card**.
 
-2. Select **Hyperledger Fabric v1.0** and click **Next**.
+2. Select **{{site.data.conrefs.hlf_full}}** v1.1 and click **Next**.",,2018-01-31 19:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/165112441,https://github.com/hyperledger/composer/pull/3284#discussion_r165112441,EdProsser
https://github.com/hyperledger/composer/pull/3284,https://github.com/hyperledger/composer/pull/3284,I think that's just merge blargh from me and you writing the same doc separately. Will change it. ^^,214811a1aed8a6c06200d667d88a1f429195d739,2018-01-31 16:42:02,165112649,"@@ -128,3 +128,9 @@ Create a diagnostic report: [composer report](./composer.report)
 `composer transaction submit`
 
 Submit a transaction for execution: [composer transaction submit](./composer.transaction.submit.html)
+
+## Reporting",,2018-01-31 19:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/165112649,https://github.com/hyperledger/composer/pull/3284#discussion_r165112649,EdProsser
https://github.com/hyperledger/composer/pull/3284,https://github.com/hyperledger/composer/pull/3284,I didn't even know you could define those options as part of the command.,214811a1aed8a6c06200d667d88a1f429195d739,2018-01-31 16:42:41,165112850,"@@ -10,11 +10,136 @@ excerpt: Web or mobile applications that need to interact with deployed business
 
 # Writing Web or mobile Applications
 
-Web or mobile applications that need to interact with deployed business networks should make calls to a REST API. The easiest way to create the REST API is to use the `composer-rest-server` to dynamically generate a REST API from the deployed business network.
+To interact with a deployed business network, web or mobile applications should make REST API calls. To create a custom REST API for a business network, use the `composer-rest-server` command.
 
-In addition the `yo hyperledger-composer` command can be used to generate a skeleton Angular project that calls the `composer-rest-server` to interact with a business network.
+To create a skeleton Angular application that can interact with the REST API, use the `yo hyperledger-composer` command.
+
+Please follow the [Developer Tutorial](../tutorials/developer-tutorial.html) for an example of how to use the `composer-rest-server` and the Angular generator.
+
+
+## Generating an Angular application from a Business Network Archive (.BNA)
+
+The flow for building an Angular application is as follows:
+
+<img src=""../assets/img/Angular Generator Flow.svg"" style=""border: none;"" alt=""Angular Generator Flow"">
+
+If you already have a Business Network Archive and would like to build a skeleton Angular application, use the following reference instructions, if you would like to fully understand how to develop a BNA from scratch and build an application from there please see the [Developer Tutorial](../tutorials/developer-tutorial.html).
+
+**Prerequisites**
+
+- You will need the {{site.data.conrefs.composer_full}} [development tools](../installing/development-tools.html) in order to run the Angular generator.
+- A Business Network Archive (.BNA) you would like to deploy.
+
+### 1. Start {{site.data.conrefs.hlf_full}} running on your local machine
+
+If you have already installed the development tools you will have {{site.data.conrefs.hlf_full}} already installed.
+
+Head to the `fabric-tools` directory and start {{site.data.conrefs.hlf_full}}. The following code is an example if you have used our development tools install guide:
+
+```bash
+cd ~/fabric-tools
+./startFabric.sh
+./createPeerAdminCard.sh
+```
+
+This will also create a `PeerAdmin` .card file which is needed to modify code running on the peers of your deployment.
+
+You can list all of the cards you have installed at any time by running the following command:
+
+```bash
+composer card list
+```
+
+### 2. Prepare the {{site.data.conrefs.hlf_full}} peers for your BNA
+
+In order to install the Business Network Archive onto the {{site.data.conrefs.hlf_full}} network you need to prepare the peers with the underlying Composer runtime.
+
+You will need to have the name of the Business Network to do this, below you can see an example with `tutorial-network` along with the 'PeerAdmin' card for your deployment.
+
+```
+composer runtime install --card PeerAdmin@hlfv1 --businessNetworkName tutorial-network
+```
+
+### 3. Deploy your BNA onto your {{site.data.conrefs.hlf_full}}
+
+It is recommended you start with a clean directory. Move your BNA into that directory and change your terminal directory to it.
+
+We will use the `composer network start` command to deploy the BNA onto {{site.data.conrefs.hlf_full}}, we will need to use our `PeerAdmin` card to do this. We will also need to create a user on our network, we will use an ""Admin"" username and password to get started.
+
+Below is an example using a `tutorial-network` BNA.
+
+```bash
+composer network start -a tutorial-network.bna -A admin -S adminpw -c PeerAdmin@hlfv1
+```
+
+This will create an 'admin' card for the business network, which for the above example is `admin@tutorial-network.card`
+
+*Please note: The `admin` username and `adminpw` secret are for a specific {{site.data.conrefs.hlf_full}} identity configured for the instance of {{site.data.conrefs.hlf_full}} deployed in the Developer Tutorial. If you have configured a {{site.data.conrefs.hlf_full}} instance from scratch these identity details will be different.*
+
+### 4. Install the 'admin' card ready for use
+
+We will next take the admin card we have just made and import it for use with your business network.
+
+```bash
+composer card import --file admin@tutorial-network.card
+```
+
+### 5. Start the REST server & generate the Swagger API documentation
+
+Navigate to your directory and run the `composer-rest-server` command.
+
+```bash
+composer-rest-server
+```
+
+  - Enter admin@tutorial-network as the card name. Make sure not to add the `.card` extension.
+  - Select never use namespaces when asked whether to use namespaces in the generated API.
+  - Select No when asked whether to secure the generated API.
+  - Select Yes when asked whether to enable event publication.
+  - Select No when asked whether to enable TLS security.",92,2018-01-31 19:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/165112850,https://github.com/hyperledger/composer/pull/3284#discussion_r165112850,EdProsser
https://github.com/hyperledger/composer/pull/3284,https://github.com/hyperledger/composer/pull/3284,"...it might not be documented :)
Oddly, using environment variables is https://hyperledger.github.io/composer//reference/rest-server",214811a1aed8a6c06200d667d88a1f429195d739,2018-01-31 16:52:31,165115951,"@@ -10,11 +10,136 @@ excerpt: Web or mobile applications that need to interact with deployed business
 
 # Writing Web or mobile Applications
 
-Web or mobile applications that need to interact with deployed business networks should make calls to a REST API. The easiest way to create the REST API is to use the `composer-rest-server` to dynamically generate a REST API from the deployed business network.
+To interact with a deployed business network, web or mobile applications should make REST API calls. To create a custom REST API for a business network, use the `composer-rest-server` command.
 
-In addition the `yo hyperledger-composer` command can be used to generate a skeleton Angular project that calls the `composer-rest-server` to interact with a business network.
+To create a skeleton Angular application that can interact with the REST API, use the `yo hyperledger-composer` command.
+
+Please follow the [Developer Tutorial](../tutorials/developer-tutorial.html) for an example of how to use the `composer-rest-server` and the Angular generator.
+
+
+## Generating an Angular application from a Business Network Archive (.BNA)
+
+The flow for building an Angular application is as follows:
+
+<img src=""../assets/img/Angular Generator Flow.svg"" style=""border: none;"" alt=""Angular Generator Flow"">
+
+If you already have a Business Network Archive and would like to build a skeleton Angular application, use the following reference instructions, if you would like to fully understand how to develop a BNA from scratch and build an application from there please see the [Developer Tutorial](../tutorials/developer-tutorial.html).
+
+**Prerequisites**
+
+- You will need the {{site.data.conrefs.composer_full}} [development tools](../installing/development-tools.html) in order to run the Angular generator.
+- A Business Network Archive (.BNA) you would like to deploy.
+
+### 1. Start {{site.data.conrefs.hlf_full}} running on your local machine
+
+If you have already installed the development tools you will have {{site.data.conrefs.hlf_full}} already installed.
+
+Head to the `fabric-tools` directory and start {{site.data.conrefs.hlf_full}}. The following code is an example if you have used our development tools install guide:
+
+```bash
+cd ~/fabric-tools
+./startFabric.sh
+./createPeerAdminCard.sh
+```
+
+This will also create a `PeerAdmin` .card file which is needed to modify code running on the peers of your deployment.
+
+You can list all of the cards you have installed at any time by running the following command:
+
+```bash
+composer card list
+```
+
+### 2. Prepare the {{site.data.conrefs.hlf_full}} peers for your BNA
+
+In order to install the Business Network Archive onto the {{site.data.conrefs.hlf_full}} network you need to prepare the peers with the underlying Composer runtime.
+
+You will need to have the name of the Business Network to do this, below you can see an example with `tutorial-network` along with the 'PeerAdmin' card for your deployment.
+
+```
+composer runtime install --card PeerAdmin@hlfv1 --businessNetworkName tutorial-network
+```
+
+### 3. Deploy your BNA onto your {{site.data.conrefs.hlf_full}}
+
+It is recommended you start with a clean directory. Move your BNA into that directory and change your terminal directory to it.
+
+We will use the `composer network start` command to deploy the BNA onto {{site.data.conrefs.hlf_full}}, we will need to use our `PeerAdmin` card to do this. We will also need to create a user on our network, we will use an ""Admin"" username and password to get started.
+
+Below is an example using a `tutorial-network` BNA.
+
+```bash
+composer network start -a tutorial-network.bna -A admin -S adminpw -c PeerAdmin@hlfv1
+```
+
+This will create an 'admin' card for the business network, which for the above example is `admin@tutorial-network.card`
+
+*Please note: The `admin` username and `adminpw` secret are for a specific {{site.data.conrefs.hlf_full}} identity configured for the instance of {{site.data.conrefs.hlf_full}} deployed in the Developer Tutorial. If you have configured a {{site.data.conrefs.hlf_full}} instance from scratch these identity details will be different.*
+
+### 4. Install the 'admin' card ready for use
+
+We will next take the admin card we have just made and import it for use with your business network.
+
+```bash
+composer card import --file admin@tutorial-network.card
+```
+
+### 5. Start the REST server & generate the Swagger API documentation
+
+Navigate to your directory and run the `composer-rest-server` command.
+
+```bash
+composer-rest-server
+```
+
+  - Enter admin@tutorial-network as the card name. Make sure not to add the `.card` extension.
+  - Select never use namespaces when asked whether to use namespaces in the generated API.
+  - Select No when asked whether to secure the generated API.
+  - Select Yes when asked whether to enable event publication.
+  - Select No when asked whether to enable TLS security.",92,2018-01-31 19:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/165115951,https://github.com/hyperledger/composer/pull/3284#discussion_r165115951,jt-nti
https://github.com/hyperledger/composer/pull/3284,https://github.com/hyperledger/composer/pull/3284,"Maybe, but wouldn't this be ok (the version is outside the bold at the moment as well)....

**{{site.data.conrefs.hlf_full}} {{site.data.conrefs.hlf_latest}}**",214811a1aed8a6c06200d667d88a1f429195d739,2018-01-31 16:54:28,165116612,"@@ -30,7 +30,7 @@ A peer admin business network card must be created in order to deploy a {{site.d
 
 1. From the **My Business Networks** screen, click **Create Business Network Card**.
 
-2. Select **Hyperledger Fabric v1.0** and click **Next**.
+2. Select **{{site.data.conrefs.hlf_full}}** v1.1 and click **Next**.",,2018-01-31 19:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/165116612,https://github.com/hyperledger/composer/pull/3284#discussion_r165116612,jt-nti
https://github.com/hyperledger/composer/pull/3284,https://github.com/hyperledger/composer/pull/3284,"Putting it everywhere is probably overkill, although I would personally err on the side of caution and keep it in more places than the current PR does",214811a1aed8a6c06200d667d88a1f429195d739,2018-01-31 16:56:58,165117374,"@@ -7,3 +7,6 @@ composer_full:
 
 hlf_full:
   Hyperledger Fabric
+
+hlf_latest:
+  v1.1",6,2018-01-31 19:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/165117374,https://github.com/hyperledger/composer/pull/3284#discussion_r165117374,jt-nti
https://github.com/hyperledger/composer/pull/3284,https://github.com/hyperledger/composer/pull/3284,"Yeah it would, but it would mean that if say, some of the instances of that variable were no longer true, I'd have to individually check them, rather defeating the purpose of having a variable.

As to the bolding, yeah fair cop.",214811a1aed8a6c06200d667d88a1f429195d739,2018-01-31 16:58:37,165117904,"@@ -30,7 +30,7 @@ A peer admin business network card must be created in order to deploy a {{site.d
 
 1. From the **My Business Networks** screen, click **Create Business Network Card**.
 
-2. Select **Hyperledger Fabric v1.0** and click **Next**.
+2. Select **{{site.data.conrefs.hlf_full}}** v1.1 and click **Next**.",,2018-01-31 19:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/165117904,https://github.com/hyperledger/composer/pull/3284#discussion_r165117904,EdProsser
https://github.com/hyperledger/composer/pull/3284,https://github.com/hyperledger/composer/pull/3284,"The versions were mostly added where they were in order to differentiate between 1.0 and 0.6.

Given that I think 1.0+ is the de facto version of fabric, is there much use specifying a specific version unless an actual specific was required?",214811a1aed8a6c06200d667d88a1f429195d739,2018-01-31 17:00:24,165118408,"@@ -7,3 +7,6 @@ composer_full:
 
 hlf_full:
   Hyperledger Fabric
+
+hlf_latest:
+  v1.1",6,2018-01-31 19:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/165118408,https://github.com/hyperledger/composer/pull/3284#discussion_r165118408,EdProsser
https://github.com/hyperledger/composer/pull/3284,https://github.com/hyperledger/composer/pull/3284,So the stable docs are targetting 1.0 and only 1.0. The next docs which are being changed here are targetting 1.1 and only 1.1. Unless we change stable and next to remove the version numbers there is a possibility of confusion.,214811a1aed8a6c06200d667d88a1f429195d739,2018-01-31 17:07:45,165120738,"@@ -7,3 +7,6 @@ composer_full:
 
 hlf_full:
   Hyperledger Fabric
+
+hlf_latest:
+  v1.1",6,2018-01-31 19:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/165120738,https://github.com/hyperledger/composer/pull/3284#discussion_r165120738,davidkel
https://github.com/hyperledger/composer/pull/3284,https://github.com/hyperledger/composer/pull/3284,"I guess it's only an issue with 0.16.x and 0.17.x running in parallel on different versions of fabric. The more explicit it is, the more chance it'll nudge someone the right way. Maybe I'm just paranoid though so up to you :)",214811a1aed8a6c06200d667d88a1f429195d739,2018-01-31 17:12:03,165122089,"@@ -7,3 +7,6 @@ composer_full:
 
 hlf_full:
   Hyperledger Fabric
+
+hlf_latest:
+  v1.1",6,2018-01-31 19:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/165122089,https://github.com/hyperledger/composer/pull/3284#discussion_r165122089,jt-nti
https://github.com/hyperledger/composer/pull/3284,https://github.com/hyperledger/composer/pull/3284,"As far as I was concerned, stable was 1.0 and next was ALL future versions.",214811a1aed8a6c06200d667d88a1f429195d739,2018-01-31 17:16:27,165123388,"@@ -7,3 +7,6 @@ composer_full:
 
 hlf_full:
   Hyperledger Fabric
+
+hlf_latest:
+  v1.1",6,2018-01-31 19:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/165123388,https://github.com/hyperledger/composer/pull/3284#discussion_r165123388,EdProsser
https://github.com/hyperledger/composer/pull/3277,https://github.com/hyperledger/composer/pull/3277,I think if you add the @abstract tag to the JSDoc comment you don't need any of these eslint/istanbul hacks ðŸ˜‰,17b92d52660127aa01e21e5d21a49f5fda2f5a58,2018-01-31 16:27:35,165107759,"@@ -0,0 +1,183 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+ // From: https://gitlab.com/dominicp/node-job-queue/blob/master/node-job-queue.js
+
+'use strict';
+
+const EventEmitter = require('events');
+
+/**
+ * A class to facilitate adding jobs to a queue and running them.
+ * @private
+ */
+class JobQueue extends EventEmitter {
+
+    /**
+     * Setup class properties.
+     *
+     * @param {int} startDelay How long after a job is added should we want before
+     *                       starting to process jobs in the queue.
+     * @param {int} jobDelay   Once we are running jobs, how long should we wait
+     *                       between each job in the queue.
+     */
+    constructor(startDelay = 0, jobDelay = 0) {
+
+        // Call the EventEmitter constructor
+        super();
+
+        // Store the arguments as class properties
+        this.startDelay = startDelay;
+
+        this.jobDelay = jobDelay;
+
+        // Setup the job queue
+        this.jobs = [];
+
+        // Setup a timer to use for startDelay
+        this.timer = false;
+
+        // Setup a switch to let us know if a synchronous job is running
+        this.jobRunning = false;
+    }
+
+    /**
+     * Add a job to the queue. After the job is added, we process the queue.
+     *
+     * @param {mixed} job This can be anything that your runJob method expects.
+     */
+    addJob(job) {
+
+        // Add the job
+        this.jobs.push(job);
+
+        // Emit an event
+        this.emit('jobAdd', job, this.jobs);
+
+        // If we have a startDelay and the queue was empty, hurry up and wait
+        if (this.startDelay && this.jobs.length < 2) {
+
+            this.timer = setTimeout(() => this.processQueue(true), this.startDelay);
+
+        } else {
+
+            this.processQueue();
+        }
+    }
+
+    /**
+     * Remove a job from the queue. Continues processing the queue when finished.
+     *
+     * @param {int} index The array index of the job to remove in this.jobs
+     */
+    deleteJob(index) {
+
+        if (! this.jobs[index]) {
+
+            this.emit('queueError',
+                new Error('Attempted to delete job that cannot be found: ' + index),
+                this.jobs
+            );
+
+        } else {
+
+            // Remove the job from the queue
+            this.jobs.splice(index, 1);
+
+            this.emit('jobRemove', this.jobs);
+        }
+    }
+
+    /**
+     * Run the next job in the queue.
+     *
+     * @param {bool} resetTimer If true we set the class timer to false.
+     */
+    processQueue(resetTimer) {
+
+        // If we were asked to, clear the global timer
+        if (resetTimer) { this.timer = false; }
+
+        // If the queue is empty, we're done
+        if (this.jobs.length < 1) { return; }
+
+        // If a job is running, or we are waiting on a startDelay, just retry later
+        if (this.jobRunning || this.timer) {
+
+            setTimeout(() => this.processQueue(), 10000);
+            return;
+        }
+
+        const nextJob = this.jobs.findIndex(job => !! job);
+
+        // Define a function to run when the sync is complete
+        const finished = () => {
+
+            // Reset the switch
+            this.jobRunning = false;
+
+            // Save a copy of the finished job before we remove it for the event
+            const finishedJob = this.jobs[nextJob];
+
+            // Remove the job from the queue
+            this.deleteJob(nextJob);
+
+            this.emit('jobFinish', finishedJob, this.jobs);
+
+            // Run the next job
+            this.timer = setTimeout(() => { this.processQueue(true); }, this.jobDelay);
+        };
+
+        this.jobRunning = true;
+
+        this.emit('jobStart', this.jobs[nextJob], this.jobs);
+
+        // Get the first job in the queue and run it
+        this.runJob(this.jobs[nextJob])
+            .then(finished)
+            .catch((error) => {
+
+                // Emit the error
+                this.emit('queueError', error, this.jobs);
+
+                // Still call the finished handler
+                finished();
+            });
+    }
+
+    /**
+     * Simpler getter for the job queue. Since this.jobs should be private
+     * access we provide this getter.
+     *
+     * @return {array} The current queue of jobs to run
+     */
+    getQueue() {
+
+        return this.jobs;
+    }
+
+    /* eslint-disable class-methods-use-this */
+
+    /* istanbul ignore next */
+    /**
+     * Abstract method: must be overriden.
+     * @param {any} job - data for the job
+     * @return {Promise} promise to the job results.
+     */
+    runJob(job) { return Promise.resolve(job); }",,2018-02-01 16:29:47,https://api.github.com/repos/hyperledger/composer/pulls/comments/165107759,https://github.com/hyperledger/composer/pull/3277#discussion_r165107759,sstone1
https://github.com/hyperledger/composer/pull/3277,https://github.com/hyperledger/composer/pull/3277,Do we really need yet another HTTP request module? We already use request and xhr.,17b92d52660127aa01e21e5d21a49f5fda2f5a58,2018-01-31 16:27:53,165107852,"@@ -49,12 +49,14 @@
     ""license-check"": ""1.1.5"",
     ""mocha"": ""3.4.2"",
     ""mockery"": ""2.0.0"",
+    ""moxios"": ""0.4.0"",
     ""nyc"": ""11.1.0"",
     ""pegjs"": ""0.9.0"",
     ""sinon"": ""2.3.8""
   },
   ""dependencies"": {
     ""acorn"": ""5.1.2"",
+    ""axios"": ""0.17.1"",",11,2018-02-01 16:29:47,https://api.github.com/repos/hyperledger/composer/pulls/comments/165107852,https://github.com/hyperledger/composer/pull/3277#discussion_r165107852,sstone1
https://github.com/hyperledger/composer/pull/3277,https://github.com/hyperledger/composer/pull/3277,"I initially wrote the code using request, but I couldn't convince it to webpack (and it was huge). I wanted something that would potentially run in Playground so we can add an ""update models"" button down the line if necessary.

Also the moxios library makes it really easy to mock the calls to axios... which is nice.

xhr is used in `composer-runtime-web` (I added it?) -- to support the `post` verb. What is the plan for that once `request` is used?",17b92d52660127aa01e21e5d21a49f5fda2f5a58,2018-01-31 17:34:05,165128513,"@@ -49,12 +49,14 @@
     ""license-check"": ""1.1.5"",
     ""mocha"": ""3.4.2"",
     ""mockery"": ""2.0.0"",
+    ""moxios"": ""0.4.0"",
     ""nyc"": ""11.1.0"",
     ""pegjs"": ""0.9.0"",
     ""sinon"": ""2.3.8""
   },
   ""dependencies"": {
     ""acorn"": ""5.1.2"",
+    ""axios"": ""0.17.1"",",11,2018-02-01 16:29:47,https://api.github.com/repos/hyperledger/composer/pulls/comments/165128513,https://github.com/hyperledger/composer/pull/3277#discussion_r165128513,dselman
https://github.com/hyperledger/composer/pull/3277,https://github.com/hyperledger/composer/pull/3277,I will make that @abstract ,17b92d52660127aa01e21e5d21a49f5fda2f5a58,2018-01-31 17:34:37,165128664,"@@ -0,0 +1,183 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+ // From: https://gitlab.com/dominicp/node-job-queue/blob/master/node-job-queue.js
+
+'use strict';
+
+const EventEmitter = require('events');
+
+/**
+ * A class to facilitate adding jobs to a queue and running them.
+ * @private
+ */
+class JobQueue extends EventEmitter {
+
+    /**
+     * Setup class properties.
+     *
+     * @param {int} startDelay How long after a job is added should we want before
+     *                       starting to process jobs in the queue.
+     * @param {int} jobDelay   Once we are running jobs, how long should we wait
+     *                       between each job in the queue.
+     */
+    constructor(startDelay = 0, jobDelay = 0) {
+
+        // Call the EventEmitter constructor
+        super();
+
+        // Store the arguments as class properties
+        this.startDelay = startDelay;
+
+        this.jobDelay = jobDelay;
+
+        // Setup the job queue
+        this.jobs = [];
+
+        // Setup a timer to use for startDelay
+        this.timer = false;
+
+        // Setup a switch to let us know if a synchronous job is running
+        this.jobRunning = false;
+    }
+
+    /**
+     * Add a job to the queue. After the job is added, we process the queue.
+     *
+     * @param {mixed} job This can be anything that your runJob method expects.
+     */
+    addJob(job) {
+
+        // Add the job
+        this.jobs.push(job);
+
+        // Emit an event
+        this.emit('jobAdd', job, this.jobs);
+
+        // If we have a startDelay and the queue was empty, hurry up and wait
+        if (this.startDelay && this.jobs.length < 2) {
+
+            this.timer = setTimeout(() => this.processQueue(true), this.startDelay);
+
+        } else {
+
+            this.processQueue();
+        }
+    }
+
+    /**
+     * Remove a job from the queue. Continues processing the queue when finished.
+     *
+     * @param {int} index The array index of the job to remove in this.jobs
+     */
+    deleteJob(index) {
+
+        if (! this.jobs[index]) {
+
+            this.emit('queueError',
+                new Error('Attempted to delete job that cannot be found: ' + index),
+                this.jobs
+            );
+
+        } else {
+
+            // Remove the job from the queue
+            this.jobs.splice(index, 1);
+
+            this.emit('jobRemove', this.jobs);
+        }
+    }
+
+    /**
+     * Run the next job in the queue.
+     *
+     * @param {bool} resetTimer If true we set the class timer to false.
+     */
+    processQueue(resetTimer) {
+
+        // If we were asked to, clear the global timer
+        if (resetTimer) { this.timer = false; }
+
+        // If the queue is empty, we're done
+        if (this.jobs.length < 1) { return; }
+
+        // If a job is running, or we are waiting on a startDelay, just retry later
+        if (this.jobRunning || this.timer) {
+
+            setTimeout(() => this.processQueue(), 10000);
+            return;
+        }
+
+        const nextJob = this.jobs.findIndex(job => !! job);
+
+        // Define a function to run when the sync is complete
+        const finished = () => {
+
+            // Reset the switch
+            this.jobRunning = false;
+
+            // Save a copy of the finished job before we remove it for the event
+            const finishedJob = this.jobs[nextJob];
+
+            // Remove the job from the queue
+            this.deleteJob(nextJob);
+
+            this.emit('jobFinish', finishedJob, this.jobs);
+
+            // Run the next job
+            this.timer = setTimeout(() => { this.processQueue(true); }, this.jobDelay);
+        };
+
+        this.jobRunning = true;
+
+        this.emit('jobStart', this.jobs[nextJob], this.jobs);
+
+        // Get the first job in the queue and run it
+        this.runJob(this.jobs[nextJob])
+            .then(finished)
+            .catch((error) => {
+
+                // Emit the error
+                this.emit('queueError', error, this.jobs);
+
+                // Still call the finished handler
+                finished();
+            });
+    }
+
+    /**
+     * Simpler getter for the job queue. Since this.jobs should be private
+     * access we provide this getter.
+     *
+     * @return {array} The current queue of jobs to run
+     */
+    getQueue() {
+
+        return this.jobs;
+    }
+
+    /* eslint-disable class-methods-use-this */
+
+    /* istanbul ignore next */
+    /**
+     * Abstract method: must be overriden.
+     * @param {any} job - data for the job
+     * @return {Promise} promise to the job results.
+     */
+    runJob(job) { return Promise.resolve(job); }",,2018-02-01 16:29:47,https://api.github.com/repos/hyperledger/composer/pulls/comments/165128664,https://github.com/hyperledger/composer/pull/3277#discussion_r165128664,dselman
https://github.com/hyperledger/composer/pull/3277,https://github.com/hyperledger/composer/pull/3277,"I think I managed to get `request` working in webpack and get rid of `xhr`. I'm not super fussed as the dream is to get rid of `request` altogether once we support external requires, and if `moxios` makes our lives easier from a testing point of view then we could move all the internal HTTP code over to that.",17b92d52660127aa01e21e5d21a49f5fda2f5a58,2018-02-01 11:43:15,165332680,"@@ -49,12 +49,14 @@
     ""license-check"": ""1.1.5"",
     ""mocha"": ""3.4.2"",
     ""mockery"": ""2.0.0"",
+    ""moxios"": ""0.4.0"",
     ""nyc"": ""11.1.0"",
     ""pegjs"": ""0.9.0"",
     ""sinon"": ""2.3.8""
   },
   ""dependencies"": {
     ""acorn"": ""5.1.2"",
+    ""axios"": ""0.17.1"",",11,2018-02-01 16:29:47,https://api.github.com/repos/hyperledger/composer/pulls/comments/165332680,https://github.com/hyperledger/composer/pull/3277#discussion_r165332680,sstone1
https://github.com/hyperledger/composer/pull/3264,https://github.com/hyperledger/composer/pull/3264,path.resolve(..) ?,ce7f1462371e46c51e908af83fa60ecfb74eb834,2018-01-29 16:57:57,164493955,"@@ -0,0 +1,78 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const fs = require('fs');
+const os = require('os');
+const { sep } = require('path');
+const moment = require('moment');
+const nodereport = require('node-report');
+const tar = require('tar');
+
+/**
+ * Main API called from cmd and composer report.
+ * @return {String} the name of the archive file that was created.
+ */
+function report() {
+    let tmpDirectory = setupReportDir();
+
+    // TODO write readme file inc. version of the composer-report module
+    // Plus versions of the other composer modules?
+
+    createNodeReport(tmpDirectory);
+    return archiveReport(tmpDirectory);
+}
+
+/**
+ * Sets up the temp directory for the report
+ * @return {String} the Path to the temporary directory
+ */
+function setupReportDir() {
+    const tmpDir = os.tmpdir();
+    return fs.mkdtempSync(`${tmpDir}${sep}`);",44,2018-01-30 10:48:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/164493955,https://github.com/hyperledger/composer/pull/3264#discussion_r164493955,mbwhite
https://github.com/hyperledger/composer/pull/3264,https://github.com/hyperledger/composer/pull/3264,which timezone this default to ,ce7f1462371e46c51e908af83fa60ecfb74eb834,2018-01-29 16:58:27,164494094,"@@ -0,0 +1,78 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const fs = require('fs');
+const os = require('os');
+const { sep } = require('path');
+const moment = require('moment');
+const nodereport = require('node-report');
+const tar = require('tar');
+
+/**
+ * Main API called from cmd and composer report.
+ * @return {String} the name of the archive file that was created.
+ */
+function report() {
+    let tmpDirectory = setupReportDir();
+
+    // TODO write readme file inc. version of the composer-report module
+    // Plus versions of the other composer modules?
+
+    createNodeReport(tmpDirectory);
+    return archiveReport(tmpDirectory);
+}
+
+/**
+ * Sets up the temp directory for the report
+ * @return {String} the Path to the temporary directory
+ */
+function setupReportDir() {
+    const tmpDir = os.tmpdir();
+    return fs.mkdtempSync(`${tmpDir}${sep}`);
+}
+
+/**
+ * Trigger node-report to write report in the temp directory
+ * @param {String} tmpDirectory the temporary directory for collecting report output
+ */
+function createNodeReport(tmpDirectory) {
+    nodereport.setDirectory(tmpDirectory);
+    nodereport.triggerReport();
+}
+
+/**
+ * Creates an archive of the temp directory for the report
+ * @param {String} tmpDirectory the temporary directory for collecting report output
+ * @return {String} the name of the archive file that has been created.
+ */
+function archiveReport(tmpDirectory) {
+    let timestamp = moment().format('YYYYMMDD[T]HHmmss');",,2018-01-30 10:48:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/164494094,https://github.com/hyperledger/composer/pull/3264#discussion_r164494094,mbwhite
https://github.com/hyperledger/composer/pull/3264,https://github.com/hyperledger/composer/pull/3264,I don't think it matters does it? It'll be whatever the user's local time zone is set to.,ce7f1462371e46c51e908af83fa60ecfb74eb834,2018-01-30 08:36:05,164670296,"@@ -0,0 +1,78 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const fs = require('fs');
+const os = require('os');
+const { sep } = require('path');
+const moment = require('moment');
+const nodereport = require('node-report');
+const tar = require('tar');
+
+/**
+ * Main API called from cmd and composer report.
+ * @return {String} the name of the archive file that was created.
+ */
+function report() {
+    let tmpDirectory = setupReportDir();
+
+    // TODO write readme file inc. version of the composer-report module
+    // Plus versions of the other composer modules?
+
+    createNodeReport(tmpDirectory);
+    return archiveReport(tmpDirectory);
+}
+
+/**
+ * Sets up the temp directory for the report
+ * @return {String} the Path to the temporary directory
+ */
+function setupReportDir() {
+    const tmpDir = os.tmpdir();
+    return fs.mkdtempSync(`${tmpDir}${sep}`);
+}
+
+/**
+ * Trigger node-report to write report in the temp directory
+ * @param {String} tmpDirectory the temporary directory for collecting report output
+ */
+function createNodeReport(tmpDirectory) {
+    nodereport.setDirectory(tmpDirectory);
+    nodereport.triggerReport();
+}
+
+/**
+ * Creates an archive of the temp directory for the report
+ * @param {String} tmpDirectory the temporary directory for collecting report output
+ * @return {String} the name of the archive file that has been created.
+ */
+function archiveReport(tmpDirectory) {
+    let timestamp = moment().format('YYYYMMDD[T]HHmmss');",,2018-01-30 10:48:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/164670296,https://github.com/hyperledger/composer/pull/3264#discussion_r164670296,samjsmith
https://github.com/hyperledger/composer/pull/3264,https://github.com/hyperledger/composer/pull/3264,Node source doesn't include a resolve but what would it add here?,ce7f1462371e46c51e908af83fa60ecfb74eb834,2018-01-30 08:39:32,164670980,"@@ -0,0 +1,78 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const fs = require('fs');
+const os = require('os');
+const { sep } = require('path');
+const moment = require('moment');
+const nodereport = require('node-report');
+const tar = require('tar');
+
+/**
+ * Main API called from cmd and composer report.
+ * @return {String} the name of the archive file that was created.
+ */
+function report() {
+    let tmpDirectory = setupReportDir();
+
+    // TODO write readme file inc. version of the composer-report module
+    // Plus versions of the other composer modules?
+
+    createNodeReport(tmpDirectory);
+    return archiveReport(tmpDirectory);
+}
+
+/**
+ * Sets up the temp directory for the report
+ * @return {String} the Path to the temporary directory
+ */
+function setupReportDir() {
+    const tmpDir = os.tmpdir();
+    return fs.mkdtempSync(`${tmpDir}${sep}`);",44,2018-01-30 10:48:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/164670980,https://github.com/hyperledger/composer/pull/3264#discussion_r164670980,samjsmith
https://github.com/hyperledger/composer/pull/3264,https://github.com/hyperledger/composer/pull/3264,"Good spot. I think UTC would make life easer to compare reports in bigger issues, especially since we're not including the offset in the filename",ce7f1462371e46c51e908af83fa60ecfb74eb834,2018-01-30 10:42:20,164702390,"@@ -0,0 +1,78 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const fs = require('fs');
+const os = require('os');
+const { sep } = require('path');
+const moment = require('moment');
+const nodereport = require('node-report');
+const tar = require('tar');
+
+/**
+ * Main API called from cmd and composer report.
+ * @return {String} the name of the archive file that was created.
+ */
+function report() {
+    let tmpDirectory = setupReportDir();
+
+    // TODO write readme file inc. version of the composer-report module
+    // Plus versions of the other composer modules?
+
+    createNodeReport(tmpDirectory);
+    return archiveReport(tmpDirectory);
+}
+
+/**
+ * Sets up the temp directory for the report
+ * @return {String} the Path to the temporary directory
+ */
+function setupReportDir() {
+    const tmpDir = os.tmpdir();
+    return fs.mkdtempSync(`${tmpDir}${sep}`);
+}
+
+/**
+ * Trigger node-report to write report in the temp directory
+ * @param {String} tmpDirectory the temporary directory for collecting report output
+ */
+function createNodeReport(tmpDirectory) {
+    nodereport.setDirectory(tmpDirectory);
+    nodereport.triggerReport();
+}
+
+/**
+ * Creates an archive of the temp directory for the report
+ * @param {String} tmpDirectory the temporary directory for collecting report output
+ * @return {String} the name of the archive file that has been created.
+ */
+function archiveReport(tmpDirectory) {
+    let timestamp = moment().format('YYYYMMDD[T]HHmmss');",,2018-01-30 10:48:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/164702390,https://github.com/hyperledger/composer/pull/3264#discussion_r164702390,jt-nti
https://github.com/hyperledger/composer/pull/3264,https://github.com/hyperledger/composer/pull/3264,"Hmmm, unless there it would add anything, I'll leave this as-is. It's from the doc anyway... https://nodejs.org/api/fs.html#fs_fs_mkdtemp_prefix_options_callback",ce7f1462371e46c51e908af83fa60ecfb74eb834,2018-01-30 10:46:39,164703443,"@@ -0,0 +1,78 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const fs = require('fs');
+const os = require('os');
+const { sep } = require('path');
+const moment = require('moment');
+const nodereport = require('node-report');
+const tar = require('tar');
+
+/**
+ * Main API called from cmd and composer report.
+ * @return {String} the name of the archive file that was created.
+ */
+function report() {
+    let tmpDirectory = setupReportDir();
+
+    // TODO write readme file inc. version of the composer-report module
+    // Plus versions of the other composer modules?
+
+    createNodeReport(tmpDirectory);
+    return archiveReport(tmpDirectory);
+}
+
+/**
+ * Sets up the temp directory for the report
+ * @return {String} the Path to the temporary directory
+ */
+function setupReportDir() {
+    const tmpDir = os.tmpdir();
+    return fs.mkdtempSync(`${tmpDir}${sep}`);",44,2018-01-30 10:48:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/164703443,https://github.com/hyperledger/composer/pull/3264#discussion_r164703443,jt-nti
https://github.com/hyperledger/composer/pull/3234,https://github.com/hyperledger/composer/pull/3234,I don't think we should be referring to a Composer IDE. Playground isn't an IDE and VSCode plugin doesn't need to be mentioned here.,699496cc894b16f4d195adf32d4e045a91d7a8ce,2018-01-26 08:07:21,164050801,"@@ -33,30 +39,45 @@ Let's get started!
 
 <h2 class='everybody'>Prerequisites</h2>
 
-If you have installed the development environment, you will need to first stop the {{site.data.conrefs.hlf_full}} provided by the development environment:
+If you have previously installed the Composer IDE / development environment, you will need to first tear down the {{site.data.conrefs.hlf_full}} containers provided by the development environment:",,2018-01-29 15:31:41,https://api.github.com/repos/hyperledger/composer/pulls/comments/164050801,https://github.com/hyperledger/composer/pull/3234#discussion_r164050801,davidkel
https://github.com/hyperledger/composer/pull/3234,https://github.com/hyperledger/composer/pull/3234,"""it needs some changes"". Not sure what that is telling me, do I need to make changes for example ? what changes ? etc",699496cc894b16f4d195adf32d4e045a91d7a8ce,2018-01-26 08:08:44,164050973,"@@ -33,30 +39,45 @@ Let's get started!
 
 <h2 class='everybody'>Prerequisites</h2>
 
-If you have installed the development environment, you will need to first stop the {{site.data.conrefs.hlf_full}} provided by the development environment:
+If you have previously installed the Composer IDE / development environment, you will need to first tear down the {{site.data.conrefs.hlf_full}} containers provided by the development environment:
 
     cd ~/fabric-tools
     ./stopFabric.sh
     ./teardownFabric.sh
 
-Clone the following GitHub repository:
+Next, clone the following GitHub Fabric Samples repository (rather than use the samples from the [Fabric site:](http://hyperledger-fabric.readthedocs.io/en/latest/build_network.html) at this point, it needs some changes)",,2018-01-29 15:31:41,https://api.github.com/repos/hyperledger/composer/pulls/comments/164050973,https://github.com/hyperledger/composer/pull/3234#discussion_r164050973,davidkel
https://github.com/hyperledger/composer/pull/3234,https://github.com/hyperledger/composer/pull/3234,Think we can stop at the point saying this is outside the scope of this tutorial.,699496cc894b16f4d195adf32d4e045a91d7a8ce,2018-01-26 08:10:17,164051252,"@@ -33,30 +39,45 @@ Let's get started!
 
 <h2 class='everybody'>Prerequisites</h2>
 
-If you have installed the development environment, you will need to first stop the {{site.data.conrefs.hlf_full}} provided by the development environment:
+If you have previously installed the Composer IDE / development environment, you will need to first tear down the {{site.data.conrefs.hlf_full}} containers provided by the development environment:
 
     cd ~/fabric-tools
     ./stopFabric.sh
     ./teardownFabric.sh
 
-Clone the following GitHub repository:
+Next, clone the following GitHub Fabric Samples repository (rather than use the samples from the [Fabric site:](http://hyperledger-fabric.readthedocs.io/en/latest/build_network.html) at this point, it needs some changes)
 
     git clone -b issue-6978 https://github.com/sstone1/fabric-samples.git
 
-Follow the [Building Your First Network tutorial](http://hyperledger-fabric.readthedocs.io/en/latest/build_network.html), ensuring that you use the GitHub repository cloned in the previous step. You must not clone and use the Hyperledger Fabric version of the GitHub repository as it is currently missing changes that are required for this tutorial.
+We are using the  [Building Your First Network](http://hyperledger-fabric.readthedocs.io/en/latest/build_network.html) Fabric sample network for this multi-org tutorial. We will refer to this {{site.data.conrefs.hlf_full}} network as the 'BYFN' (Building Your First Network) network henceforth. If you choose to split your organisations across separate physical machines or separate virtual machines running on different IP networks, it is outside the scope of this particular tutorial. You will need to configure the blockchain network (for each org) and check that you can deploy/interact with some Fabric chaincode samples deployed to that network. Furthermore, the container names defined below in the connection profiles are resolved easily on single-machine based tutorial - you will need to ensure your setup is configured for any resolution or routing that is required between the machines.",,2018-01-29 15:31:41,https://api.github.com/repos/hyperledger/composer/pulls/comments/164051252,https://github.com/hyperledger/composer/pull/3234#discussion_r164051252,davidkel
https://github.com/hyperledger/composer/pull/3234,https://github.com/hyperledger/composer/pull/3234,Given we are providing more info we should explain a bit more about the generate step or point back to the original byfn documentation.,699496cc894b16f4d195adf32d4e045a91d7a8ce,2018-01-26 08:12:44,164051685,"@@ -33,30 +39,45 @@ Let's get started!
 
 <h2 class='everybody'>Prerequisites</h2>
 
-If you have installed the development environment, you will need to first stop the {{site.data.conrefs.hlf_full}} provided by the development environment:
+If you have previously installed the Composer IDE / development environment, you will need to first tear down the {{site.data.conrefs.hlf_full}} containers provided by the development environment:
 
     cd ~/fabric-tools
     ./stopFabric.sh
     ./teardownFabric.sh
 
-Clone the following GitHub repository:
+Next, clone the following GitHub Fabric Samples repository (rather than use the samples from the [Fabric site:](http://hyperledger-fabric.readthedocs.io/en/latest/build_network.html) at this point, it needs some changes)
 
     git clone -b issue-6978 https://github.com/sstone1/fabric-samples.git
 
-Follow the [Building Your First Network tutorial](http://hyperledger-fabric.readthedocs.io/en/latest/build_network.html), ensuring that you use the GitHub repository cloned in the previous step. You must not clone and use the Hyperledger Fabric version of the GitHub repository as it is currently missing changes that are required for this tutorial.
+We are using the  [Building Your First Network](http://hyperledger-fabric.readthedocs.io/en/latest/build_network.html) Fabric sample network for this multi-org tutorial. We will refer to this {{site.data.conrefs.hlf_full}} network as the 'BYFN' (Building Your First Network) network henceforth. If you choose to split your organisations across separate physical machines or separate virtual machines running on different IP networks, it is outside the scope of this particular tutorial. You will need to configure the blockchain network (for each org) and check that you can deploy/interact with some Fabric chaincode samples deployed to that network. Furthermore, the container names defined below in the connection profiles are resolved easily on single-machine based tutorial - you will need to ensure your setup is configured for any resolution or routing that is required between the machines.
 
 <h2 class='everybody'>Step One: Starting a {{site.data.conrefs.hlf_full}} network</h2>
 
-In order to follow this tutorial, you must start a {{site.data.conrefs.hlf_full}} network.
+In order to follow this tutorial, you must start up a fresh {{site.data.conrefs.hlf_full}} network. This tutorial will assume that you use the {{site.data.conrefs.hlf_full}} network provided in the {{site.data.conrefs.hlf_full}} [Building Your First Network tutorial](http://hyperledger-fabric.readthedocs.io/en/latest/build_network.html). 
+
+1. change directory to `fabric-samples`
 
-This tutorial will assume that you use the {{site.data.conrefs.hlf_full}} network provided in the {{site.data.conrefs.hlf_full}} [Building Your First Network tutorial](http://hyperledger-fabric.readthedocs.io/en/latest/build_network.html). We will refer to this {{site.data.conrefs.hlf_full}} network as the BYFN (Building Your First Network) network.
+    cd fabric-samples
+    
+2. Download the platform binaries, including cryptogen :
+  
+    curl -sSL https://goo.gl/6wtTN5 | bash -s 1.1.0-preview
 
-You can now start the BYFN network. You must specify additional flags that are not specified in the Building Your First Network tutorial. This is because we want to use CouchDB as the world state database, and we want to start a Certificate Authority (CA) for each organization.
+    Verify the list of docker images downloaded without issues
+    
+3. change directory into `first-network` sample 
+
+    cd first-network
+
+4. Next, start the BYFN network - additional flags (to the `byfn.sh` script below) must be specified, as we're using CouchDB as the world state database (different to that specified on the Fabric BYFN page) - we also want to start a Certificate Authority (CA) for **each** organization.
+ 
+5. Execute the following commands in sequence from the `first-network` directory:
 
     ./byfn.sh -m generate
+    
     ./byfn.sh -m up -s couchdb -a
 
-If the command works successfully, the BYFN network is started, and you will see the following output:
+If the command works successfully, the first command will generate artifacts, then following the second command, the BYFN network is started, and verify that you see the following output before proceeding:",,2018-01-29 15:31:41,https://api.github.com/repos/hyperledger/composer/pulls/comments/164051685,https://github.com/hyperledger/composer/pull/3234#discussion_r164051685,davidkel
https://github.com/hyperledger/composer/pull/3234,https://github.com/hyperledger/composer/pull/3234,/tmp/composer doesn't exist until you do the mkdir commands that follow,699496cc894b16f4d195adf32d4e045a91d7a8ce,2018-01-26 08:14:29,164051977,"@@ -281,43 +302,42 @@ We need a base connection profile that describes this fabric network which can t
         }
     }
 
-When working with the certificates it is recommended to create a temporary working directory to create the Composer connection profiles:
+Copy this base file (above) into a file  `byfn-network.json` under the new directory `/tmp/composer`. When working with the certificates, it is recommended to create a temporary working directory to create the Composer connection profiles.  ",,2018-01-29 15:31:41,https://api.github.com/repos/hyperledger/composer/pulls/comments/164051977,https://github.com/hyperledger/composer/pull/3234#discussion_r164051977,davidkel
https://github.com/hyperledger/composer/pull/3234,https://github.com/hyperledger/composer/pull/3234,"Next implies there is a first step, so we should define a first step in the section above.",699496cc894b16f4d195adf32d4e045a91d7a8ce,2018-01-26 08:16:18,164052249,"@@ -281,43 +302,42 @@ We need a base connection profile that describes this fabric network which can t
         }
     }
 
-When working with the certificates it is recommended to create a temporary working directory to create the Composer connection profiles:
+Copy this base file (above) into a file  `byfn-network.json` under the new directory `/tmp/composer`. When working with the certificates, it is recommended to create a temporary working directory to create the Composer connection profiles.  
+
 
     mkdir -p /tmp/composer/org1
+    
     mkdir -p /tmp/composer/org2
 
-You need to replace all instances of the text `INSERT_ORG1_CA_CERT` with the CA certificate for the peer nodes for `Org1`:
-Use the following command to convert the pem file to something that can be embedded into the above connection profile.
+Open `byfn-network.json` and replace all instances of the text `INSERT_ORG1_CA_CERT` with the CA certificate for the peer nodes for `Org1`: - use the following command to get the certificate from the .pem file so that it can be embedded into the above connection profile.
 
     awk 'NF {sub(/\r/, """"); printf ""%s\\n"",$0;}' crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt > /tmp/composer/org1/ca-org1.txt
 
-copy the contents of the file `/tmp/composer/org1/ca-org1.txt` and replace the text `INSERT_ORG1_CA_CERT`. It should now look something like this (but be a single line in the profile file)
+Next, copy the contents of the file `/tmp/composer/org1/ca-org1.txt` and replace the text `INSERT_ORG1_CA_CERT` in the .json file. It should now look something like this (must be a single line in the profile file as shown)",,2018-01-29 15:31:41,https://api.github.com/repos/hyperledger/composer/pulls/comments/164052249,https://github.com/hyperledger/composer/pull/3234#discussion_r164052249,davidkel
https://github.com/hyperledger/composer/pull/3234,https://github.com/hyperledger/composer/pull/3234,"I don't know what you mean by ""in your edit sessions"" so would suggest it be removed.",699496cc894b16f4d195adf32d4e045a91d7a8ce,2018-01-26 08:17:07,164052415,"@@ -281,43 +302,42 @@ We need a base connection profile that describes this fabric network which can t
         }
     }
 
-When working with the certificates it is recommended to create a temporary working directory to create the Composer connection profiles:
+Copy this base file (above) into a file  `byfn-network.json` under the new directory `/tmp/composer`. When working with the certificates, it is recommended to create a temporary working directory to create the Composer connection profiles.  
+
 
     mkdir -p /tmp/composer/org1
+    
     mkdir -p /tmp/composer/org2
 
-You need to replace all instances of the text `INSERT_ORG1_CA_CERT` with the CA certificate for the peer nodes for `Org1`:
-Use the following command to convert the pem file to something that can be embedded into the above connection profile.
+Open `byfn-network.json` and replace all instances of the text `INSERT_ORG1_CA_CERT` with the CA certificate for the peer nodes for `Org1`: - use the following command to get the certificate from the .pem file so that it can be embedded into the above connection profile.
 
     awk 'NF {sub(/\r/, """"); printf ""%s\\n"",$0;}' crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt > /tmp/composer/org1/ca-org1.txt
 
-copy the contents of the file `/tmp/composer/org1/ca-org1.txt` and replace the text `INSERT_ORG1_CA_CERT`. It should now look something like this (but be a single line in the profile file)
+Next, copy the contents of the file `/tmp/composer/org1/ca-org1.txt` and replace the text `INSERT_ORG1_CA_CERT` in the .json file. It should now look something like this (must be a single line in the profile file as shown)
 
 ```
 ""pem"": ""-----BEGIN CERTIFICATE-----\nMIICNTCCAdygAwIBAgIRAMNvmQpnXi7uM19BLdha3MwwCgYIKoZIzj0EAwIwbDEL\nMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNhbGlmb3JuaWExFjAUBgNVBAcTDVNhbiBG\ncmFuY2lzY28xFDASBgNVBAoTC2V4YW1wbGUuY29tMRowGAYDVQQDExF0bHNjYS5l\neGFtcGxlLmNvbTAeFw0xNzA2MjYxMjQ5MjZaFw0yNzA2MjQxMjQ5MjZaMGwxCzAJ\nBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRYwFAYDVQQHEw1TYW4gRnJh\nbmNpc2NvMRQwEgYDVQQKEwtleGFtcGxlLmNvbTEaMBgGA1UEAxMRdGxzY2EuZXhh\nbXBsZS5jb20wWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASJn3QUVcKCp+s6lSPE\nP5KlWmE9rEG0kpECsAfW28vZQSIg2Ez+Tp1alA9SYN/5BtL1N6lUUoVhG3lz8uvi\n8zhro18wXTAOBgNVHQ8BAf8EBAMCAaYwDwYDVR0lBAgwBgYEVR0lADAPBgNVHRMB\nAf8EBTADAQH/MCkGA1UdDgQiBCB7ULYTq3+BQqnzwae1RsnwQgJv/HQ5+je2xcDr\nka4MHTAKBggqhkjOPQQDAgNHADBEAiB2hLiS8B1g4J5Qbxu15dVWAZTAXX9xPAvm\n4l25e1oS+gIgBiU/aBwSxY0uambwMB6xtQz0ZE/D4lyTZZcW9SODlOE=\n-----END CERTIFICATE-----\n""
 ```
 
-You need to replace all instances of the text `INSERT_ORG2_CA_CERT` with the CA certificate for the peer nodes for `Org2`:
-Use the following command to convert the pem file to something that can be embedded into the above connection profile.
+Next, in the same .json file - you need to replace all instances of the text `INSERT_ORG2_CA_CERT` with the CA certificate for the peer nodes for `Org2`:  - use the following command to convert the .pem file to something that can be embedded into the above connection profile.
 
     awk 'NF {sub(/\r/, """"); printf ""%s\\n"",$0;}' crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt > /tmp/composer/org2/ca-org2.txt
 
-Copy the contents of the file `/tmp/composer/org2/ca-org2.txt` and replace the text `INSERT_ORG2_CA_CERT`.
+Copy the contents of the file `/tmp/composer/org2/ca-org2.txt` and replace the text called `INSERT_ORG2_CA_CERT`. Once again, all on the same line.
 
-You need to replace all instances of the text `INSERT_ORDERER_CA_CERT` with the CA certificate for the orderer node:
-Use the following command to convert the pem file to something that can be embedded into the above connection profile.
+Next, you need to replace all instances of the text `INSERT_ORDERER_CA_CERT` with the CA certificate for the orderer node:  use the following command to convert the .pem file to something that can be embedded into the above connection profile json file.
 
     awk 'NF {sub(/\r/, """"); printf ""%s\\n"",$0;}' crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/ca.crt > /tmp/composer/ca-orderer.txt
 
 copy the contents of the file `/tmp/composer/ca-orderer.txt` and replace the text `INSERT_ORDERER_CA_CERT`.
 
-Once done, save this file as `/tmp/composer/byfn-network.json`.
+Once done, save this file in your edit sessions as  `/tmp/composer/byfn-network.json`.",,2018-01-29 15:31:41,https://api.github.com/repos/hyperledger/composer/pulls/comments/164052415,https://github.com/hyperledger/composer/pull/3234#discussion_r164052415,davidkel
https://github.com/hyperledger/composer/pull/3234,https://github.com/hyperledger/composer/pull/3234,between the version (need the),699496cc894b16f4d195adf32d4e045a91d7a8ce,2018-01-26 08:18:13,164052608,"@@ -281,43 +302,42 @@ We need a base connection profile that describes this fabric network which can t
         }
     }
 
-When working with the certificates it is recommended to create a temporary working directory to create the Composer connection profiles:
+Copy this base file (above) into a file  `byfn-network.json` under the new directory `/tmp/composer`. When working with the certificates, it is recommended to create a temporary working directory to create the Composer connection profiles.  
+
 
     mkdir -p /tmp/composer/org1
+    
     mkdir -p /tmp/composer/org2
 
-You need to replace all instances of the text `INSERT_ORG1_CA_CERT` with the CA certificate for the peer nodes for `Org1`:
-Use the following command to convert the pem file to something that can be embedded into the above connection profile.
+Open `byfn-network.json` and replace all instances of the text `INSERT_ORG1_CA_CERT` with the CA certificate for the peer nodes for `Org1`: - use the following command to get the certificate from the .pem file so that it can be embedded into the above connection profile.
 
     awk 'NF {sub(/\r/, """"); printf ""%s\\n"",$0;}' crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt > /tmp/composer/org1/ca-org1.txt
 
-copy the contents of the file `/tmp/composer/org1/ca-org1.txt` and replace the text `INSERT_ORG1_CA_CERT`. It should now look something like this (but be a single line in the profile file)
+Next, copy the contents of the file `/tmp/composer/org1/ca-org1.txt` and replace the text `INSERT_ORG1_CA_CERT` in the .json file. It should now look something like this (must be a single line in the profile file as shown)
 
 ```
 ""pem"": ""-----BEGIN CERTIFICATE-----\nMIICNTCCAdygAwIBAgIRAMNvmQpnXi7uM19BLdha3MwwCgYIKoZIzj0EAwIwbDEL\nMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNhbGlmb3JuaWExFjAUBgNVBAcTDVNhbiBG\ncmFuY2lzY28xFDASBgNVBAoTC2V4YW1wbGUuY29tMRowGAYDVQQDExF0bHNjYS5l\neGFtcGxlLmNvbTAeFw0xNzA2MjYxMjQ5MjZaFw0yNzA2MjQxMjQ5MjZaMGwxCzAJ\nBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRYwFAYDVQQHEw1TYW4gRnJh\nbmNpc2NvMRQwEgYDVQQKEwtleGFtcGxlLmNvbTEaMBgGA1UEAxMRdGxzY2EuZXhh\nbXBsZS5jb20wWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASJn3QUVcKCp+s6lSPE\nP5KlWmE9rEG0kpECsAfW28vZQSIg2Ez+Tp1alA9SYN/5BtL1N6lUUoVhG3lz8uvi\n8zhro18wXTAOBgNVHQ8BAf8EBAMCAaYwDwYDVR0lBAgwBgYEVR0lADAPBgNVHRMB\nAf8EBTADAQH/MCkGA1UdDgQiBCB7ULYTq3+BQqnzwae1RsnwQgJv/HQ5+je2xcDr\nka4MHTAKBggqhkjOPQQDAgNHADBEAiB2hLiS8B1g4J5Qbxu15dVWAZTAXX9xPAvm\n4l25e1oS+gIgBiU/aBwSxY0uambwMB6xtQz0ZE/D4lyTZZcW9SODlOE=\n-----END CERTIFICATE-----\n""
 ```
 
-You need to replace all instances of the text `INSERT_ORG2_CA_CERT` with the CA certificate for the peer nodes for `Org2`:
-Use the following command to convert the pem file to something that can be embedded into the above connection profile.
+Next, in the same .json file - you need to replace all instances of the text `INSERT_ORG2_CA_CERT` with the CA certificate for the peer nodes for `Org2`:  - use the following command to convert the .pem file to something that can be embedded into the above connection profile.
 
     awk 'NF {sub(/\r/, """"); printf ""%s\\n"",$0;}' crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt > /tmp/composer/org2/ca-org2.txt
 
-Copy the contents of the file `/tmp/composer/org2/ca-org2.txt` and replace the text `INSERT_ORG2_CA_CERT`.
+Copy the contents of the file `/tmp/composer/org2/ca-org2.txt` and replace the text called `INSERT_ORG2_CA_CERT`. Once again, all on the same line.
 
-You need to replace all instances of the text `INSERT_ORDERER_CA_CERT` with the CA certificate for the orderer node:
-Use the following command to convert the pem file to something that can be embedded into the above connection profile.
+Next, you need to replace all instances of the text `INSERT_ORDERER_CA_CERT` with the CA certificate for the orderer node:  use the following command to convert the .pem file to something that can be embedded into the above connection profile json file.
 
     awk 'NF {sub(/\r/, """"); printf ""%s\\n"",$0;}' crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/ca.crt > /tmp/composer/ca-orderer.txt
 
 copy the contents of the file `/tmp/composer/ca-orderer.txt` and replace the text `INSERT_ORDERER_CA_CERT`.
 
-Once done, save this file as `/tmp/composer/byfn-network.json`.
+Once done, save this file in your edit sessions as  `/tmp/composer/byfn-network.json`.
 
 This connection profile now describes the fabric network setup, all the peers, orderers and certificate authorities that are part of the network, it defines all the organizations that are participating in the network and also defines the channel's on this network. {{site.data.conrefs.composer_full}} can only interact with a single channel so only one channel should be defined.
 
 <h2 class='alice'>Step Three: Customizing the connection profile for Org1</h2>
 
-This is just a case of now specifying the organization that `alice` belongs to in a client section with optional timeouts, so add the following block into the above connection profile `/tmp/composer/byfn-network.json` after the `version` property and before the `channel` property and save it as `/tmp/composer/org1/byfn-network-org1.json`.
+This is just a case of specifying the organization that `alice` belongs to, in a `client` section with optional timeouts,  add the following block into the above connection profile `/tmp/composer/byfn-network.json` between `version` property and just before the `channel` property - once done, save it as a NEW file called  `/tmp/composer/org1/byfn-network-org1.json`.",,2018-01-29 15:31:41,https://api.github.com/repos/hyperledger/composer/pulls/comments/164052608,https://github.com/hyperledger/composer/pull/3234#discussion_r164052608,davidkel
https://github.com/hyperledger/composer/pull/3234,https://github.com/hyperledger/composer/pull/3234,Why is this section repeated again ? it looks like the example directly above it.,699496cc894b16f4d195adf32d4e045a91d7a8ce,2018-01-26 08:19:25,164052802,"@@ -375,17 +395,48 @@ Repeat the same process for `bob` but this time specify the organization as `Org
         ""channel"": {
         ...
 
+So the section of the profile should look like",,2018-01-29 15:31:41,https://api.github.com/repos/hyperledger/composer/pulls/comments/164052802,https://github.com/hyperledger/composer/pull/3234#discussion_r164052802,davidkel
https://github.com/hyperledger/composer/pull/3234,https://github.com/hyperledger/composer/pull/3234,"huh ? ok, so it's done in the example later, but either need more explanation here or just don't say anything.",699496cc894b16f4d195adf32d4e045a91d7a8ce,2018-01-26 08:20:00,164052876,"@@ -375,17 +395,48 @@ Repeat the same process for `bob` but this time specify the organization as `Org
         ""channel"": {
         ...
 
+So the section of the profile should look like
+
+        ...
+        ""version"": ""1.0.0"",
+        ""client"": {
+            ""organization"": ""Org2"",
+            ""connection"": {
+                ""timeout"": {
+                    ""peer"": {
+                        ""endorser"": ""300"",
+                        ""eventHub"": ""300"",
+                        ""eventReg"": ""300""
+                    },
+                    ""orderer"": ""300""
+                }
+            }
+        },
+        ""channel"": {
+        ...
+
 <h2 class='alice'>Step Five: Locating the certificate and private key for the {{site.data.conrefs.hlf_full}} administrator for Org1</h2>
 
-The administrator for our {{site.data.conrefs.hlf_full}} network is a user called `Admin@org1.example.com`. The certificates and private key files for this user are stored in the directory:
+The administrator for our {{site.data.conrefs.hlf_full}} Org1 network is a user called `Admin@org1.example.com`. The certificates and private key files for this user are stored in the directory:
 
     crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
 
+You can set this directory as a variable to use for copying the certificate and key: ",,2018-01-29 15:31:41,https://api.github.com/repos/hyperledger/composer/pulls/comments/164052876,https://github.com/hyperledger/composer/pull/3234#discussion_r164052876,davidkel
https://github.com/hyperledger/composer/pull/3234,https://github.com/hyperledger/composer/pull/3234,Shouldn't this be at the first place where trade-network is referenced.,699496cc894b16f4d195adf32d4e045a91d7a8ce,2018-01-26 08:23:23,164053373,"@@ -439,13 +499,15 @@ If the command works successfully, a business network card called `PeerAdmin@byf
 
 Run the `composer runtime install` command to install the {{site.data.conrefs.composer_full}} runtime onto all of the {{site.data.conrefs.hlf_full}} peer nodes for `Org1` that you specified in the connection profile file you created in step three:
 
-    composer runtime install -c PeerAdmin@byfn-network-org1 -n tutorial-network
+    composer runtime install -c PeerAdmin@byfn-network-org1 -n trade-network
 
 <h2 class='bob'>Step Twelve: Installing the {{site.data.conrefs.composer_full}} runtime onto the {{site.data.conrefs.hlf_full}} peer nodes for Org2</h2>
 
 Run the `composer runtime install` command to install the {{site.data.conrefs.composer_full}} runtime onto all of the {{site.data.conrefs.hlf_full}} peer nodes for `Org2` that you specified in the connection profile file you created in step four:
 
-    composer runtime install -c PeerAdmin@byfn-network-org2 -n tutorial-network
+    composer runtime install -c PeerAdmin@byfn-network-org2 -n trade-network
+",,2018-01-29 15:31:41,https://api.github.com/repos/hyperledger/composer/pulls/comments/164053373,https://github.com/hyperledger/composer/pull/3234#discussion_r164053373,davidkel
https://github.com/hyperledger/composer/pull/3228,https://github.com/hyperledger/composer/pull/3228,"As this doc is going into master, it should only refer to v1.1 of fabric. We don't refer to fabric directly in our docs but rather use a variable for substitution. 
{{site.data.conrefs.hlf_full}}
Also not sure about the ""refere"" word, did you mean ""reference"" ?",bbe0f72e17ab40eb8ee7cc97e94a2e8901c87524,2018-01-31 16:06:23,165100656,"@@ -33,6 +33,8 @@ The `statement` property contains the defining rules of the query, and can have
 - `SKIP` is an optional operator which defines the number of results to skip.
 - `LIMIT` is an optional operator which defines the maximum number of results to return from a query, by default limit is set at 25.
 
+> Note: If you're using Fabric v1 or Fabric v1.1, the `LIMIT` and `SKIP` won't work as there is an issue passing the params to couchdb from fabric. refere : [FAB-2809](https://jira.hyperledger.org/browse/FAB-2809)",,2018-02-02 08:22:36,https://api.github.com/repos/hyperledger/composer/pulls/comments/165100656,https://github.com/hyperledger/composer/pull/3228#discussion_r165100656,davidkel
https://github.com/hyperledger/composer/pull/3219,https://github.com/hyperledger/composer/pull/3219,"""Frank Frankly"" ðŸ˜‚ ",d0da91e4340e29472ca531902f73757decf3fac8,2018-01-25 07:49:15,163769063,"@@ -106,6 +106,44 @@ describe('Identity system tests', function() {
             });
     });
 
+    it('should issue an identity that can issue another identity and make it available for a ping request', () => {
+        let identity = uuid.v4();
+        let identity2 = uuid.v4();
+        let participant2;
+        return client.issueIdentity(participant, identity, {issuer: true})
+            .then((identity) => {
+                return TestUtil.getClient(cardStore,'systest-identities', identity.userID, identity.userSecret);
+            })
+            .then((result) => {
+                client = result;
+                return client.ping();
+            })
+            .then((result) => {
+                result.participant.should.equal(participant.getFullyQualifiedIdentifier());
+                let factory = client.getBusinessNetwork().getFactory();
+                participant2 = factory.newResource('systest.identities', 'SampleParticipant', 'frank@uk.ibm.com');
+                participant2.firstName = 'Frank';
+                participant2.lastName = 'Frankly';",21,2018-01-25 19:18:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/163769063,https://github.com/hyperledger/composer/pull/3219#discussion_r163769063,sstone1
https://github.com/hyperledger/composer/pull/3178,https://github.com/hyperledger/composer/pull/3178,I think we'll probably end up having to extend this URL scheme and this loader in the future to cope with GitHub Enterprise instances but it's fine as-is. ,6c49f7351231bc2b4a8bb4550930ad695ff66ece,2018-01-29 11:50:27,164408253,"@@ -0,0 +1,62 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const LOG = require('../../log/logger').getLog('GitHubModelFileLoader');
+const HTTPModelFileLoader = require('./httpmodelfileloader');
+
+/**
+ * Loads ModelFiles from an external source, such as a URL.
+ *
+ * @class
+ * @private
+ * @memberof module:composer-common
+ */
+class GitHubModelFileLoader extends HTTPModelFileLoader {
+    /**
+     * Create the ModelLoader.
+     * @param {ModelManager} modelManager - the modelManager for the modelFile
+     * @private
+     */
+    constructor(modelManager) {
+        LOG.entry('constructor');
+        super(modelManager);
+        LOG.exit('constructor');
+    }
+
+    /**
+     * Returns true if this ModelLoader can process the URL
+     * @param {string} url - the URL
+     * @return {boolean} true if this ModelLoader accepts the URL
+     * @abstract
+     */
+    accepts(url) {
+        return url.startsWith('github://');
+    }
+
+    /**
+     * Load a ModelFile from a URL and return it
+     * @param {string} url - the url to get
+     * @param {object} options - additional options
+     * @return {Promise} a promise to the ModelFile
+     */
+    load(url, options) {
+        const rewrittenUrl = 'https://raw.githubusercontent.com/' + url.substring(9);",56,2018-01-29 11:50:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/164408253,https://github.com/hyperledger/composer/pull/3178#discussion_r164408253,sstone1
https://github.com/hyperledger/composer/pull/3178,https://github.com/hyperledger/composer/pull/3178,Do we really need yet another HTTP request module? We already use `request` and `xhr`.,6c49f7351231bc2b4a8bb4550930ad695ff66ece,2018-01-29 11:51:34,164408479,"@@ -0,0 +1,78 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const axios = require('axios');",17,2018-01-29 11:51:34,https://api.github.com/repos/hyperledger/composer/pulls/comments/164408479,https://github.com/hyperledger/composer/pull/3178#discussion_r164408479,sstone1
https://github.com/hyperledger/composer/pull/3178,https://github.com/hyperledger/composer/pull/3178,I think if you add the `@abstract` tag to the JSDoc comment you don't need any of these eslint/istanbul hacks ðŸ˜‰ ,6c49f7351231bc2b4a8bb4550930ad695ff66ece,2018-01-29 11:53:13,164408799,"@@ -0,0 +1,183 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+ // From: https://gitlab.com/dominicp/node-job-queue/blob/master/node-job-queue.js
+
+'use strict';
+
+const EventEmitter = require('events');
+
+/**
+ * A class to facilitate adding jobs to a queue and running them.
+ * @private
+ */
+class JobQueue extends EventEmitter {
+
+    /**
+     * Setup class properties.
+     *
+     * @param {int} startDelay How long after a job is added should we want before
+     *                       starting to process jobs in the queue.
+     * @param {int} jobDelay   Once we are running jobs, how long should we wait
+     *                       between each job in the queue.
+     */
+    constructor(startDelay = 0, jobDelay = 0) {
+
+        // Call the EventEmitter constructor
+        super();
+
+        // Store the arguments as class properties
+        this.startDelay = startDelay;
+
+        this.jobDelay = jobDelay;
+
+        // Setup the job queue
+        this.jobs = [];
+
+        // Setup a timer to use for startDelay
+        this.timer = false;
+
+        // Setup a switch to let us know if a synchronous job is running
+        this.jobRunning = false;
+    }
+
+    /**
+     * Add a job to the queue. After the job is added, we process the queue.
+     *
+     * @param {mixed} job This can be anything that your runJob method expects.
+     */
+    addJob(job) {
+
+        // Add the job
+        this.jobs.push(job);
+
+        // Emit an event
+        this.emit('jobAdd', job, this.jobs);
+
+        // If we have a startDelay and the queue was empty, hurry up and wait
+        if (this.startDelay && this.jobs.length < 2) {
+
+            this.timer = setTimeout(() => this.processQueue(true), this.startDelay);
+
+        } else {
+
+            this.processQueue();
+        }
+    }
+
+    /**
+     * Remove a job from the queue. Continues processing the queue when finished.
+     *
+     * @param {int} index The array index of the job to remove in this.jobs
+     */
+    deleteJob(index) {
+
+        if (! this.jobs[index]) {
+
+            this.emit('queueError',
+                new Error('Attempted to delete job that cannot be found: ' + index),
+                this.jobs
+            );
+
+        } else {
+
+            // Remove the job from the queue
+            this.jobs.splice(index, 1);
+
+            this.emit('jobRemove', this.jobs);
+        }
+    }
+
+    /**
+     * Run the next job in the queue.
+     *
+     * @param {bool} resetTimer If true we set the class timer to false.
+     */
+    processQueue(resetTimer) {
+
+        // If we were asked to, clear the global timer
+        if (resetTimer) { this.timer = false; }
+
+        // If the queue is empty, we're done
+        if (this.jobs.length < 1) { return; }
+
+        // If a job is running, or we are waiting on a startDelay, just retry later
+        if (this.jobRunning || this.timer) {
+
+            setTimeout(() => this.processQueue(), 10000);
+            return;
+        }
+
+        const nextJob = this.jobs.findIndex(job => !! job);
+
+        // Define a function to run when the sync is complete
+        const finished = () => {
+
+            // Reset the switch
+            this.jobRunning = false;
+
+            // Save a copy of the finished job before we remove it for the event
+            const finishedJob = this.jobs[nextJob];
+
+            // Remove the job from the queue
+            this.deleteJob(nextJob);
+
+            this.emit('jobFinish', finishedJob, this.jobs);
+
+            // Run the next job
+            this.timer = setTimeout(() => { this.processQueue(true); }, this.jobDelay);
+        };
+
+        this.jobRunning = true;
+
+        this.emit('jobStart', this.jobs[nextJob], this.jobs);
+
+        // Get the first job in the queue and run it
+        this.runJob(this.jobs[nextJob])
+            .then(finished)
+            .catch((error) => {
+
+                // Emit the error
+                this.emit('queueError', error, this.jobs);
+
+                // Still call the finished handler
+                finished();
+            });
+    }
+
+    /**
+     * Simpler getter for the job queue. Since this.jobs should be private
+     * access we provide this getter.
+     *
+     * @return {array} The current queue of jobs to run
+     */
+    getQueue() {
+
+        return this.jobs;
+    }
+
+    /* eslint-disable class-methods-use-this */
+
+    /* istanbul ignore next */
+    /**
+     * Abstract method: must be overriden.
+     * @param {any} job - data for the job
+     * @return {Promise} promise to the job results.
+     */
+    runJob(job) { return Promise.resolve(job); }",178,2018-01-29 11:53:13,https://api.github.com/repos/hyperledger/composer/pulls/comments/164408799,https://github.com/hyperledger/composer/pull/3178#discussion_r164408799,sstone1
https://github.com/hyperledger/composer/pull/3178,https://github.com/hyperledger/composer/pull/3178,What's this doing in this PR?,6c49f7351231bc2b4a8bb4550930ad695ff66ece,2018-01-29 11:55:16,164409248,"@@ -313,6 +313,12 @@ copy the contents of the file `/tmp/composer/ca-orderer.txt` and replace the tex
 
 Once done, save this file as `/tmp/composer/byfn-network.json`.
 
+Run the following commands to create connection profiles for Org1 and Org2:",4,2018-01-29 11:55:16,https://api.github.com/repos/hyperledger/composer/pulls/comments/164409248,https://github.com/hyperledger/composer/pull/3178#discussion_r164409248,sstone1
https://github.com/hyperledger/composer/pull/3144,https://github.com/hyperledger/composer/pull/3144,mockGoType == mockJavaType?,476fe1787c522bb30886153664df505c49eebf99,2018-01-24 16:42:23,163605141,"@@ -0,0 +1,524 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const chai = require('chai');
+const should = chai.should();
+const sinon = require('sinon');
+
+const JavaVisitor = require('../../../../lib/codegen/fromcto/java/javavisitor.js');
+
+const ClassDeclaration = require('../../../../lib/introspect/classdeclaration');
+const EnumDeclaration = require('../../../../lib/introspect/enumdeclaration');
+const EnumValueDeclaration = require('../../../../lib/introspect/enumvaluedeclaration');
+const Field = require('../../../../lib/introspect/field');
+const ModelFile = require('../../../../lib/introspect/modelfile');
+const ModelManager = require('../../../../lib/modelmanager');
+const BusinessNetworkDefinition = require('../../../../lib/businessnetworkdefinition');
+const RelationshipDeclaration = require('../../../../lib/introspect/relationshipdeclaration');
+const FunctionDeclaration = require('../../../../lib/introspect/functiondeclaration');
+
+const fileWriter = require('../../../../lib/codegen/filewriter.js');
+
+describe('JavaVisitor', function () {
+    let javaVisit;
+    let mockFileWriter;
+    beforeEach(() => {
+        javaVisit = new JavaVisitor();
+        mockFileWriter = sinon.createStubInstance(fileWriter);
+    });
+
+    describe('visit', () => {
+        let param;
+        beforeEach(() => {
+            param = {
+                property1: 'value1'
+            };
+        });
+
+        it('should call visitBusinessNetworkDefinition for a BusinessNetworkDefintion', () => {
+            let thing = sinon.createStubInstance(BusinessNetworkDefinition);
+            let mockSpecialVisit = sinon.stub(javaVisit, 'visitBusinessNetworkDefinition');
+            mockSpecialVisit.returns('Duck');
+
+            javaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitModelManager for a ModelManager', () => {
+            let thing = sinon.createStubInstance(ModelManager);
+            let mockSpecialVisit = sinon.stub(javaVisit, 'visitModelManager');
+            mockSpecialVisit.returns('Duck');
+
+            javaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitModelFile for a ModelFile', () => {
+            let thing = sinon.createStubInstance(ModelFile);
+            let mockSpecialVisit = sinon.stub(javaVisit, 'visitModelFile');
+            mockSpecialVisit.returns('Duck');
+
+            javaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitEnumDeclaration for a EnumDeclaration', () => {
+            let thing = sinon.createStubInstance(EnumDeclaration);
+            let mockSpecialVisit = sinon.stub(javaVisit, 'visitEnumDeclaration');
+            mockSpecialVisit.returns('Duck');
+
+            javaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitClassDeclaration for a ClassDeclaration', () => {
+            let thing = sinon.createStubInstance(ClassDeclaration);
+            let mockSpecialVisit = sinon.stub(javaVisit, 'visitClassDeclaration');
+            mockSpecialVisit.returns('Duck');
+
+            javaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitField for a Field', () => {
+            let thing = sinon.createStubInstance(Field);
+            let mockSpecialVisit = sinon.stub(javaVisit, 'visitField');
+            mockSpecialVisit.returns('Duck');
+
+            javaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitRelationship for a RelationshipDeclaration', () => {
+            let thing = sinon.createStubInstance(RelationshipDeclaration);
+            let mockSpecialVisit = sinon.stub(javaVisit, 'visitRelationship');
+            mockSpecialVisit.returns('Duck');
+
+            javaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitEnumValueDeclaration for a EnumValueDeclaration', () => {
+            let thing = sinon.createStubInstance(EnumValueDeclaration);
+            let mockSpecialVisit = sinon.stub(javaVisit, 'visitEnumValueDeclaration');
+            mockSpecialVisit.returns('Duck');
+
+            javaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call nothing for a FunctionDeclaration', () => {
+            let thing = sinon.createStubInstance(FunctionDeclaration);
+
+            should.equal(javaVisit.visit(thing, param), undefined);
+        });
+
+        it('should throw an error when an unrecognised type is supplied', () => {
+            let thing = 'Something of unrecognised type';
+
+            (() => {
+                javaVisit.visit(thing, param);
+            }).should.throw('Unrecognised type: string, value: \'Something of unrecognised type\'');
+        });
+    });
+
+    describe('visitBusinessNetworkDefinition', () => {
+        let param = {
+            property1: 'value1'
+        };
+
+        it('should accept ModelManager', () => {
+            let acceptSpy = sinon.spy();
+            let mockBusinessNetworkDefinition = sinon.createStubInstance(BusinessNetworkDefinition);
+            mockBusinessNetworkDefinition.getModelManager.returns({
+                accept: acceptSpy
+            });
+
+            javaVisit.visitBusinessNetworkDefinition(mockBusinessNetworkDefinition, param);
+            acceptSpy.withArgs(javaVisit, param).calledOnce.should.be.ok;
+        });
+    });
+
+    describe('visitModelManager', () => {
+        it('should write to the org/hyperledger/composer/system/Resource.java file and call accept for each model file', () => {
+            let param = {
+                fileWriter: mockFileWriter
+            };
+
+            let acceptSpy = sinon.spy();
+            let mockModelManagerDefinition = sinon.createStubInstance(ModelManager);
+            mockModelManagerDefinition.getModelFiles.returns([{
+                accept: acceptSpy
+            },
+            {
+                accept: acceptSpy
+            }]);
+
+            javaVisit.visitModelManager(mockModelManagerDefinition, param);
+            param.fileWriter.openFile.withArgs('org/hyperledger/composer/system/Resource.java').calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(4);
+            param.fileWriter.closeFile.calledOnce.should.be.ok;
+            acceptSpy.withArgs(javaVisit, param).calledTwice.should.be.ok;
+        });
+    });
+
+    describe('visitModelFile', () => {
+        it('should call accept for each declaration', () => {
+            let param = {
+                property1: 'value1'
+            };
+
+            let acceptSpy = sinon.spy();
+            let mockModelFile = sinon.createStubInstance(ModelFile);
+            mockModelFile.getAllDeclarations.returns([{
+                accept: acceptSpy
+            },
+            {
+                accept: acceptSpy
+            }]);
+
+            javaVisit.visitModelFile(mockModelFile, param);
+
+            acceptSpy.withArgs(javaVisit, param).calledTwice.should.be.ok;
+        });
+    });
+
+    describe('startClassFile', () => {
+        it('should write a java class file header', () => {
+            let param = {
+                fileWriter: mockFileWriter
+            };
+
+            let mockClass = sinon.createStubInstance(ClassDeclaration);
+            mockClass.getModelFile.returns({
+                getNamespace: () => {
+                    return 'org.acme.people';
+                },
+                getName: () => {
+                    return 'Bob';
+                }
+            });
+
+            javaVisit.startClassFile(mockClass, param);
+
+            param.fileWriter.openFile.withArgs('org/acme/people/bob.java');
+            param.fileWriter.writeLine.callCount.should.deep.equal(4);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, '// this code is generated and should not be modified']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, 'package org.acme.people;']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, '']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([0, 'import org.hyperledger.composer.system.*;']);
+        });
+    });
+
+    describe('endClassFile', () => {
+        it('should close a java class file', () => {
+            let param = {
+                fileWriter: mockFileWriter
+            };
+
+            let mockClass = sinon.createStubInstance(ClassDeclaration);
+
+            javaVisit.endClassFile(mockClass, param);
+
+            param.fileWriter.closeFile.calledOnce.should.be.ok;
+        });
+    });
+
+    describe('visitEnumDeclaration', () => {
+        it('should write an enum declaration and call accept on each property', () => {
+            let acceptSpy = sinon.spy();
+
+            let param = {
+                fileWriter: mockFileWriter
+            };
+
+            let mockEnumDeclaration = sinon.createStubInstance(EnumDeclaration);
+            mockEnumDeclaration.getName.returns('Bob');
+            mockEnumDeclaration.getOwnProperties.returns([{
+                accept: acceptSpy
+            },
+            {
+                accept: acceptSpy
+            }]);
+
+            let mockStartClassFile = sinon.stub(javaVisit, 'startClassFile');
+            let mockEndClassFile = sinon.stub(javaVisit, 'endClassFile');
+
+            javaVisit.visitEnumDeclaration(mockEnumDeclaration, param);
+
+            mockStartClassFile.withArgs(mockEnumDeclaration, param).calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(4);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, 'import com.fasterxml.jackson.annotation.JsonIgnoreProperties;']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, '@JsonIgnoreProperties({""$class""})']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, 'public enum Bob {']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([0, '}']);
+            mockEndClassFile.withArgs(mockEnumDeclaration, param).calledOnce.should.be.ok;
+        });
+    });
+
+    describe('visitClassDeclaration', () => {
+        let acceptSpy;
+        let param;
+        let mockClassDeclaration;
+        let mockStartClassFile;
+        let mockEndClassFile;
+        beforeEach(() => {
+            acceptSpy = sinon.spy();
+
+            param = {
+                fileWriter: mockFileWriter
+            };
+
+            mockClassDeclaration = sinon.createStubInstance(ClassDeclaration);
+            mockClassDeclaration.getName.returns('Bob');
+            mockClassDeclaration.getModelFile.returns({
+                getImports: () => {
+                    return ['oranges', 'apples'];
+                }
+            });
+            mockClassDeclaration.getOwnProperties.returns([{
+                accept: acceptSpy
+            },
+            {
+                accept: acceptSpy
+            }]);
+            mockClassDeclaration.isConcept.returns(false);
+            mockClassDeclaration.isAbstract.returns(false);
+            mockClassDeclaration.isSystemCoreType.returns(false);
+            mockClassDeclaration.getSuperType.returns(false);
+            mockClassDeclaration.getIdentifierFieldName.returns(false);
+
+            mockStartClassFile = sinon.stub(javaVisit, 'startClassFile');
+            mockEndClassFile = sinon.stub(javaVisit, 'endClassFile');
+        });
+
+        it('should write a class declaration and call accept on each property', () => {
+            javaVisit.visitClassDeclaration(mockClassDeclaration, param);
+
+            mockStartClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(4);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, 'import oranges;']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, 'import apples;']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, 'public class Bob {']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([0, '}']);
+            acceptSpy.withArgs(javaVisit, param).calledTwice.should.be.ok;
+            mockEndClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+        });
+
+        it('should write a concept class declaration and call accept on each property', () => {
+            mockClassDeclaration.isConcept.returns(true);
+
+            javaVisit.visitClassDeclaration(mockClassDeclaration, param);
+
+            mockStartClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(7);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, 'import oranges;']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, 'import apples;']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, 'import com.fasterxml.jackson.annotation.JsonIgnoreProperties;']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([0, '']);
+            param.fileWriter.writeLine.getCall(4).args.should.deep.equal([0, '@JsonIgnoreProperties({""$class""})']);
+            param.fileWriter.writeLine.getCall(5).args.should.deep.equal([0, 'public class Bob {']);
+            param.fileWriter.writeLine.getCall(6).args.should.deep.equal([0, '}']);
+            acceptSpy.withArgs(javaVisit, param).calledTwice.should.be.ok;
+            mockEndClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+        });
+
+        it('should write an abstract class declaration and call accept on each property', () => {
+            mockClassDeclaration.isAbstract.returns(true);
+
+            javaVisit.visitClassDeclaration(mockClassDeclaration, param);
+
+            mockStartClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(4);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, 'import oranges;']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, 'import apples;']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, 'public abstract class Bob {']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([0, '}']);
+            acceptSpy.withArgs(javaVisit, param).calledTwice.should.be.ok;
+            mockEndClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+        });
+
+        it('should write a system core type class declaration and call accept on each property', () => {
+            mockClassDeclaration.isSystemCoreType.returns(true);
+
+            javaVisit.visitClassDeclaration(mockClassDeclaration, param);
+
+            mockStartClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(4);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, 'import oranges;']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, 'import apples;']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, 'public class Bob extends org.hyperledger.composer.system.Resource {']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([0, '}']);
+            acceptSpy.withArgs(javaVisit, param).calledTwice.should.be.ok;
+            mockEndClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+        });
+
+        it('should write a super type class declaration and call accept on each property', () => {
+            mockClassDeclaration.getSuperType.returns('org.acme.person');
+
+            javaVisit.visitClassDeclaration(mockClassDeclaration, param);
+
+            mockStartClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(4);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, 'import oranges;']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, 'import apples;']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, 'public class Bob extends person {']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([0, '}']);
+            acceptSpy.withArgs(javaVisit, param).calledTwice.should.be.ok;
+            mockEndClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+        });
+
+        it('should write a class declaration, including a function to access the id field and call accept on each property', () => {
+            mockClassDeclaration.getIdentifierFieldName.returns('employeeID');
+            javaVisit.visitClassDeclaration(mockClassDeclaration, param);
+
+            mockStartClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(5);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, 'import oranges;']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, 'import apples;']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, 'public class Bob {']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([1, `
+   // the accessor for the identifying field
+   public String getID() {
+      return employeeID;
+   }
+`]);
+            param.fileWriter.writeLine.getCall(4).args.should.deep.equal([0, '}']);
+            acceptSpy.withArgs(javaVisit, param).calledTwice.should.be.ok;
+            mockEndClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+        });
+    });
+
+    describe('visitField', () => {
+        let param;
+
+        beforeEach(() => {
+            param = {
+                fileWriter: mockFileWriter
+            };
+        });
+
+        it('should write a line defining a field', () => {
+            let mockField = sinon.createStubInstance(Field);
+            mockField.isArray.returns(false);
+            mockField.getName.returns('Bob');
+            mockField.getType.returns('SpecialType');
+            let mockGoType = sinon.stub(javaVisit, 'toJavaType');",,2018-01-25 14:04:04,https://api.github.com/repos/hyperledger/composer/pulls/comments/163605141,https://github.com/hyperledger/composer/pull/3144#discussion_r163605141,nklincoln
https://github.com/hyperledger/composer/pull/3144,https://github.com/hyperledger/composer/pull/3144,"This mockGoType is mocking so hard to be a java type, shall we let him have the right name too?",476fe1787c522bb30886153664df505c49eebf99,2018-01-24 16:43:22,163605515,"@@ -0,0 +1,524 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const chai = require('chai');
+const should = chai.should();
+const sinon = require('sinon');
+
+const JavaVisitor = require('../../../../lib/codegen/fromcto/java/javavisitor.js');
+
+const ClassDeclaration = require('../../../../lib/introspect/classdeclaration');
+const EnumDeclaration = require('../../../../lib/introspect/enumdeclaration');
+const EnumValueDeclaration = require('../../../../lib/introspect/enumvaluedeclaration');
+const Field = require('../../../../lib/introspect/field');
+const ModelFile = require('../../../../lib/introspect/modelfile');
+const ModelManager = require('../../../../lib/modelmanager');
+const BusinessNetworkDefinition = require('../../../../lib/businessnetworkdefinition');
+const RelationshipDeclaration = require('../../../../lib/introspect/relationshipdeclaration');
+const FunctionDeclaration = require('../../../../lib/introspect/functiondeclaration');
+
+const fileWriter = require('../../../../lib/codegen/filewriter.js');
+
+describe('JavaVisitor', function () {
+    let javaVisit;
+    let mockFileWriter;
+    beforeEach(() => {
+        javaVisit = new JavaVisitor();
+        mockFileWriter = sinon.createStubInstance(fileWriter);
+    });
+
+    describe('visit', () => {
+        let param;
+        beforeEach(() => {
+            param = {
+                property1: 'value1'
+            };
+        });
+
+        it('should call visitBusinessNetworkDefinition for a BusinessNetworkDefintion', () => {
+            let thing = sinon.createStubInstance(BusinessNetworkDefinition);
+            let mockSpecialVisit = sinon.stub(javaVisit, 'visitBusinessNetworkDefinition');
+            mockSpecialVisit.returns('Duck');
+
+            javaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitModelManager for a ModelManager', () => {
+            let thing = sinon.createStubInstance(ModelManager);
+            let mockSpecialVisit = sinon.stub(javaVisit, 'visitModelManager');
+            mockSpecialVisit.returns('Duck');
+
+            javaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitModelFile for a ModelFile', () => {
+            let thing = sinon.createStubInstance(ModelFile);
+            let mockSpecialVisit = sinon.stub(javaVisit, 'visitModelFile');
+            mockSpecialVisit.returns('Duck');
+
+            javaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitEnumDeclaration for a EnumDeclaration', () => {
+            let thing = sinon.createStubInstance(EnumDeclaration);
+            let mockSpecialVisit = sinon.stub(javaVisit, 'visitEnumDeclaration');
+            mockSpecialVisit.returns('Duck');
+
+            javaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitClassDeclaration for a ClassDeclaration', () => {
+            let thing = sinon.createStubInstance(ClassDeclaration);
+            let mockSpecialVisit = sinon.stub(javaVisit, 'visitClassDeclaration');
+            mockSpecialVisit.returns('Duck');
+
+            javaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitField for a Field', () => {
+            let thing = sinon.createStubInstance(Field);
+            let mockSpecialVisit = sinon.stub(javaVisit, 'visitField');
+            mockSpecialVisit.returns('Duck');
+
+            javaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitRelationship for a RelationshipDeclaration', () => {
+            let thing = sinon.createStubInstance(RelationshipDeclaration);
+            let mockSpecialVisit = sinon.stub(javaVisit, 'visitRelationship');
+            mockSpecialVisit.returns('Duck');
+
+            javaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitEnumValueDeclaration for a EnumValueDeclaration', () => {
+            let thing = sinon.createStubInstance(EnumValueDeclaration);
+            let mockSpecialVisit = sinon.stub(javaVisit, 'visitEnumValueDeclaration');
+            mockSpecialVisit.returns('Duck');
+
+            javaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call nothing for a FunctionDeclaration', () => {
+            let thing = sinon.createStubInstance(FunctionDeclaration);
+
+            should.equal(javaVisit.visit(thing, param), undefined);
+        });
+
+        it('should throw an error when an unrecognised type is supplied', () => {
+            let thing = 'Something of unrecognised type';
+
+            (() => {
+                javaVisit.visit(thing, param);
+            }).should.throw('Unrecognised type: string, value: \'Something of unrecognised type\'');
+        });
+    });
+
+    describe('visitBusinessNetworkDefinition', () => {
+        let param = {
+            property1: 'value1'
+        };
+
+        it('should accept ModelManager', () => {
+            let acceptSpy = sinon.spy();
+            let mockBusinessNetworkDefinition = sinon.createStubInstance(BusinessNetworkDefinition);
+            mockBusinessNetworkDefinition.getModelManager.returns({
+                accept: acceptSpy
+            });
+
+            javaVisit.visitBusinessNetworkDefinition(mockBusinessNetworkDefinition, param);
+            acceptSpy.withArgs(javaVisit, param).calledOnce.should.be.ok;
+        });
+    });
+
+    describe('visitModelManager', () => {
+        it('should write to the org/hyperledger/composer/system/Resource.java file and call accept for each model file', () => {
+            let param = {
+                fileWriter: mockFileWriter
+            };
+
+            let acceptSpy = sinon.spy();
+            let mockModelManagerDefinition = sinon.createStubInstance(ModelManager);
+            mockModelManagerDefinition.getModelFiles.returns([{
+                accept: acceptSpy
+            },
+            {
+                accept: acceptSpy
+            }]);
+
+            javaVisit.visitModelManager(mockModelManagerDefinition, param);
+            param.fileWriter.openFile.withArgs('org/hyperledger/composer/system/Resource.java').calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(4);
+            param.fileWriter.closeFile.calledOnce.should.be.ok;
+            acceptSpy.withArgs(javaVisit, param).calledTwice.should.be.ok;
+        });
+    });
+
+    describe('visitModelFile', () => {
+        it('should call accept for each declaration', () => {
+            let param = {
+                property1: 'value1'
+            };
+
+            let acceptSpy = sinon.spy();
+            let mockModelFile = sinon.createStubInstance(ModelFile);
+            mockModelFile.getAllDeclarations.returns([{
+                accept: acceptSpy
+            },
+            {
+                accept: acceptSpy
+            }]);
+
+            javaVisit.visitModelFile(mockModelFile, param);
+
+            acceptSpy.withArgs(javaVisit, param).calledTwice.should.be.ok;
+        });
+    });
+
+    describe('startClassFile', () => {
+        it('should write a java class file header', () => {
+            let param = {
+                fileWriter: mockFileWriter
+            };
+
+            let mockClass = sinon.createStubInstance(ClassDeclaration);
+            mockClass.getModelFile.returns({
+                getNamespace: () => {
+                    return 'org.acme.people';
+                },
+                getName: () => {
+                    return 'Bob';
+                }
+            });
+
+            javaVisit.startClassFile(mockClass, param);
+
+            param.fileWriter.openFile.withArgs('org/acme/people/bob.java');
+            param.fileWriter.writeLine.callCount.should.deep.equal(4);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, '// this code is generated and should not be modified']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, 'package org.acme.people;']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, '']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([0, 'import org.hyperledger.composer.system.*;']);
+        });
+    });
+
+    describe('endClassFile', () => {
+        it('should close a java class file', () => {
+            let param = {
+                fileWriter: mockFileWriter
+            };
+
+            let mockClass = sinon.createStubInstance(ClassDeclaration);
+
+            javaVisit.endClassFile(mockClass, param);
+
+            param.fileWriter.closeFile.calledOnce.should.be.ok;
+        });
+    });
+
+    describe('visitEnumDeclaration', () => {
+        it('should write an enum declaration and call accept on each property', () => {
+            let acceptSpy = sinon.spy();
+
+            let param = {
+                fileWriter: mockFileWriter
+            };
+
+            let mockEnumDeclaration = sinon.createStubInstance(EnumDeclaration);
+            mockEnumDeclaration.getName.returns('Bob');
+            mockEnumDeclaration.getOwnProperties.returns([{
+                accept: acceptSpy
+            },
+            {
+                accept: acceptSpy
+            }]);
+
+            let mockStartClassFile = sinon.stub(javaVisit, 'startClassFile');
+            let mockEndClassFile = sinon.stub(javaVisit, 'endClassFile');
+
+            javaVisit.visitEnumDeclaration(mockEnumDeclaration, param);
+
+            mockStartClassFile.withArgs(mockEnumDeclaration, param).calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(4);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, 'import com.fasterxml.jackson.annotation.JsonIgnoreProperties;']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, '@JsonIgnoreProperties({""$class""})']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, 'public enum Bob {']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([0, '}']);
+            mockEndClassFile.withArgs(mockEnumDeclaration, param).calledOnce.should.be.ok;
+        });
+    });
+
+    describe('visitClassDeclaration', () => {
+        let acceptSpy;
+        let param;
+        let mockClassDeclaration;
+        let mockStartClassFile;
+        let mockEndClassFile;
+        beforeEach(() => {
+            acceptSpy = sinon.spy();
+
+            param = {
+                fileWriter: mockFileWriter
+            };
+
+            mockClassDeclaration = sinon.createStubInstance(ClassDeclaration);
+            mockClassDeclaration.getName.returns('Bob');
+            mockClassDeclaration.getModelFile.returns({
+                getImports: () => {
+                    return ['oranges', 'apples'];
+                }
+            });
+            mockClassDeclaration.getOwnProperties.returns([{
+                accept: acceptSpy
+            },
+            {
+                accept: acceptSpy
+            }]);
+            mockClassDeclaration.isConcept.returns(false);
+            mockClassDeclaration.isAbstract.returns(false);
+            mockClassDeclaration.isSystemCoreType.returns(false);
+            mockClassDeclaration.getSuperType.returns(false);
+            mockClassDeclaration.getIdentifierFieldName.returns(false);
+
+            mockStartClassFile = sinon.stub(javaVisit, 'startClassFile');
+            mockEndClassFile = sinon.stub(javaVisit, 'endClassFile');
+        });
+
+        it('should write a class declaration and call accept on each property', () => {
+            javaVisit.visitClassDeclaration(mockClassDeclaration, param);
+
+            mockStartClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(4);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, 'import oranges;']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, 'import apples;']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, 'public class Bob {']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([0, '}']);
+            acceptSpy.withArgs(javaVisit, param).calledTwice.should.be.ok;
+            mockEndClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+        });
+
+        it('should write a concept class declaration and call accept on each property', () => {
+            mockClassDeclaration.isConcept.returns(true);
+
+            javaVisit.visitClassDeclaration(mockClassDeclaration, param);
+
+            mockStartClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(7);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, 'import oranges;']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, 'import apples;']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, 'import com.fasterxml.jackson.annotation.JsonIgnoreProperties;']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([0, '']);
+            param.fileWriter.writeLine.getCall(4).args.should.deep.equal([0, '@JsonIgnoreProperties({""$class""})']);
+            param.fileWriter.writeLine.getCall(5).args.should.deep.equal([0, 'public class Bob {']);
+            param.fileWriter.writeLine.getCall(6).args.should.deep.equal([0, '}']);
+            acceptSpy.withArgs(javaVisit, param).calledTwice.should.be.ok;
+            mockEndClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+        });
+
+        it('should write an abstract class declaration and call accept on each property', () => {
+            mockClassDeclaration.isAbstract.returns(true);
+
+            javaVisit.visitClassDeclaration(mockClassDeclaration, param);
+
+            mockStartClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(4);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, 'import oranges;']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, 'import apples;']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, 'public abstract class Bob {']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([0, '}']);
+            acceptSpy.withArgs(javaVisit, param).calledTwice.should.be.ok;
+            mockEndClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+        });
+
+        it('should write a system core type class declaration and call accept on each property', () => {
+            mockClassDeclaration.isSystemCoreType.returns(true);
+
+            javaVisit.visitClassDeclaration(mockClassDeclaration, param);
+
+            mockStartClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(4);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, 'import oranges;']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, 'import apples;']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, 'public class Bob extends org.hyperledger.composer.system.Resource {']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([0, '}']);
+            acceptSpy.withArgs(javaVisit, param).calledTwice.should.be.ok;
+            mockEndClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+        });
+
+        it('should write a super type class declaration and call accept on each property', () => {
+            mockClassDeclaration.getSuperType.returns('org.acme.person');
+
+            javaVisit.visitClassDeclaration(mockClassDeclaration, param);
+
+            mockStartClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(4);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, 'import oranges;']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, 'import apples;']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, 'public class Bob extends person {']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([0, '}']);
+            acceptSpy.withArgs(javaVisit, param).calledTwice.should.be.ok;
+            mockEndClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+        });
+
+        it('should write a class declaration, including a function to access the id field and call accept on each property', () => {
+            mockClassDeclaration.getIdentifierFieldName.returns('employeeID');
+            javaVisit.visitClassDeclaration(mockClassDeclaration, param);
+
+            mockStartClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(5);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, 'import oranges;']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, 'import apples;']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, 'public class Bob {']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([1, `
+   // the accessor for the identifying field
+   public String getID() {
+      return employeeID;
+   }
+`]);
+            param.fileWriter.writeLine.getCall(4).args.should.deep.equal([0, '}']);
+            acceptSpy.withArgs(javaVisit, param).calledTwice.should.be.ok;
+            mockEndClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+        });
+    });
+
+    describe('visitField', () => {
+        let param;
+
+        beforeEach(() => {
+            param = {
+                fileWriter: mockFileWriter
+            };
+        });
+
+        it('should write a line defining a field', () => {
+            let mockField = sinon.createStubInstance(Field);
+            mockField.isArray.returns(false);
+            mockField.getName.returns('Bob');
+            mockField.getType.returns('SpecialType');
+            let mockGoType = sinon.stub(javaVisit, 'toJavaType');
+            mockGoType.returns('JavaType');
+
+            javaVisit.visitField(mockField, param);
+            param.fileWriter.writeLine.withArgs(1, 'public JavaType Bob;').calledOnce.should.be.ok;
+        });
+
+        it('should write a line defining a field and add [] if an array', () => {
+            let mockField = sinon.createStubInstance(Field);
+            mockField.isArray.returns(true);
+            mockField.getName.returns('Bob');
+            mockField.getType.returns('SpecialType');
+            let mockGoType = sinon.stub(javaVisit, 'toJavaType');",,2018-01-25 14:04:04,https://api.github.com/repos/hyperledger/composer/pulls/comments/163605515,https://github.com/hyperledger/composer/pull/3144#discussion_r163605515,nklincoln
https://github.com/hyperledger/composer/pull/3144,https://github.com/hyperledger/composer/pull/3144,ðŸ˜ ,476fe1787c522bb30886153664df505c49eebf99,2018-01-24 16:44:07,163605776,"@@ -0,0 +1,524 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const chai = require('chai');
+const should = chai.should();
+const sinon = require('sinon');
+
+const JavaVisitor = require('../../../../lib/codegen/fromcto/java/javavisitor.js');
+
+const ClassDeclaration = require('../../../../lib/introspect/classdeclaration');
+const EnumDeclaration = require('../../../../lib/introspect/enumdeclaration');
+const EnumValueDeclaration = require('../../../../lib/introspect/enumvaluedeclaration');
+const Field = require('../../../../lib/introspect/field');
+const ModelFile = require('../../../../lib/introspect/modelfile');
+const ModelManager = require('../../../../lib/modelmanager');
+const BusinessNetworkDefinition = require('../../../../lib/businessnetworkdefinition');
+const RelationshipDeclaration = require('../../../../lib/introspect/relationshipdeclaration');
+const FunctionDeclaration = require('../../../../lib/introspect/functiondeclaration');
+
+const fileWriter = require('../../../../lib/codegen/filewriter.js');
+
+describe('JavaVisitor', function () {
+    let javaVisit;
+    let mockFileWriter;
+    beforeEach(() => {
+        javaVisit = new JavaVisitor();
+        mockFileWriter = sinon.createStubInstance(fileWriter);
+    });
+
+    describe('visit', () => {
+        let param;
+        beforeEach(() => {
+            param = {
+                property1: 'value1'
+            };
+        });
+
+        it('should call visitBusinessNetworkDefinition for a BusinessNetworkDefintion', () => {
+            let thing = sinon.createStubInstance(BusinessNetworkDefinition);
+            let mockSpecialVisit = sinon.stub(javaVisit, 'visitBusinessNetworkDefinition');
+            mockSpecialVisit.returns('Duck');
+
+            javaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitModelManager for a ModelManager', () => {
+            let thing = sinon.createStubInstance(ModelManager);
+            let mockSpecialVisit = sinon.stub(javaVisit, 'visitModelManager');
+            mockSpecialVisit.returns('Duck');
+
+            javaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitModelFile for a ModelFile', () => {
+            let thing = sinon.createStubInstance(ModelFile);
+            let mockSpecialVisit = sinon.stub(javaVisit, 'visitModelFile');
+            mockSpecialVisit.returns('Duck');
+
+            javaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitEnumDeclaration for a EnumDeclaration', () => {
+            let thing = sinon.createStubInstance(EnumDeclaration);
+            let mockSpecialVisit = sinon.stub(javaVisit, 'visitEnumDeclaration');
+            mockSpecialVisit.returns('Duck');
+
+            javaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitClassDeclaration for a ClassDeclaration', () => {
+            let thing = sinon.createStubInstance(ClassDeclaration);
+            let mockSpecialVisit = sinon.stub(javaVisit, 'visitClassDeclaration');
+            mockSpecialVisit.returns('Duck');
+
+            javaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitField for a Field', () => {
+            let thing = sinon.createStubInstance(Field);
+            let mockSpecialVisit = sinon.stub(javaVisit, 'visitField');
+            mockSpecialVisit.returns('Duck');
+
+            javaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitRelationship for a RelationshipDeclaration', () => {
+            let thing = sinon.createStubInstance(RelationshipDeclaration);
+            let mockSpecialVisit = sinon.stub(javaVisit, 'visitRelationship');
+            mockSpecialVisit.returns('Duck');
+
+            javaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitEnumValueDeclaration for a EnumValueDeclaration', () => {
+            let thing = sinon.createStubInstance(EnumValueDeclaration);
+            let mockSpecialVisit = sinon.stub(javaVisit, 'visitEnumValueDeclaration');
+            mockSpecialVisit.returns('Duck');
+
+            javaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call nothing for a FunctionDeclaration', () => {
+            let thing = sinon.createStubInstance(FunctionDeclaration);
+
+            should.equal(javaVisit.visit(thing, param), undefined);
+        });
+
+        it('should throw an error when an unrecognised type is supplied', () => {
+            let thing = 'Something of unrecognised type';
+
+            (() => {
+                javaVisit.visit(thing, param);
+            }).should.throw('Unrecognised type: string, value: \'Something of unrecognised type\'');
+        });
+    });
+
+    describe('visitBusinessNetworkDefinition', () => {
+        let param = {
+            property1: 'value1'
+        };
+
+        it('should accept ModelManager', () => {
+            let acceptSpy = sinon.spy();
+            let mockBusinessNetworkDefinition = sinon.createStubInstance(BusinessNetworkDefinition);
+            mockBusinessNetworkDefinition.getModelManager.returns({
+                accept: acceptSpy
+            });
+
+            javaVisit.visitBusinessNetworkDefinition(mockBusinessNetworkDefinition, param);
+            acceptSpy.withArgs(javaVisit, param).calledOnce.should.be.ok;
+        });
+    });
+
+    describe('visitModelManager', () => {
+        it('should write to the org/hyperledger/composer/system/Resource.java file and call accept for each model file', () => {
+            let param = {
+                fileWriter: mockFileWriter
+            };
+
+            let acceptSpy = sinon.spy();
+            let mockModelManagerDefinition = sinon.createStubInstance(ModelManager);
+            mockModelManagerDefinition.getModelFiles.returns([{
+                accept: acceptSpy
+            },
+            {
+                accept: acceptSpy
+            }]);
+
+            javaVisit.visitModelManager(mockModelManagerDefinition, param);
+            param.fileWriter.openFile.withArgs('org/hyperledger/composer/system/Resource.java').calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(4);
+            param.fileWriter.closeFile.calledOnce.should.be.ok;
+            acceptSpy.withArgs(javaVisit, param).calledTwice.should.be.ok;
+        });
+    });
+
+    describe('visitModelFile', () => {
+        it('should call accept for each declaration', () => {
+            let param = {
+                property1: 'value1'
+            };
+
+            let acceptSpy = sinon.spy();
+            let mockModelFile = sinon.createStubInstance(ModelFile);
+            mockModelFile.getAllDeclarations.returns([{
+                accept: acceptSpy
+            },
+            {
+                accept: acceptSpy
+            }]);
+
+            javaVisit.visitModelFile(mockModelFile, param);
+
+            acceptSpy.withArgs(javaVisit, param).calledTwice.should.be.ok;
+        });
+    });
+
+    describe('startClassFile', () => {
+        it('should write a java class file header', () => {
+            let param = {
+                fileWriter: mockFileWriter
+            };
+
+            let mockClass = sinon.createStubInstance(ClassDeclaration);
+            mockClass.getModelFile.returns({
+                getNamespace: () => {
+                    return 'org.acme.people';
+                },
+                getName: () => {
+                    return 'Bob';
+                }
+            });
+
+            javaVisit.startClassFile(mockClass, param);
+
+            param.fileWriter.openFile.withArgs('org/acme/people/bob.java');
+            param.fileWriter.writeLine.callCount.should.deep.equal(4);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, '// this code is generated and should not be modified']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, 'package org.acme.people;']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, '']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([0, 'import org.hyperledger.composer.system.*;']);
+        });
+    });
+
+    describe('endClassFile', () => {
+        it('should close a java class file', () => {
+            let param = {
+                fileWriter: mockFileWriter
+            };
+
+            let mockClass = sinon.createStubInstance(ClassDeclaration);
+
+            javaVisit.endClassFile(mockClass, param);
+
+            param.fileWriter.closeFile.calledOnce.should.be.ok;
+        });
+    });
+
+    describe('visitEnumDeclaration', () => {
+        it('should write an enum declaration and call accept on each property', () => {
+            let acceptSpy = sinon.spy();
+
+            let param = {
+                fileWriter: mockFileWriter
+            };
+
+            let mockEnumDeclaration = sinon.createStubInstance(EnumDeclaration);
+            mockEnumDeclaration.getName.returns('Bob');
+            mockEnumDeclaration.getOwnProperties.returns([{
+                accept: acceptSpy
+            },
+            {
+                accept: acceptSpy
+            }]);
+
+            let mockStartClassFile = sinon.stub(javaVisit, 'startClassFile');
+            let mockEndClassFile = sinon.stub(javaVisit, 'endClassFile');
+
+            javaVisit.visitEnumDeclaration(mockEnumDeclaration, param);
+
+            mockStartClassFile.withArgs(mockEnumDeclaration, param).calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(4);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, 'import com.fasterxml.jackson.annotation.JsonIgnoreProperties;']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, '@JsonIgnoreProperties({""$class""})']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, 'public enum Bob {']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([0, '}']);
+            mockEndClassFile.withArgs(mockEnumDeclaration, param).calledOnce.should.be.ok;
+        });
+    });
+
+    describe('visitClassDeclaration', () => {
+        let acceptSpy;
+        let param;
+        let mockClassDeclaration;
+        let mockStartClassFile;
+        let mockEndClassFile;
+        beforeEach(() => {
+            acceptSpy = sinon.spy();
+
+            param = {
+                fileWriter: mockFileWriter
+            };
+
+            mockClassDeclaration = sinon.createStubInstance(ClassDeclaration);
+            mockClassDeclaration.getName.returns('Bob');
+            mockClassDeclaration.getModelFile.returns({
+                getImports: () => {
+                    return ['oranges', 'apples'];
+                }
+            });
+            mockClassDeclaration.getOwnProperties.returns([{
+                accept: acceptSpy
+            },
+            {
+                accept: acceptSpy
+            }]);
+            mockClassDeclaration.isConcept.returns(false);
+            mockClassDeclaration.isAbstract.returns(false);
+            mockClassDeclaration.isSystemCoreType.returns(false);
+            mockClassDeclaration.getSuperType.returns(false);
+            mockClassDeclaration.getIdentifierFieldName.returns(false);
+
+            mockStartClassFile = sinon.stub(javaVisit, 'startClassFile');
+            mockEndClassFile = sinon.stub(javaVisit, 'endClassFile');
+        });
+
+        it('should write a class declaration and call accept on each property', () => {
+            javaVisit.visitClassDeclaration(mockClassDeclaration, param);
+
+            mockStartClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(4);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, 'import oranges;']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, 'import apples;']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, 'public class Bob {']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([0, '}']);
+            acceptSpy.withArgs(javaVisit, param).calledTwice.should.be.ok;
+            mockEndClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+        });
+
+        it('should write a concept class declaration and call accept on each property', () => {
+            mockClassDeclaration.isConcept.returns(true);
+
+            javaVisit.visitClassDeclaration(mockClassDeclaration, param);
+
+            mockStartClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(7);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, 'import oranges;']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, 'import apples;']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, 'import com.fasterxml.jackson.annotation.JsonIgnoreProperties;']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([0, '']);
+            param.fileWriter.writeLine.getCall(4).args.should.deep.equal([0, '@JsonIgnoreProperties({""$class""})']);
+            param.fileWriter.writeLine.getCall(5).args.should.deep.equal([0, 'public class Bob {']);
+            param.fileWriter.writeLine.getCall(6).args.should.deep.equal([0, '}']);
+            acceptSpy.withArgs(javaVisit, param).calledTwice.should.be.ok;
+            mockEndClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+        });
+
+        it('should write an abstract class declaration and call accept on each property', () => {
+            mockClassDeclaration.isAbstract.returns(true);
+
+            javaVisit.visitClassDeclaration(mockClassDeclaration, param);
+
+            mockStartClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(4);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, 'import oranges;']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, 'import apples;']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, 'public abstract class Bob {']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([0, '}']);
+            acceptSpy.withArgs(javaVisit, param).calledTwice.should.be.ok;
+            mockEndClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+        });
+
+        it('should write a system core type class declaration and call accept on each property', () => {
+            mockClassDeclaration.isSystemCoreType.returns(true);
+
+            javaVisit.visitClassDeclaration(mockClassDeclaration, param);
+
+            mockStartClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(4);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, 'import oranges;']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, 'import apples;']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, 'public class Bob extends org.hyperledger.composer.system.Resource {']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([0, '}']);
+            acceptSpy.withArgs(javaVisit, param).calledTwice.should.be.ok;
+            mockEndClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+        });
+
+        it('should write a super type class declaration and call accept on each property', () => {
+            mockClassDeclaration.getSuperType.returns('org.acme.person');
+
+            javaVisit.visitClassDeclaration(mockClassDeclaration, param);
+
+            mockStartClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(4);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, 'import oranges;']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, 'import apples;']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, 'public class Bob extends person {']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([0, '}']);
+            acceptSpy.withArgs(javaVisit, param).calledTwice.should.be.ok;
+            mockEndClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+        });
+
+        it('should write a class declaration, including a function to access the id field and call accept on each property', () => {
+            mockClassDeclaration.getIdentifierFieldName.returns('employeeID');
+            javaVisit.visitClassDeclaration(mockClassDeclaration, param);
+
+            mockStartClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(5);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, 'import oranges;']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, 'import apples;']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, 'public class Bob {']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([1, `
+   // the accessor for the identifying field
+   public String getID() {
+      return employeeID;
+   }
+`]);
+            param.fileWriter.writeLine.getCall(4).args.should.deep.equal([0, '}']);
+            acceptSpy.withArgs(javaVisit, param).calledTwice.should.be.ok;
+            mockEndClassFile.withArgs(mockClassDeclaration, param).calledOnce.should.be.ok;
+        });
+    });
+
+    describe('visitField', () => {
+        let param;
+
+        beforeEach(() => {
+            param = {
+                fileWriter: mockFileWriter
+            };
+        });
+
+        it('should write a line defining a field', () => {
+            let mockField = sinon.createStubInstance(Field);
+            mockField.isArray.returns(false);
+            mockField.getName.returns('Bob');
+            mockField.getType.returns('SpecialType');
+            let mockGoType = sinon.stub(javaVisit, 'toJavaType');
+            mockGoType.returns('JavaType');
+
+            javaVisit.visitField(mockField, param);
+            param.fileWriter.writeLine.withArgs(1, 'public JavaType Bob;').calledOnce.should.be.ok;
+        });
+
+        it('should write a line defining a field and add [] if an array', () => {
+            let mockField = sinon.createStubInstance(Field);
+            mockField.isArray.returns(true);
+            mockField.getName.returns('Bob');
+            mockField.getType.returns('SpecialType');
+            let mockGoType = sinon.stub(javaVisit, 'toJavaType');
+            mockGoType.returns('JavaType');
+
+            javaVisit.visitField(mockField, param);
+            param.fileWriter.writeLine.withArgs(1, 'public JavaType[] Bob;').calledOnce.should.be.ok;
+        });
+    });
+
+    describe('visitEnumValueDeclaration', () => {
+        it('should write a line with the enum value', () => {
+            let param = {
+                fileWriter: mockFileWriter
+            };
+
+            let mockEnumValueDeclaration = sinon.createStubInstance(EnumValueDeclaration);
+            mockEnumValueDeclaration.getName.returns('Bob');
+
+            javaVisit.visitEnumValueDeclaration(mockEnumValueDeclaration, param);
+            param.fileWriter.writeLine.withArgs(1, 'Bob,').calledOnce.should.be.ok;
+        });
+    });
+
+    describe('visitRelationship', () => {
+        let param;
+
+        beforeEach(() => {
+            param = {
+                fileWriter: mockFileWriter
+            };
+        });
+
+        it('should write a line defining a field', () => {
+            let mockRelationship = sinon.createStubInstance(RelationshipDeclaration);
+            mockRelationship.isArray.returns(false);
+            mockRelationship.getName.returns('Bob');
+            mockRelationship.getType.returns('SpecialType');
+            let mockGoType = sinon.stub(javaVisit, 'toJavaType');
+            mockGoType.returns('JavaType');
+
+            javaVisit.visitRelationship(mockRelationship, param);
+            param.fileWriter.writeLine.withArgs(1, 'public JavaType Bob;').calledOnce.should.be.ok;
+        });
+
+        it('should write a line defining a field and add [] if an array', () => {
+            let mockRelationship = sinon.createStubInstance(RelationshipDeclaration);
+            mockRelationship.isArray.returns(true);
+            mockRelationship.getName.returns('Bob');
+            mockRelationship.getType.returns('SpecialType');
+            let mockGoType = sinon.stub(javaVisit, 'toJavaType');
+            mockGoType.returns('JavaType');
+
+            javaVisit.visitRelationship(mockRelationship, param);
+            param.fileWriter.writeLine.withArgs(1, 'public JavaType[] Bob;').calledOnce.should.be.ok;
+        });
+    });
+
+    describe('toJavaType', () => {
+        it('should return java.util.Date for DateTime', () => {
+            javaVisit.toJavaType('DateTime').should.deep.equal('java.util.Date');
+        });
+
+        it('should return boolean for Boolean', () => {
+            javaVisit.toJavaType('Boolean').should.deep.equal('boolean');
+        });
+
+        it('should return String for String', () => {
+            javaVisit.toJavaType('String').should.deep.equal('String');
+        });
+
+        it('should return double for Double', () => {
+            javaVisit.toJavaType('Double').should.deep.equal('double');
+        });
+
+        it('should return long for Long', () => {
+            javaVisit.toJavaType('Long').should.deep.equal('long');
+        });
+
+        it('should return int for Integer', () => {
+            javaVisit.toJavaType('Integer').should.deep.equal('int');
+        });
+
+        it('should return the param as default', () => {
+            javaVisit.toJavaType('Penguin').should.deep.equal('Penguin');",521,2018-01-25 14:04:04,https://api.github.com/repos/hyperledger/composer/pulls/comments/163605776,https://github.com/hyperledger/composer/pull/3144#discussion_r163605776,nklincoln
https://github.com/hyperledger/composer/pull/3144,https://github.com/hyperledger/composer/pull/3144,"Good opportunity to use a sinon spy? Happy to debate, but it will involve coffee â˜•ï¸ ",476fe1787c522bb30886153664df505c49eebf99,2018-01-24 16:51:13,163608196,"@@ -0,0 +1,800 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const chai = require('chai');
+chai.should();
+const sinon = require('sinon');
+
+const JSONSchemaVisitor = require('../../../../lib/codegen/fromcto/jsonschema/jsonschemavisitor.js');
+
+const AssetDeclaration = require('../../../../lib/introspect/assetdeclaration');
+const ClassDeclaration = require('../../../../lib/introspect/classdeclaration');
+const EnumDeclaration = require('../../../../lib/introspect/enumdeclaration');
+const ConceptDeclaration = require('../../../../lib/introspect/conceptdeclaration');
+const EnumValueDeclaration = require('../../../../lib/introspect/enumvaluedeclaration');
+const Field = require('../../../../lib/introspect/field');
+const ModelFile = require('../../../../lib/introspect/modelfile');
+const ModelManager = require('../../../../lib/modelmanager');
+const BusinessNetworkDefinition = require('../../../../lib/businessnetworkdefinition');
+const RelationshipDeclaration = require('../../../../lib/introspect/relationshipdeclaration');
+const TransactionDeclaration = require('../../../../lib/introspect/transactiondeclaration');
+
+const fileWriter = require('../../../../lib/codegen/filewriter.js');
+
+describe('JSONSchema', function () {
+    let jsonSchemaVisit;
+    let mockFileWriter;
+    beforeEach(() => {
+        jsonSchemaVisit = new JSONSchemaVisitor();
+        mockFileWriter = sinon.createStubInstance(fileWriter);
+    });
+
+    describe('visit', () => {
+        let param;
+        beforeEach(() => {
+            param = {
+                property1: 'value1'
+            };
+        });
+        it('should return visitBusinessNetwork for a BusinessNetworkDefintion', () => {
+            let thing = sinon.createStubInstance(BusinessNetworkDefinition);
+            let mockSpecialVisit = sinon.stub(jsonSchemaVisit, 'visitBusinessNetwork');
+            mockSpecialVisit.returns('Duck');
+
+            jsonSchemaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitModelManager for a ModelManager', () => {
+            let thing = sinon.createStubInstance(ModelManager);
+            let mockSpecialVisit = sinon.stub(jsonSchemaVisit, 'visitModelManager');
+            mockSpecialVisit.returns('Duck');
+
+            jsonSchemaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitModelFile for a ModelFile', () => {
+            let thing = sinon.createStubInstance(ModelFile);
+            let mockSpecialVisit = sinon.stub(jsonSchemaVisit, 'visitModelFile');
+            mockSpecialVisit.returns('Duck');
+
+            jsonSchemaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitAssetDeclaration for a AssetDeclaration', () => {
+            let thing = sinon.createStubInstance(AssetDeclaration);
+            let mockSpecialVisit = sinon.stub(jsonSchemaVisit, 'visitAssetDeclaration');
+            mockSpecialVisit.returns('Duck');
+
+            jsonSchemaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitTransactionDeclaration for a TransactionDeclaration', () => {
+            let thing = sinon.createStubInstance(TransactionDeclaration);
+            let mockSpecialVisit = sinon.stub(jsonSchemaVisit, 'visitTransactionDeclaration');
+            mockSpecialVisit.returns('Duck');
+
+            jsonSchemaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitEnumDeclaration for a EnumDeclaration', () => {
+            let thing = sinon.createStubInstance(EnumDeclaration);
+            let mockSpecialVisit = sinon.stub(jsonSchemaVisit, 'visitEnumDeclaration');
+            mockSpecialVisit.returns('Duck');
+
+            jsonSchemaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitConceptDeclaration for a ConceptDeclaration', () => {
+            let thing = sinon.createStubInstance(ConceptDeclaration);
+            let mockSpecialVisit = sinon.stub(jsonSchemaVisit, 'visitConceptDeclaration');
+            mockSpecialVisit.returns('Duck');
+
+            jsonSchemaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitClassDeclaration for a ClassDeclaration', () => {
+            let thing = sinon.createStubInstance(ClassDeclaration);
+            let mockSpecialVisit = sinon.stub(jsonSchemaVisit, 'visitClassDeclaration');
+            mockSpecialVisit.returns('Duck');
+
+            jsonSchemaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitField for a Field', () => {
+            let thing = sinon.createStubInstance(Field);
+            let mockSpecialVisit = sinon.stub(jsonSchemaVisit, 'visitField');
+            mockSpecialVisit.returns('Duck');
+
+            jsonSchemaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitRelationshipDeclaration for a RelationshipDeclaration', () => {
+            let thing = sinon.createStubInstance(RelationshipDeclaration);",143,2018-01-25 14:04:04,https://api.github.com/repos/hyperledger/composer/pulls/comments/163608196,https://github.com/hyperledger/composer/pull/3144#discussion_r163608196,nklincoln
https://github.com/hyperledger/composer/pull/3144,https://github.com/hyperledger/composer/pull/3144,"Being picky, 'concatenated' might have been what you were looking for.",476fe1787c522bb30886153664df505c49eebf99,2018-01-24 16:51:53,163608401,"@@ -0,0 +1,800 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const chai = require('chai');
+chai.should();
+const sinon = require('sinon');
+
+const JSONSchemaVisitor = require('../../../../lib/codegen/fromcto/jsonschema/jsonschemavisitor.js');
+
+const AssetDeclaration = require('../../../../lib/introspect/assetdeclaration');
+const ClassDeclaration = require('../../../../lib/introspect/classdeclaration');
+const EnumDeclaration = require('../../../../lib/introspect/enumdeclaration');
+const ConceptDeclaration = require('../../../../lib/introspect/conceptdeclaration');
+const EnumValueDeclaration = require('../../../../lib/introspect/enumvaluedeclaration');
+const Field = require('../../../../lib/introspect/field');
+const ModelFile = require('../../../../lib/introspect/modelfile');
+const ModelManager = require('../../../../lib/modelmanager');
+const BusinessNetworkDefinition = require('../../../../lib/businessnetworkdefinition');
+const RelationshipDeclaration = require('../../../../lib/introspect/relationshipdeclaration');
+const TransactionDeclaration = require('../../../../lib/introspect/transactiondeclaration');
+
+const fileWriter = require('../../../../lib/codegen/filewriter.js');
+
+describe('JSONSchema', function () {
+    let jsonSchemaVisit;
+    let mockFileWriter;
+    beforeEach(() => {
+        jsonSchemaVisit = new JSONSchemaVisitor();
+        mockFileWriter = sinon.createStubInstance(fileWriter);
+    });
+
+    describe('visit', () => {
+        let param;
+        beforeEach(() => {
+            param = {
+                property1: 'value1'
+            };
+        });
+        it('should return visitBusinessNetwork for a BusinessNetworkDefintion', () => {
+            let thing = sinon.createStubInstance(BusinessNetworkDefinition);
+            let mockSpecialVisit = sinon.stub(jsonSchemaVisit, 'visitBusinessNetwork');
+            mockSpecialVisit.returns('Duck');
+
+            jsonSchemaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitModelManager for a ModelManager', () => {
+            let thing = sinon.createStubInstance(ModelManager);
+            let mockSpecialVisit = sinon.stub(jsonSchemaVisit, 'visitModelManager');
+            mockSpecialVisit.returns('Duck');
+
+            jsonSchemaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitModelFile for a ModelFile', () => {
+            let thing = sinon.createStubInstance(ModelFile);
+            let mockSpecialVisit = sinon.stub(jsonSchemaVisit, 'visitModelFile');
+            mockSpecialVisit.returns('Duck');
+
+            jsonSchemaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitAssetDeclaration for a AssetDeclaration', () => {
+            let thing = sinon.createStubInstance(AssetDeclaration);
+            let mockSpecialVisit = sinon.stub(jsonSchemaVisit, 'visitAssetDeclaration');
+            mockSpecialVisit.returns('Duck');
+
+            jsonSchemaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitTransactionDeclaration for a TransactionDeclaration', () => {
+            let thing = sinon.createStubInstance(TransactionDeclaration);
+            let mockSpecialVisit = sinon.stub(jsonSchemaVisit, 'visitTransactionDeclaration');
+            mockSpecialVisit.returns('Duck');
+
+            jsonSchemaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitEnumDeclaration for a EnumDeclaration', () => {
+            let thing = sinon.createStubInstance(EnumDeclaration);
+            let mockSpecialVisit = sinon.stub(jsonSchemaVisit, 'visitEnumDeclaration');
+            mockSpecialVisit.returns('Duck');
+
+            jsonSchemaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitConceptDeclaration for a ConceptDeclaration', () => {
+            let thing = sinon.createStubInstance(ConceptDeclaration);
+            let mockSpecialVisit = sinon.stub(jsonSchemaVisit, 'visitConceptDeclaration');
+            mockSpecialVisit.returns('Duck');
+
+            jsonSchemaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitClassDeclaration for a ClassDeclaration', () => {
+            let thing = sinon.createStubInstance(ClassDeclaration);
+            let mockSpecialVisit = sinon.stub(jsonSchemaVisit, 'visitClassDeclaration');
+            mockSpecialVisit.returns('Duck');
+
+            jsonSchemaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitField for a Field', () => {
+            let thing = sinon.createStubInstance(Field);
+            let mockSpecialVisit = sinon.stub(jsonSchemaVisit, 'visitField');
+            mockSpecialVisit.returns('Duck');
+
+            jsonSchemaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitRelationshipDeclaration for a RelationshipDeclaration', () => {
+            let thing = sinon.createStubInstance(RelationshipDeclaration);
+            let mockSpecialVisit = sinon.stub(jsonSchemaVisit, 'visitRelationshipDeclaration');
+            mockSpecialVisit.returns('Duck');
+
+            jsonSchemaVisit.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should call visitEnumValueDeclaration for a EnumValueDeclaration', () => {
+            let thing = sinon.createStubInstance(EnumValueDeclaration);
+            let mockSpecialVisit = sinon.stub(jsonSchemaVisit, 'visitEnumValueDeclaration');
+            mockSpecialVisit.returns('Goose');
+
+            jsonSchemaVisit.visit(thing, param).should.deep.equal('Goose');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should throw an error when an unrecognised type is supplied', () => {
+            let thing = 'Something of unrecognised type';
+
+            (() => {
+                jsonSchemaVisit.visit(thing, param);
+            }).should.throw('Unrecognised type: string, value: \'Something of unrecognised type\'');
+        });
+    });
+
+    describe('visitBusinessNetwork', () => {
+        let param = {
+            property1: 'value1'
+        };
+
+        it('should accept each model file', () => {
+            let acceptSpy = sinon.spy();
+            let mockBusinessNetworkDefinition = sinon.createStubInstance(BusinessNetworkDefinition);
+            mockBusinessNetworkDefinition.getModelManager.returns({
+                getModelFiles: () => {
+                    return [{
+                        accept: acceptSpy
+                    },
+                    {
+                        accept: acceptSpy
+                    }];
+                }
+            });
+
+            jsonSchemaVisit.visitBusinessNetwork(mockBusinessNetworkDefinition, param);
+            acceptSpy.withArgs(jsonSchemaVisit, param).calledTwice.should.be.ok;
+        });
+    });
+
+    describe('visitModelManager', () => {
+        it('should return a value of the concatted output of each modelFiles accept', () => {",,2018-01-25 14:04:04,https://api.github.com/repos/hyperledger/composer/pulls/comments/163608401,https://github.com/hyperledger/composer/pull/3144#discussion_r163608401,nklincoln
https://github.com/hyperledger/composer/pull/3144,https://github.com/hyperledger/composer/pull/3144,YES!!! ðŸ§ ,476fe1787c522bb30886153664df505c49eebf99,2018-01-24 17:06:33,163613301,"@@ -0,0 +1,508 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const chai = require('chai');
+chai.should();
+const sinon = require('sinon');
+
+const TypescriptVisitor = require('../../../../lib/codegen/fromcto/typescript/typescriptvisitor.js');
+
+const BusinessNetworkDefinition = require('../../../../lib/businessnetworkdefinition');
+const ModelManager = require('../../../../lib/modelmanager');
+const ModelFile = require('../../../../lib/introspect/modelfile');
+const ClassDeclaration = require('../../../../lib/introspect/classdeclaration');
+const Field = require('../../../../lib/introspect/field');
+const RelationshipDeclaration = require('../../../../lib/introspect/relationshipdeclaration');
+const EnumDeclaration = require('../../../../lib/introspect/enumdeclaration');
+const EnumValueDeclaration = require('../../../../lib/introspect/enumvaluedeclaration');
+
+const fileWriter = require('../../../../lib/codegen/filewriter.js');
+
+describe('TypescriptVisitor', function () {
+    let typescriptVisitor;
+    let mockFileWriter;
+    beforeEach(() => {
+        typescriptVisitor = new TypescriptVisitor();
+        mockFileWriter = sinon.createStubInstance(fileWriter);
+    });
+
+    describe('visit', () => {
+        let param;
+        beforeEach(() => {
+            param = {
+                property1: 'value1'
+            };
+        });
+        it('should return visitBusinessNetworkDefinition for a BusinessNetworkDefintion', () => {
+            let thing = sinon.createStubInstance(BusinessNetworkDefinition);
+            let mockSpecialVisit = sinon.stub(typescriptVisitor, 'visitBusinessNetworkDefinition');
+            mockSpecialVisit.returns('Duck');
+
+            typescriptVisitor.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should return visitModelManager for a ModelManager', () => {
+            let thing = sinon.createStubInstance(ModelManager);
+            let mockSpecialVisit = sinon.stub(typescriptVisitor, 'visitModelManager');
+            mockSpecialVisit.returns('Duck');
+
+            typescriptVisitor.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should return visitModelFile for a ModelFile', () => {
+            let thing = sinon.createStubInstance(ModelFile);
+            let mockSpecialVisit = sinon.stub(typescriptVisitor, 'visitModelFile');
+            mockSpecialVisit.returns('Duck');
+
+            typescriptVisitor.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should return visitEnumDeclaration for a EnumDeclaration', () => {
+            let thing = sinon.createStubInstance(EnumDeclaration);
+            let mockSpecialVisit = sinon.stub(typescriptVisitor, 'visitEnumDeclaration');
+            mockSpecialVisit.returns('Duck');
+
+            typescriptVisitor.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should return visitClassDeclaration for a ClassDeclaration', () => {
+            let thing = sinon.createStubInstance(ClassDeclaration);
+            let mockSpecialVisit = sinon.stub(typescriptVisitor, 'visitClassDeclaration');
+            mockSpecialVisit.returns('Duck');
+
+            typescriptVisitor.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should return visitField for a Field', () => {
+            let thing = sinon.createStubInstance(Field);
+            let mockSpecialVisit = sinon.stub(typescriptVisitor, 'visitField');
+            mockSpecialVisit.returns('Duck');
+
+            typescriptVisitor.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should return visitRelationship for a RelationshipDeclaration', () => {
+            let thing = sinon.createStubInstance(RelationshipDeclaration);
+            let mockSpecialVisit = sinon.stub(typescriptVisitor, 'visitRelationship');
+            mockSpecialVisit.returns('Duck');
+
+            typescriptVisitor.visit(thing, param).should.deep.equal('Duck');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should return visitEnumValueDeclaration for a EnumValueDeclaration', () => {
+            let thing = sinon.createStubInstance(EnumValueDeclaration);
+            let mockSpecialVisit = sinon.stub(typescriptVisitor, 'visitEnumValueDeclaration');
+            mockSpecialVisit.returns('Goose');
+
+            typescriptVisitor.visit(thing, param).should.deep.equal('Goose');
+
+            mockSpecialVisit.calledWith(thing, param).should.be.ok;
+        });
+
+        it('should throw an error when an unrecognised type is supplied', () => {
+            let thing = 'Something of unrecognised type';
+
+            (() => {
+                typescriptVisitor.visit(thing, param);
+            }).should.throw('Unrecognised type: string, value: \'Something of unrecognised type\'');
+        });
+    });
+
+    describe('visitBusinessNetworkDefinition', () => {
+        it('should call accept on the model manager', () => {
+            let acceptSpy = sinon.spy();
+
+            let param = {};
+
+            let mockBusinessNetworkDefinition = sinon.createStubInstance(BusinessNetworkDefinition);
+            mockBusinessNetworkDefinition.getModelManager.returns({
+                accept: acceptSpy
+            });
+
+            typescriptVisitor.visitBusinessNetworkDefinition(mockBusinessNetworkDefinition, param);
+
+            acceptSpy.withArgs(typescriptVisitor, param).calledOnce.should.be.ok;
+        });
+    });
+
+    describe('visitModelManager', () => {
+        it('should call accept for each model file', () => {
+            let acceptSpy = sinon.spy();
+
+            let param = {};
+
+            let mockModelManager = sinon.createStubInstance(ModelManager);
+            mockModelManager.getModelFiles.returns([{
+                accept: acceptSpy
+            },
+            {
+                accept: acceptSpy
+            }
+            ]);
+
+            typescriptVisitor.visitModelManager(mockModelManager, param);
+
+            acceptSpy.withArgs(typescriptVisitor, param).calledTwice.should.be.ok;
+        });
+    });
+
+    describe('visitModelFile', () => {
+        let param;
+        beforeEach(() => {
+            param = {
+                fileWriter: mockFileWriter
+            };
+        });
+        it('should write lines for the imports that are not in own namespace ignoring primitives', () => {
+            let acceptSpy = sinon.spy();
+            let mockEnum = sinon.createStubInstance(EnumDeclaration);
+            mockEnum.isEnum.returns(true);
+            mockEnum.accept = acceptSpy;
+
+            let property1 = {
+                isPrimitive: () => {
+                    return false;
+                },
+                getFullyQualifiedTypeName: () => {
+                    return 'org.org1.Property1';
+                }
+            };
+
+            let property2 = {
+                isPrimitive: () => {
+                    return false;
+                },
+                getFullyQualifiedTypeName: () => {
+                    return 'org.acme.Property2';
+                }
+            };
+
+            let property3 = {
+                isPrimitive: () => {
+                    return true;
+                },
+                getFullyQualifiedTypeName: () => {
+                    return 'org.org2.Property3';
+                }
+            };
+
+            let mockClassDeclaration = sinon.createStubInstance(ClassDeclaration);
+            mockClassDeclaration.getProperties.returns([property1, property2, property3]);
+            mockClassDeclaration.accept = acceptSpy;
+
+            let mockModelFile = sinon.createStubInstance(ModelFile);
+            mockModelFile.isSystemModelFile.returns(true);
+            mockModelFile.getNamespace.returns('org.acme.Person');
+            mockModelFile.getAllDeclarations.returns([
+                mockEnum,
+                mockClassDeclaration
+            ]);
+            mockModelFile.getImports.returns([
+                'org.org1.Import1',
+                'org.org1.Import2',
+                'org.org2.Import1'
+            ]);
+
+            typescriptVisitor.visitModelFile(mockModelFile, param);
+
+            param.fileWriter.openFile.withArgs('org.acme.Person.ts').calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(3);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, 'import {Property1} from \'./org.org1\';']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, '// export namespace org.acme.Person{']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, '// }']);
+            param.fileWriter.closeFile.should.be.called;
+
+            acceptSpy.withArgs(typescriptVisitor, param).calledTwice.should.be.ok;
+        });
+
+        it('should write lines for the imports that are not in own namespace ignoring primitives and write lines for importing system type', () => {
+            let acceptSpy = sinon.spy();
+            let mockEnum = sinon.createStubInstance(EnumDeclaration);
+            mockEnum.isEnum.returns(true);
+            mockEnum.accept = acceptSpy;
+
+            let property1 = {
+                isPrimitive: () => {
+                    return false;
+                },
+                getFullyQualifiedTypeName: () => {
+                    return 'org.org1.Property1';
+                }
+            };
+
+            let property2 = {
+                isPrimitive: () => {
+                    return false;
+                },
+                getFullyQualifiedTypeName: () => {
+                    return 'org.acme.Property2';
+                }
+            };
+
+            let property3 = {
+                isPrimitive: () => {
+                    return true;
+                },
+                getFullyQualifiedTypeName: () => {
+                    return 'org.org2.Property3';
+                }
+            };
+
+            let mockClassDeclaration = sinon.createStubInstance(ClassDeclaration);
+            mockClassDeclaration.getProperties.returns([property1, property2, property3]);
+            mockClassDeclaration.accept = acceptSpy;
+
+            let mockModelManager = sinon.createStubInstance(ModelManager);
+            mockModelManager.getSystemTypes.returns([{
+                getName: () => {
+                    return 'Bob';
+                }
+            },
+            {
+                getName: () => {
+                    return 'Fred';
+                }
+            }]);
+
+            let mockModelFile = sinon.createStubInstance(ModelFile);
+            mockModelFile.isSystemModelFile.returns(false);
+            mockModelFile.getNamespace.returns('org.acme.Person');
+            mockModelFile.getAllDeclarations.returns([
+                mockEnum,
+                mockClassDeclaration
+            ]);
+            mockModelFile.getImports.returns([
+                'org.org1.Import1',
+                'org.org1.Import2',
+                'org.org2.Import1'
+            ]);
+            mockModelFile.getModelManager.returns(mockModelManager);
+
+            typescriptVisitor.visitModelFile(mockModelFile, param);
+
+            param.fileWriter.openFile.withArgs('org.acme.Person.ts').calledOnce.should.be.ok;
+            param.fileWriter.writeLine.callCount.should.deep.equal(5);
+            param.fileWriter.writeLine.getCall(0).args.should.deep.equal([0, 'import {Bob} from \'./org.hyperledger.composer.system\';']);
+            param.fileWriter.writeLine.getCall(1).args.should.deep.equal([0, 'import {Fred} from \'./org.hyperledger.composer.system\';']);
+            param.fileWriter.writeLine.getCall(2).args.should.deep.equal([0, 'import {Property1} from \'./org.org1\';']);
+            param.fileWriter.writeLine.getCall(3).args.should.deep.equal([0, '// export namespace org.acme.Person{']);
+            param.fileWriter.writeLine.getCall(4).args.should.deep.equal([0, '// }']);
+            param.fileWriter.closeFile.should.be.called;
+
+            acceptSpy.withArgs(typescriptVisitor, param).calledTwice.should.be.ok;
+        });
+    });
+
+    describe('visitEnumDeclaration', () => {
+        it('should write the export enum and call accept on each property', () => {
+            let acceptSpy = sinon.spy();
+
+            let param = {
+                fileWriter: mockFileWriter
+            };
+
+            let mockEnumDeclaration = sinon.createStubInstance(EnumDeclaration);
+            mockEnumDeclaration.getName.returns('Bob');
+            mockEnumDeclaration.getOwnProperties.returns([{
+                accept: acceptSpy
+            },
+            {
+                accept: acceptSpy
+            }]);
+
+            typescriptVisitor.visitEnumDeclaration(mockEnumDeclaration, param);
+
+            param.fileWriter.writeLine.callCount.should.deep.equal(2);
+            param.fileWriter.writeLine.withArgs(1, 'export enum Bob {').calledOnce.should.be.ok;
+            param.fileWriter.writeLine.withArgs(1, '}').calledOnce.should.be.ok;
+
+            acceptSpy.withArgs(typescriptVisitor, param).calledTwice.should.be.ok;
+        });
+    });
+
+    describe('visitClassDeclaration', () => {
+        let param;
+        beforeEach(() => {
+            param = {
+                fileWriter: mockFileWriter
+            };
+        });
+        it('should write the class opening and close', () => {
+            let acceptSpy = sinon.spy();
+
+            let mockClassDeclaration = sinon.createStubInstance(ClassDeclaration);
+            mockClassDeclaration.getOwnProperties.returns([{
+                accept: acceptSpy
+            },
+            {
+                accept: acceptSpy
+            }]);
+            mockClassDeclaration.getName.returns('Bob');
+
+            typescriptVisitor.visitClassDeclaration(mockClassDeclaration, param);
+
+            param.fileWriter.writeLine.callCount.should.deep.equal(2);
+            param.fileWriter.writeLine.withArgs(1, 'export class Bob {').calledOnce.should.be.ok;
+            param.fileWriter.writeLine.withArgs(1, '}').calledOnce.should.be.ok;
+            acceptSpy.withArgs(typescriptVisitor, param).calledTwice.should.be.ok;
+        });
+        it('should write the class opening and close with abstract and super type', () => {
+            let acceptSpy = sinon.spy();
+
+            let mockClassDeclaration = sinon.createStubInstance(ClassDeclaration);
+            mockClassDeclaration.getOwnProperties.returns([{
+                accept: acceptSpy
+            },
+            {
+                accept: acceptSpy
+            }]);
+            mockClassDeclaration.getName.returns('Bob');
+            mockClassDeclaration.isAbstract.returns(true);
+            mockClassDeclaration.getSuperType.returns('org.acme.Person');
+
+            typescriptVisitor.visitClassDeclaration(mockClassDeclaration, param);
+
+            param.fileWriter.writeLine.callCount.should.deep.equal(2);
+            param.fileWriter.writeLine.withArgs(1, 'export abstract class Bob extends Person {').calledOnce.should.be.ok;
+            param.fileWriter.writeLine.withArgs(1, '}').calledOnce.should.be.ok;
+            acceptSpy.withArgs(typescriptVisitor, param).calledTwice.should.be.ok;
+        });
+    });
+
+    describe('visitField', () => {
+        let param;
+        beforeEach(() => {
+            param = {
+                fileWriter: mockFileWriter
+            };
+        });
+        it('should write a line for field name and type', () => {
+            let mockField = sinon.createStubInstance(Field);
+            mockField.getName.returns('Bob');
+            mockField.getType.returns('Person');
+
+            let mockToType = sinon.stub(typescriptVisitor, 'toTsType');
+            mockToType.withArgs('Person').returns('Human');
+
+            typescriptVisitor.visitField(mockField, param);
+
+            param.fileWriter.writeLine.withArgs(2, 'Bob: Human;').calledOnce.should.be.ok;
+        });
+
+        it('should write a line for field name and type thats an array', () => {
+            let mockField = sinon.createStubInstance(Field);
+            mockField.getName.returns('Bob');
+            mockField.getType.returns('Person');
+            mockField.isArray.returns(true);
+
+            let mockToType = sinon.stub(typescriptVisitor, 'toTsType');
+            mockToType.withArgs('Person').returns('Human');
+
+            typescriptVisitor.visitField(mockField, param);
+
+            param.fileWriter.writeLine.withArgs(2, 'Bob: Human[];').calledOnce.should.be.ok;
+        });
+    });
+
+    describe('visitEnumValueDeclaration', () => {
+        it('should write a line with the name of the enum value', () => {
+            let param = {
+                fileWriter: mockFileWriter
+            };
+
+            let mockEnumValueDeclaration = sinon.createStubInstance(EnumValueDeclaration);
+            mockEnumValueDeclaration.getName.returns('Bob');
+
+            typescriptVisitor.visitEnumValueDeclaration(mockEnumValueDeclaration, param);
+
+            param.fileWriter.writeLine.withArgs(2, 'Bob,').calledOnce.should.be.ok;
+        });
+    });
+
+    describe('visitRelationship', () => {
+        let param;
+        beforeEach(() => {
+            param = {
+                fileWriter: mockFileWriter
+            };
+        });
+        it('should write a line for field name and type', () => {
+            let mockRelationship = sinon.createStubInstance(RelationshipDeclaration);
+            mockRelationship.getName.returns('Bob');
+            mockRelationship.getType.returns('Person');
+
+            let mockToType = sinon.stub(typescriptVisitor, 'toTsType');
+            mockToType.withArgs('Person').returns('Human');
+
+            typescriptVisitor.visitRelationship(mockRelationship, param);
+
+            param.fileWriter.writeLine.withArgs(2, 'Bob: Human;').calledOnce.should.be.ok;
+        });
+
+        it('should write a line for field name and type thats an array', () => {
+            let mockRelationship = sinon.createStubInstance(Field);
+            mockRelationship.getName.returns('Bob');
+            mockRelationship.getType.returns('Person');
+            mockRelationship.isArray.returns(true);
+
+            let mockToType = sinon.stub(typescriptVisitor, 'toTsType');
+            mockToType.withArgs('Person').returns('Human');
+
+            typescriptVisitor.visitRelationship(mockRelationship, param);
+
+            param.fileWriter.writeLine.withArgs(2, 'Bob: Human[];').calledOnce.should.be.ok;
+        });
+    });
+
+    describe('toTsType', () => {
+        it('should return Date for DateTime', () => {
+            typescriptVisitor.toTsType('DateTime').should.deep.equal('Date');
+        });
+        it('should return boolean for Boolean', () => {
+            typescriptVisitor.toTsType('Boolean').should.deep.equal('boolean');
+        });
+        it('should return string for String', () => {
+            typescriptVisitor.toTsType('String').should.deep.equal('string');
+        });
+        it('should return number for Double', () => {
+            typescriptVisitor.toTsType('Double').should.deep.equal('number');
+        });
+        it('should return number for Long', () => {
+            typescriptVisitor.toTsType('Long').should.deep.equal('number');
+        });
+        it('should return number for Integer', () => {
+            typescriptVisitor.toTsType('Integer').should.deep.equal('number');
+        });
+        it('should return passed in type by default', () => {
+            typescriptVisitor.toTsType('Penguin').should.deep.equal('Penguin');",504,2018-01-25 14:04:04,https://api.github.com/repos/hyperledger/composer/pulls/comments/163613301,https://github.com/hyperledger/composer/pull/3144#discussion_r163613301,nklincoln
https://github.com/hyperledger/composer/pull/3070,https://github.com/hyperledger/composer/pull/3070,commented out code,63a4a59675853b2a2334033e73436e0f25c6f5d6,2018-01-08 19:11:17,160229375,"@@ -19,7 +19,7 @@ const logLevel = require ('./lib/loglevel.js');
 module.exports.command = 'loglevel [options]';
 module.exports.describe = 'Change the logging level of a business network';
 module.exports.builder = {
-    newlevel: { alias: 'l', optional: true, describe: 'the new logging level', choices : ['INFO', 'WARNING', 'ERROR', 'DEBUG'] },
+    newlevel: { alias: 'l', optional: true, describe: 'the new logging level', type: 'string'},//choices : ['INFO', 'WARNING', 'ERROR', 'DEBUG'] },",,2018-02-09 16:01:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/160229375,https://github.com/hyperledger/composer/pull/3070#discussion_r160229375,davidkel
https://github.com/hyperledger/composer/pull/3070,https://github.com/hyperledger/composer/pull/3070,Don't think this file should be part of the pull request,63a4a59675853b2a2334033e73436e0f25c6f5d6,2018-01-08 19:12:28,160229672,"@@ -0,0 +1,97 @@
+{",,2018-02-09 16:01:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/160229672,https://github.com/hyperledger/composer/pull/3070#discussion_r160229672,davidkel
https://github.com/hyperledger/composer/pull/3070,https://github.com/hyperledger/composer/pull/3070,"You have to do this, we need access to the stub",63a4a59675853b2a2334033e73436e0f25c6f5d6,2018-01-08 19:13:00,160229797,"@@ -63,7 +63,7 @@ class Composer {
         let engine = this._createEngine();
         let nodeContext = this._createContext(engine, stub);
         try {
-            await this.container.initLogging(stub);
+            // await this.container.initLogging(stub);",,2018-02-09 16:01:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/160229797,https://github.com/hyperledger/composer/pull/3070#discussion_r160229797,davidkel
https://github.com/hyperledger/composer/pull/3070,https://github.com/hyperledger/composer/pull/3070,"You need to do this, you need access to the stub.",63a4a59675853b2a2334033e73436e0f25c6f5d6,2018-01-08 19:13:16,160229850,"@@ -90,7 +90,7 @@ class Composer {
         let engine = this._createEngine();
         let nodeContext = this._createContext(engine, stub);
         try {
-            await this.container.initLogging(stub);
+            // await this.container.initLogging(stub);",,2018-02-09 16:01:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/160229850,https://github.com/hyperledger/composer/pull/3070#discussion_r160229850,davidkel
https://github.com/hyperledger/composer/pull/3070,https://github.com/hyperledger/composer/pull/3070,"Stripping out this file will stop the logging of the transaction id. I'm not sure that there would ever be a need to do anything except console logging, winston maybe overkill, plus we may want to consider combining with the fabric shim logging",63a4a59675853b2a2334033e73436e0f25c6f5d6,2018-01-08 19:15:09,160230324,"@@ -16,168 +16,30 @@
 
 const LoggingService = require('composer-runtime').LoggingService;
 
-
-const LOG_LEVELS = {
-    CRITICAL: 0,
-    ERROR:    100,
-    WARNING:  200,
-    NOTICE:   300,
-    INFO:     400,
-    DEBUG:    500
-};
-
-const LOOKUP_LOG_LEVELS = {
-    '-1':  'NOT_ENABLED',
-    0:   'CRITICAL',
-    100: 'ERROR',
-    200: 'WARNING',
-    300: 'NOTICE',
-    400: 'INFO',
-    500: 'DEBUG'
-};
-
-const LOGLEVEL_KEY = 'ComposerLogLevel';
-
 /**
  * Base class representing the logging service provided by a {@link Container}.
  * @protected
  */
 class NodeLoggingService extends LoggingService {",,2018-02-09 16:01:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/160230324,https://github.com/hyperledger/composer/pull/3070#discussion_r160230324,davidkel
https://github.com/hyperledger/composer/pull/3070,https://github.com/hyperledger/composer/pull/3070,"Also, we need to be able to get the CHAINCODE environment variable still, that proved to be indispensible over the xmas period. Also we need to ensure that any change of log level on the chaincode is stored in the world state.",63a4a59675853b2a2334033e73436e0f25c6f5d6,2018-01-08 19:25:40,160233146,"@@ -16,168 +16,30 @@
 
 const LoggingService = require('composer-runtime').LoggingService;
 
-
-const LOG_LEVELS = {
-    CRITICAL: 0,
-    ERROR:    100,
-    WARNING:  200,
-    NOTICE:   300,
-    INFO:     400,
-    DEBUG:    500
-};
-
-const LOOKUP_LOG_LEVELS = {
-    '-1':  'NOT_ENABLED',
-    0:   'CRITICAL',
-    100: 'ERROR',
-    200: 'WARNING',
-    300: 'NOTICE',
-    400: 'INFO',
-    500: 'DEBUG'
-};
-
-const LOGLEVEL_KEY = 'ComposerLogLevel';
-
 /**
  * Base class representing the logging service provided by a {@link Container}.
  * @protected
  */
 class NodeLoggingService extends LoggingService {",,2018-02-09 16:01:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/160233146,https://github.com/hyperledger/composer/pull/3070#discussion_r160233146,davidkel
https://github.com/hyperledger/composer/pull/3061,https://github.com/hyperledger/composer/pull/3061,did you mean to do this twice?,ae1ea75c207c59dcdaf8be3cf6e634a8c9adbed3,2018-01-09 13:03:21,160400072,"@@ -197,11 +197,42 @@ class Composer {
         }
     }
 
+    /**
+     * Check that a value exists in the savedValue map for the label that has been specified
+     * @param {String} label -  type (folder or file) that is being considered
+     * @return {Promise} - Promise that will be resolved or rejected with an error if not exist
+     */
+    savedValueExists(label) {
+        if ( savedValues.has(label) ) {
+            return Promise.resolve();
+        } else {
+            return Promise.reject('The following item(s) do not exist: '+label);
+        }
+    }
+
+    /**
+     * Saves the string that matches the specified regex in the Map keyed by the specified label.
+     * @param {String} regex - the regex to match
+     * @param {String} label - the alias/lable to save any data under
+     * @return {Promise} resolved if successful match and save, rejected otherwise
+     */
+    saveDataFromOutput(regex, label) {
+        let regexp = new RegExp(regex, 'g');
+        let match = regexp.exec(this.lastResp.stdout);
+        if(match && match.length===2) {
+            savedValues.set(label, match[1]);
+            savedValues.set(label, match[1]);",,2018-01-09 17:26:53,https://api.github.com/repos/hyperledger/composer/pulls/comments/160400072,https://github.com/hyperledger/composer/pull/3061#discussion_r160400072,andrew-coleman
https://github.com/hyperledger/composer/pull/3049,https://github.com/hyperledger/composer/pull/3049,Need to restore the comment this one isn't correct.,cb4ef31910328185637a54e8eaac16e3b975c54a,2017-12-19 15:27:48,157785517,"@@ -65,12 +65,19 @@ class ConnectionProfileManager {
     /**
      * Retrieves the ConnectionManager for the given connection type.
      *
-     * @param {string} connectionType The type of the connection type
+     * @param {object} connectionType The connection type",,2017-12-19 16:26:23,https://api.github.com/repos/hyperledger/composer/pulls/comments/157785517,https://github.com/hyperledger/composer/pull/3049#discussion_r157785517,davidkel
https://github.com/hyperledger/composer/pull/3049,https://github.com/hyperledger/composer/pull/3049,commented out line,cb4ef31910328185637a54e8eaac16e3b975c54a,2017-12-19 15:28:24,157785688,"@@ -19,14 +19,17 @@ const nodeFs = require('fs');
 const path = require('path');
 const process = require('process');
 const thenifyAll = require('thenify-all');
+const yaml = require('js-yaml');
 const JSZip = require('jszip');
 
 const thenifyMkdirp = thenifyAll(mkdirp);
 
 const Logger = require('./log/logger');
 const LOG = Logger.getLog('IdCard');
 
-const CONNECTION_FILENAME = 'connection.json';
+//const CONNECTION_FILENAME = 'connection.json';",,2017-12-19 16:26:23,https://api.github.com/repos/hyperledger/composer/pulls/comments/157785688,https://github.com/hyperledger/composer/pull/3049#discussion_r157785688,davidkel
https://github.com/hyperledger/composer/pull/3007,https://github.com/hyperledger/composer/pull/3007,CONCERTO 4 LYFE,33ace39b182ce52c9d613042d8755d134188fa04,2017-12-13 15:55:03,156699264,"@@ -4,23 +4,20 @@
 set -ev
 set -o pipefail
 
-# Grab the Concerto directory.",4,2017-12-13 15:55:03,https://api.github.com/repos/hyperledger/composer/pulls/comments/156699264,https://github.com/hyperledger/composer/pull/3007#discussion_r156699264,sstone1
https://github.com/hyperledger/composer/pull/3007,https://github.com/hyperledger/composer/pull/3007,":-)
",33ace39b182ce52c9d613042d8755d134188fa04,2017-12-13 15:57:09,156700035,"@@ -4,23 +4,20 @@
 set -ev
 set -o pipefail
 
-# Grab the Concerto directory.",4,2017-12-13 15:57:09,https://api.github.com/repos/hyperledger/composer/pulls/comments/156700035,https://github.com/hyperledger/composer/pull/3007#discussion_r156700035,mbwhite
https://github.com/hyperledger/composer/pull/2998,https://github.com/hyperledger/composer/pull/2998,"a-a?
",d721b1a6ed11b469b62910be52ab70ed7759b27a,2017-12-15 13:22:02,157198842,"@@ -20,7 +20,7 @@
     ""systest:hlf"": ""mocha -t 0 systest"",
     ""systest:hlfv1"": ""mocha -t 0 systest"",
     ""systest:hlfv1_tls"": ""mocha -t 0 systest"",
-    ""systest:hlfv1-1"": ""mocha -t 0 systest/[a-p]*.js systest/setup.js"",
+    ""systest:hlfv1-1"": ""mocha -t 0 systest/[a-a]*.js systest/setup.js"",",,2017-12-15 13:43:10,https://api.github.com/repos/hyperledger/composer/pulls/comments/157198842,https://github.com/hyperledger/composer/pull/2998#discussion_r157198842,mbwhite
https://github.com/hyperledger/composer/pull/2998,https://github.com/hyperledger/composer/pull/2998,comment out test?,d721b1a6ed11b469b62910be52ab70ed7759b27a,2017-12-15 13:24:20,157199588,"@@ -1246,6 +1219,12 @@ describe('HLFConnectionManager', () => {
             sandbox.reset();
         });
 
+        /*",,2017-12-15 13:43:10,https://api.github.com/repos/hyperledger/composer/pulls/comments/157199588,https://github.com/hyperledger/composer/pull/2998#discussion_r157199588,mbwhite
https://github.com/hyperledger/composer/pull/2974,https://github.com/hyperledger/composer/pull/2974,could you delete this line pls?,6ca4579ec6281c1724e26a4ea24d7dddc0bda5a0,2017-12-14 12:01:50,156925683,"@@ -341,13 +342,31 @@ class Composer {
             let stdout = '';
             let stderr = '';
 
+            // match BOBSID for revoking test
+            if(savedId && savedId!=='') {
+                command = command.replace(/BOBSID/, savedId);
+                // console.log('Command:', command);",,2017-12-15 16:35:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/156925683,https://github.com/hyperledger/composer/pull/2974#discussion_r156925683,nklincoln
https://github.com/hyperledger/composer/pull/2968,https://github.com/hyperledger/composer/pull/2968,This file needs to be removed from the pull request,9aeca6048e637926ec9f01be49c6bc72cfb8943e,2017-12-06 16:47:50,155292939,"@@ -0,0 +1 @@
+registry=http://9.140.101.134:4873",,2017-12-07 09:25:56,https://api.github.com/repos/hyperledger/composer/pulls/comments/155292939,https://github.com/hyperledger/composer/pull/2968#discussion_r155292939,davidkel
https://github.com/hyperledger/composer/pull/2950,https://github.com/hyperledger/composer/pull/2950,"the test descriptions here don't match with what the tests actually do - the description says it should throw, but in fact it tests that they all return false?",039cd3117073003da54b5b46f2019d8d24234a48,2017-12-06 11:56:31,155216228,"@@ -308,17 +286,93 @@ describe('FilterParser', () => {
             (() => {FilterParser.parseObjectValue('f1', {'between': [false, true]});
             }).should.throw(/Unsupported data type for the between operator/);
         });
+
+        it('should throw when a field value has more than one keys', () => {
+            (() => {
+                const keyObject = {'lte':'v1', 'gt':'v2'};
+                FilterParser.parseObjectValue('f1', keyObject);
+            }).should.throw(/The loopback user input operator has more than one operators in a field object/);
+        });
+
+        it('should throw when a where condition with an unsupported operator', () => {
+            (() => {
+                const keyObject = {'unknown':'v1'};
+                FilterParser.parseObjectValue('f1', keyObject);
+            }).should.throw(/The key unknown operator is not supported by the Composer filter where/);
+        });
+
+        it('should return when a where condition with a between operator', () => {
+            (() => {
+                const keyObject = {'between':[1,10,20]};
+                FilterParser.parseObjectValue('f1', keyObject);
+            }).should.throw(/The between value is not an array or does not have two elements/);
+        });
+
     });
 
     describe('#isDateTime',()=> {",63,2017-12-06 16:28:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/155216228,https://github.com/hyperledger/composer/pull/2950#discussion_r155216228,nklincoln
https://github.com/hyperledger/composer/pull/2950,https://github.com/hyperledger/composer/pull/2950,should return false?,039cd3117073003da54b5b46f2019d8d24234a48,2017-12-06 11:57:59,155216542,"@@ -308,17 +286,93 @@ describe('FilterParser', () => {
             (() => {FilterParser.parseObjectValue('f1', {'between': [false, true]});
             }).should.throw(/Unsupported data type for the between operator/);
         });
+
+        it('should throw when a field value has more than one keys', () => {
+            (() => {
+                const keyObject = {'lte':'v1', 'gt':'v2'};
+                FilterParser.parseObjectValue('f1', keyObject);
+            }).should.throw(/The loopback user input operator has more than one operators in a field object/);
+        });
+
+        it('should throw when a where condition with an unsupported operator', () => {
+            (() => {
+                const keyObject = {'unknown':'v1'};
+                FilterParser.parseObjectValue('f1', keyObject);
+            }).should.throw(/The key unknown operator is not supported by the Composer filter where/);
+        });
+
+        it('should return when a where condition with a between operator', () => {
+            (() => {
+                const keyObject = {'between':[1,10,20]};
+                FilterParser.parseObjectValue('f1', keyObject);
+            }).should.throw(/The between value is not an array or does not have two elements/);
+        });
+
     });
 
     describe('#isDateTime',()=> {
-        const testDate = new Date('2017-09-26T14:43:48.444Z');
 
-        FilterParser.isDateTime(testDate).should.be.true;
+        it('should return when parse a valid datetime value', () => {
+            const testDate = new Date('2017-09-26T14:43:48.444Z');
+
+            FilterParser.isDateTime(testDate).should.be.true;
+        });
+
+        it('should throw when parse an invalid datetime with an object value', () => {
+
+            FilterParser.isDateTime({'datetime:': '2017-09-26T14:43:48.444Z'}).should.be.false;
+        });
+
+        it('should throw when parse an invalid datetime with a null value', () => {
+
+            FilterParser.isDateTime(null).should.be.false;
+        });
+
+        it('should throw when parse an invalid datetime with a string value', () => {
+            FilterParser.isDateTime('2017-09-26T14:43:48.444Z').should.be.false;
+        });
+
+        it('should throw when parse an invalid datetime with an int value', () => {
+            FilterParser.isDateTime(1234567).should.be.false;
+        });
+
+        it('should throw when parse an invalid datetime with an undefined value', () => {
+            FilterParser.isDateTime(undefined).should.be.false;
+        });
+
     });
 
     describe('#isPrimitiveTypeValue',()=> {
-        const testDate = new Date('2017-09-26T14:43:48.444Z');
 
-        FilterParser.isPrimitiveTypeValue(testDate).should.be.true;
+        it('should return when parse a datetime value', () => {
+            const testDate = new Date('2017-09-26T14:43:48.444Z');
+            FilterParser.isPrimitiveTypeValue(testDate).should.be.true;
+        });
+
+        it('should return when parse a string value', () => {
+            FilterParser.isPrimitiveTypeValue('2017-09-26T14:43:48.444Z').should.be.true;
+        });
+
+        it('should return when parse a number value', () => {
+            FilterParser.isPrimitiveTypeValue(1234567).should.be.true;
+        });
+
+        it('should return when parse a boolean value', () => {
+            FilterParser.isPrimitiveTypeValue(true).should.be.true;
+        });
+
+        it('should return when parse an Object value', () => {",,2017-12-06 16:28:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/155216542,https://github.com/hyperledger/composer/pull/2950#discussion_r155216542,nklincoln
https://github.com/hyperledger/composer/pull/2950,https://github.com/hyperledger/composer/pull/2950,"Need to be more descriptive in the descriptions here - the test should return something explicit, ie:
 -  'should return true when passed a value that is X '
 -  'should return false when passed a value that is Y'
 -  'should throw when passed a value that is Z'",039cd3117073003da54b5b46f2019d8d24234a48,2017-12-06 11:59:40,155216860,"@@ -308,17 +286,93 @@ describe('FilterParser', () => {
             (() => {FilterParser.parseObjectValue('f1', {'between': [false, true]});
             }).should.throw(/Unsupported data type for the between operator/);
         });
+
+        it('should throw when a field value has more than one keys', () => {
+            (() => {
+                const keyObject = {'lte':'v1', 'gt':'v2'};
+                FilterParser.parseObjectValue('f1', keyObject);
+            }).should.throw(/The loopback user input operator has more than one operators in a field object/);
+        });
+
+        it('should throw when a where condition with an unsupported operator', () => {
+            (() => {
+                const keyObject = {'unknown':'v1'};
+                FilterParser.parseObjectValue('f1', keyObject);
+            }).should.throw(/The key unknown operator is not supported by the Composer filter where/);
+        });
+
+        it('should return when a where condition with a between operator', () => {
+            (() => {
+                const keyObject = {'between':[1,10,20]};
+                FilterParser.parseObjectValue('f1', keyObject);
+            }).should.throw(/The between value is not an array or does not have two elements/);
+        });
+
     });
 
     describe('#isDateTime',()=> {
-        const testDate = new Date('2017-09-26T14:43:48.444Z');
 
-        FilterParser.isDateTime(testDate).should.be.true;
+        it('should return when parse a valid datetime value', () => {
+            const testDate = new Date('2017-09-26T14:43:48.444Z');
+
+            FilterParser.isDateTime(testDate).should.be.true;
+        });
+
+        it('should throw when parse an invalid datetime with an object value', () => {
+
+            FilterParser.isDateTime({'datetime:': '2017-09-26T14:43:48.444Z'}).should.be.false;
+        });
+
+        it('should throw when parse an invalid datetime with a null value', () => {
+
+            FilterParser.isDateTime(null).should.be.false;
+        });
+
+        it('should throw when parse an invalid datetime with a string value', () => {
+            FilterParser.isDateTime('2017-09-26T14:43:48.444Z').should.be.false;
+        });
+
+        it('should throw when parse an invalid datetime with an int value', () => {
+            FilterParser.isDateTime(1234567).should.be.false;
+        });
+
+        it('should throw when parse an invalid datetime with an undefined value', () => {
+            FilterParser.isDateTime(undefined).should.be.false;
+        });
+
     });
 
     describe('#isPrimitiveTypeValue',()=> {",97,2017-12-06 16:28:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/155216860,https://github.com/hyperledger/composer/pull/2950#discussion_r155216860,nklincoln
https://github.com/hyperledger/composer/pull/2950,https://github.com/hyperledger/composer/pull/2950,updated the descriptions now,039cd3117073003da54b5b46f2019d8d24234a48,2017-12-06 12:30:15,155222839,"@@ -308,17 +286,93 @@ describe('FilterParser', () => {
             (() => {FilterParser.parseObjectValue('f1', {'between': [false, true]});
             }).should.throw(/Unsupported data type for the between operator/);
         });
+
+        it('should throw when a field value has more than one keys', () => {
+            (() => {
+                const keyObject = {'lte':'v1', 'gt':'v2'};
+                FilterParser.parseObjectValue('f1', keyObject);
+            }).should.throw(/The loopback user input operator has more than one operators in a field object/);
+        });
+
+        it('should throw when a where condition with an unsupported operator', () => {
+            (() => {
+                const keyObject = {'unknown':'v1'};
+                FilterParser.parseObjectValue('f1', keyObject);
+            }).should.throw(/The key unknown operator is not supported by the Composer filter where/);
+        });
+
+        it('should return when a where condition with a between operator', () => {
+            (() => {
+                const keyObject = {'between':[1,10,20]};
+                FilterParser.parseObjectValue('f1', keyObject);
+            }).should.throw(/The between value is not an array or does not have two elements/);
+        });
+
     });
 
     describe('#isDateTime',()=> {
-        const testDate = new Date('2017-09-26T14:43:48.444Z');
 
-        FilterParser.isDateTime(testDate).should.be.true;
+        it('should return when parse a valid datetime value', () => {
+            const testDate = new Date('2017-09-26T14:43:48.444Z');
+
+            FilterParser.isDateTime(testDate).should.be.true;
+        });
+
+        it('should throw when parse an invalid datetime with an object value', () => {
+
+            FilterParser.isDateTime({'datetime:': '2017-09-26T14:43:48.444Z'}).should.be.false;
+        });
+
+        it('should throw when parse an invalid datetime with a null value', () => {
+
+            FilterParser.isDateTime(null).should.be.false;
+        });
+
+        it('should throw when parse an invalid datetime with a string value', () => {
+            FilterParser.isDateTime('2017-09-26T14:43:48.444Z').should.be.false;
+        });
+
+        it('should throw when parse an invalid datetime with an int value', () => {
+            FilterParser.isDateTime(1234567).should.be.false;
+        });
+
+        it('should throw when parse an invalid datetime with an undefined value', () => {
+            FilterParser.isDateTime(undefined).should.be.false;
+        });
+
     });
 
     describe('#isPrimitiveTypeValue',()=> {
-        const testDate = new Date('2017-09-26T14:43:48.444Z');
 
-        FilterParser.isPrimitiveTypeValue(testDate).should.be.true;
+        it('should return when parse a datetime value', () => {
+            const testDate = new Date('2017-09-26T14:43:48.444Z');
+            FilterParser.isPrimitiveTypeValue(testDate).should.be.true;
+        });
+
+        it('should return when parse a string value', () => {
+            FilterParser.isPrimitiveTypeValue('2017-09-26T14:43:48.444Z').should.be.true;
+        });
+
+        it('should return when parse a number value', () => {
+            FilterParser.isPrimitiveTypeValue(1234567).should.be.true;
+        });
+
+        it('should return when parse a boolean value', () => {
+            FilterParser.isPrimitiveTypeValue(true).should.be.true;
+        });
+
+        it('should return when parse an Object value', () => {",,2017-12-06 16:28:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/155222839,https://github.com/hyperledger/composer/pull/2950#discussion_r155222839,fenglianxu
https://github.com/hyperledger/composer/pull/2940,https://github.com/hyperledger/composer/pull/2940,"Given stable is meant to be stable, I think this needs to be for the 0.16.x branch explicitly, rather than just an else...
```
elif [ ""${TRAVIS_BRANCH}"" = ""0.16.x"" ]; then
```
Not sure what DOCS should be if it's some other branch though. `unexpected`?! :)",19498f1a66424e89beea3c78b1edae354dd9ebf5,2017-12-05 08:34:32,154876036,"@@ -51,7 +51,11 @@ if [ ""${DOCS}"" != """" ]; then
   if [ -z ""${TRAVIS_TAG}"" ]; then
     DOCS=""unstable""
   else
-    DOCS=""full""
+    if [ ""${TRAVIS_BRANCH}"" = ""master"" ]; then
+        DOCS=""latest""
+    else",,2017-12-05 16:46:33,https://api.github.com/repos/hyperledger/composer/pulls/comments/154876036,https://github.com/hyperledger/composer/pull/2940#discussion_r154876036,jt-nti
https://github.com/hyperledger/composer/pull/2940,https://github.com/hyperledger/composer/pull/2940,"Client side redirects are a bit jarring, especially on a page that most people will see. Could we keep the landing page content in the root index.html rather than redirecting? That would mean being disciplined and making sure that the index is always the same in stable, latest and unstable branches.",19498f1a66424e89beea3c78b1edae354dd9ebf5,2017-12-05 08:38:22,154876722,"@@ -27,16 +27,23 @@ export TODIR=""${DIR}/packages/composer-website/out/gh-pages""
 # Load the GitHub repository using the gh-pages branch.
 git clone -b gh-pages git@github.com:${TRAVIS_REPO_SLUG}.git ${TODIR}
 
+# Should be able to copy all the docs as needed
+mkdir -p ${TODIR}/${DOCS}
+rm -rf ${TODIR}/${DOCS}/*
+cp -rf ${DIR}/packages/composer-website/jekylldocs/_site/* ${TODIR}/${DOCS}/
+
+echo ""<meta http-equiv=\""refresh\"" content=\""0; url=stable/index.html\"" />"" > ${TODIR}/index.html",21,2017-12-05 16:46:33,https://api.github.com/repos/hyperledger/composer/pulls/comments/154876722,https://github.com/hyperledger/composer/pull/2940#discussion_r154876722,jt-nti
https://github.com/hyperledger/composer/pull/2940,https://github.com/hyperledger/composer/pull/2940,Commented out code,19498f1a66424e89beea3c78b1edae354dd9ebf5,2017-12-05 08:38:49,154876817,"@@ -27,16 +27,23 @@ export TODIR=""${DIR}/packages/composer-website/out/gh-pages""
 # Load the GitHub repository using the gh-pages branch.
 git clone -b gh-pages git@github.com:${TRAVIS_REPO_SLUG}.git ${TODIR}
 
+# Should be able to copy all the docs as needed
+mkdir -p ${TODIR}/${DOCS}
+rm -rf ${TODIR}/${DOCS}/*
+cp -rf ${DIR}/packages/composer-website/jekylldocs/_site/* ${TODIR}/${DOCS}/
+
+echo ""<meta http-equiv=\""refresh\"" content=\""0; url=stable/index.html\"" />"" > ${TODIR}/index.html
+
 # If this is a full docs build, copy the docs into the GitHub repository as the main website.
-if [ ""${DOCS}"" == ""full"" ]; then
-    rm -rf ${TODIR}/*
-    cp -rf ${DIR}/packages/composer-website/jekylldocs/_site/* ${TODIR}/
-fi
+#if [ ""${DOCS}"" == ""stable"" ]; then
+#    rm -rf ${TODIR}/*
+#    cp -rf ${DIR}/packages/composer-website/jekylldocs/_site/* ${TODIR}/stable
+#fi",,2017-12-05 16:46:33,https://api.github.com/repos/hyperledger/composer/pulls/comments/154876817,https://github.com/hyperledger/composer/pull/2940#discussion_r154876817,jt-nti
https://github.com/hyperledger/composer/pull/2940,https://github.com/hyperledger/composer/pull/2940,Commented out code,19498f1a66424e89beea3c78b1edae354dd9ebf5,2017-12-05 08:39:15,154877012,"@@ -27,16 +27,23 @@ export TODIR=""${DIR}/packages/composer-website/out/gh-pages""
 # Load the GitHub repository using the gh-pages branch.
 git clone -b gh-pages git@github.com:${TRAVIS_REPO_SLUG}.git ${TODIR}
 
+# Should be able to copy all the docs as needed
+mkdir -p ${TODIR}/${DOCS}
+rm -rf ${TODIR}/${DOCS}/*
+cp -rf ${DIR}/packages/composer-website/jekylldocs/_site/* ${TODIR}/${DOCS}/
+
+echo ""<meta http-equiv=\""refresh\"" content=\""0; url=stable/index.html\"" />"" > ${TODIR}/index.html
+
 # If this is a full docs build, copy the docs into the GitHub repository as the main website.
-if [ ""${DOCS}"" == ""full"" ]; then
-    rm -rf ${TODIR}/*
-    cp -rf ${DIR}/packages/composer-website/jekylldocs/_site/* ${TODIR}/
-fi
+#if [ ""${DOCS}"" == ""stable"" ]; then
+#    rm -rf ${TODIR}/*
+#    cp -rf ${DIR}/packages/composer-website/jekylldocs/_site/* ${TODIR}/stable
+#fi
 
 # Always copy the docs into the GitHub repository as the unstable website.
-mkdir -p ${TODIR}/unstable
-rm -rf ${TODIR}/unstable/*
-cp -rf ${DIR}/packages/composer-website/jekylldocs/_site/* ${TODIR}/unstable/
+#mkdir -p ${TODIR}/unstable
+#rm -rf ${TODIR}/unstable/*
+#cp -rf ${DIR}/packages/composer-website/jekylldocs/_site/* ${TODIR}/unstable/",,2017-12-05 16:46:33,https://api.github.com/repos/hyperledger/composer/pulls/comments/154877012,https://github.com/hyperledger/composer/pull/2940#discussion_r154877012,jt-nti
https://github.com/hyperledger/composer/pull/2938,https://github.com/hyperledger/composer/pull/2938,The Constructor for TransactionRegistry doesn't match what is being invoked here. I can see that the superclass for TransactionRegistry does match this signature. You should also modify TransactionRegistry constructor to correctly match the required construction parameters.,4a9e2355852f276aa5abb5864e2465b48986bb8b,2018-01-16 09:05:39,161694003,"@@ -526,11 +526,11 @@ class BusinessNetworkConnection extends EventEmitter {
             .then((registry) => {
                 switch (type) {
                 case 'Transaction':
-                    return new TransactionRegistry(registry.id, registry.name, this.securityContext, businessNetwork.getModelManager(), businessNetwork.getFactory(), businessNetwork.getSerializer());
+                    return new TransactionRegistry(registry.id, registry.name, this.securityContext, businessNetwork.getModelManager(), businessNetwork.getFactory(), businessNetwork.getSerializer(),this);",5,2018-01-16 09:05:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/161694003,https://github.com/hyperledger/composer/pull/2938#discussion_r161694003,davidkel
https://github.com/hyperledger/composer/pull/2918,https://github.com/hyperledger/composer/pull/2918,Surely a mistake? ðŸ˜‰ ,de1b0240d9eff2b2f0ea43813240bb28cf5e1916,2017-12-04 21:20:12,154778179,"@@ -31,7 +31,7 @@ process.setMaxListeners(Infinity);
 
 describe('Access control system tests', function() {
 
-    this.retries(TestUtil.retries());
+    // this.retries(TestUtil.retries());",,2017-12-30 08:21:59,https://api.github.com/repos/hyperledger/composer/pulls/comments/154778179,https://github.com/hyperledger/composer/pull/2918#discussion_r154778179,sstone1
https://github.com/hyperledger/composer/pull/2918,https://github.com/hyperledger/composer/pull/2918,You can just `return error` rather than using `Promise.resolve`.,de1b0240d9eff2b2f0ea43813240bb28cf5e1916,2017-12-04 21:20:33,154778258,"@@ -203,6 +208,38 @@ class Registry extends EventEmitter {
             });
     }
 
+    /**
+     * Tests to see if the the specified resource to this registry could be added to the registry
+     * invokes the same ACL rules as really adding.
+     *
+     * @param {Resource} resource The resource to test adding to this registry.
+     * @return {Promise} A promise that will be resolved with null if this resource could be added, or resolved with the
+     * error that would have been thrown.
+     */
+    testAdd(resource) {
+
+        return Promise.resolve().then(() => {
+            if (!(resource instanceof Resource)) {
+                throw new Error('Expected a Resource or Concept.');                }
+            else if (this.type !== resource.getClassDeclaration().getSystemType()){
+                throw new Error('Cannot add type: ' + resource.getClassDeclaration().getSystemType() + ' to ' + this.type);
+            }
+        })
+        .then(() => {
+            return this.accessController.check(resource, 'CREATE');
+        })
+        .then(()=>{
+            return null;
+        })
+        .catch((error)=>{
+            // access has not been granted, so return the error that would have been thrown in the
+            // promise
+            return Promise.resolve(error);",,2017-12-30 08:21:59,https://api.github.com/repos/hyperledger/composer/pulls/comments/154778258,https://github.com/hyperledger/composer/pull/2918#discussion_r154778258,sstone1
https://github.com/hyperledger/composer/pull/2918,https://github.com/hyperledger/composer/pull/2918,"Such comment, much ðŸ˜­ ",de1b0240d9eff2b2f0ea43813240bb28cf5e1916,2017-12-04 21:20:49,154778320,"@@ -176,17 +176,22 @@ class Registry extends EventEmitter {
      */
     add(resource, options) {
 
-        return Promise.resolve().then(() => {
-            if (!(resource instanceof Resource)) {
-                throw new Error('Expected a Resource or Concept.');                }
-            else if (this.type !== resource.getClassDeclaration().getSystemType()){
-                throw new Error('Cannot add type: ' + resource.getClassDeclaration().getSystemType() + ' to ' + this.type);
-            }
-        })
-            .then(() => {
-                return this.accessController.check(resource, 'CREATE');
-            })
-            .then(() => {
+        // return Promise.resolve().then(() => {
+        //     if (!(resource instanceof Resource)) {
+        //         throw new Error('Expected a Resource or Concept.');                }
+        //     else if (this.type !== resource.getClassDeclaration().getSystemType()){
+        //         throw new Error('Cannot add type: ' + resource.getClassDeclaration().getSystemType() + ' to ' + this.type);
+        //     }
+        // })
+        //     .then(() => {
+        //         return this.accessController.check(resource, 'CREATE');
+        //     })",,2017-12-30 08:21:59,https://api.github.com/repos/hyperledger/composer/pulls/comments/154778320,https://github.com/hyperledger/composer/pull/2918#discussion_r154778320,sstone1
https://github.com/hyperledger/composer/pull/2918,https://github.com/hyperledger/composer/pull/2918,ah.. good point... being in a catch block doesn't affect that?,de1b0240d9eff2b2f0ea43813240bb28cf5e1916,2017-12-06 10:09:49,155193464,"@@ -203,6 +208,38 @@ class Registry extends EventEmitter {
             });
     }
 
+    /**
+     * Tests to see if the the specified resource to this registry could be added to the registry
+     * invokes the same ACL rules as really adding.
+     *
+     * @param {Resource} resource The resource to test adding to this registry.
+     * @return {Promise} A promise that will be resolved with null if this resource could be added, or resolved with the
+     * error that would have been thrown.
+     */
+    testAdd(resource) {
+
+        return Promise.resolve().then(() => {
+            if (!(resource instanceof Resource)) {
+                throw new Error('Expected a Resource or Concept.');                }
+            else if (this.type !== resource.getClassDeclaration().getSystemType()){
+                throw new Error('Cannot add type: ' + resource.getClassDeclaration().getSystemType() + ' to ' + this.type);
+            }
+        })
+        .then(() => {
+            return this.accessController.check(resource, 'CREATE');
+        })
+        .then(()=>{
+            return null;
+        })
+        .catch((error)=>{
+            // access has not been granted, so return the error that would have been thrown in the
+            // promise
+            return Promise.resolve(error);",,2017-12-30 08:21:59,https://api.github.com/repos/hyperledger/composer/pulls/comments/155193464,https://github.com/hyperledger/composer/pull/2918#discussion_r155193464,mbwhite
https://github.com/hyperledger/composer/pull/2918,https://github.com/hyperledger/composer/pull/2918,"oohh flip..
",de1b0240d9eff2b2f0ea43813240bb28cf5e1916,2017-12-06 10:09:58,155193493,"@@ -31,7 +31,7 @@ process.setMaxListeners(Infinity);
 
 describe('Access control system tests', function() {
 
-    this.retries(TestUtil.retries());
+    // this.retries(TestUtil.retries());",,2017-12-30 08:21:59,https://api.github.com/repos/hyperledger/composer/pulls/comments/155193493,https://github.com/hyperledger/composer/pull/2918#discussion_r155193493,mbwhite
https://github.com/hyperledger/composer/pull/2905,https://github.com/hyperledger/composer/pull/2905,"I can see how this works but i'm not sure this is the right solution. You should only need to load the config once, then you already have it and you shouldn't be updating the config later",f1a50605422c665c24350e640677f6e383fc17d4,2017-11-30 13:25:51,154073154,"@@ -115,14 +115,10 @@ export class AppComponent implements OnInit, OnDestroy {
                 this.fileService.deleteAllFiles();
                 this.showWelcome = false;
 
-                try {
-                  this.config = this.configService.getConfig();
-                } catch (err) {
-                  this.configService.loadConfig()
-                  .then((config) => {
-                      this.config = config;
-                  });
-                }
+                this.configService.loadConfig()",,2017-12-15 11:46:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/154073154,https://github.com/hyperledger/composer/pull/2905#discussion_r154073154,cazfletch
https://github.com/hyperledger/composer/pull/2905,https://github.com/hyperledger/composer/pull/2905,The trouble seemed to stem from that JavaScript's object handling meant that the returned config from getConfig when updated also updated the config object in getConfig so I reload it from the base file. Should I make the change such that the config objects loaded from getConfig are cloned before use in the app component so that logout sticks with getConfig?,f1a50605422c665c24350e640677f6e383fc17d4,2017-11-30 13:38:20,154076086,"@@ -115,14 +115,10 @@ export class AppComponent implements OnInit, OnDestroy {
                 this.fileService.deleteAllFiles();
                 this.showWelcome = false;
 
-                try {
-                  this.config = this.configService.getConfig();
-                } catch (err) {
-                  this.configService.loadConfig()
-                  .then((config) => {
-                      this.config = config;
-                  });
-                }
+                this.configService.loadConfig()",,2017-12-15 11:46:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/154076086,https://github.com/hyperledger/composer/pull/2905#discussion_r154076086,awjh-ibm
https://github.com/hyperledger/composer/pull/2905,https://github.com/hyperledger/composer/pull/2905,please remove,f1a50605422c665c24350e640677f6e383fc17d4,2017-12-05 08:50:21,154879266,"@@ -68,6 +69,7 @@ export class AppComponent implements OnInit, OnDestroy {
     }
 
     ngOnInit(): Promise<void> {
+        console.log(this.composerBanner, 'BANNER TEST');",,2017-12-15 11:46:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/154879266,https://github.com/hyperledger/composer/pull/2905#discussion_r154879266,nklincoln
https://github.com/hyperledger/composer/pull/2901,https://github.com/hyperledger/composer/pull/2901,Is the toString needed?,0026dd3f708722b962b531f55e63d88b439a42d7,2017-11-30 13:23:12,154072588,"@@ -62,6 +62,14 @@ export class TransactionComponent implements OnInit {
                 return !modelClassDeclaration.isAbstract() &&
                     !modelClassDeclaration.isSystemType() &&
                     modelClassDeclaration instanceof TransactionDeclaration;
+            })
+            .sort((a, b) => {
+                if (a.getName().toString() < b.getName().toString()) {",,2017-12-05 09:27:33,https://api.github.com/repos/hyperledger/composer/pulls/comments/154072588,https://github.com/hyperledger/composer/pull/2901#discussion_r154072588,cazfletch
https://github.com/hyperledger/composer/pull/2901,https://github.com/hyperledger/composer/pull/2901,"Yeah OK, it's picky, but it would make me really happy if this was in a final 'else' block ðŸ‘ ",0026dd3f708722b962b531f55e63d88b439a42d7,2017-12-05 09:09:01,154883663,"@@ -62,6 +62,14 @@ export class TransactionComponent implements OnInit {
                 return !modelClassDeclaration.isAbstract() &&
                     !modelClassDeclaration.isSystemType() &&
                     modelClassDeclaration instanceof TransactionDeclaration;
+            })
+            .sort((a, b) => {
+                if (a.getName() < b.getName()) {
+                  return -1;
+                } else if (a.getName() > b.getName()) {
+                  return 1;
+                }
+                return 0;",,2017-12-05 09:27:33,https://api.github.com/repos/hyperledger/composer/pulls/comments/154883663,https://github.com/hyperledger/composer/pull/2901#discussion_r154883663,nklincoln
https://github.com/hyperledger/composer/pull/2876,https://github.com/hyperledger/composer/pull/2876,"Need to remove the composer-rest-server as well, this causes the cli to be a much bigger package than required.",7ceeee96db797b132d406bf875baf7259c09df96,2017-11-29 11:42:00,153764084,"@@ -47,7 +47,6 @@
     ""composer-client"": ""0.17.0"",
     ""composer-common"": ""0.17.0"",
     ""composer-rest-server"": ""0.17.0"",",,2017-11-29 13:12:15,https://api.github.com/repos/hyperledger/composer/pulls/comments/153764084,https://github.com/hyperledger/composer/pull/2876#discussion_r153764084,davidkel
https://github.com/hyperledger/composer/pull/2874,https://github.com/hyperledger/composer/pull/2874,remove ðŸ‘ ,fd4f2c312b7c720ed319dd79df042d1e8fe42f4e,2017-11-29 11:10:37,153757357,"@@ -4,12 +4,15 @@
   ""description"": ""Integration tests for Hyperledger Composer"",
   ""main"": ""index.js"",
   ""scripts"": {
+    ""start_verdaccio"": ""verdaccio -l 0.0.0.0:4873 -c ./scripts/config.yaml >/dev/null &"",
+    ""stop_verdaccio"": ""pkill verdaccio | true"",
     ""pretest"": ""npm run licchk"",
     ""licchk"": ""license-check"",
     ""postlicchk"": ""npm run lint"",
     ""lint"": ""eslint ."",
     ""test-inner"": ""cucumber-js"",
-    ""int-test"": ""npm run pretest && npm run lint && node ./scripts/npm_serve && npm run test-inner""
+    ""int-test"": ""npm run pretest && npm run lint && npm run start_verdaccio && node ./scripts/npm_serve && npm run test-inner && npm run stop_verdaccio"",
+    ""int-test1"": ""npm run pretest && npm run lint && node ./scripts/npm_serve && npm run test-inner""",,2017-11-29 11:36:24,https://api.github.com/repos/hyperledger/composer/pulls/comments/153757357,https://github.com/hyperledger/composer/pull/2874#discussion_r153757357,nklincoln
https://github.com/hyperledger/composer/pull/2807,https://github.com/hyperledger/composer/pull/2807,the eventHubUrl isn't required,1b42a1b0275ea593192347b4bc351a55760a3a2b,2017-11-22 13:35:10,152565389,"@@ -319,8 +319,7 @@ describe('ConnectionProfileComponent', () => {
                 channel: ['composerchannel', [Validators.required]],
                 mspID: ['Org1MSP', [Validators.required]],
                 ca: ['http://localhost:7054', [Validators.required]],
-                eventHubURL: ['grpc://localhost:7053'],
-                keyValStore: ['/tmp/keyValStore', [Validators.required]],
+                eventHubURL: ['grpc://localhost:7053', [Validators.required]],",,2017-11-22 14:35:07,https://api.github.com/repos/hyperledger/composer/pulls/comments/152565389,https://github.com/hyperledger/composer/pull/2807#discussion_r152565389,cazfletch
https://github.com/hyperledger/composer/pull/2807,https://github.com/hyperledger/composer/pull/2807,again here the eventHubUrl isn't required,1b42a1b0275ea593192347b4bc351a55760a3a2b,2017-11-22 13:35:37,152565511,"@@ -425,8 +420,7 @@ describe('ConnectionProfileComponent', () => {
                 name: ['new v06 Profile', [Validators.required, Validators.pattern('^(?!New Connection Profile$).*$')]],
                 peerURL: ['grpc://localhost:7051', [Validators.required]],
                 membershipServicesURL: ['grpc://localhost:7054', [Validators.required]],
-                eventHubURL: ['grpc://localhost:7053'],
-                keyValStore: ['/tmp/keyValStore', [Validators.required]],
+                eventHubURL: ['grpc://localhost:7053', [Validators.required]],",,2017-11-22 14:35:07,https://api.github.com/repos/hyperledger/composer/pulls/comments/152565511,https://github.com/hyperledger/composer/pull/2807#discussion_r152565511,cazfletch
https://github.com/hyperledger/composer/pull/2791,https://github.com/hyperledger/composer/pull/2791,It would be better not to include a default analyticsID,81d267bd044e345af2aba75c1777f71045b55d38,2017-11-21 11:01:58,152241871,"@@ -50,6 +50,8 @@ export class AppComponent implements OnInit, OnDestroy {
 
     private busyModalRef = null;
 
+    private analyticsID = 'UA-91314349-3';",,2017-11-21 20:17:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/152241871,https://github.com/hyperledger/composer/pull/2791#discussion_r152241871,jt-nti
https://github.com/hyperledger/composer/pull/2791,https://github.com/hyperledger/composer/pull/2791,Should only do this if there is an ID :),81d267bd044e345af2aba75c1777f71045b55d38,2017-11-21 11:03:05,152242143,"@@ -134,6 +140,14 @@ export class AppComponent implements OnInit, OnDestroy {
         return this.initializationService.initialize()
             .then(() => {
                 this.usingLocally = !this.configService.isWebOnly();
+
+                const config = this.configService.getConfig();
+                let analyticsID = this.analyticsID;
+                if (config && config.analyticsID) {
+                    analyticsID = config.analyticsID;
+                }
+
+                window['ga']('create', analyticsID, 'auto');",,2017-11-21 20:17:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/152242143,https://github.com/hyperledger/composer/pull/2791#discussion_r152242143,jt-nti
https://github.com/hyperledger/composer/pull/2791,https://github.com/hyperledger/composer/pull/2791,`console.log`?,81d267bd044e345af2aba75c1777f71045b55d38,2017-11-21 11:03:34,152242247,"@@ -107,6 +109,10 @@ export class AppComponent implements OnInit, OnDestroy {
     }
 
     processRouteEvent(event): Promise<void> {
+        console.log('page', event.urlAfterRedirects);",,2017-11-21 20:17:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/152242247,https://github.com/hyperledger/composer/pull/2791#discussion_r152242247,jt-nti
https://github.com/hyperledger/composer/pull/2791,https://github.com/hyperledger/composer/pull/2791,Should only send page views if there is an ID,81d267bd044e345af2aba75c1777f71045b55d38,2017-11-21 11:04:05,152242370,"@@ -107,6 +109,10 @@ export class AppComponent implements OnInit, OnDestroy {
     }
 
     processRouteEvent(event): Promise<void> {
+        console.log('page', event.urlAfterRedirects);
+        (window)['ga']('set', 'page', event.urlAfterRedirects);
+        (window)['ga']('send', 'pageview');",,2017-11-21 20:17:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/152242370,https://github.com/hyperledger/composer/pull/2791#discussion_r152242370,jt-nti
https://github.com/hyperledger/composer/pull/2791,https://github.com/hyperledger/composer/pull/2791,Only the bluemix hosted playground should include the analyticsID,81d267bd044e345af2aba75c1777f71045b55d38,2017-11-21 19:56:18,152384875,"@@ -10,6 +10,7 @@ services:
     environment:
       COMPOSER_CONFIG: >
         {
+            ""analyticsID"" : ""UA-91314349-3"",",,2017-11-21 20:17:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/152384875,https://github.com/hyperledger/composer/pull/2791#discussion_r152384875,jt-nti
https://github.com/hyperledger/composer/pull/2791,https://github.com/hyperledger/composer/pull/2791,Why?,81d267bd044e345af2aba75c1777f71045b55d38,2017-11-21 19:57:30,152385163,"@@ -10,6 +10,7 @@ services:
     environment:
       COMPOSER_CONFIG: >
         {
+            ""analyticsID"" : ""UA-91314349-3"",",,2017-11-21 20:17:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/152385163,https://github.com/hyperledger/composer/pull/2791#discussion_r152385163,cazfletch
https://github.com/hyperledger/composer/pull/2791,https://github.com/hyperledger/composer/pull/2791,Why?,81d267bd044e345af2aba75c1777f71045b55d38,2017-11-21 19:57:32,152385175,"@@ -10,6 +10,7 @@ services:
     environment:
       COMPOSER_CONFIG: >
         {
+            ""analyticsID"" : ""UA-91314349-3"",",,2017-11-21 20:17:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/152385175,https://github.com/hyperledger/composer/pull/2791#discussion_r152385175,cazfletch
https://github.com/hyperledger/composer/pull/2775,https://github.com/hyperledger/composer/pull/2775,Can you remove the console.log please,fd41808be541535d6c835b243d125de5e87b485b,2017-11-20 14:43:24,152008326,"@@ -277,6 +274,7 @@ export class ConnectionProfileComponent {
             throw new Error('Invalid connection profile type');
         } else {
             if (this.connectionProfileData.profile.type === 'hlfv1') {
+                console.log('THE V1 FORM IS: ', this.v1Form);",,2017-11-20 14:55:38,https://api.github.com/repos/hyperledger/composer/pulls/comments/152008326,https://github.com/hyperledger/composer/pull/2775#discussion_r152008326,cazfletch
https://github.com/hyperledger/composer/pull/2771,https://github.com/hyperledger/composer/pull/2771,Why did you modify an existing test rather than add a new one?  Is the original test no longer valid (i.e. it no longer passes by design)?,34ab6056df7955a969fbafa74e5e6195eefcbcb2,2017-11-21 09:44:59,152221903,"@@ -668,16 +668,33 @@ describe('QueryCompiler', () => {
             const result = queryCompiler.visitArrayCombinationOperator({
                 type: 'BinaryExpression',
                 operator: 'AND',
+",4,2017-11-21 10:30:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/152221903,https://github.com/hyperledger/composer/pull/2771#discussion_r152221903,andrew-coleman
https://github.com/hyperledger/composer/pull/2771,https://github.com/hyperledger/composer/pull/2771,The original test case is no longer valid as we use the implicit format without using the explicit AND. ,34ab6056df7955a969fbafa74e5e6195eefcbcb2,2017-11-21 10:06:33,152227644,"@@ -668,16 +668,33 @@ describe('QueryCompiler', () => {
             const result = queryCompiler.visitArrayCombinationOperator({
                 type: 'BinaryExpression',
                 operator: 'AND',
+",4,2017-11-21 10:30:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/152227644,https://github.com/hyperledger/composer/pull/2771#discussion_r152227644,fenglianxu
https://github.com/hyperledger/composer/pull/2761,https://github.com/hyperledger/composer/pull/2761,never heard of this guy,1f70535b6c488c1b394008efdc709aa57701d371,2017-11-18 13:43:15,151838197,"@@ -1,3 +1,4 @@
 [submodule ""packages/composer-runtime-hlfv1/vendor/gopkg.in/olebedev/go-duktape.v3""]
 	path = packages/composer-runtime-hlfv1/vendor/gopkg.in/olebedev/go-duktape.v3
-	url = https://gopkg.in/olebedev/go-duktape.v3.git
+	url = https://gopkg.in/sstone1/go-duktape.v3.git",4,2017-11-18 13:43:15,https://api.github.com/repos/hyperledger/composer/pulls/comments/151838197,https://github.com/hyperledger/composer/pull/2761#discussion_r151838197,nklincoln
https://github.com/hyperledger/composer/pull/2732,https://github.com/hyperledger/composer/pull/2732,Could the `*ngIf` go on the tutorial-link directly?,f5fed1209b7827edb2246a96d199ce36e75da027,2017-11-21 11:27:45,152247668,"@@ -7,17 +7,19 @@
     </button>
   </div>
   <section class=""modal-body"">
-    <h1>Welcome to Hyperledger Composer Playground!</h1>
+    <h1>Welcome to {{ config.banner.join(' ') }}!</h1>
     <svg class=""splash-icon"" aria-hidden=""true"">
       <use xlink:href=""#icon-WelcomeToPlayground""></use>
     </svg>
-    <p>In this web sandbox, you can deploy, edit and test business network definitions. Have a play and learn what Hyperledger Composer is all about.
+    <p>In this web sandbox, you can deploy, edit and test business network definitions. Have a play and learn what {{ config.banner.join(' ') }} is all about.
     </p>
   </section>
   <footer>
     <button id=""welcome_start"" type=""button"" class=""primary centre"" (click)=""activeModal.close();"">
       <span>Let's Blockchain!</span>
     </button>
-    <tutorial-link></tutorial-link>
+    <div *ngIf=""config.links && config.links.tutorial"" >",,2017-11-23 15:11:19,https://api.github.com/repos/hyperledger/composer/pulls/comments/152247668,https://github.com/hyperledger/composer/pull/2732#discussion_r152247668,jt-nti
https://github.com/hyperledger/composer/pull/2732,https://github.com/hyperledger/composer/pull/2732,Hopefully these aren't still required,f5fed1209b7827edb2246a96d199ce36e75da027,2017-11-21 11:39:46,152250079,"@@ -2,6 +2,17 @@
     ""name"": ""composer-playground"",
     ""version"": ""0.15.1"",
     ""description"": ""A test harness/UI for the web runtime container for Hyperledger Composer"",
+    ""config"": {
+      ""title"": ""Hyperledger Composer"",
+      ""banner"": [""Hyperledger"", ""Composer Playground""],
+      ""links"": {
+        ""docs"": ""https://hyperledger.github.io/composer/introduction/introduction.html"",
+        ""tutorial"": ""https://hyperledger.github.io/composer/tutorials/playground-guide.html"",
+        ""community"": ""https://hyperledger.github.io/composer/support/support-index.html"",
+        ""github"": ""https://github.com/hyperledger/composer"",
+        ""install"": ""https://hyperledger.github.io/composer/installing/installing-index.html""
+      }
+    },",,2017-11-23 15:11:19,https://api.github.com/repos/hyperledger/composer/pulls/comments/152250079,https://github.com/hyperledger/composer/pull/2732#discussion_r152250079,jt-nti
https://github.com/hyperledger/composer/pull/2732,https://github.com/hyperledger/composer/pull/2732,Couldn't the defaults be defined here? (See below),f5fed1209b7827edb2246a96d199ce36e75da027,2017-11-21 11:43:42,152250818,"@@ -46,7 +47,10 @@ export class AppComponent implements OnInit, OnDestroy {
     private showWelcome = true;
     private dropListActive = false;
 
-    private composerBanner = ['Hyperledger', 'Composer Playground'];
+    private config;
+
+    private composerBanner: Array<string> = ['', ''];
+    private localInstallLink: string = '';",,2017-11-23 15:11:19,https://api.github.com/repos/hyperledger/composer/pulls/comments/152250818,https://github.com/hyperledger/composer/pull/2732#discussion_r152250818,jt-nti
https://github.com/hyperledger/composer/pull/2732,https://github.com/hyperledger/composer/pull/2732,Would be better to avoid repetition of the banner/link/title strings here. It seems like the defaults could just be defined to start with and overridden if there is any config,f5fed1209b7827edb2246a96d199ce36e75da027,2017-11-21 11:46:51,152251509,"@@ -87,6 +92,19 @@ export class AppComponent implements OnInit, OnDestroy {
             if (!success) {
                 this.openVersionModal();
             }
+            return this.configService.loadConfig();
+        }).then((config) => {
+            this.config = config;
+            this.composerBanner = (this.config.banner && this.config.banner.length === 2) ? this.config.banner : ['Hyperledger', 'Composer Playground'];
+            this.localInstallLink = (this.config.links && this.config.links.install) ? this.config.links.install : 'https://hyperledger.github.io/composer/installing/installing-index.html';
+            let title = this.config.title ? this.config.title : 'Hyperledger Composer';
+            this.setTitle(title);
+        })
+        .catch((err) => {
+            this.composerBanner = ['Hyperledger', 'Composer Playground'];
+            this.localInstallLink = 'https://hyperledger.github.io/composer/installing/installing-index.html';
+            this.setTitle('Hyperledger Composer');
+            this.alertService.errorStatus$.next(err);",,2017-11-23 15:11:19,https://api.github.com/repos/hyperledger/composer/pulls/comments/152251509,https://github.com/hyperledger/composer/pull/2732#discussion_r152251509,jt-nti
https://github.com/hyperledger/composer/pull/2732,https://github.com/hyperledger/composer/pull/2732,"Looks like another place with the same defaults.

(Seems good to have defaults though which isn't the case for all the config data)",f5fed1209b7827edb2246a96d199ce36e75da027,2017-11-21 11:48:59,152251929,"@@ -100,7 +118,7 @@ export class AppComponent implements OnInit, OnDestroy {
         this.clientService.disconnect();
         this.identityService.setLoggedIn(false);
         this.fileService.deleteAllFiles();
-        this.composerBanner = ['Hyperledger', 'Composer Playground'];
+        this.composerBanner = (this.config.banner && this.config.banner.length === 2) ? this.config.banner : ['Hyperledger', 'Composer Playground'];",,2017-11-23 15:11:19,https://api.github.com/repos/hyperledger/composer/pulls/comments/152251929,https://github.com/hyperledger/composer/pull/2732#discussion_r152251929,jt-nti
https://github.com/hyperledger/composer/pull/2732,https://github.com/hyperledger/composer/pull/2732,No default value for the github link?,f5fed1209b7827edb2246a96d199ce36e75da027,2017-11-21 11:50:37,152252222,"@@ -3,22 +3,22 @@
         <div class=""footer-item"">
             <a href=""https://www.apache.org/licenses/LICENSE-2.0"" target=""_blank"">Legal</a>
         </div>
-        <div class=""footer-item"">
-            <a href=""https://github.com/hyperledger/composer"" target=""_blank"">GitHub</a>
+        <div *ngIf='config.links && config.links.github' class=""footer-item"">
+            <a href=""{{ config.links.github }}"" target=""_blank"">GitHub</a>",,2017-11-23 15:11:19,https://api.github.com/repos/hyperledger/composer/pulls/comments/152252222,https://github.com/hyperledger/composer/pull/2732#discussion_r152252222,jt-nti
https://github.com/hyperledger/composer/pull/2732,https://github.com/hyperledger/composer/pull/2732,No default value for the tutorial link?,f5fed1209b7827edb2246a96d199ce36e75da027,2017-11-21 11:50:47,152252247,"@@ -3,22 +3,22 @@
         <div class=""footer-item"">
             <a href=""https://www.apache.org/licenses/LICENSE-2.0"" target=""_blank"">Legal</a>
         </div>
-        <div class=""footer-item"">
-            <a href=""https://github.com/hyperledger/composer"" target=""_blank"">GitHub</a>
+        <div *ngIf='config.links && config.links.github' class=""footer-item"">
+            <a href=""{{ config.links.github }}"" target=""_blank"">GitHub</a>
         </div>
     </div>
     <div class=""footer-right"">
         <div class=""footer-item"">
             Playground v{{ playgroundVersion }}
         </div>
-        <div class=""footer-item"">
-            <a href=""https://hyperledger.github.io/composer/tutorials/playground-guide.html"" target=""_blank"">Tutorial</a>
+        <div *ngIf='config.links && config.links.tutorial' class=""footer-item"">
+            <a href=""{{ config.links.tutorial }}"" target=""_blank"">Tutorial</a>",,2017-11-23 15:11:19,https://api.github.com/repos/hyperledger/composer/pulls/comments/152252247,https://github.com/hyperledger/composer/pull/2732#discussion_r152252247,jt-nti
https://github.com/hyperledger/composer/pull/2732,https://github.com/hyperledger/composer/pull/2732,No default value for the doc link?,f5fed1209b7827edb2246a96d199ce36e75da027,2017-11-21 11:50:58,152252278,"@@ -3,22 +3,22 @@
         <div class=""footer-item"">
             <a href=""https://www.apache.org/licenses/LICENSE-2.0"" target=""_blank"">Legal</a>
         </div>
-        <div class=""footer-item"">
-            <a href=""https://github.com/hyperledger/composer"" target=""_blank"">GitHub</a>
+        <div *ngIf='config.links && config.links.github' class=""footer-item"">
+            <a href=""{{ config.links.github }}"" target=""_blank"">GitHub</a>
         </div>
     </div>
     <div class=""footer-right"">
         <div class=""footer-item"">
             Playground v{{ playgroundVersion }}
         </div>
-        <div class=""footer-item"">
-            <a href=""https://hyperledger.github.io/composer/tutorials/playground-guide.html"" target=""_blank"">Tutorial</a>
+        <div *ngIf='config.links && config.links.tutorial' class=""footer-item"">
+            <a href=""{{ config.links.tutorial }}"" target=""_blank"">Tutorial</a>
         </div>
-        <div class=""footer-item"">
-            <a href=""https://hyperledger.github.io/composer/introduction/introduction.html"" target=""_blank"">Docs</a>
+        <div *ngIf='config.links && config.links.docs' class=""footer-item"">
+            <a href=""{{ config.links.docs }}"" target=""_blank"">Docs</a>",,2017-11-23 15:11:19,https://api.github.com/repos/hyperledger/composer/pulls/comments/152252278,https://github.com/hyperledger/composer/pull/2732#discussion_r152252278,jt-nti
https://github.com/hyperledger/composer/pull/2732,https://github.com/hyperledger/composer/pull/2732,No default value for the community link?,f5fed1209b7827edb2246a96d199ce36e75da027,2017-11-21 11:51:09,152252323,"@@ -3,22 +3,22 @@
         <div class=""footer-item"">
             <a href=""https://www.apache.org/licenses/LICENSE-2.0"" target=""_blank"">Legal</a>
         </div>
-        <div class=""footer-item"">
-            <a href=""https://github.com/hyperledger/composer"" target=""_blank"">GitHub</a>
+        <div *ngIf='config.links && config.links.github' class=""footer-item"">
+            <a href=""{{ config.links.github }}"" target=""_blank"">GitHub</a>
         </div>
     </div>
     <div class=""footer-right"">
         <div class=""footer-item"">
             Playground v{{ playgroundVersion }}
         </div>
-        <div class=""footer-item"">
-            <a href=""https://hyperledger.github.io/composer/tutorials/playground-guide.html"" target=""_blank"">Tutorial</a>
+        <div *ngIf='config.links && config.links.tutorial' class=""footer-item"">
+            <a href=""{{ config.links.tutorial }}"" target=""_blank"">Tutorial</a>
         </div>
-        <div class=""footer-item"">
-            <a href=""https://hyperledger.github.io/composer/introduction/introduction.html"" target=""_blank"">Docs</a>
+        <div *ngIf='config.links && config.links.docs' class=""footer-item"">
+            <a href=""{{ config.links.docs }}"" target=""_blank"">Docs</a>
         </div>
-        <div class=""footer-item"">
-            <a href=""https://hyperledger.github.io/composer/support/support-index.html"" target=""_blank"">Community</a>
+        <div *ngIf='config.links && config.links.community' class=""footer-item"">
+            <a href=""{{ config.links.community }}"" target=""_blank"">Community</a>",,2017-11-23 15:11:19,https://api.github.com/repos/hyperledger/composer/pulls/comments/152252323,https://github.com/hyperledger/composer/pull/2732#discussion_r152252323,jt-nti
https://github.com/hyperledger/composer/pull/2732,https://github.com/hyperledger/composer/pull/2732,No default value for the tutorial link?,f5fed1209b7827edb2246a96d199ce36e75da027,2017-11-21 11:51:51,152252477,"@@ -7,17 +7,19 @@
     </button>
   </div>
   <section class=""modal-body"">
-    <h1>Welcome to Hyperledger Composer Playground!</h1>
+    <h1>Welcome to {{ config.banner.join(' ') }}!</h1>
     <svg class=""splash-icon"" aria-hidden=""true"">
       <use xlink:href=""#icon-WelcomeToPlayground""></use>
     </svg>
-    <p>In this web sandbox, you can deploy, edit and test business network definitions. Have a play and learn what Hyperledger Composer is all about.
+    <p>In this web sandbox, you can deploy, edit and test business network definitions. Have a play and learn what {{ config.banner.join(' ') }} is all about.
     </p>
   </section>
   <footer>
     <button id=""welcome_start"" type=""button"" class=""primary centre"" (click)=""activeModal.close();"">
       <span>Let's Blockchain!</span>
     </button>
-    <tutorial-link></tutorial-link>
+    <div *ngIf=""config.links && config.links.tutorial"" >
+      <tutorial-link [links]=""config.links.tutorial""></tutorial-link>
+    </div>",,2017-11-23 15:11:19,https://api.github.com/repos/hyperledger/composer/pulls/comments/152252477,https://github.com/hyperledger/composer/pull/2732#discussion_r152252477,jt-nti
https://github.com/hyperledger/composer/pull/2732,https://github.com/hyperledger/composer/pull/2732,No condition on there being an install link?,f5fed1209b7827edb2246a96d199ce36e75da027,2017-11-21 12:52:03,152265627,"@@ -19,7 +19,7 @@
                 </ul>
                 <ul *ngIf=""!showHeaderLinks && !usingLocally"" class=""links navright"">
                     <li>
-                        <a href=""https://hyperledger.github.io/composer/installing/installing-index.html""
+                        <a href=""{{ localInstallLink }}""",,2017-11-23 15:11:19,https://api.github.com/repos/hyperledger/composer/pulls/comments/152265627,https://github.com/hyperledger/composer/pull/2732#discussion_r152265627,jt-nti
https://github.com/hyperledger/composer/pull/2732,https://github.com/hyperledger/composer/pull/2732,I left these blank was as there was a small delay between getting the config data and the pages initial load meaning it would show Hyperledger Composer Playground in the banner for a while then change to the custom configured version if the defaults were set there,f5fed1209b7827edb2246a96d199ce36e75da027,2017-11-21 13:37:10,152276120,"@@ -46,7 +47,10 @@ export class AppComponent implements OnInit, OnDestroy {
     private showWelcome = true;
     private dropListActive = false;
 
-    private composerBanner = ['Hyperledger', 'Composer Playground'];
+    private config;
+
+    private composerBanner: Array<string> = ['', ''];
+    private localInstallLink: string = '';",,2017-11-23 15:11:19,https://api.github.com/repos/hyperledger/composer/pulls/comments/152276120,https://github.com/hyperledger/composer/pull/2732#discussion_r152276120,awjh-ibm
https://github.com/hyperledger/composer/pull/2725,https://github.com/hyperledger/composer/pull/2725,Typo in _carrd_,30fbc78dc2f11c271ef2c8f72b79bf49a3327ece,2017-11-15 11:48:47,151104540,"@@ -928,22 +932,36 @@ class AdminConnection {
      *     // Add optional error handling here.
      * });
      *
-     * @param {string} connectionProfile Name of the connection profile
-     * @param {string} enrollmentID The ID to enroll
-     * @param {string} enrollmentSecret The secret for the ID
+     * @param {string} cardName Name of the carrd to use",,2017-11-15 13:53:03,https://api.github.com/repos/hyperledger/composer/pulls/comments/151104540,https://github.com/hyperledger/composer/pull/2725#discussion_r151104540,bestbeforetoday
https://github.com/hyperledger/composer/pull/2725,https://github.com/hyperledger/composer/pull/2725,Commented out code,30fbc78dc2f11c271ef2c8f72b79bf49a3327ece,2017-11-15 11:52:57,151105353,"@@ -39,14 +41,18 @@ describe('composer identity request CLI unit tests', () => {
 
     beforeEach(() => {
         sandbox = sinon.sandbox.create();
+        testCard = new IdCard({ userName: 'SuccessKid' , businessNetwork :'penguin-network',enrollmentSecret:'humbolt'}, {type:'embedded', name: 'myprofile' });
+        testCard.setCredentials({certificate:'cert',privateKey:'nottelling'});
+        store.put('cardName',testCard);
+        //mockAdminConnection = new Client.AdminConnection({cardStore:store});",,2017-11-15 13:53:03,https://api.github.com/repos/hyperledger/composer/pulls/comments/151105353,https://github.com/hyperledger/composer/pull/2725#discussion_r151105353,bestbeforetoday
https://github.com/hyperledger/composer/pull/2725,https://github.com/hyperledger/composer/pull/2725,Does not return a Promise so don't need to extend the promise chain for this call.,30fbc78dc2f11c271ef2c8f72b79bf49a3327ece,2017-11-15 11:54:30,151105628,"@@ -928,22 +932,36 @@ class AdminConnection {
      *     // Add optional error handling here.
      * });
      *
-     * @param {string} connectionProfile Name of the connection profile
-     * @param {string} enrollmentID The ID to enroll
-     * @param {string} enrollmentSecret The secret for the ID
+     * @param {string} cardName Name of the carrd to use
+     * @param {string} [enrollmentID] The ID to enroll
+     * @param {string} [enrollmentSecret] The secret for the ID
      * @returns {Promise} A promise which is resolved when the identity is imported
+     * @deprecated
      * @private
      */
-    requestIdentity(connectionProfile, enrollmentID, enrollmentSecret) {
-        let savedConnectionManager;
-        return this.connectionProfileManager.getConnectionManager(connectionProfile)
-            .then((connectionManager) => {
-                savedConnectionManager = connectionManager;
-                return this.getProfile(connectionProfile);
-            })
-            .then((profileData) => {
-                return savedConnectionManager.requestIdentity(connectionProfile, profileData, enrollmentID, enrollmentSecret);
-            })
+    requestIdentity(cardName, enrollmentID, enrollmentSecret) {
+        let connectionProfileData;
+        let card;
+        return this.cardStore.get(cardName)
+          .then((result)=>{
+              card = result;
+              return card.getConnectionProfile();",,2017-11-15 13:53:03,https://api.github.com/repos/hyperledger/composer/pulls/comments/151105628,https://github.com/hyperledger/composer/pull/2725#discussion_r151105628,bestbeforetoday
https://github.com/hyperledger/composer/pull/2725,https://github.com/hyperledger/composer/pull/2725,Lots of code duplication with previous test. Can it be extracted out to a either a `beforeEach` or a utility function?,30fbc78dc2f11c271ef2c8f72b79bf49a3327ece,2017-11-15 12:01:41,151106942,"@@ -604,23 +604,66 @@ describe('AdminConnection', () => {
 
     describe('#requestIdentity', () => {
         it('should be able to request an identity', () => {
-            mockConnectionManager.importIdentity = sinon.stub();
+            mockConnectionManager.requestIdentity.resolves({
+                certificate: 'a',
+                key: 'b',
+                rootCertificate: 'c',
+                caName: 'caName',
+                enrollId : 'fred'
+            });
             adminConnection.connection = mockConnection;
             adminConnection.securityContext = mockSecurityContext;
-            return adminConnection.requestIdentity(testProfileName, 'id', 'secret')
+            let cardStub = sinon.createStubInstance(IdCard);
+            let cp = config;
+            cp.name=testProfileName;
+            cardStub.getConnectionProfile.returns(cp);
+            cardStub.getUserName.returns('fred');
+            cardStub.getBusinessNetworkName.returns('network');
+            cardStub.getCredentials.returns({});
+            cardStub.getEnrollmentCredentials.returns({secret:'password'});
+            cardStore.put('testCardname',cardStub);
+
+            return adminConnection.requestIdentity('testCardname', 'id', 'secret')
                 .then(() => {
                     sinon.assert.calledOnce(mockConnectionManager.requestIdentity);
                     sinon.assert.calledWith(mockConnectionManager.requestIdentity, testProfileName, config, 'id', 'secret');
                 });
         });
 
+        it('should be able to request an identity with id and secret from the card', () => {
+            mockConnectionManager.requestIdentity.resolves({",,2017-11-15 13:53:03,https://api.github.com/repos/hyperledger/composer/pulls/comments/151106942,https://github.com/hyperledger/composer/pull/2725#discussion_r151106942,bestbeforetoday
https://github.com/hyperledger/composer/pull/2725,https://github.com/hyperledger/composer/pull/2725,"removed...
",30fbc78dc2f11c271ef2c8f72b79bf49a3327ece,2017-11-15 12:34:19,151113188,"@@ -39,14 +41,18 @@ describe('composer identity request CLI unit tests', () => {
 
     beforeEach(() => {
         sandbox = sinon.sandbox.create();
+        testCard = new IdCard({ userName: 'SuccessKid' , businessNetwork :'penguin-network',enrollmentSecret:'humbolt'}, {type:'embedded', name: 'myprofile' });
+        testCard.setCredentials({certificate:'cert',privateKey:'nottelling'});
+        store.put('cardName',testCard);
+        //mockAdminConnection = new Client.AdminConnection({cardStore:store});",,2017-11-15 13:53:03,https://api.github.com/repos/hyperledger/composer/pulls/comments/151113188,https://github.com/hyperledger/composer/pull/2725#discussion_r151113188,mbwhite
https://github.com/hyperledger/composer/pull/2725,https://github.com/hyperledger/composer/pull/2725,...extracted...,30fbc78dc2f11c271ef2c8f72b79bf49a3327ece,2017-11-15 12:34:28,151113209,"@@ -604,23 +604,66 @@ describe('AdminConnection', () => {
 
     describe('#requestIdentity', () => {
         it('should be able to request an identity', () => {
-            mockConnectionManager.importIdentity = sinon.stub();
+            mockConnectionManager.requestIdentity.resolves({
+                certificate: 'a',
+                key: 'b',
+                rootCertificate: 'c',
+                caName: 'caName',
+                enrollId : 'fred'
+            });
             adminConnection.connection = mockConnection;
             adminConnection.securityContext = mockSecurityContext;
-            return adminConnection.requestIdentity(testProfileName, 'id', 'secret')
+            let cardStub = sinon.createStubInstance(IdCard);
+            let cp = config;
+            cp.name=testProfileName;
+            cardStub.getConnectionProfile.returns(cp);
+            cardStub.getUserName.returns('fred');
+            cardStub.getBusinessNetworkName.returns('network');
+            cardStub.getCredentials.returns({});
+            cardStub.getEnrollmentCredentials.returns({secret:'password'});
+            cardStore.put('testCardname',cardStub);
+
+            return adminConnection.requestIdentity('testCardname', 'id', 'secret')
                 .then(() => {
                     sinon.assert.calledOnce(mockConnectionManager.requestIdentity);
                     sinon.assert.calledWith(mockConnectionManager.requestIdentity, testProfileName, config, 'id', 'secret');
                 });
         });
 
+        it('should be able to request an identity with id and secret from the card', () => {
+            mockConnectionManager.requestIdentity.resolves({",,2017-11-15 13:53:03,https://api.github.com/repos/hyperledger/composer/pulls/comments/151113209,https://github.com/hyperledger/composer/pull/2725#discussion_r151113209,mbwhite
https://github.com/hyperledger/composer/pull/2725,https://github.com/hyperledger/composer/pull/2725,... force of habbit... gone.,30fbc78dc2f11c271ef2c8f72b79bf49a3327ece,2017-11-15 12:34:45,151113267,"@@ -928,22 +932,36 @@ class AdminConnection {
      *     // Add optional error handling here.
      * });
      *
-     * @param {string} connectionProfile Name of the connection profile
-     * @param {string} enrollmentID The ID to enroll
-     * @param {string} enrollmentSecret The secret for the ID
+     * @param {string} cardName Name of the carrd to use
+     * @param {string} [enrollmentID] The ID to enroll
+     * @param {string} [enrollmentSecret] The secret for the ID
      * @returns {Promise} A promise which is resolved when the identity is imported
+     * @deprecated
      * @private
      */
-    requestIdentity(connectionProfile, enrollmentID, enrollmentSecret) {
-        let savedConnectionManager;
-        return this.connectionProfileManager.getConnectionManager(connectionProfile)
-            .then((connectionManager) => {
-                savedConnectionManager = connectionManager;
-                return this.getProfile(connectionProfile);
-            })
-            .then((profileData) => {
-                return savedConnectionManager.requestIdentity(connectionProfile, profileData, enrollmentID, enrollmentSecret);
-            })
+    requestIdentity(cardName, enrollmentID, enrollmentSecret) {
+        let connectionProfileData;
+        let card;
+        return this.cardStore.get(cardName)
+          .then((result)=>{
+              card = result;
+              return card.getConnectionProfile();",,2017-11-15 13:53:03,https://api.github.com/repos/hyperledger/composer/pulls/comments/151113267,https://github.com/hyperledger/composer/pull/2725#discussion_r151113267,mbwhite
https://github.com/hyperledger/composer/pull/2725,https://github.com/hyperledger/composer/pull/2725,no idea why these are there... however this will be going in in after the import card changes... so shouldn't be an issue... ,30fbc78dc2f11c271ef2c8f72b79bf49a3327ece,2017-11-15 12:35:20,151113352,"@@ -928,22 +932,36 @@ class AdminConnection {
      *     // Add optional error handling here.
      * });
      *
-     * @param {string} connectionProfile Name of the connection profile
-     * @param {string} enrollmentID The ID to enroll
-     * @param {string} enrollmentSecret The secret for the ID
+     * @param {string} cardName Name of the carrd to use",,2017-11-15 13:53:03,https://api.github.com/repos/hyperledger/composer/pulls/comments/151113352,https://github.com/hyperledger/composer/pull/2725#discussion_r151113352,mbwhite
https://github.com/hyperledger/composer/pull/2725,https://github.com/hyperledger/composer/pull/2725,"Just to clarify, **card** only has one **r** in it. **Carrd** is spelled incorrectly.",30fbc78dc2f11c271ef2c8f72b79bf49a3327ece,2017-11-15 13:29:01,151124872,"@@ -928,22 +932,36 @@ class AdminConnection {
      *     // Add optional error handling here.
      * });
      *
-     * @param {string} connectionProfile Name of the connection profile
-     * @param {string} enrollmentID The ID to enroll
-     * @param {string} enrollmentSecret The secret for the ID
+     * @param {string} cardName Name of the carrd to use",,2017-11-15 13:53:03,https://api.github.com/repos/hyperledger/composer/pulls/comments/151124872,https://github.com/hyperledger/composer/pull/2725#discussion_r151124872,bestbeforetoday
https://github.com/hyperledger/composer/pull/2724,https://github.com/hyperledger/composer/pull/2724,should this not be `it('blah ...' )` so that it runs now?,15dc8476071754491e60b52411f37fce03e31a3e,2017-11-15 11:00:01,151094700,"@@ -647,30 +706,55 @@ const bfs_fs = BrowserFS.BFSRequire('fs');
 
         describe('Filter include:resolve', () => {
 
-            xit('should return a single fully resolved Resource', () => {
+            it('should return a single fully resolved Resource', () => {
                 return chai.request(app)
                 .get(`/api/${prefix}BondAsset?filter={""where"":{""ISINCode"":""ISIN_1""}, ""include"":""resolve""}`)
                 .then((res) => {
                     res.should.be.json;
                     res.should.have.status(200);
-                    // TODO : Assert fully resolved (includes Issuer)
+                    res.body.should.be.a('array');
+                    res.body.should.have.length(1);
+                    res.body[0].bond.issuer.should.deep.equal(participants[0]);
                 });
             });
 
-            xit('should return multiple fully resolved Resources', () => {
+            it('should return multiple fully resolved Resources', () => {
                 return chai.request(app)
-                .get(`/api/${prefix}BondAsset?filter={""where"":{""ISINCode"":{""between"":[""ISIN_1"", ""ISIN_3""]}}}, ""include"":""resolve""}`)
+                .get(`/api/${prefix}BondAsset?filter={""where"":{""ISINCode"":{""between"":[""ISIN_1"", ""ISIN_3""]}}, ""include"":""resolve""}`)
                 .then((res) => {
                     res.should.be.json;
                     res.should.have.status(200);
-                    // TODO : Assert all fully resolved (includes Issuer)
+                    res.body.should.be.a('array');
+                    res.body.should.have.length(3);
+                    res.body[0].bond.issuer.should.deep.equal(participants[0]);
+                    res.body[1].bond.issuer.should.deep.equal(participants[1]);
+                    res.body[2].bond.issuer.should.deep.equal(participants[2]);
                 });
             });
 
-            xit('should handle missing reference in resolve process of single Resource', () => {
+            it('should return the missing reference as a string value in resolve process of single Resource', () => {
+                return chai.request(app)
+                .get(`/api/${prefix}BondAsset?filter={""where"":{""ISINCode"":""ISIN_5""}, ""include"":""resolve""}`)
+                .then((res) => {
+                    res.should.be.json;
+                    res.should.have.status(200);
+                    res.body.should.be.a('array');
+                    res.body.should.have.length(1);
+                    res.body[0].should.deep.equal(assetData[4]);
+                });
             });
 
-            xit('should handle missing reference in resolve process of multiple Resources', () => {
+            xit('should return missing references with string values as they are not resolved for multiple Resources', () => {",,2017-11-15 15:45:11,https://api.github.com/repos/hyperledger/composer/pulls/comments/151094700,https://github.com/hyperledger/composer/pull/2724#discussion_r151094700,nklincoln
https://github.com/hyperledger/composer/pull/2717,https://github.com/hyperledger/composer/pull/2717,unstable?,3ecdb9068af9fe5b487bd41af717d974cff4c919,2017-11-15 11:35:04,151101752,"@@ -3,7 +3,7 @@
 {% if page.index-order %}
 {% capture mods %}{{ page.index-order | modulo:100 }}{% endcapture %}
 {% if mods == ""0"" and page.exception == nil %}
-- [{{ page.title }}](..{{page.url}}.html)
+- [<b>{{ page.title }}</b><img src=""/composer/unstable/assets/img/chevron-left.svg"" class=""caret"">](..{{page.url}}.html)",,2017-11-15 16:23:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/151101752,https://github.com/hyperledger/composer/pull/2717#discussion_r151101752,nklincoln
https://github.com/hyperledger/composer/pull/2717,https://github.com/hyperledger/composer/pull/2717,delete?,3ecdb9068af9fe5b487bd41af717d974cff4c919,2017-11-15 11:35:31,151101842,"@@ -124,20 +124,20 @@ $callout: #FFD640;
               top: 0;
               right: 0px;
               bottom: 0;
-              width: 2px;
+              // width: 2px;
               background-color: $first-highlight;
           }
         }
         &.active {
           height: auto !important;
-          border-left-color: $first-highlight;
+          border-left-color: $black;
           &:after {
               content: "" "";
               position: absolute;
               top: 0;
               right: 0px;
               bottom: 0;
-              width: 2px;
+              // width: 2px;",,2017-11-15 16:23:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/151101842,https://github.com/hyperledger/composer/pull/2717#discussion_r151101842,nklincoln
https://github.com/hyperledger/composer/pull/2717,https://github.com/hyperledger/composer/pull/2717,delete?,3ecdb9068af9fe5b487bd41af717d974cff4c919,2017-11-15 11:35:47,151101896,"@@ -167,7 +166,7 @@ $callout: #FFD640;
                 top: 0;
                 right: 0px;
                 bottom: 0;
-                width: 2px;
+                // width: 2px;",,2017-11-15 16:23:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/151101896,https://github.com/hyperledger/composer/pull/2717#discussion_r151101896,nklincoln
https://github.com/hyperledger/composer/pull/2717,https://github.com/hyperledger/composer/pull/2717,delete?,3ecdb9068af9fe5b487bd41af717d974cff4c919,2017-11-15 11:36:20,151102009,"@@ -124,20 +124,20 @@ $callout: #FFD640;
               top: 0;
               right: 0px;
               bottom: 0;
-              width: 2px;
+              // width: 2px;",,2017-11-15 16:23:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/151102009,https://github.com/hyperledger/composer/pull/2717#discussion_r151102009,nklincoln
https://github.com/hyperledger/composer/pull/2707,https://github.com/hyperledger/composer/pull/2707,carrd?,ee7c0bda72e3fc614d224de8c93671342de9ba5e,2017-11-15 12:07:43,151108037,"@@ -928,22 +928,36 @@ class AdminConnection {
      *     // Add optional error handling here.
      * });
      *
-     * @param {string} connectionProfile Name of the connection profile
-     * @param {string} enrollmentID The ID to enroll
-     * @param {string} enrollmentSecret The secret for the ID
+     * @param {string} cardName Name of the carrd to use",,2017-11-15 13:03:07,https://api.github.com/repos/hyperledger/composer/pulls/comments/151108037,https://github.com/hyperledger/composer/pull/2707#discussion_r151108037,sstone1
https://github.com/hyperledger/composer/pull/2704,https://github.com/hyperledger/composer/pull/2704,looks like something odd has creeped in.,62e4ca574ba4c3877e44467c7a909448d744e61b,2017-11-14 11:20:09,150805234,"@@ -966,3 +966,4 @@ class AdminConnection {
 }
 
 module.exports = AdminConnection;
+undefined;",,2017-11-14 14:22:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/150805234,https://github.com/hyperledger/composer/pull/2704#discussion_r150805234,davidkel
https://github.com/hyperledger/composer/pull/2704,https://github.com/hyperledger/composer/pull/2704,comment said -C rather than 'e' ? do we also need to update the docs ? probably easier to do it here rather than get ed to change.,62e4ca574ba4c3877e44467c7a909448d744e61b,2017-11-14 11:21:23,150805510,"@@ -21,7 +21,7 @@ module.exports.describe = 'Bind an existing identity to a participant in a parti
 module.exports.builder = {
     card: {alias: 'c', required: true, describe: 'Name of the network card to use', type: 'string'},
     participantId: { alias: 'a', required: true, describe: 'The particpant to issue the new identity to', type: 'string' },
-    certificateFile: { alias: 'c', required: true, describe: 'File containing the certificate', type: 'string' }
+    certificateFile: { alias: 'e', required: true, describe: 'File containing the certificate', type: 'string' }",5,2017-11-14 14:22:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/150805510,https://github.com/hyperledger/composer/pull/2704#discussion_r150805510,davidkel
https://github.com/hyperledger/composer/pull/2704,https://github.com/hyperledger/composer/pull/2704,"quick question I thought about over the weekend was what happens if I do an import and the card already exists, so looks like this used to reject it, but now it replaces it ? If that is the case I wonder if we should display some sort of warning ?",62e4ca574ba4c3877e44467c7a909448d744e61b,2017-11-14 11:24:48,150806253,"@@ -37,17 +37,11 @@ class Import {
             cardToImport = card;
             cardName = args.name || cmdUtil.getDefaultCardName(card);
             adminConnection = cmdUtil.createAdminConnection();
-            return adminConnection.exportCard(cardName);
-        }).then(existingCard => {
-            if (existingCard) {
-                throw new Error('Card already exists: ' + cardName);
-            }
             return adminConnection.importCard(cardName, cardToImport);",,2017-11-14 14:22:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/150806253,https://github.com/hyperledger/composer/pull/2704#discussion_r150806253,davidkel
https://github.com/hyperledger/composer/pull/2692,https://github.com/hyperledger/composer/pull/2692,Is it the path and not the fully qualified filename ? otherwise are we saying it has to be called connection.json ?,dfe9131bda6afc49aaec588bb3cb6e715d2540fa,2017-11-13 09:01:01,150476922,"@@ -42,7 +48,7 @@ module.exports.builder = function (yargs) {
     yargs.options({
         file: {alias: 'f', required: false, describe: 'File name of the card archive to be created', type: 'string' },
         businessNetworkName: {alias: 'n', required: false, describe: 'The business network name', type: 'string' },
-        connectionProfileFile: {alias: 'p', required: true, describe: 'Filename of the connection profile json file', type: 'string' },
+        connectionProfileFile: {alias: 'p', required: true, describe: 'Path of the connection profile json file', type: 'string' },",,2017-11-13 14:46:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/150476922,https://github.com/hyperledger/composer/pull/2692#discussion_r150476922,davidkel
https://github.com/hyperledger/composer/pull/2692,https://github.com/hyperledger/composer/pull/2692,"static member, so this won't be correct here",dfe9131bda6afc49aaec588bb3cb6e715d2540fa,2017-11-13 09:02:58,150477283,"@@ -47,7 +59,7 @@ class CmdUtil {
             if (fs.existsSync(argv.optionsFile)) {
                 mergedOptions = JSON.parse(fs.readFileSync(argv.optionsFile));
             } else {
-                console.log('WARNING: options file ' + argv.optionsFile + ' specified, but wasn\'t found');
+                this.log('WARNING: options file ' + argv.optionsFile + ' specified, but wasn\'t found');",,2017-11-13 14:46:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/150477283,https://github.com/hyperledger/composer/pull/2692#discussion_r150477283,davidkel
https://github.com/hyperledger/composer/pull/2692,https://github.com/hyperledger/composer/pull/2692,this probably shouldn't be in the code.,dfe9131bda6afc49aaec588bb3cb6e715d2540fa,2017-11-13 09:03:46,150477451,"@@ -17,20 +17,26 @@
 const Create = require ('./lib/create.js');
 const checkFn = (argv,options)=>{
 
-
-    if (!argv.s){
+    if (!argv.enrollSecret){
+        console.log(argv);",,2017-11-13 14:46:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/150477451,https://github.com/hyperledger/composer/pull/2692#discussion_r150477451,davidkel
https://github.com/hyperledger/composer/pull/2692,https://github.com/hyperledger/composer/pull/2692,It was a topic of discussion with Ed.  but it should be FIlename.,dfe9131bda6afc49aaec588bb3cb6e715d2540fa,2017-11-13 09:22:22,150481857,"@@ -42,7 +48,7 @@ module.exports.builder = function (yargs) {
     yargs.options({
         file: {alias: 'f', required: false, describe: 'File name of the card archive to be created', type: 'string' },
         businessNetworkName: {alias: 'n', required: false, describe: 'The business network name', type: 'string' },
-        connectionProfileFile: {alias: 'p', required: true, describe: 'Filename of the connection profile json file', type: 'string' },
+        connectionProfileFile: {alias: 'p', required: true, describe: 'Path of the connection profile json file', type: 'string' },",,2017-11-13 14:46:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/150481857,https://github.com/hyperledger/composer/pull/2692#discussion_r150481857,mbwhite
https://github.com/hyperledger/composer/pull/2692,https://github.com/hyperledger/composer/pull/2692,Changed... seemed to work - but you're right. ,dfe9131bda6afc49aaec588bb3cb6e715d2540fa,2017-11-13 09:22:41,150481915,"@@ -47,7 +59,7 @@ class CmdUtil {
             if (fs.existsSync(argv.optionsFile)) {
                 mergedOptions = JSON.parse(fs.readFileSync(argv.optionsFile));
             } else {
-                console.log('WARNING: options file ' + argv.optionsFile + ' specified, but wasn\'t found');
+                this.log('WARNING: options file ' + argv.optionsFile + ' specified, but wasn\'t found');",,2017-11-13 14:46:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/150481915,https://github.com/hyperledger/composer/pull/2692#discussion_r150481915,mbwhite
https://github.com/hyperledger/composer/pull/2692,https://github.com/hyperledger/composer/pull/2692,Gone.. replaced with the yargs.implies.,dfe9131bda6afc49aaec588bb3cb6e715d2540fa,2017-11-13 09:22:52,150481970,"@@ -17,20 +17,26 @@
 const Create = require ('./lib/create.js');
 const checkFn = (argv,options)=>{
 
-
-    if (!argv.s){
+    if (!argv.enrollSecret){
+        console.log(argv);",,2017-11-13 14:46:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/150481970,https://github.com/hyperledger/composer/pull/2692#discussion_r150481970,mbwhite
https://github.com/hyperledger/composer/pull/2692,https://github.com/hyperledger/composer/pull/2692,Strange name for a method that isn't handling null anymore,dfe9131bda6afc49aaec588bb3cb6e715d2540fa,2017-11-13 10:53:56,150504266,"@@ -115,9 +127,7 @@ class List {
      */
     static handleNull(o){",,2017-11-13 14:46:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/150504266,https://github.com/hyperledger/composer/pull/2692#discussion_r150504266,davidkel
https://github.com/hyperledger/composer/pull/2692,https://github.com/hyperledger/composer/pull/2692,"probably should check if spinner isn't null, before calling fail. as there is a point where if an exception is thrown spinner hasn't been defined.",dfe9131bda6afc49aaec588bb3cb6e715d2540fa,2017-11-13 10:56:36,150504950,"@@ -64,6 +68,15 @@ class IssueCard {
 
                 // re-use the logic in the create command to create the id card
                 return Create.createCard(metadata,issuingCard.getConnectionProfile(),argv);
+            })
+            .then((fileName)=>{
+                spinner.succeed();
+                cmdUtil.log(chalk.blue.bold('\nSuccessfully created business network card file to '));
+                cmdUtil.log(chalk.blue('\tOutput file: ')+fileName);
+            })
+            .catch((error) => {
+                spinner.fail();",,2017-11-13 14:46:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/150504950,https://github.com/hyperledger/composer/pull/2692#discussion_r150504950,davidkel
https://github.com/hyperledger/composer/pull/2692,https://github.com/hyperledger/composer/pull/2692,"just checking that although the comment says enforce and the function says requiresArg, it doesn't mean loglevel is a required argument, but I am not sure what this is doing.",dfe9131bda6afc49aaec588bb3cb6e715d2540fa,2017-11-13 10:58:17,150505362,"@@ -27,15 +27,19 @@ module.exports.builder = function (yargs) {
         networkAdmin: { alias: 'A', required: true, description: 'The identity name of the business network administrator', type: 'string' },
         networkAdminCertificateFile: { alias: 'C', required: false, description: 'The certificate of the business network administrator', type: 'string' },
         networkAdminEnrollSecret: { alias: 'S', required: false, description: 'The enrollment secret for the business network administrator', type: 'string' },
-        card: { alias: 'c', required: false, description: 'The cardname to use to deploy the network', type:'string'},
+        card: { alias: 'c', required: true, description: 'The cardname to use to deploy the network', type:'string'},
         file: { alias: 'f', required: false, description: 'File name of the card to be created', type: 'string'}
     });
 
     // enforce the option after these options
-    yargs.requiresArg(['file','archiveFile','networkAdmin','networkAdminCertificateFile','networkAdminEnrollSecret','card']);
+    yargs.requiresArg(['loglevel','file','archiveFile','networkAdmin','networkAdminCertificateFile','networkAdminEnrollSecret','card']);",,2017-11-13 14:46:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/150505362,https://github.com/hyperledger/composer/pull/2692#discussion_r150505362,davidkel
https://github.com/hyperledger/composer/pull/2690,https://github.com/hyperledger/composer/pull/2690,A table for the command-line looks a bit weird to me; I preferred the string versions used below as that's how commands look when I type them in.,db1ee32009d092832e485056def78c561e841ee7,2017-11-17 15:04:41,151705954,"@@ -0,0 +1,57 @@
+Feature: Cli steps
+
+    Background:
+        Given I have generated crypto material
+
+    Scenario: Using the CLI, I can create a business network card
+        Given I have the following items
+            | ../hlfv1/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/signcerts |
+            | ../hlfv1/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/keystore |
+            | ../profiles/basic-connection-org1.json |
+        When I run the following CLI command
+            | command | composer card create |",12,2017-11-17 17:37:43,https://api.github.com/repos/hyperledger/composer/pulls/comments/151705954,https://github.com/hyperledger/composer/pull/2690#discussion_r151705954,bestbeforetoday
https://github.com/hyperledger/composer/pull/2690,https://github.com/hyperledger/composer/pull/2690,Not a show-stopper but I no likey `s` as a variable name. `socket` would be clearer to me.,db1ee32009d092832e485056def78c561e841ee7,2017-11-17 15:06:52,151706495,"@@ -0,0 +1,358 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+const IdCard = require('composer-common').IdCard;
+const net = require('net');
+const path = require('path');
+const sleep = require('sleep-promise');
+const fs = require('fs');
+const childProcess = require('child_process');
+
+let generated = false;
+
+/**
+ * Trick browserify by making the ID parameter to require dynamic.
+ * @param {string} id The module ID.
+ * @return {*} The module.
+ */
+function dynamicRequire(id) {
+    return require(id);
+}
+
+/**
+ * A class that handles all of the interactions with a business network for
+ * a currently executing Cucumber scenario and steps.
+ */
+class Composer {
+
+    /**
+     * Constructor.
+     * @param {string} uri The URI of the currently executing Cucumber scenario.
+     * @param {boolean} errorExpected Is an error expected in this Cucumber scenario?
+     */
+    constructor(uri, errorExpected) {
+        this.uri = uri;
+        this.errorExpected = errorExpected;
+        this.error = null;
+        this.lastResp = null;
+    }
+
+    /**
+     * Check to see if running in Hyperledger Fabric mode.
+     * @return {boolean} True if running in Hyperledger Fabric mode, false if not.
+     */
+    static isHyperledgerFabricV1() {
+        return process.env.INTEST && process.env.INTEST.match('^hlfv1.*');
+    }
+
+    /**
+     * Wait for the specified hostname to start listening on the specified port.
+     * @param {string} hostname - the hostname.
+     * @param {integer} port - the port.
+     * @return {Promise} - a promise that will be resolved when the specified
+     * hostname to start listening on the specified port.
+     */
+    static waitForPort(hostname, port) {
+        let waitTime = 30;
+        if (process.env.COMPOSER_PORT_WAIT_SECS) {
+            waitTime = parseInt(process.env.COMPOSER_PORT_WAIT_SECS);
+        }
+        return new Promise(function (resolve, reject) {
+            let testConnect = function (count) {
+                let s = new net.Socket();",,2017-11-17 17:37:43,https://api.github.com/repos/hyperledger/composer/pulls/comments/151706495,https://github.com/hyperledger/composer/pull/2690#discussion_r151706495,bestbeforetoday
https://github.com/hyperledger/composer/pull/2690,https://github.com/hyperledger/composer/pull/2690,"Technically this looks to be the maximum retry count (which happens to match the wait time since a timeout of 1 second is used), but meh...",db1ee32009d092832e485056def78c561e841ee7,2017-11-17 15:07:45,151706720,"@@ -0,0 +1,358 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+const IdCard = require('composer-common').IdCard;
+const net = require('net');
+const path = require('path');
+const sleep = require('sleep-promise');
+const fs = require('fs');
+const childProcess = require('child_process');
+
+let generated = false;
+
+/**
+ * Trick browserify by making the ID parameter to require dynamic.
+ * @param {string} id The module ID.
+ * @return {*} The module.
+ */
+function dynamicRequire(id) {
+    return require(id);
+}
+
+/**
+ * A class that handles all of the interactions with a business network for
+ * a currently executing Cucumber scenario and steps.
+ */
+class Composer {
+
+    /**
+     * Constructor.
+     * @param {string} uri The URI of the currently executing Cucumber scenario.
+     * @param {boolean} errorExpected Is an error expected in this Cucumber scenario?
+     */
+    constructor(uri, errorExpected) {
+        this.uri = uri;
+        this.errorExpected = errorExpected;
+        this.error = null;
+        this.lastResp = null;
+    }
+
+    /**
+     * Check to see if running in Hyperledger Fabric mode.
+     * @return {boolean} True if running in Hyperledger Fabric mode, false if not.
+     */
+    static isHyperledgerFabricV1() {
+        return process.env.INTEST && process.env.INTEST.match('^hlfv1.*');
+    }
+
+    /**
+     * Wait for the specified hostname to start listening on the specified port.
+     * @param {string} hostname - the hostname.
+     * @param {integer} port - the port.
+     * @return {Promise} - a promise that will be resolved when the specified
+     * hostname to start listening on the specified port.
+     */
+    static waitForPort(hostname, port) {
+        let waitTime = 30;",70,2017-11-17 17:37:43,https://api.github.com/repos/hyperledger/composer/pulls/comments/151706720,https://github.com/hyperledger/composer/pull/2690#discussion_r151706720,bestbeforetoday
https://github.com/hyperledger/composer/pull/2690,https://github.com/hyperledger/composer/pull/2690,Might be worth using `Promise.all()` here rather than wait for each promise to resolve sequentially.,db1ee32009d092832e485056def78c561e841ee7,2017-11-17 15:10:14,151707323,"@@ -0,0 +1,358 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+const IdCard = require('composer-common').IdCard;
+const net = require('net');
+const path = require('path');
+const sleep = require('sleep-promise');
+const fs = require('fs');
+const childProcess = require('child_process');
+
+let generated = false;
+
+/**
+ * Trick browserify by making the ID parameter to require dynamic.
+ * @param {string} id The module ID.
+ * @return {*} The module.
+ */
+function dynamicRequire(id) {
+    return require(id);
+}
+
+/**
+ * A class that handles all of the interactions with a business network for
+ * a currently executing Cucumber scenario and steps.
+ */
+class Composer {
+
+    /**
+     * Constructor.
+     * @param {string} uri The URI of the currently executing Cucumber scenario.
+     * @param {boolean} errorExpected Is an error expected in this Cucumber scenario?
+     */
+    constructor(uri, errorExpected) {
+        this.uri = uri;
+        this.errorExpected = errorExpected;
+        this.error = null;
+        this.lastResp = null;
+    }
+
+    /**
+     * Check to see if running in Hyperledger Fabric mode.
+     * @return {boolean} True if running in Hyperledger Fabric mode, false if not.
+     */
+    static isHyperledgerFabricV1() {
+        return process.env.INTEST && process.env.INTEST.match('^hlfv1.*');
+    }
+
+    /**
+     * Wait for the specified hostname to start listening on the specified port.
+     * @param {string} hostname - the hostname.
+     * @param {integer} port - the port.
+     * @return {Promise} - a promise that will be resolved when the specified
+     * hostname to start listening on the specified port.
+     */
+    static waitForPort(hostname, port) {
+        let waitTime = 30;
+        if (process.env.COMPOSER_PORT_WAIT_SECS) {
+            waitTime = parseInt(process.env.COMPOSER_PORT_WAIT_SECS);
+        }
+        return new Promise(function (resolve, reject) {
+            let testConnect = function (count) {
+                let s = new net.Socket();
+                s.on('error', function (error) {
+                    if (count > waitTime) {
+                        return reject(error);
+                    } else {
+                        setTimeout(function () {
+                            testConnect(count + 1);
+                        }, 1000);
+                    }
+                });
+                s.on('connect', function () {
+                    s.end();
+                    return resolve();
+                });
+                s.connect(port, hostname);
+            };
+            testConnect(0);
+        });
+    }
+
+    /**
+     * Wait for the peer on the specified hostname and port to start listening
+     * on the specified port.
+     * @return {Promise} - a promise that will be resolved when the peer has
+     * started listening on the specified port.
+     */
+    static waitForPorts() {
+        // startsWith not available in browser test environment
+        if (process.env.INTEST.match('^hlfv1')) {
+            return Promise.resolve();
+        }
+        return Composer.waitForPort('localhost', 7050)",,2017-11-17 17:37:43,https://api.github.com/repos/hyperledger/composer/pulls/comments/151707323,https://github.com/hyperledger/composer/pull/2690#discussion_r151707323,bestbeforetoday
https://github.com/hyperledger/composer/pull/2690,https://github.com/hyperledger/composer/pull/2690,"The value of `roles` should be an array. You might want `roles: [ 'PeerAdmin', 'ChannelAdmin' ]`. Nothing uses it today so it won't bite you until ""the future"".",db1ee32009d092832e485056def78c561e841ee7,2017-11-17 15:11:27,151707627,"@@ -0,0 +1,358 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+const IdCard = require('composer-common').IdCard;
+const net = require('net');
+const path = require('path');
+const sleep = require('sleep-promise');
+const fs = require('fs');
+const childProcess = require('child_process');
+
+let generated = false;
+
+/**
+ * Trick browserify by making the ID parameter to require dynamic.
+ * @param {string} id The module ID.
+ * @return {*} The module.
+ */
+function dynamicRequire(id) {
+    return require(id);
+}
+
+/**
+ * A class that handles all of the interactions with a business network for
+ * a currently executing Cucumber scenario and steps.
+ */
+class Composer {
+
+    /**
+     * Constructor.
+     * @param {string} uri The URI of the currently executing Cucumber scenario.
+     * @param {boolean} errorExpected Is an error expected in this Cucumber scenario?
+     */
+    constructor(uri, errorExpected) {
+        this.uri = uri;
+        this.errorExpected = errorExpected;
+        this.error = null;
+        this.lastResp = null;
+    }
+
+    /**
+     * Check to see if running in Hyperledger Fabric mode.
+     * @return {boolean} True if running in Hyperledger Fabric mode, false if not.
+     */
+    static isHyperledgerFabricV1() {
+        return process.env.INTEST && process.env.INTEST.match('^hlfv1.*');
+    }
+
+    /**
+     * Wait for the specified hostname to start listening on the specified port.
+     * @param {string} hostname - the hostname.
+     * @param {integer} port - the port.
+     * @return {Promise} - a promise that will be resolved when the specified
+     * hostname to start listening on the specified port.
+     */
+    static waitForPort(hostname, port) {
+        let waitTime = 30;
+        if (process.env.COMPOSER_PORT_WAIT_SECS) {
+            waitTime = parseInt(process.env.COMPOSER_PORT_WAIT_SECS);
+        }
+        return new Promise(function (resolve, reject) {
+            let testConnect = function (count) {
+                let s = new net.Socket();
+                s.on('error', function (error) {
+                    if (count > waitTime) {
+                        return reject(error);
+                    } else {
+                        setTimeout(function () {
+                            testConnect(count + 1);
+                        }, 1000);
+                    }
+                });
+                s.on('connect', function () {
+                    s.end();
+                    return resolve();
+                });
+                s.connect(port, hostname);
+            };
+            testConnect(0);
+        });
+    }
+
+    /**
+     * Wait for the peer on the specified hostname and port to start listening
+     * on the specified port.
+     * @return {Promise} - a promise that will be resolved when the peer has
+     * started listening on the specified port.
+     */
+    static waitForPorts() {
+        // startsWith not available in browser test environment
+        if (process.env.INTEST.match('^hlfv1')) {
+            return Promise.resolve();
+        }
+        return Composer.waitForPort('localhost', 7050)
+            .then(() => {
+                return Composer.waitForPort('localhost', 7051);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7052);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7053);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7054);
+            })
+            .then(() => {
+                return sleep(5000);
+            });
+    }
+
+    /**
+     * Creates crypto material
+     * @return {Promise} - a promise that will be resolved when crypto material is created or rejected with failure
+     */
+    setup() {
+        if(generated) {
+            return Promise.resolve();
+        } else {
+            const adminConnection = new AdminConnection();
+            return Composer.waitForPorts()
+            .then(() => {
+                if (Composer.isHyperledgerFabricV1()) {
+                    let fs = dynamicRequire('fs');
+                    const admins = [
+                        { org: 'org1', keyFile: 'key.pem', profile : 'org1-only' },
+                        { org: 'org2', keyFile: 'key.pem', profile : 'org2-only' },
+                        { org: 'org1', keyFile: 'key.pem', profile : 'org1' },
+                        { org: 'org2', keyFile: 'key.pem', profile : 'org2' }
+                    ];
+                    return admins.reduce((promise, admin) => {
+                        const org = admin.org;
+                        const prof = admin.profile;
+                        const keyFile = admin.keyFile;
+                        return promise.then(() => {
+                            let keyPath = path.join(__dirname, `../hlfv1/crypto-config/peerOrganizations/${org}.example.com/users/Admin@${org}.example.com/msp/keystore/${keyFile}`);
+                            let certPath = path.join(__dirname, `../hlfv1/crypto-config/peerOrganizations/${org}.example.com/users/Admin@${org}.example.com/msp/signcerts/Admin@${org}.example.com-cert.pem`);
+                            let cert = fs.readFileSync(certPath).toString();
+                            let key = fs.readFileSync(keyPath).toString();
+
+                            // set if the options have been given into the metadata
+                            let metadata = {
+                                version:1,
+                                userName : `TestPeerAdmin@${prof}`,
+                                roles : 'PeerAdmin',",,2017-11-17 17:37:43,https://api.github.com/repos/hyperledger/composer/pulls/comments/151707627,https://github.com/hyperledger/composer/pull/2690#discussion_r151707627,bestbeforetoday
https://github.com/hyperledger/composer/pull/2690,https://github.com/hyperledger/composer/pull/2690,You probably shouldn't be accessing `adminConnection.cardStore` directly. the recently added `AdminConnection.hasCard()` might be your friend.,db1ee32009d092832e485056def78c561e841ee7,2017-11-17 15:16:01,151708802,"@@ -0,0 +1,358 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+const IdCard = require('composer-common').IdCard;
+const net = require('net');
+const path = require('path');
+const sleep = require('sleep-promise');
+const fs = require('fs');
+const childProcess = require('child_process');
+
+let generated = false;
+
+/**
+ * Trick browserify by making the ID parameter to require dynamic.
+ * @param {string} id The module ID.
+ * @return {*} The module.
+ */
+function dynamicRequire(id) {
+    return require(id);
+}
+
+/**
+ * A class that handles all of the interactions with a business network for
+ * a currently executing Cucumber scenario and steps.
+ */
+class Composer {
+
+    /**
+     * Constructor.
+     * @param {string} uri The URI of the currently executing Cucumber scenario.
+     * @param {boolean} errorExpected Is an error expected in this Cucumber scenario?
+     */
+    constructor(uri, errorExpected) {
+        this.uri = uri;
+        this.errorExpected = errorExpected;
+        this.error = null;
+        this.lastResp = null;
+    }
+
+    /**
+     * Check to see if running in Hyperledger Fabric mode.
+     * @return {boolean} True if running in Hyperledger Fabric mode, false if not.
+     */
+    static isHyperledgerFabricV1() {
+        return process.env.INTEST && process.env.INTEST.match('^hlfv1.*');
+    }
+
+    /**
+     * Wait for the specified hostname to start listening on the specified port.
+     * @param {string} hostname - the hostname.
+     * @param {integer} port - the port.
+     * @return {Promise} - a promise that will be resolved when the specified
+     * hostname to start listening on the specified port.
+     */
+    static waitForPort(hostname, port) {
+        let waitTime = 30;
+        if (process.env.COMPOSER_PORT_WAIT_SECS) {
+            waitTime = parseInt(process.env.COMPOSER_PORT_WAIT_SECS);
+        }
+        return new Promise(function (resolve, reject) {
+            let testConnect = function (count) {
+                let s = new net.Socket();
+                s.on('error', function (error) {
+                    if (count > waitTime) {
+                        return reject(error);
+                    } else {
+                        setTimeout(function () {
+                            testConnect(count + 1);
+                        }, 1000);
+                    }
+                });
+                s.on('connect', function () {
+                    s.end();
+                    return resolve();
+                });
+                s.connect(port, hostname);
+            };
+            testConnect(0);
+        });
+    }
+
+    /**
+     * Wait for the peer on the specified hostname and port to start listening
+     * on the specified port.
+     * @return {Promise} - a promise that will be resolved when the peer has
+     * started listening on the specified port.
+     */
+    static waitForPorts() {
+        // startsWith not available in browser test environment
+        if (process.env.INTEST.match('^hlfv1')) {
+            return Promise.resolve();
+        }
+        return Composer.waitForPort('localhost', 7050)
+            .then(() => {
+                return Composer.waitForPort('localhost', 7051);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7052);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7053);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7054);
+            })
+            .then(() => {
+                return sleep(5000);
+            });
+    }
+
+    /**
+     * Creates crypto material
+     * @return {Promise} - a promise that will be resolved when crypto material is created or rejected with failure
+     */
+    setup() {
+        if(generated) {
+            return Promise.resolve();
+        } else {
+            const adminConnection = new AdminConnection();
+            return Composer.waitForPorts()
+            .then(() => {
+                if (Composer.isHyperledgerFabricV1()) {
+                    let fs = dynamicRequire('fs');
+                    const admins = [
+                        { org: 'org1', keyFile: 'key.pem', profile : 'org1-only' },
+                        { org: 'org2', keyFile: 'key.pem', profile : 'org2-only' },
+                        { org: 'org1', keyFile: 'key.pem', profile : 'org1' },
+                        { org: 'org2', keyFile: 'key.pem', profile : 'org2' }
+                    ];
+                    return admins.reduce((promise, admin) => {
+                        const org = admin.org;
+                        const prof = admin.profile;
+                        const keyFile = admin.keyFile;
+                        return promise.then(() => {
+                            let keyPath = path.join(__dirname, `../hlfv1/crypto-config/peerOrganizations/${org}.example.com/users/Admin@${org}.example.com/msp/keystore/${keyFile}`);
+                            let certPath = path.join(__dirname, `../hlfv1/crypto-config/peerOrganizations/${org}.example.com/users/Admin@${org}.example.com/msp/signcerts/Admin@${org}.example.com-cert.pem`);
+                            let cert = fs.readFileSync(certPath).toString();
+                            let key = fs.readFileSync(keyPath).toString();
+
+                            // set if the options have been given into the metadata
+                            let metadata = {
+                                version:1,
+                                userName : `TestPeerAdmin@${prof}`,
+                                roles : 'PeerAdmin',
+                            };
+
+                            let profile;
+                            if(process.env.INTEST.match('tls$')){
+                                let profilePath = path.join(__dirname, `../profiles/tls-connection-${prof}.json`);
+                                profile = fs.readFileSync(profilePath, 'utf8');
+                            } else {
+                                let profilePath = path.join(__dirname, `../profiles/basic-connection-${prof}.json`);
+                                profile = fs.readFileSync(profilePath, 'utf8');
+                            }
+
+                            let idCard = new IdCard(metadata, JSON.parse(profile));
+
+                            // certificates & privateKey
+                            const newCredentials = { };
+                            newCredentials.certificate = cert;
+                            newCredentials.privateKey =  key;
+
+                            idCard.setCredentials(newCredentials);
+                            let cardName = `TestPeerAdmin@${prof}`;
+
+                            this.containsCard(adminConnection, cardName)
+                            .then((exists) => {
+                                if(exists) {
+                                    console.log('skipping card import of existing card: ', cardName);
+                                    return Promise.resolve();
+                                } else {
+                                    console.log('importing card: ', cardName);
+                                    return adminConnection.importCard(cardName, idCard);
+                                }
+                            });
+                        });
+                    }, Promise.resolve());
+                }
+            })
+            .then(() => {
+                generated = true;
+                return Promise.resolve();
+            })
+            .catch((err) => {
+                return Promise.reject(err);
+            });
+        }
+    }
+
+    /**
+     * Check if card already exists
+     * @param {AdminConnection} adminConnection array of cards to check
+     * @param {string} cardName card to check for
+     * @returns {Promise} boolean true if card exists
+     */
+    containsCard(adminConnection, cardName) {
+        return adminConnection.cardStore.get(cardName)",,2017-11-17 17:37:43,https://api.github.com/repos/hyperledger/composer/pulls/comments/151708802,https://github.com/hyperledger/composer/pull/2690#discussion_r151708802,bestbeforetoday
https://github.com/hyperledger/composer/pull/2690,https://github.com/hyperledger/composer/pull/2690,Might be worth using `row.filter()` to find all the bad rows and rejecting with a message about all of them instead of just the first one.,db1ee32009d092832e485056def78c561e841ee7,2017-11-17 15:19:33,151709624,"@@ -0,0 +1,358 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+const IdCard = require('composer-common').IdCard;
+const net = require('net');
+const path = require('path');
+const sleep = require('sleep-promise');
+const fs = require('fs');
+const childProcess = require('child_process');
+
+let generated = false;
+
+/**
+ * Trick browserify by making the ID parameter to require dynamic.
+ * @param {string} id The module ID.
+ * @return {*} The module.
+ */
+function dynamicRequire(id) {
+    return require(id);
+}
+
+/**
+ * A class that handles all of the interactions with a business network for
+ * a currently executing Cucumber scenario and steps.
+ */
+class Composer {
+
+    /**
+     * Constructor.
+     * @param {string} uri The URI of the currently executing Cucumber scenario.
+     * @param {boolean} errorExpected Is an error expected in this Cucumber scenario?
+     */
+    constructor(uri, errorExpected) {
+        this.uri = uri;
+        this.errorExpected = errorExpected;
+        this.error = null;
+        this.lastResp = null;
+    }
+
+    /**
+     * Check to see if running in Hyperledger Fabric mode.
+     * @return {boolean} True if running in Hyperledger Fabric mode, false if not.
+     */
+    static isHyperledgerFabricV1() {
+        return process.env.INTEST && process.env.INTEST.match('^hlfv1.*');
+    }
+
+    /**
+     * Wait for the specified hostname to start listening on the specified port.
+     * @param {string} hostname - the hostname.
+     * @param {integer} port - the port.
+     * @return {Promise} - a promise that will be resolved when the specified
+     * hostname to start listening on the specified port.
+     */
+    static waitForPort(hostname, port) {
+        let waitTime = 30;
+        if (process.env.COMPOSER_PORT_WAIT_SECS) {
+            waitTime = parseInt(process.env.COMPOSER_PORT_WAIT_SECS);
+        }
+        return new Promise(function (resolve, reject) {
+            let testConnect = function (count) {
+                let s = new net.Socket();
+                s.on('error', function (error) {
+                    if (count > waitTime) {
+                        return reject(error);
+                    } else {
+                        setTimeout(function () {
+                            testConnect(count + 1);
+                        }, 1000);
+                    }
+                });
+                s.on('connect', function () {
+                    s.end();
+                    return resolve();
+                });
+                s.connect(port, hostname);
+            };
+            testConnect(0);
+        });
+    }
+
+    /**
+     * Wait for the peer on the specified hostname and port to start listening
+     * on the specified port.
+     * @return {Promise} - a promise that will be resolved when the peer has
+     * started listening on the specified port.
+     */
+    static waitForPorts() {
+        // startsWith not available in browser test environment
+        if (process.env.INTEST.match('^hlfv1')) {
+            return Promise.resolve();
+        }
+        return Composer.waitForPort('localhost', 7050)
+            .then(() => {
+                return Composer.waitForPort('localhost', 7051);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7052);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7053);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7054);
+            })
+            .then(() => {
+                return sleep(5000);
+            });
+    }
+
+    /**
+     * Creates crypto material
+     * @return {Promise} - a promise that will be resolved when crypto material is created or rejected with failure
+     */
+    setup() {
+        if(generated) {
+            return Promise.resolve();
+        } else {
+            const adminConnection = new AdminConnection();
+            return Composer.waitForPorts()
+            .then(() => {
+                if (Composer.isHyperledgerFabricV1()) {
+                    let fs = dynamicRequire('fs');
+                    const admins = [
+                        { org: 'org1', keyFile: 'key.pem', profile : 'org1-only' },
+                        { org: 'org2', keyFile: 'key.pem', profile : 'org2-only' },
+                        { org: 'org1', keyFile: 'key.pem', profile : 'org1' },
+                        { org: 'org2', keyFile: 'key.pem', profile : 'org2' }
+                    ];
+                    return admins.reduce((promise, admin) => {
+                        const org = admin.org;
+                        const prof = admin.profile;
+                        const keyFile = admin.keyFile;
+                        return promise.then(() => {
+                            let keyPath = path.join(__dirname, `../hlfv1/crypto-config/peerOrganizations/${org}.example.com/users/Admin@${org}.example.com/msp/keystore/${keyFile}`);
+                            let certPath = path.join(__dirname, `../hlfv1/crypto-config/peerOrganizations/${org}.example.com/users/Admin@${org}.example.com/msp/signcerts/Admin@${org}.example.com-cert.pem`);
+                            let cert = fs.readFileSync(certPath).toString();
+                            let key = fs.readFileSync(keyPath).toString();
+
+                            // set if the options have been given into the metadata
+                            let metadata = {
+                                version:1,
+                                userName : `TestPeerAdmin@${prof}`,
+                                roles : 'PeerAdmin',
+                            };
+
+                            let profile;
+                            if(process.env.INTEST.match('tls$')){
+                                let profilePath = path.join(__dirname, `../profiles/tls-connection-${prof}.json`);
+                                profile = fs.readFileSync(profilePath, 'utf8');
+                            } else {
+                                let profilePath = path.join(__dirname, `../profiles/basic-connection-${prof}.json`);
+                                profile = fs.readFileSync(profilePath, 'utf8');
+                            }
+
+                            let idCard = new IdCard(metadata, JSON.parse(profile));
+
+                            // certificates & privateKey
+                            const newCredentials = { };
+                            newCredentials.certificate = cert;
+                            newCredentials.privateKey =  key;
+
+                            idCard.setCredentials(newCredentials);
+                            let cardName = `TestPeerAdmin@${prof}`;
+
+                            this.containsCard(adminConnection, cardName)
+                            .then((exists) => {
+                                if(exists) {
+                                    console.log('skipping card import of existing card: ', cardName);
+                                    return Promise.resolve();
+                                } else {
+                                    console.log('importing card: ', cardName);
+                                    return adminConnection.importCard(cardName, idCard);
+                                }
+                            });
+                        });
+                    }, Promise.resolve());
+                }
+            })
+            .then(() => {
+                generated = true;
+                return Promise.resolve();
+            })
+            .catch((err) => {
+                return Promise.reject(err);
+            });
+        }
+    }
+
+    /**
+     * Check if card already exists
+     * @param {AdminConnection} adminConnection array of cards to check
+     * @param {string} cardName card to check for
+     * @returns {Promise} boolean true if card exists
+     */
+    containsCard(adminConnection, cardName) {
+        return adminConnection.cardStore.get(cardName)
+        .then((card)=>{
+            return Promise.resolve(true);
+        })
+        .catch((err) => {
+            return Promise.resolve(false);
+        });
+    }
+
+    /**
+     * Check that the provided list of items (files or folders) exist
+     * @param {String} type -  type (folder or file) that is being considered
+     * @param {DataTable} table -  DataTable listing the business networks expeted to exist
+     * @return {Promise} - Pomise that will be resolved or rejected with an error
+     */
+    checkExists(type, table) {
+        const rows = table.raw();
+        return new Promise((resolve, reject) => {
+            rows.forEach((row) => {",,2017-11-17 17:37:43,https://api.github.com/repos/hyperledger/composer/pulls/comments/151709624,https://github.com/hyperledger/composer/pull/2690#discussion_r151709624,bestbeforetoday
https://github.com/hyperledger/composer/pull/2690,https://github.com/hyperledger/composer/pull/2690,"Not sure if you'll hit any performance issues on string concatenation as they are immutable so create new strings each time. Logically fine but an alternative might be to build an array of output data and mash it all together into a string at the end if you need to. Mind you, I don't think Javascript arrays are super performant either, so who knows!",db1ee32009d092832e485056def78c561e841ee7,2017-11-17 15:27:03,151711515,"@@ -0,0 +1,358 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+const IdCard = require('composer-common').IdCard;
+const net = require('net');
+const path = require('path');
+const sleep = require('sleep-promise');
+const fs = require('fs');
+const childProcess = require('child_process');
+
+let generated = false;
+
+/**
+ * Trick browserify by making the ID parameter to require dynamic.
+ * @param {string} id The module ID.
+ * @return {*} The module.
+ */
+function dynamicRequire(id) {
+    return require(id);
+}
+
+/**
+ * A class that handles all of the interactions with a business network for
+ * a currently executing Cucumber scenario and steps.
+ */
+class Composer {
+
+    /**
+     * Constructor.
+     * @param {string} uri The URI of the currently executing Cucumber scenario.
+     * @param {boolean} errorExpected Is an error expected in this Cucumber scenario?
+     */
+    constructor(uri, errorExpected) {
+        this.uri = uri;
+        this.errorExpected = errorExpected;
+        this.error = null;
+        this.lastResp = null;
+    }
+
+    /**
+     * Check to see if running in Hyperledger Fabric mode.
+     * @return {boolean} True if running in Hyperledger Fabric mode, false if not.
+     */
+    static isHyperledgerFabricV1() {
+        return process.env.INTEST && process.env.INTEST.match('^hlfv1.*');
+    }
+
+    /**
+     * Wait for the specified hostname to start listening on the specified port.
+     * @param {string} hostname - the hostname.
+     * @param {integer} port - the port.
+     * @return {Promise} - a promise that will be resolved when the specified
+     * hostname to start listening on the specified port.
+     */
+    static waitForPort(hostname, port) {
+        let waitTime = 30;
+        if (process.env.COMPOSER_PORT_WAIT_SECS) {
+            waitTime = parseInt(process.env.COMPOSER_PORT_WAIT_SECS);
+        }
+        return new Promise(function (resolve, reject) {
+            let testConnect = function (count) {
+                let s = new net.Socket();
+                s.on('error', function (error) {
+                    if (count > waitTime) {
+                        return reject(error);
+                    } else {
+                        setTimeout(function () {
+                            testConnect(count + 1);
+                        }, 1000);
+                    }
+                });
+                s.on('connect', function () {
+                    s.end();
+                    return resolve();
+                });
+                s.connect(port, hostname);
+            };
+            testConnect(0);
+        });
+    }
+
+    /**
+     * Wait for the peer on the specified hostname and port to start listening
+     * on the specified port.
+     * @return {Promise} - a promise that will be resolved when the peer has
+     * started listening on the specified port.
+     */
+    static waitForPorts() {
+        // startsWith not available in browser test environment
+        if (process.env.INTEST.match('^hlfv1')) {
+            return Promise.resolve();
+        }
+        return Composer.waitForPort('localhost', 7050)
+            .then(() => {
+                return Composer.waitForPort('localhost', 7051);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7052);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7053);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7054);
+            })
+            .then(() => {
+                return sleep(5000);
+            });
+    }
+
+    /**
+     * Creates crypto material
+     * @return {Promise} - a promise that will be resolved when crypto material is created or rejected with failure
+     */
+    setup() {
+        if(generated) {
+            return Promise.resolve();
+        } else {
+            const adminConnection = new AdminConnection();
+            return Composer.waitForPorts()
+            .then(() => {
+                if (Composer.isHyperledgerFabricV1()) {
+                    let fs = dynamicRequire('fs');
+                    const admins = [
+                        { org: 'org1', keyFile: 'key.pem', profile : 'org1-only' },
+                        { org: 'org2', keyFile: 'key.pem', profile : 'org2-only' },
+                        { org: 'org1', keyFile: 'key.pem', profile : 'org1' },
+                        { org: 'org2', keyFile: 'key.pem', profile : 'org2' }
+                    ];
+                    return admins.reduce((promise, admin) => {
+                        const org = admin.org;
+                        const prof = admin.profile;
+                        const keyFile = admin.keyFile;
+                        return promise.then(() => {
+                            let keyPath = path.join(__dirname, `../hlfv1/crypto-config/peerOrganizations/${org}.example.com/users/Admin@${org}.example.com/msp/keystore/${keyFile}`);
+                            let certPath = path.join(__dirname, `../hlfv1/crypto-config/peerOrganizations/${org}.example.com/users/Admin@${org}.example.com/msp/signcerts/Admin@${org}.example.com-cert.pem`);
+                            let cert = fs.readFileSync(certPath).toString();
+                            let key = fs.readFileSync(keyPath).toString();
+
+                            // set if the options have been given into the metadata
+                            let metadata = {
+                                version:1,
+                                userName : `TestPeerAdmin@${prof}`,
+                                roles : 'PeerAdmin',
+                            };
+
+                            let profile;
+                            if(process.env.INTEST.match('tls$')){
+                                let profilePath = path.join(__dirname, `../profiles/tls-connection-${prof}.json`);
+                                profile = fs.readFileSync(profilePath, 'utf8');
+                            } else {
+                                let profilePath = path.join(__dirname, `../profiles/basic-connection-${prof}.json`);
+                                profile = fs.readFileSync(profilePath, 'utf8');
+                            }
+
+                            let idCard = new IdCard(metadata, JSON.parse(profile));
+
+                            // certificates & privateKey
+                            const newCredentials = { };
+                            newCredentials.certificate = cert;
+                            newCredentials.privateKey =  key;
+
+                            idCard.setCredentials(newCredentials);
+                            let cardName = `TestPeerAdmin@${prof}`;
+
+                            this.containsCard(adminConnection, cardName)
+                            .then((exists) => {
+                                if(exists) {
+                                    console.log('skipping card import of existing card: ', cardName);
+                                    return Promise.resolve();
+                                } else {
+                                    console.log('importing card: ', cardName);
+                                    return adminConnection.importCard(cardName, idCard);
+                                }
+                            });
+                        });
+                    }, Promise.resolve());
+                }
+            })
+            .then(() => {
+                generated = true;
+                return Promise.resolve();
+            })
+            .catch((err) => {
+                return Promise.reject(err);
+            });
+        }
+    }
+
+    /**
+     * Check if card already exists
+     * @param {AdminConnection} adminConnection array of cards to check
+     * @param {string} cardName card to check for
+     * @returns {Promise} boolean true if card exists
+     */
+    containsCard(adminConnection, cardName) {
+        return adminConnection.cardStore.get(cardName)
+        .then((card)=>{
+            return Promise.resolve(true);
+        })
+        .catch((err) => {
+            return Promise.resolve(false);
+        });
+    }
+
+    /**
+     * Check that the provided list of items (files or folders) exist
+     * @param {String} type -  type (folder or file) that is being considered
+     * @param {DataTable} table -  DataTable listing the business networks expeted to exist
+     * @return {Promise} - Pomise that will be resolved or rejected with an error
+     */
+    checkExists(type, table) {
+        const rows = table.raw();
+        return new Promise((resolve, reject) => {
+            rows.forEach((row) => {
+                let itemPath = path.resolve(__dirname, row[0]);
+                if ( !fs.existsSync(itemPath) ) {
+                    reject('[' + row +'] does not exist.');
+                }
+            });
+            resolve();
+        });
+    }
+
+    /**
+     * Prepare CLI Command to run
+     * @param {DataTable} table -  Information listing the CLI command and parameters to be run
+     * @return {Promise} - Promise that will be resolved or rejected with an error
+     */
+    runCLI(table) {
+        if (typeof table === 'string') {
+            return this._runCLI(table);
+        } else {
+            return this._runCLI(this.convertTableToCommand(table));
+        }
+    }
+
+    /**
+     * Convert a prameterised table into a string command to run
+     * @param {DataTable} table -  DataTable listing the CLI command and parameters to be run
+     * @return {String} - String command based upon the input table
+     */
+    convertTableToCommand(table) {
+        let command = '';
+        const data = table.rowsHash();
+        Object.keys(data).forEach((key) => {
+            if (key === 'command') {
+                command += data[key] + ' ';
+            } else {
+                command += key + ' ' + data[key] + ' ';
+            }
+        });
+        return command;
+    }
+
+    /**
+     * Run a composer CLI command
+     * @param {DataTable} table -  DataTable listing the CLI command and parameters to be run
+     * @return {Promise} - Promise that will be resolved or rejected with an error
+     */
+    _runCLI(table) {
+        if (typeof table !== 'string') {
+            return Promise.reject('Command passed to function was not a string');
+        } else {
+            let command = table;
+            let stdout = '';
+            let stderr = '';
+
+            //console.log(command);
+
+            return new Promise( (resolve, reject) => {
+
+                let childCliProcess = childProcess.exec(command);
+
+                childCliProcess.stdout.setEncoding('utf8');
+                childCliProcess.stderr.setEncoding('utf8');
+
+                childCliProcess.stdout.on('data', (data) => {
+                    stdout += data;",271,2017-11-17 17:37:43,https://api.github.com/repos/hyperledger/composer/pulls/comments/151711515,https://github.com/hyperledger/composer/pull/2690#discussion_r151711515,bestbeforetoday
https://github.com/hyperledger/composer/pull/2690,https://github.com/hyperledger/composer/pull/2690,Looks very similar to the function above. Maybe scope to refactor our some common code... or maybe not :),db1ee32009d092832e485056def78c561e841ee7,2017-11-17 15:29:18,151712140,"@@ -0,0 +1,358 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+const IdCard = require('composer-common').IdCard;
+const net = require('net');
+const path = require('path');
+const sleep = require('sleep-promise');
+const fs = require('fs');
+const childProcess = require('child_process');
+
+let generated = false;
+
+/**
+ * Trick browserify by making the ID parameter to require dynamic.
+ * @param {string} id The module ID.
+ * @return {*} The module.
+ */
+function dynamicRequire(id) {
+    return require(id);
+}
+
+/**
+ * A class that handles all of the interactions with a business network for
+ * a currently executing Cucumber scenario and steps.
+ */
+class Composer {
+
+    /**
+     * Constructor.
+     * @param {string} uri The URI of the currently executing Cucumber scenario.
+     * @param {boolean} errorExpected Is an error expected in this Cucumber scenario?
+     */
+    constructor(uri, errorExpected) {
+        this.uri = uri;
+        this.errorExpected = errorExpected;
+        this.error = null;
+        this.lastResp = null;
+    }
+
+    /**
+     * Check to see if running in Hyperledger Fabric mode.
+     * @return {boolean} True if running in Hyperledger Fabric mode, false if not.
+     */
+    static isHyperledgerFabricV1() {
+        return process.env.INTEST && process.env.INTEST.match('^hlfv1.*');
+    }
+
+    /**
+     * Wait for the specified hostname to start listening on the specified port.
+     * @param {string} hostname - the hostname.
+     * @param {integer} port - the port.
+     * @return {Promise} - a promise that will be resolved when the specified
+     * hostname to start listening on the specified port.
+     */
+    static waitForPort(hostname, port) {
+        let waitTime = 30;
+        if (process.env.COMPOSER_PORT_WAIT_SECS) {
+            waitTime = parseInt(process.env.COMPOSER_PORT_WAIT_SECS);
+        }
+        return new Promise(function (resolve, reject) {
+            let testConnect = function (count) {
+                let s = new net.Socket();
+                s.on('error', function (error) {
+                    if (count > waitTime) {
+                        return reject(error);
+                    } else {
+                        setTimeout(function () {
+                            testConnect(count + 1);
+                        }, 1000);
+                    }
+                });
+                s.on('connect', function () {
+                    s.end();
+                    return resolve();
+                });
+                s.connect(port, hostname);
+            };
+            testConnect(0);
+        });
+    }
+
+    /**
+     * Wait for the peer on the specified hostname and port to start listening
+     * on the specified port.
+     * @return {Promise} - a promise that will be resolved when the peer has
+     * started listening on the specified port.
+     */
+    static waitForPorts() {
+        // startsWith not available in browser test environment
+        if (process.env.INTEST.match('^hlfv1')) {
+            return Promise.resolve();
+        }
+        return Composer.waitForPort('localhost', 7050)
+            .then(() => {
+                return Composer.waitForPort('localhost', 7051);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7052);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7053);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7054);
+            })
+            .then(() => {
+                return sleep(5000);
+            });
+    }
+
+    /**
+     * Creates crypto material
+     * @return {Promise} - a promise that will be resolved when crypto material is created or rejected with failure
+     */
+    setup() {
+        if(generated) {
+            return Promise.resolve();
+        } else {
+            const adminConnection = new AdminConnection();
+            return Composer.waitForPorts()
+            .then(() => {
+                if (Composer.isHyperledgerFabricV1()) {
+                    let fs = dynamicRequire('fs');
+                    const admins = [
+                        { org: 'org1', keyFile: 'key.pem', profile : 'org1-only' },
+                        { org: 'org2', keyFile: 'key.pem', profile : 'org2-only' },
+                        { org: 'org1', keyFile: 'key.pem', profile : 'org1' },
+                        { org: 'org2', keyFile: 'key.pem', profile : 'org2' }
+                    ];
+                    return admins.reduce((promise, admin) => {
+                        const org = admin.org;
+                        const prof = admin.profile;
+                        const keyFile = admin.keyFile;
+                        return promise.then(() => {
+                            let keyPath = path.join(__dirname, `../hlfv1/crypto-config/peerOrganizations/${org}.example.com/users/Admin@${org}.example.com/msp/keystore/${keyFile}`);
+                            let certPath = path.join(__dirname, `../hlfv1/crypto-config/peerOrganizations/${org}.example.com/users/Admin@${org}.example.com/msp/signcerts/Admin@${org}.example.com-cert.pem`);
+                            let cert = fs.readFileSync(certPath).toString();
+                            let key = fs.readFileSync(keyPath).toString();
+
+                            // set if the options have been given into the metadata
+                            let metadata = {
+                                version:1,
+                                userName : `TestPeerAdmin@${prof}`,
+                                roles : 'PeerAdmin',
+                            };
+
+                            let profile;
+                            if(process.env.INTEST.match('tls$')){
+                                let profilePath = path.join(__dirname, `../profiles/tls-connection-${prof}.json`);
+                                profile = fs.readFileSync(profilePath, 'utf8');
+                            } else {
+                                let profilePath = path.join(__dirname, `../profiles/basic-connection-${prof}.json`);
+                                profile = fs.readFileSync(profilePath, 'utf8');
+                            }
+
+                            let idCard = new IdCard(metadata, JSON.parse(profile));
+
+                            // certificates & privateKey
+                            const newCredentials = { };
+                            newCredentials.certificate = cert;
+                            newCredentials.privateKey =  key;
+
+                            idCard.setCredentials(newCredentials);
+                            let cardName = `TestPeerAdmin@${prof}`;
+
+                            this.containsCard(adminConnection, cardName)
+                            .then((exists) => {
+                                if(exists) {
+                                    console.log('skipping card import of existing card: ', cardName);
+                                    return Promise.resolve();
+                                } else {
+                                    console.log('importing card: ', cardName);
+                                    return adminConnection.importCard(cardName, idCard);
+                                }
+                            });
+                        });
+                    }, Promise.resolve());
+                }
+            })
+            .then(() => {
+                generated = true;
+                return Promise.resolve();
+            })
+            .catch((err) => {
+                return Promise.reject(err);
+            });
+        }
+    }
+
+    /**
+     * Check if card already exists
+     * @param {AdminConnection} adminConnection array of cards to check
+     * @param {string} cardName card to check for
+     * @returns {Promise} boolean true if card exists
+     */
+    containsCard(adminConnection, cardName) {
+        return adminConnection.cardStore.get(cardName)
+        .then((card)=>{
+            return Promise.resolve(true);
+        })
+        .catch((err) => {
+            return Promise.resolve(false);
+        });
+    }
+
+    /**
+     * Check that the provided list of items (files or folders) exist
+     * @param {String} type -  type (folder or file) that is being considered
+     * @param {DataTable} table -  DataTable listing the business networks expeted to exist
+     * @return {Promise} - Pomise that will be resolved or rejected with an error
+     */
+    checkExists(type, table) {
+        const rows = table.raw();
+        return new Promise((resolve, reject) => {
+            rows.forEach((row) => {
+                let itemPath = path.resolve(__dirname, row[0]);
+                if ( !fs.existsSync(itemPath) ) {
+                    reject('[' + row +'] does not exist.');
+                }
+            });
+            resolve();
+        });
+    }
+
+    /**
+     * Prepare CLI Command to run
+     * @param {DataTable} table -  Information listing the CLI command and parameters to be run
+     * @return {Promise} - Promise that will be resolved or rejected with an error
+     */
+    runCLI(table) {
+        if (typeof table === 'string') {
+            return this._runCLI(table);
+        } else {
+            return this._runCLI(this.convertTableToCommand(table));
+        }
+    }
+
+    /**
+     * Convert a prameterised table into a string command to run
+     * @param {DataTable} table -  DataTable listing the CLI command and parameters to be run
+     * @return {String} - String command based upon the input table
+     */
+    convertTableToCommand(table) {
+        let command = '';
+        const data = table.rowsHash();
+        Object.keys(data).forEach((key) => {
+            if (key === 'command') {
+                command += data[key] + ' ';
+            } else {
+                command += key + ' ' + data[key] + ' ';
+            }
+        });
+        return command;
+    }
+
+    /**
+     * Run a composer CLI command
+     * @param {DataTable} table -  DataTable listing the CLI command and parameters to be run
+     * @return {Promise} - Promise that will be resolved or rejected with an error
+     */
+    _runCLI(table) {
+        if (typeof table !== 'string') {
+            return Promise.reject('Command passed to function was not a string');
+        } else {
+            let command = table;
+            let stdout = '';
+            let stderr = '';
+
+            //console.log(command);
+
+            return new Promise( (resolve, reject) => {
+
+                let childCliProcess = childProcess.exec(command);
+
+                childCliProcess.stdout.setEncoding('utf8');
+                childCliProcess.stderr.setEncoding('utf8');
+
+                childCliProcess.stdout.on('data', (data) => {
+                    stdout += data;
+                });
+
+                childCliProcess.stderr.on('data', (data) => {
+                    stderr += data;
+                });
+
+                childCliProcess.on('error', (error) => {
+                    this.lastResp = { error: error, stdout: stdout, stderr: stderr };
+                    reject(this.lastResp);
+                });
+
+                childCliProcess.on('close', (code) => {
+                    if (code && code !== 0) {
+                        this.lastResp = { code: code, stdout: stdout, stderr: stderr };
+                        reject(this.lastResp);
+                    } else {
+                        this.lastResp = { code: code, stdout: stdout, stderr: stderr };
+                        resolve(this.lastResp);
+                    }
+                });
+            });
+        }
+    }
+
+    /**
+     * Check the last response message for success with regex
+     * @param {RegExp} [regex] Optional regular expression.
+     * @return {Promise} - Pomise that will be resolved or rejected with an error
+     */
+    checkStdOutResponse(regex) {
+        return new Promise( (resolve, reject) => {
+            if (!this.lastResp || !this.lastResp.stdout) {
+                reject('a stdout response was expected, but no repsonse messages have been generated');
+            } else if (regex) {
+                if(this.lastResp.stdout.match(regex)) {
+                    resolve();
+                } else {
+                    reject('regex match on stdout failed');
+                }
+            }
+        });
+    }
+
+    /**
+     * Check the last response message for error with regex
+     * @param {RegExp} [regex] Optional regular expression.
+     * @return {Promise} - Pomise that will be resolved or rejected with an error
+     */
+    testError(regex) {",,2017-11-17 17:37:43,https://api.github.com/repos/hyperledger/composer/pulls/comments/151712140,https://github.com/hyperledger/composer/pull/2690#discussion_r151712140,bestbeforetoday
https://github.com/hyperledger/composer/pull/2690,https://github.com/hyperledger/composer/pull/2690,excellent - would much rather use the API item ðŸ‘ ,db1ee32009d092832e485056def78c561e841ee7,2017-11-17 17:05:29,151738152,"@@ -0,0 +1,358 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+const IdCard = require('composer-common').IdCard;
+const net = require('net');
+const path = require('path');
+const sleep = require('sleep-promise');
+const fs = require('fs');
+const childProcess = require('child_process');
+
+let generated = false;
+
+/**
+ * Trick browserify by making the ID parameter to require dynamic.
+ * @param {string} id The module ID.
+ * @return {*} The module.
+ */
+function dynamicRequire(id) {
+    return require(id);
+}
+
+/**
+ * A class that handles all of the interactions with a business network for
+ * a currently executing Cucumber scenario and steps.
+ */
+class Composer {
+
+    /**
+     * Constructor.
+     * @param {string} uri The URI of the currently executing Cucumber scenario.
+     * @param {boolean} errorExpected Is an error expected in this Cucumber scenario?
+     */
+    constructor(uri, errorExpected) {
+        this.uri = uri;
+        this.errorExpected = errorExpected;
+        this.error = null;
+        this.lastResp = null;
+    }
+
+    /**
+     * Check to see if running in Hyperledger Fabric mode.
+     * @return {boolean} True if running in Hyperledger Fabric mode, false if not.
+     */
+    static isHyperledgerFabricV1() {
+        return process.env.INTEST && process.env.INTEST.match('^hlfv1.*');
+    }
+
+    /**
+     * Wait for the specified hostname to start listening on the specified port.
+     * @param {string} hostname - the hostname.
+     * @param {integer} port - the port.
+     * @return {Promise} - a promise that will be resolved when the specified
+     * hostname to start listening on the specified port.
+     */
+    static waitForPort(hostname, port) {
+        let waitTime = 30;
+        if (process.env.COMPOSER_PORT_WAIT_SECS) {
+            waitTime = parseInt(process.env.COMPOSER_PORT_WAIT_SECS);
+        }
+        return new Promise(function (resolve, reject) {
+            let testConnect = function (count) {
+                let s = new net.Socket();
+                s.on('error', function (error) {
+                    if (count > waitTime) {
+                        return reject(error);
+                    } else {
+                        setTimeout(function () {
+                            testConnect(count + 1);
+                        }, 1000);
+                    }
+                });
+                s.on('connect', function () {
+                    s.end();
+                    return resolve();
+                });
+                s.connect(port, hostname);
+            };
+            testConnect(0);
+        });
+    }
+
+    /**
+     * Wait for the peer on the specified hostname and port to start listening
+     * on the specified port.
+     * @return {Promise} - a promise that will be resolved when the peer has
+     * started listening on the specified port.
+     */
+    static waitForPorts() {
+        // startsWith not available in browser test environment
+        if (process.env.INTEST.match('^hlfv1')) {
+            return Promise.resolve();
+        }
+        return Composer.waitForPort('localhost', 7050)
+            .then(() => {
+                return Composer.waitForPort('localhost', 7051);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7052);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7053);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7054);
+            })
+            .then(() => {
+                return sleep(5000);
+            });
+    }
+
+    /**
+     * Creates crypto material
+     * @return {Promise} - a promise that will be resolved when crypto material is created or rejected with failure
+     */
+    setup() {
+        if(generated) {
+            return Promise.resolve();
+        } else {
+            const adminConnection = new AdminConnection();
+            return Composer.waitForPorts()
+            .then(() => {
+                if (Composer.isHyperledgerFabricV1()) {
+                    let fs = dynamicRequire('fs');
+                    const admins = [
+                        { org: 'org1', keyFile: 'key.pem', profile : 'org1-only' },
+                        { org: 'org2', keyFile: 'key.pem', profile : 'org2-only' },
+                        { org: 'org1', keyFile: 'key.pem', profile : 'org1' },
+                        { org: 'org2', keyFile: 'key.pem', profile : 'org2' }
+                    ];
+                    return admins.reduce((promise, admin) => {
+                        const org = admin.org;
+                        const prof = admin.profile;
+                        const keyFile = admin.keyFile;
+                        return promise.then(() => {
+                            let keyPath = path.join(__dirname, `../hlfv1/crypto-config/peerOrganizations/${org}.example.com/users/Admin@${org}.example.com/msp/keystore/${keyFile}`);
+                            let certPath = path.join(__dirname, `../hlfv1/crypto-config/peerOrganizations/${org}.example.com/users/Admin@${org}.example.com/msp/signcerts/Admin@${org}.example.com-cert.pem`);
+                            let cert = fs.readFileSync(certPath).toString();
+                            let key = fs.readFileSync(keyPath).toString();
+
+                            // set if the options have been given into the metadata
+                            let metadata = {
+                                version:1,
+                                userName : `TestPeerAdmin@${prof}`,
+                                roles : 'PeerAdmin',
+                            };
+
+                            let profile;
+                            if(process.env.INTEST.match('tls$')){
+                                let profilePath = path.join(__dirname, `../profiles/tls-connection-${prof}.json`);
+                                profile = fs.readFileSync(profilePath, 'utf8');
+                            } else {
+                                let profilePath = path.join(__dirname, `../profiles/basic-connection-${prof}.json`);
+                                profile = fs.readFileSync(profilePath, 'utf8');
+                            }
+
+                            let idCard = new IdCard(metadata, JSON.parse(profile));
+
+                            // certificates & privateKey
+                            const newCredentials = { };
+                            newCredentials.certificate = cert;
+                            newCredentials.privateKey =  key;
+
+                            idCard.setCredentials(newCredentials);
+                            let cardName = `TestPeerAdmin@${prof}`;
+
+                            this.containsCard(adminConnection, cardName)
+                            .then((exists) => {
+                                if(exists) {
+                                    console.log('skipping card import of existing card: ', cardName);
+                                    return Promise.resolve();
+                                } else {
+                                    console.log('importing card: ', cardName);
+                                    return adminConnection.importCard(cardName, idCard);
+                                }
+                            });
+                        });
+                    }, Promise.resolve());
+                }
+            })
+            .then(() => {
+                generated = true;
+                return Promise.resolve();
+            })
+            .catch((err) => {
+                return Promise.reject(err);
+            });
+        }
+    }
+
+    /**
+     * Check if card already exists
+     * @param {AdminConnection} adminConnection array of cards to check
+     * @param {string} cardName card to check for
+     * @returns {Promise} boolean true if card exists
+     */
+    containsCard(adminConnection, cardName) {
+        return adminConnection.cardStore.get(cardName)",,2017-11-17 17:37:43,https://api.github.com/repos/hyperledger/composer/pulls/comments/151738152,https://github.com/hyperledger/composer/pull/2690#discussion_r151738152,nklincoln
https://github.com/hyperledger/composer/pull/2690,https://github.com/hyperledger/composer/pull/2690,"good point - change to be made (well, i've done it, but i'm writing this before pushing the changes!)",db1ee32009d092832e485056def78c561e841ee7,2017-11-17 17:05:36,151738184,"@@ -0,0 +1,358 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+const IdCard = require('composer-common').IdCard;
+const net = require('net');
+const path = require('path');
+const sleep = require('sleep-promise');
+const fs = require('fs');
+const childProcess = require('child_process');
+
+let generated = false;
+
+/**
+ * Trick browserify by making the ID parameter to require dynamic.
+ * @param {string} id The module ID.
+ * @return {*} The module.
+ */
+function dynamicRequire(id) {
+    return require(id);
+}
+
+/**
+ * A class that handles all of the interactions with a business network for
+ * a currently executing Cucumber scenario and steps.
+ */
+class Composer {
+
+    /**
+     * Constructor.
+     * @param {string} uri The URI of the currently executing Cucumber scenario.
+     * @param {boolean} errorExpected Is an error expected in this Cucumber scenario?
+     */
+    constructor(uri, errorExpected) {
+        this.uri = uri;
+        this.errorExpected = errorExpected;
+        this.error = null;
+        this.lastResp = null;
+    }
+
+    /**
+     * Check to see if running in Hyperledger Fabric mode.
+     * @return {boolean} True if running in Hyperledger Fabric mode, false if not.
+     */
+    static isHyperledgerFabricV1() {
+        return process.env.INTEST && process.env.INTEST.match('^hlfv1.*');
+    }
+
+    /**
+     * Wait for the specified hostname to start listening on the specified port.
+     * @param {string} hostname - the hostname.
+     * @param {integer} port - the port.
+     * @return {Promise} - a promise that will be resolved when the specified
+     * hostname to start listening on the specified port.
+     */
+    static waitForPort(hostname, port) {
+        let waitTime = 30;
+        if (process.env.COMPOSER_PORT_WAIT_SECS) {
+            waitTime = parseInt(process.env.COMPOSER_PORT_WAIT_SECS);
+        }
+        return new Promise(function (resolve, reject) {
+            let testConnect = function (count) {
+                let s = new net.Socket();
+                s.on('error', function (error) {
+                    if (count > waitTime) {
+                        return reject(error);
+                    } else {
+                        setTimeout(function () {
+                            testConnect(count + 1);
+                        }, 1000);
+                    }
+                });
+                s.on('connect', function () {
+                    s.end();
+                    return resolve();
+                });
+                s.connect(port, hostname);
+            };
+            testConnect(0);
+        });
+    }
+
+    /**
+     * Wait for the peer on the specified hostname and port to start listening
+     * on the specified port.
+     * @return {Promise} - a promise that will be resolved when the peer has
+     * started listening on the specified port.
+     */
+    static waitForPorts() {
+        // startsWith not available in browser test environment
+        if (process.env.INTEST.match('^hlfv1')) {
+            return Promise.resolve();
+        }
+        return Composer.waitForPort('localhost', 7050)
+            .then(() => {
+                return Composer.waitForPort('localhost', 7051);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7052);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7053);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7054);
+            })
+            .then(() => {
+                return sleep(5000);
+            });
+    }
+
+    /**
+     * Creates crypto material
+     * @return {Promise} - a promise that will be resolved when crypto material is created or rejected with failure
+     */
+    setup() {
+        if(generated) {
+            return Promise.resolve();
+        } else {
+            const adminConnection = new AdminConnection();
+            return Composer.waitForPorts()
+            .then(() => {
+                if (Composer.isHyperledgerFabricV1()) {
+                    let fs = dynamicRequire('fs');
+                    const admins = [
+                        { org: 'org1', keyFile: 'key.pem', profile : 'org1-only' },
+                        { org: 'org2', keyFile: 'key.pem', profile : 'org2-only' },
+                        { org: 'org1', keyFile: 'key.pem', profile : 'org1' },
+                        { org: 'org2', keyFile: 'key.pem', profile : 'org2' }
+                    ];
+                    return admins.reduce((promise, admin) => {
+                        const org = admin.org;
+                        const prof = admin.profile;
+                        const keyFile = admin.keyFile;
+                        return promise.then(() => {
+                            let keyPath = path.join(__dirname, `../hlfv1/crypto-config/peerOrganizations/${org}.example.com/users/Admin@${org}.example.com/msp/keystore/${keyFile}`);
+                            let certPath = path.join(__dirname, `../hlfv1/crypto-config/peerOrganizations/${org}.example.com/users/Admin@${org}.example.com/msp/signcerts/Admin@${org}.example.com-cert.pem`);
+                            let cert = fs.readFileSync(certPath).toString();
+                            let key = fs.readFileSync(keyPath).toString();
+
+                            // set if the options have been given into the metadata
+                            let metadata = {
+                                version:1,
+                                userName : `TestPeerAdmin@${prof}`,
+                                roles : 'PeerAdmin',
+                            };
+
+                            let profile;
+                            if(process.env.INTEST.match('tls$')){
+                                let profilePath = path.join(__dirname, `../profiles/tls-connection-${prof}.json`);
+                                profile = fs.readFileSync(profilePath, 'utf8');
+                            } else {
+                                let profilePath = path.join(__dirname, `../profiles/basic-connection-${prof}.json`);
+                                profile = fs.readFileSync(profilePath, 'utf8');
+                            }
+
+                            let idCard = new IdCard(metadata, JSON.parse(profile));
+
+                            // certificates & privateKey
+                            const newCredentials = { };
+                            newCredentials.certificate = cert;
+                            newCredentials.privateKey =  key;
+
+                            idCard.setCredentials(newCredentials);
+                            let cardName = `TestPeerAdmin@${prof}`;
+
+                            this.containsCard(adminConnection, cardName)
+                            .then((exists) => {
+                                if(exists) {
+                                    console.log('skipping card import of existing card: ', cardName);
+                                    return Promise.resolve();
+                                } else {
+                                    console.log('importing card: ', cardName);
+                                    return adminConnection.importCard(cardName, idCard);
+                                }
+                            });
+                        });
+                    }, Promise.resolve());
+                }
+            })
+            .then(() => {
+                generated = true;
+                return Promise.resolve();
+            })
+            .catch((err) => {
+                return Promise.reject(err);
+            });
+        }
+    }
+
+    /**
+     * Check if card already exists
+     * @param {AdminConnection} adminConnection array of cards to check
+     * @param {string} cardName card to check for
+     * @returns {Promise} boolean true if card exists
+     */
+    containsCard(adminConnection, cardName) {
+        return adminConnection.cardStore.get(cardName)
+        .then((card)=>{
+            return Promise.resolve(true);
+        })
+        .catch((err) => {
+            return Promise.resolve(false);
+        });
+    }
+
+    /**
+     * Check that the provided list of items (files or folders) exist
+     * @param {String} type -  type (folder or file) that is being considered
+     * @param {DataTable} table -  DataTable listing the business networks expeted to exist
+     * @return {Promise} - Pomise that will be resolved or rejected with an error
+     */
+    checkExists(type, table) {
+        const rows = table.raw();
+        return new Promise((resolve, reject) => {
+            rows.forEach((row) => {
+                let itemPath = path.resolve(__dirname, row[0]);
+                if ( !fs.existsSync(itemPath) ) {
+                    reject('[' + row +'] does not exist.');
+                }
+            });
+            resolve();
+        });
+    }
+
+    /**
+     * Prepare CLI Command to run
+     * @param {DataTable} table -  Information listing the CLI command and parameters to be run
+     * @return {Promise} - Promise that will be resolved or rejected with an error
+     */
+    runCLI(table) {
+        if (typeof table === 'string') {
+            return this._runCLI(table);
+        } else {
+            return this._runCLI(this.convertTableToCommand(table));
+        }
+    }
+
+    /**
+     * Convert a prameterised table into a string command to run
+     * @param {DataTable} table -  DataTable listing the CLI command and parameters to be run
+     * @return {String} - String command based upon the input table
+     */
+    convertTableToCommand(table) {
+        let command = '';
+        const data = table.rowsHash();
+        Object.keys(data).forEach((key) => {
+            if (key === 'command') {
+                command += data[key] + ' ';
+            } else {
+                command += key + ' ' + data[key] + ' ';
+            }
+        });
+        return command;
+    }
+
+    /**
+     * Run a composer CLI command
+     * @param {DataTable} table -  DataTable listing the CLI command and parameters to be run
+     * @return {Promise} - Promise that will be resolved or rejected with an error
+     */
+    _runCLI(table) {
+        if (typeof table !== 'string') {
+            return Promise.reject('Command passed to function was not a string');
+        } else {
+            let command = table;
+            let stdout = '';
+            let stderr = '';
+
+            //console.log(command);
+
+            return new Promise( (resolve, reject) => {
+
+                let childCliProcess = childProcess.exec(command);
+
+                childCliProcess.stdout.setEncoding('utf8');
+                childCliProcess.stderr.setEncoding('utf8');
+
+                childCliProcess.stdout.on('data', (data) => {
+                    stdout += data;
+                });
+
+                childCliProcess.stderr.on('data', (data) => {
+                    stderr += data;
+                });
+
+                childCliProcess.on('error', (error) => {
+                    this.lastResp = { error: error, stdout: stdout, stderr: stderr };
+                    reject(this.lastResp);
+                });
+
+                childCliProcess.on('close', (code) => {
+                    if (code && code !== 0) {
+                        this.lastResp = { code: code, stdout: stdout, stderr: stderr };
+                        reject(this.lastResp);
+                    } else {
+                        this.lastResp = { code: code, stdout: stdout, stderr: stderr };
+                        resolve(this.lastResp);
+                    }
+                });
+            });
+        }
+    }
+
+    /**
+     * Check the last response message for success with regex
+     * @param {RegExp} [regex] Optional regular expression.
+     * @return {Promise} - Pomise that will be resolved or rejected with an error
+     */
+    checkStdOutResponse(regex) {
+        return new Promise( (resolve, reject) => {
+            if (!this.lastResp || !this.lastResp.stdout) {
+                reject('a stdout response was expected, but no repsonse messages have been generated');
+            } else if (regex) {
+                if(this.lastResp.stdout.match(regex)) {
+                    resolve();
+                } else {
+                    reject('regex match on stdout failed');
+                }
+            }
+        });
+    }
+
+    /**
+     * Check the last response message for error with regex
+     * @param {RegExp} [regex] Optional regular expression.
+     * @return {Promise} - Pomise that will be resolved or rejected with an error
+     */
+    testError(regex) {",,2017-11-17 17:37:43,https://api.github.com/repos/hyperledger/composer/pulls/comments/151738184,https://github.com/hyperledger/composer/pull/2690#discussion_r151738184,nklincoln
https://github.com/hyperledger/composer/pull/2690,https://github.com/hyperledger/composer/pull/2690,cool -change made to permit future functionality ðŸ‘ ,db1ee32009d092832e485056def78c561e841ee7,2017-11-17 17:06:04,151738298,"@@ -0,0 +1,358 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+const IdCard = require('composer-common').IdCard;
+const net = require('net');
+const path = require('path');
+const sleep = require('sleep-promise');
+const fs = require('fs');
+const childProcess = require('child_process');
+
+let generated = false;
+
+/**
+ * Trick browserify by making the ID parameter to require dynamic.
+ * @param {string} id The module ID.
+ * @return {*} The module.
+ */
+function dynamicRequire(id) {
+    return require(id);
+}
+
+/**
+ * A class that handles all of the interactions with a business network for
+ * a currently executing Cucumber scenario and steps.
+ */
+class Composer {
+
+    /**
+     * Constructor.
+     * @param {string} uri The URI of the currently executing Cucumber scenario.
+     * @param {boolean} errorExpected Is an error expected in this Cucumber scenario?
+     */
+    constructor(uri, errorExpected) {
+        this.uri = uri;
+        this.errorExpected = errorExpected;
+        this.error = null;
+        this.lastResp = null;
+    }
+
+    /**
+     * Check to see if running in Hyperledger Fabric mode.
+     * @return {boolean} True if running in Hyperledger Fabric mode, false if not.
+     */
+    static isHyperledgerFabricV1() {
+        return process.env.INTEST && process.env.INTEST.match('^hlfv1.*');
+    }
+
+    /**
+     * Wait for the specified hostname to start listening on the specified port.
+     * @param {string} hostname - the hostname.
+     * @param {integer} port - the port.
+     * @return {Promise} - a promise that will be resolved when the specified
+     * hostname to start listening on the specified port.
+     */
+    static waitForPort(hostname, port) {
+        let waitTime = 30;
+        if (process.env.COMPOSER_PORT_WAIT_SECS) {
+            waitTime = parseInt(process.env.COMPOSER_PORT_WAIT_SECS);
+        }
+        return new Promise(function (resolve, reject) {
+            let testConnect = function (count) {
+                let s = new net.Socket();
+                s.on('error', function (error) {
+                    if (count > waitTime) {
+                        return reject(error);
+                    } else {
+                        setTimeout(function () {
+                            testConnect(count + 1);
+                        }, 1000);
+                    }
+                });
+                s.on('connect', function () {
+                    s.end();
+                    return resolve();
+                });
+                s.connect(port, hostname);
+            };
+            testConnect(0);
+        });
+    }
+
+    /**
+     * Wait for the peer on the specified hostname and port to start listening
+     * on the specified port.
+     * @return {Promise} - a promise that will be resolved when the peer has
+     * started listening on the specified port.
+     */
+    static waitForPorts() {
+        // startsWith not available in browser test environment
+        if (process.env.INTEST.match('^hlfv1')) {
+            return Promise.resolve();
+        }
+        return Composer.waitForPort('localhost', 7050)
+            .then(() => {
+                return Composer.waitForPort('localhost', 7051);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7052);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7053);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7054);
+            })
+            .then(() => {
+                return sleep(5000);
+            });
+    }
+
+    /**
+     * Creates crypto material
+     * @return {Promise} - a promise that will be resolved when crypto material is created or rejected with failure
+     */
+    setup() {
+        if(generated) {
+            return Promise.resolve();
+        } else {
+            const adminConnection = new AdminConnection();
+            return Composer.waitForPorts()
+            .then(() => {
+                if (Composer.isHyperledgerFabricV1()) {
+                    let fs = dynamicRequire('fs');
+                    const admins = [
+                        { org: 'org1', keyFile: 'key.pem', profile : 'org1-only' },
+                        { org: 'org2', keyFile: 'key.pem', profile : 'org2-only' },
+                        { org: 'org1', keyFile: 'key.pem', profile : 'org1' },
+                        { org: 'org2', keyFile: 'key.pem', profile : 'org2' }
+                    ];
+                    return admins.reduce((promise, admin) => {
+                        const org = admin.org;
+                        const prof = admin.profile;
+                        const keyFile = admin.keyFile;
+                        return promise.then(() => {
+                            let keyPath = path.join(__dirname, `../hlfv1/crypto-config/peerOrganizations/${org}.example.com/users/Admin@${org}.example.com/msp/keystore/${keyFile}`);
+                            let certPath = path.join(__dirname, `../hlfv1/crypto-config/peerOrganizations/${org}.example.com/users/Admin@${org}.example.com/msp/signcerts/Admin@${org}.example.com-cert.pem`);
+                            let cert = fs.readFileSync(certPath).toString();
+                            let key = fs.readFileSync(keyPath).toString();
+
+                            // set if the options have been given into the metadata
+                            let metadata = {
+                                version:1,
+                                userName : `TestPeerAdmin@${prof}`,
+                                roles : 'PeerAdmin',",,2017-11-17 17:37:43,https://api.github.com/repos/hyperledger/composer/pulls/comments/151738298,https://github.com/hyperledger/composer/pull/2690#discussion_r151738298,nklincoln
https://github.com/hyperledger/composer/pull/2690,https://github.com/hyperledger/composer/pull/2690,"yeah, saves a few lines - done!",db1ee32009d092832e485056def78c561e841ee7,2017-11-17 17:06:15,151738336,"@@ -0,0 +1,358 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+const IdCard = require('composer-common').IdCard;
+const net = require('net');
+const path = require('path');
+const sleep = require('sleep-promise');
+const fs = require('fs');
+const childProcess = require('child_process');
+
+let generated = false;
+
+/**
+ * Trick browserify by making the ID parameter to require dynamic.
+ * @param {string} id The module ID.
+ * @return {*} The module.
+ */
+function dynamicRequire(id) {
+    return require(id);
+}
+
+/**
+ * A class that handles all of the interactions with a business network for
+ * a currently executing Cucumber scenario and steps.
+ */
+class Composer {
+
+    /**
+     * Constructor.
+     * @param {string} uri The URI of the currently executing Cucumber scenario.
+     * @param {boolean} errorExpected Is an error expected in this Cucumber scenario?
+     */
+    constructor(uri, errorExpected) {
+        this.uri = uri;
+        this.errorExpected = errorExpected;
+        this.error = null;
+        this.lastResp = null;
+    }
+
+    /**
+     * Check to see if running in Hyperledger Fabric mode.
+     * @return {boolean} True if running in Hyperledger Fabric mode, false if not.
+     */
+    static isHyperledgerFabricV1() {
+        return process.env.INTEST && process.env.INTEST.match('^hlfv1.*');
+    }
+
+    /**
+     * Wait for the specified hostname to start listening on the specified port.
+     * @param {string} hostname - the hostname.
+     * @param {integer} port - the port.
+     * @return {Promise} - a promise that will be resolved when the specified
+     * hostname to start listening on the specified port.
+     */
+    static waitForPort(hostname, port) {
+        let waitTime = 30;
+        if (process.env.COMPOSER_PORT_WAIT_SECS) {
+            waitTime = parseInt(process.env.COMPOSER_PORT_WAIT_SECS);
+        }
+        return new Promise(function (resolve, reject) {
+            let testConnect = function (count) {
+                let s = new net.Socket();
+                s.on('error', function (error) {
+                    if (count > waitTime) {
+                        return reject(error);
+                    } else {
+                        setTimeout(function () {
+                            testConnect(count + 1);
+                        }, 1000);
+                    }
+                });
+                s.on('connect', function () {
+                    s.end();
+                    return resolve();
+                });
+                s.connect(port, hostname);
+            };
+            testConnect(0);
+        });
+    }
+
+    /**
+     * Wait for the peer on the specified hostname and port to start listening
+     * on the specified port.
+     * @return {Promise} - a promise that will be resolved when the peer has
+     * started listening on the specified port.
+     */
+    static waitForPorts() {
+        // startsWith not available in browser test environment
+        if (process.env.INTEST.match('^hlfv1')) {
+            return Promise.resolve();
+        }
+        return Composer.waitForPort('localhost', 7050)",,2017-11-17 17:37:43,https://api.github.com/repos/hyperledger/composer/pulls/comments/151738336,https://github.com/hyperledger/composer/pull/2690#discussion_r151738336,nklincoln
https://github.com/hyperledger/composer/pull/2690,https://github.com/hyperledger/composer/pull/2690,socket it is then!,db1ee32009d092832e485056def78c561e841ee7,2017-11-17 17:06:26,151738368,"@@ -0,0 +1,358 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+const IdCard = require('composer-common').IdCard;
+const net = require('net');
+const path = require('path');
+const sleep = require('sleep-promise');
+const fs = require('fs');
+const childProcess = require('child_process');
+
+let generated = false;
+
+/**
+ * Trick browserify by making the ID parameter to require dynamic.
+ * @param {string} id The module ID.
+ * @return {*} The module.
+ */
+function dynamicRequire(id) {
+    return require(id);
+}
+
+/**
+ * A class that handles all of the interactions with a business network for
+ * a currently executing Cucumber scenario and steps.
+ */
+class Composer {
+
+    /**
+     * Constructor.
+     * @param {string} uri The URI of the currently executing Cucumber scenario.
+     * @param {boolean} errorExpected Is an error expected in this Cucumber scenario?
+     */
+    constructor(uri, errorExpected) {
+        this.uri = uri;
+        this.errorExpected = errorExpected;
+        this.error = null;
+        this.lastResp = null;
+    }
+
+    /**
+     * Check to see if running in Hyperledger Fabric mode.
+     * @return {boolean} True if running in Hyperledger Fabric mode, false if not.
+     */
+    static isHyperledgerFabricV1() {
+        return process.env.INTEST && process.env.INTEST.match('^hlfv1.*');
+    }
+
+    /**
+     * Wait for the specified hostname to start listening on the specified port.
+     * @param {string} hostname - the hostname.
+     * @param {integer} port - the port.
+     * @return {Promise} - a promise that will be resolved when the specified
+     * hostname to start listening on the specified port.
+     */
+    static waitForPort(hostname, port) {
+        let waitTime = 30;
+        if (process.env.COMPOSER_PORT_WAIT_SECS) {
+            waitTime = parseInt(process.env.COMPOSER_PORT_WAIT_SECS);
+        }
+        return new Promise(function (resolve, reject) {
+            let testConnect = function (count) {
+                let s = new net.Socket();",,2017-11-17 17:37:43,https://api.github.com/repos/hyperledger/composer/pulls/comments/151738368,https://github.com/hyperledger/composer/pull/2690#discussion_r151738368,nklincoln
https://github.com/hyperledger/composer/pull/2690,https://github.com/hyperledger/composer/pull/2690,"I do agree, but the problem there is that with such a long command (due to paths for files etc), reading the test becomes very difficult ",db1ee32009d092832e485056def78c561e841ee7,2017-11-17 17:08:38,151738824,"@@ -0,0 +1,57 @@
+Feature: Cli steps
+
+    Background:
+        Given I have generated crypto material
+
+    Scenario: Using the CLI, I can create a business network card
+        Given I have the following items
+            | ../hlfv1/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/signcerts |
+            | ../hlfv1/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/keystore |
+            | ../profiles/basic-connection-org1.json |
+        When I run the following CLI command
+            | command | composer card create |",12,2017-11-17 17:37:43,https://api.github.com/repos/hyperledger/composer/pulls/comments/151738824,https://github.com/hyperledger/composer/pull/2690#discussion_r151738824,nklincoln
https://github.com/hyperledger/composer/pull/2690,https://github.com/hyperledger/composer/pull/2690,ah - good idea .. .and done!,db1ee32009d092832e485056def78c561e841ee7,2017-11-17 17:27:40,151742926,"@@ -0,0 +1,358 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+const IdCard = require('composer-common').IdCard;
+const net = require('net');
+const path = require('path');
+const sleep = require('sleep-promise');
+const fs = require('fs');
+const childProcess = require('child_process');
+
+let generated = false;
+
+/**
+ * Trick browserify by making the ID parameter to require dynamic.
+ * @param {string} id The module ID.
+ * @return {*} The module.
+ */
+function dynamicRequire(id) {
+    return require(id);
+}
+
+/**
+ * A class that handles all of the interactions with a business network for
+ * a currently executing Cucumber scenario and steps.
+ */
+class Composer {
+
+    /**
+     * Constructor.
+     * @param {string} uri The URI of the currently executing Cucumber scenario.
+     * @param {boolean} errorExpected Is an error expected in this Cucumber scenario?
+     */
+    constructor(uri, errorExpected) {
+        this.uri = uri;
+        this.errorExpected = errorExpected;
+        this.error = null;
+        this.lastResp = null;
+    }
+
+    /**
+     * Check to see if running in Hyperledger Fabric mode.
+     * @return {boolean} True if running in Hyperledger Fabric mode, false if not.
+     */
+    static isHyperledgerFabricV1() {
+        return process.env.INTEST && process.env.INTEST.match('^hlfv1.*');
+    }
+
+    /**
+     * Wait for the specified hostname to start listening on the specified port.
+     * @param {string} hostname - the hostname.
+     * @param {integer} port - the port.
+     * @return {Promise} - a promise that will be resolved when the specified
+     * hostname to start listening on the specified port.
+     */
+    static waitForPort(hostname, port) {
+        let waitTime = 30;
+        if (process.env.COMPOSER_PORT_WAIT_SECS) {
+            waitTime = parseInt(process.env.COMPOSER_PORT_WAIT_SECS);
+        }
+        return new Promise(function (resolve, reject) {
+            let testConnect = function (count) {
+                let s = new net.Socket();
+                s.on('error', function (error) {
+                    if (count > waitTime) {
+                        return reject(error);
+                    } else {
+                        setTimeout(function () {
+                            testConnect(count + 1);
+                        }, 1000);
+                    }
+                });
+                s.on('connect', function () {
+                    s.end();
+                    return resolve();
+                });
+                s.connect(port, hostname);
+            };
+            testConnect(0);
+        });
+    }
+
+    /**
+     * Wait for the peer on the specified hostname and port to start listening
+     * on the specified port.
+     * @return {Promise} - a promise that will be resolved when the peer has
+     * started listening on the specified port.
+     */
+    static waitForPorts() {
+        // startsWith not available in browser test environment
+        if (process.env.INTEST.match('^hlfv1')) {
+            return Promise.resolve();
+        }
+        return Composer.waitForPort('localhost', 7050)
+            .then(() => {
+                return Composer.waitForPort('localhost', 7051);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7052);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7053);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7054);
+            })
+            .then(() => {
+                return sleep(5000);
+            });
+    }
+
+    /**
+     * Creates crypto material
+     * @return {Promise} - a promise that will be resolved when crypto material is created or rejected with failure
+     */
+    setup() {
+        if(generated) {
+            return Promise.resolve();
+        } else {
+            const adminConnection = new AdminConnection();
+            return Composer.waitForPorts()
+            .then(() => {
+                if (Composer.isHyperledgerFabricV1()) {
+                    let fs = dynamicRequire('fs');
+                    const admins = [
+                        { org: 'org1', keyFile: 'key.pem', profile : 'org1-only' },
+                        { org: 'org2', keyFile: 'key.pem', profile : 'org2-only' },
+                        { org: 'org1', keyFile: 'key.pem', profile : 'org1' },
+                        { org: 'org2', keyFile: 'key.pem', profile : 'org2' }
+                    ];
+                    return admins.reduce((promise, admin) => {
+                        const org = admin.org;
+                        const prof = admin.profile;
+                        const keyFile = admin.keyFile;
+                        return promise.then(() => {
+                            let keyPath = path.join(__dirname, `../hlfv1/crypto-config/peerOrganizations/${org}.example.com/users/Admin@${org}.example.com/msp/keystore/${keyFile}`);
+                            let certPath = path.join(__dirname, `../hlfv1/crypto-config/peerOrganizations/${org}.example.com/users/Admin@${org}.example.com/msp/signcerts/Admin@${org}.example.com-cert.pem`);
+                            let cert = fs.readFileSync(certPath).toString();
+                            let key = fs.readFileSync(keyPath).toString();
+
+                            // set if the options have been given into the metadata
+                            let metadata = {
+                                version:1,
+                                userName : `TestPeerAdmin@${prof}`,
+                                roles : 'PeerAdmin',
+                            };
+
+                            let profile;
+                            if(process.env.INTEST.match('tls$')){
+                                let profilePath = path.join(__dirname, `../profiles/tls-connection-${prof}.json`);
+                                profile = fs.readFileSync(profilePath, 'utf8');
+                            } else {
+                                let profilePath = path.join(__dirname, `../profiles/basic-connection-${prof}.json`);
+                                profile = fs.readFileSync(profilePath, 'utf8');
+                            }
+
+                            let idCard = new IdCard(metadata, JSON.parse(profile));
+
+                            // certificates & privateKey
+                            const newCredentials = { };
+                            newCredentials.certificate = cert;
+                            newCredentials.privateKey =  key;
+
+                            idCard.setCredentials(newCredentials);
+                            let cardName = `TestPeerAdmin@${prof}`;
+
+                            this.containsCard(adminConnection, cardName)
+                            .then((exists) => {
+                                if(exists) {
+                                    console.log('skipping card import of existing card: ', cardName);
+                                    return Promise.resolve();
+                                } else {
+                                    console.log('importing card: ', cardName);
+                                    return adminConnection.importCard(cardName, idCard);
+                                }
+                            });
+                        });
+                    }, Promise.resolve());
+                }
+            })
+            .then(() => {
+                generated = true;
+                return Promise.resolve();
+            })
+            .catch((err) => {
+                return Promise.reject(err);
+            });
+        }
+    }
+
+    /**
+     * Check if card already exists
+     * @param {AdminConnection} adminConnection array of cards to check
+     * @param {string} cardName card to check for
+     * @returns {Promise} boolean true if card exists
+     */
+    containsCard(adminConnection, cardName) {
+        return adminConnection.cardStore.get(cardName)
+        .then((card)=>{
+            return Promise.resolve(true);
+        })
+        .catch((err) => {
+            return Promise.resolve(false);
+        });
+    }
+
+    /**
+     * Check that the provided list of items (files or folders) exist
+     * @param {String} type -  type (folder or file) that is being considered
+     * @param {DataTable} table -  DataTable listing the business networks expeted to exist
+     * @return {Promise} - Pomise that will be resolved or rejected with an error
+     */
+    checkExists(type, table) {
+        const rows = table.raw();
+        return new Promise((resolve, reject) => {
+            rows.forEach((row) => {",,2017-11-17 17:37:43,https://api.github.com/repos/hyperledger/composer/pulls/comments/151742926,https://github.com/hyperledger/composer/pull/2690#discussion_r151742926,nklincoln
https://github.com/hyperledger/composer/pull/2690,https://github.com/hyperledger/composer/pull/2690,<shrugs> ,db1ee32009d092832e485056def78c561e841ee7,2017-11-17 17:28:12,151743057,"@@ -0,0 +1,358 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+const IdCard = require('composer-common').IdCard;
+const net = require('net');
+const path = require('path');
+const sleep = require('sleep-promise');
+const fs = require('fs');
+const childProcess = require('child_process');
+
+let generated = false;
+
+/**
+ * Trick browserify by making the ID parameter to require dynamic.
+ * @param {string} id The module ID.
+ * @return {*} The module.
+ */
+function dynamicRequire(id) {
+    return require(id);
+}
+
+/**
+ * A class that handles all of the interactions with a business network for
+ * a currently executing Cucumber scenario and steps.
+ */
+class Composer {
+
+    /**
+     * Constructor.
+     * @param {string} uri The URI of the currently executing Cucumber scenario.
+     * @param {boolean} errorExpected Is an error expected in this Cucumber scenario?
+     */
+    constructor(uri, errorExpected) {
+        this.uri = uri;
+        this.errorExpected = errorExpected;
+        this.error = null;
+        this.lastResp = null;
+    }
+
+    /**
+     * Check to see if running in Hyperledger Fabric mode.
+     * @return {boolean} True if running in Hyperledger Fabric mode, false if not.
+     */
+    static isHyperledgerFabricV1() {
+        return process.env.INTEST && process.env.INTEST.match('^hlfv1.*');
+    }
+
+    /**
+     * Wait for the specified hostname to start listening on the specified port.
+     * @param {string} hostname - the hostname.
+     * @param {integer} port - the port.
+     * @return {Promise} - a promise that will be resolved when the specified
+     * hostname to start listening on the specified port.
+     */
+    static waitForPort(hostname, port) {
+        let waitTime = 30;
+        if (process.env.COMPOSER_PORT_WAIT_SECS) {
+            waitTime = parseInt(process.env.COMPOSER_PORT_WAIT_SECS);
+        }
+        return new Promise(function (resolve, reject) {
+            let testConnect = function (count) {
+                let s = new net.Socket();
+                s.on('error', function (error) {
+                    if (count > waitTime) {
+                        return reject(error);
+                    } else {
+                        setTimeout(function () {
+                            testConnect(count + 1);
+                        }, 1000);
+                    }
+                });
+                s.on('connect', function () {
+                    s.end();
+                    return resolve();
+                });
+                s.connect(port, hostname);
+            };
+            testConnect(0);
+        });
+    }
+
+    /**
+     * Wait for the peer on the specified hostname and port to start listening
+     * on the specified port.
+     * @return {Promise} - a promise that will be resolved when the peer has
+     * started listening on the specified port.
+     */
+    static waitForPorts() {
+        // startsWith not available in browser test environment
+        if (process.env.INTEST.match('^hlfv1')) {
+            return Promise.resolve();
+        }
+        return Composer.waitForPort('localhost', 7050)
+            .then(() => {
+                return Composer.waitForPort('localhost', 7051);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7052);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7053);
+            })
+            .then(() => {
+                return Composer.waitForPort('localhost', 7054);
+            })
+            .then(() => {
+                return sleep(5000);
+            });
+    }
+
+    /**
+     * Creates crypto material
+     * @return {Promise} - a promise that will be resolved when crypto material is created or rejected with failure
+     */
+    setup() {
+        if(generated) {
+            return Promise.resolve();
+        } else {
+            const adminConnection = new AdminConnection();
+            return Composer.waitForPorts()
+            .then(() => {
+                if (Composer.isHyperledgerFabricV1()) {
+                    let fs = dynamicRequire('fs');
+                    const admins = [
+                        { org: 'org1', keyFile: 'key.pem', profile : 'org1-only' },
+                        { org: 'org2', keyFile: 'key.pem', profile : 'org2-only' },
+                        { org: 'org1', keyFile: 'key.pem', profile : 'org1' },
+                        { org: 'org2', keyFile: 'key.pem', profile : 'org2' }
+                    ];
+                    return admins.reduce((promise, admin) => {
+                        const org = admin.org;
+                        const prof = admin.profile;
+                        const keyFile = admin.keyFile;
+                        return promise.then(() => {
+                            let keyPath = path.join(__dirname, `../hlfv1/crypto-config/peerOrganizations/${org}.example.com/users/Admin@${org}.example.com/msp/keystore/${keyFile}`);
+                            let certPath = path.join(__dirname, `../hlfv1/crypto-config/peerOrganizations/${org}.example.com/users/Admin@${org}.example.com/msp/signcerts/Admin@${org}.example.com-cert.pem`);
+                            let cert = fs.readFileSync(certPath).toString();
+                            let key = fs.readFileSync(keyPath).toString();
+
+                            // set if the options have been given into the metadata
+                            let metadata = {
+                                version:1,
+                                userName : `TestPeerAdmin@${prof}`,
+                                roles : 'PeerAdmin',
+                            };
+
+                            let profile;
+                            if(process.env.INTEST.match('tls$')){
+                                let profilePath = path.join(__dirname, `../profiles/tls-connection-${prof}.json`);
+                                profile = fs.readFileSync(profilePath, 'utf8');
+                            } else {
+                                let profilePath = path.join(__dirname, `../profiles/basic-connection-${prof}.json`);
+                                profile = fs.readFileSync(profilePath, 'utf8');
+                            }
+
+                            let idCard = new IdCard(metadata, JSON.parse(profile));
+
+                            // certificates & privateKey
+                            const newCredentials = { };
+                            newCredentials.certificate = cert;
+                            newCredentials.privateKey =  key;
+
+                            idCard.setCredentials(newCredentials);
+                            let cardName = `TestPeerAdmin@${prof}`;
+
+                            this.containsCard(adminConnection, cardName)
+                            .then((exists) => {
+                                if(exists) {
+                                    console.log('skipping card import of existing card: ', cardName);
+                                    return Promise.resolve();
+                                } else {
+                                    console.log('importing card: ', cardName);
+                                    return adminConnection.importCard(cardName, idCard);
+                                }
+                            });
+                        });
+                    }, Promise.resolve());
+                }
+            })
+            .then(() => {
+                generated = true;
+                return Promise.resolve();
+            })
+            .catch((err) => {
+                return Promise.reject(err);
+            });
+        }
+    }
+
+    /**
+     * Check if card already exists
+     * @param {AdminConnection} adminConnection array of cards to check
+     * @param {string} cardName card to check for
+     * @returns {Promise} boolean true if card exists
+     */
+    containsCard(adminConnection, cardName) {
+        return adminConnection.cardStore.get(cardName)
+        .then((card)=>{
+            return Promise.resolve(true);
+        })
+        .catch((err) => {
+            return Promise.resolve(false);
+        });
+    }
+
+    /**
+     * Check that the provided list of items (files or folders) exist
+     * @param {String} type -  type (folder or file) that is being considered
+     * @param {DataTable} table -  DataTable listing the business networks expeted to exist
+     * @return {Promise} - Pomise that will be resolved or rejected with an error
+     */
+    checkExists(type, table) {
+        const rows = table.raw();
+        return new Promise((resolve, reject) => {
+            rows.forEach((row) => {
+                let itemPath = path.resolve(__dirname, row[0]);
+                if ( !fs.existsSync(itemPath) ) {
+                    reject('[' + row +'] does not exist.');
+                }
+            });
+            resolve();
+        });
+    }
+
+    /**
+     * Prepare CLI Command to run
+     * @param {DataTable} table -  Information listing the CLI command and parameters to be run
+     * @return {Promise} - Promise that will be resolved or rejected with an error
+     */
+    runCLI(table) {
+        if (typeof table === 'string') {
+            return this._runCLI(table);
+        } else {
+            return this._runCLI(this.convertTableToCommand(table));
+        }
+    }
+
+    /**
+     * Convert a prameterised table into a string command to run
+     * @param {DataTable} table -  DataTable listing the CLI command and parameters to be run
+     * @return {String} - String command based upon the input table
+     */
+    convertTableToCommand(table) {
+        let command = '';
+        const data = table.rowsHash();
+        Object.keys(data).forEach((key) => {
+            if (key === 'command') {
+                command += data[key] + ' ';
+            } else {
+                command += key + ' ' + data[key] + ' ';
+            }
+        });
+        return command;
+    }
+
+    /**
+     * Run a composer CLI command
+     * @param {DataTable} table -  DataTable listing the CLI command and parameters to be run
+     * @return {Promise} - Promise that will be resolved or rejected with an error
+     */
+    _runCLI(table) {
+        if (typeof table !== 'string') {
+            return Promise.reject('Command passed to function was not a string');
+        } else {
+            let command = table;
+            let stdout = '';
+            let stderr = '';
+
+            //console.log(command);
+
+            return new Promise( (resolve, reject) => {
+
+                let childCliProcess = childProcess.exec(command);
+
+                childCliProcess.stdout.setEncoding('utf8');
+                childCliProcess.stderr.setEncoding('utf8');
+
+                childCliProcess.stdout.on('data', (data) => {
+                    stdout += data;",271,2017-11-17 17:37:43,https://api.github.com/repos/hyperledger/composer/pulls/comments/151743057,https://github.com/hyperledger/composer/pull/2690#discussion_r151743057,nklincoln
https://github.com/hyperledger/composer/pull/2635,https://github.com/hyperledger/composer/pull/2635,This solution works but isn't the correct one. The problem is that becuase we are using behaviourSubject is stores the last value given to it and when you subscribe you receive that value so when you switch page and come back it gets a businessNetworkChangedEvent and becuase everything is valid it enables the deploy button. The solution is to change the behaviourSubject to just a subject,dea79f8dba18b5465c815c87bde2d5d8a6512e02,2017-11-08 18:19:22,149753533,"@@ -445,6 +445,7 @@ export class EditorComponent implements OnInit, OnDestroy {
             .then(() => {
                 this.dirty = false;
                 this.deploying = false;
+                this.fileService.businessNetworkChanged$.next(false);",,2017-11-13 17:48:10,https://api.github.com/repos/hyperledger/composer/pulls/comments/149753533,https://github.com/hyperledger/composer/pull/2635#discussion_r149753533,cazfletch
https://github.com/hyperledger/composer/pull/2632,https://github.com/hyperledger/composer/pull/2632,can't this just be null,5e256f91d0a355d8834b30ff3980d0752622c641,2017-11-08 17:04:33,149732765,"@@ -455,7 +455,15 @@ class BusinessNetworkConnection extends EventEmitter {
             })
             .then((connection) => {
                 LOG.exit(method);
-                return this._connectionLogin(connection,this.card.getUserName(),this.card.getEnrollmentCredentials().secret);
+
+                let secret = this.card.getEnrollmentCredentials();
+                if (!secret){
+                    secret='na';",,2017-11-08 19:20:05,https://api.github.com/repos/hyperledger/composer/pulls/comments/149732765,https://github.com/hyperledger/composer/pull/2632#discussion_r149732765,cazfletch
https://github.com/hyperledger/composer/pull/2632,https://github.com/hyperledger/composer/pull/2632,apparently not because it has to be a string,5e256f91d0a355d8834b30ff3980d0752622c641,2017-11-08 17:19:42,149737332,"@@ -455,7 +455,15 @@ class BusinessNetworkConnection extends EventEmitter {
             })
             .then((connection) => {
                 LOG.exit(method);
-                return this._connectionLogin(connection,this.card.getUserName(),this.card.getEnrollmentCredentials().secret);
+
+                let secret = this.card.getEnrollmentCredentials();
+                if (!secret){
+                    secret='na';",,2017-11-08 19:20:05,https://api.github.com/repos/hyperledger/composer/pulls/comments/149737332,https://github.com/hyperledger/composer/pull/2632#discussion_r149737332,cazfletch
https://github.com/hyperledger/composer/pull/2569,https://github.com/hyperledger/composer/pull/2569,"Sorry Nick, it's 'targets' not 'peers'",f90c1446d84d2a2f98ef8fe19b6f2f108d01fd1f,2017-11-06 12:20:33,149064917,"@@ -738,9 +738,11 @@ class HLFConnection extends Connection {
         });
 
         let txId = this.client.newTransactionID();
+        let peerArray = [this.channel.getPeers()[0]];
 
         // Submit the query request.
         const request = {
+            peers: peerArray,",,2017-11-06 20:24:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/149064917,https://github.com/hyperledger/composer/pull/2569#discussion_r149064917,davidkel
https://github.com/hyperledger/composer/pull/2569,https://github.com/hyperledger/composer/pull/2569,See above,f90c1446d84d2a2f98ef8fe19b6f2f108d01fd1f,2017-11-06 12:21:32,149065098,"@@ -2043,7 +2043,8 @@ describe('HLFConnection', () => {
                         chaincodeVersion: connectorPackageJSON.version,
                         txId: mockTransactionID,
                         fcn: 'myfunc',
-                        args: ['arg1', 'arg2']
+                        args: ['arg1', 'arg2'],
+                        peers: [mockPeer]",,2017-11-06 20:24:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/149065098,https://github.com/hyperledger/composer/pull/2569#discussion_r149065098,davidkel
https://github.com/hyperledger/composer/pull/2536,https://github.com/hyperledger/composer/pull/2536,Typo for `8-8-` here?,5306ec1b2443c08afc823b15b2700f24339aa24d,2017-11-03 07:28:10,148719898,"@@ -1,4 +1,4 @@
-FROM ppc64le/node:6.11
+FROM ppc64le/node:8-8-alpine",,2017-11-03 09:12:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/148719898,https://github.com/hyperledger/composer/pull/2536#discussion_r148719898,sstone1
https://github.com/hyperledger/composer/pull/2536,https://github.com/hyperledger/composer/pull/2536,Typo for `8-8-` here?,5306ec1b2443c08afc823b15b2700f24339aa24d,2017-11-03 07:28:30,148719937,"@@ -1,4 +1,4 @@
-FROM ppc64le/node:6.11
+FROM ppc64le/node:8-8-alpine",,2017-11-03 09:12:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/148719937,https://github.com/hyperledger/composer/pull/2536#discussion_r148719937,sstone1
https://github.com/hyperledger/composer/pull/2536,https://github.com/hyperledger/composer/pull/2536,Typo for `8-8-` here?,5306ec1b2443c08afc823b15b2700f24339aa24d,2017-11-03 07:28:36,148719948,"@@ -1,4 +1,4 @@
-FROM ppc64le/node:6.11
+FROM ppc64le/node:8-8-alpine",,2017-11-03 09:12:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/148719948,https://github.com/hyperledger/composer/pull/2536#discussion_r148719948,sstone1
https://github.com/hyperledger/composer/pull/2522,https://github.com/hyperledger/composer/pull/2522,"Might be worth breaking out these functions that are shared between more than one command into a utility/helper class rather than have one command reference another, but that can be tackled later.",8b15ddb337d23612132bdea2012464083d303fca,2017-11-02 16:45:56,148591822,"@@ -62,8 +62,8 @@ class IssueCard {
                     businessNetwork : issuingCard.getBusinessNetworkName()
                 };
 
-                let idCard = new IdCard(metadata,issuingCard.getConnectionProfile());
-                return Export.writeCardToFile(argv.file,idCard);
+                // re-use the logic in the create command to create the id card
+                return Create.createCard(metadata,issuingCard.getConnectionProfile(),argv);",,2017-11-03 09:35:04,https://api.github.com/repos/hyperledger/composer/pulls/comments/148591822,https://github.com/hyperledger/composer/pull/2522#discussion_r148591822,bestbeforetoday
https://github.com/hyperledger/composer/pull/2522,https://github.com/hyperledger/composer/pull/2522,Is it worth renaming `issuecard.js` to `issue.js` to be consistent with all the other command code?,8b15ddb337d23612132bdea2012464083d303fca,2017-11-02 16:48:00,148592471,"@@ -14,60 +14,26 @@
 
 'use strict';
 
-const Issue = require ('./lib/issue.js');
 const IssueCard = require ('./lib/issuecard.js');",,2017-11-03 09:35:04,https://api.github.com/repos/hyperledger/composer/pulls/comments/148592471,https://github.com/hyperledger/composer/pull/2522#discussion_r148592471,bestbeforetoday
https://github.com/hyperledger/composer/pull/2522,https://github.com/hyperledger/composer/pull/2522,I'm not a fan of mocking the IdCard when it is just as easy to use a real one and that guarantees we're seeing real behaviour.,8b15ddb337d23612132bdea2012464083d303fca,2017-11-02 16:50:14,148593209,"@@ -39,56 +39,48 @@ describe('composer identity issue CLI unit tests', () => {
     let mockBusinessNetworkConnection;
     let mockAdminConnection;
     let mockIdCard;
+    let cardBuffer;
 
     beforeEach(() => {
         sandbox = sinon.sandbox.create();
         mockBusinessNetworkConnection = sinon.createStubInstance(BusinessNetworkConnection);
         mockAdminConnection = sinon.createStubInstance(AdminConnection);
         mockIdCard = sinon.createStubInstance(IdCard);
-        mockBusinessNetworkConnection.connect.resolves();
+        mockIdCard.toArchive.resolves(cardBuffer);",,2017-11-03 09:35:04,https://api.github.com/repos/hyperledger/composer/pulls/comments/148593209,https://github.com/hyperledger/composer/pull/2522#discussion_r148593209,bestbeforetoday
https://github.com/hyperledger/composer/pull/2522,https://github.com/hyperledger/composer/pull/2522,`cardBuffer` is never assigned a value. I guess this must be redundant?,8b15ddb337d23612132bdea2012464083d303fca,2017-11-02 16:51:22,148593544,"@@ -39,56 +39,48 @@ describe('composer identity issue CLI unit tests', () => {
     let mockBusinessNetworkConnection;
     let mockAdminConnection;
     let mockIdCard;
+    let cardBuffer;
 
     beforeEach(() => {
         sandbox = sinon.sandbox.create();
         mockBusinessNetworkConnection = sinon.createStubInstance(BusinessNetworkConnection);
         mockAdminConnection = sinon.createStubInstance(AdminConnection);
         mockIdCard = sinon.createStubInstance(IdCard);
-        mockBusinessNetworkConnection.connect.resolves();
+        mockIdCard.toArchive.resolves(cardBuffer);",,2017-11-03 09:35:04,https://api.github.com/repos/hyperledger/composer/pulls/comments/148593544,https://github.com/hyperledger/composer/pull/2522#discussion_r148593544,bestbeforetoday
https://github.com/hyperledger/composer/pull/2522,https://github.com/hyperledger/composer/pull/2522,I don't spot anywhere in these tests that is checking a card gets produced correctly.,8b15ddb337d23612132bdea2012464083d303fca,2017-11-02 17:00:12,148596254,"@@ -205,7 +169,7 @@ describe('composer identity issue CLI unit tests', () => {
 
     it('should issue a new card using the specified profile', () => {",207,2017-11-03 09:35:04,https://api.github.com/repos/hyperledger/composer/pulls/comments/148596254,https://github.com/hyperledger/composer/pull/2522#discussion_r148596254,bestbeforetoday
https://github.com/hyperledger/composer/pull/2521,https://github.com/hyperledger/composer/pull/2521,Not used.,1b976a270657a57219d881217784dab482f5ae37,2017-11-01 16:52:12,148317454,"@@ -174,6 +175,7 @@ describe('ResourceComponent', () => {
     describe('#generateResource', () => {
         let mockClassDeclaration;
         let mockModelFile;
+        let mockValidator;",,2017-11-01 17:35:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/148317454,https://github.com/hyperledger/composer/pull/2521#discussion_r148317454,bestbeforetoday
https://github.com/hyperledger/composer/pull/2521,https://github.com/hyperledger/composer/pull/2521,Should return a String?,1b976a270657a57219d881217784dab482f5ae37,2017-11-01 16:56:56,148318687,"@@ -182,11 +184,15 @@ describe('ResourceComponent', () => {
             mockClassDeclaration.getModelFile.returns(mockModelFile);
             mockClassDeclaration.getName.returns('class.declaration');
             mockClassDeclaration.getIdentifierFieldName.returns('resourceId');
-
         });
 
-        it('should generate a valid resource with undefined', () => {
-
+        it('should generate a valid resource with an empty ID', () => {
+            let mockField = {
+                getValidator: () => {
+                    return true;",,2017-11-01 17:35:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/148318687,https://github.com/hyperledger/composer/pull/2521#discussion_r148318687,bestbeforetoday
https://github.com/hyperledger/composer/pull/2521,https://github.com/hyperledger/composer/pull/2521,"You know the identifier field name (in the `beforeEach`) so might be worth pulling that out to a variable and using `mockClassDeclaration.getOwnProperty.calledWith(idFieldName).returns(mockField);`. This is saying that all field names exist and return the same mock, but maybe that's OK.",1b976a270657a57219d881217784dab482f5ae37,2017-11-01 16:59:00,148319277,"@@ -182,11 +184,15 @@ describe('ResourceComponent', () => {
             mockClassDeclaration.getModelFile.returns(mockModelFile);
             mockClassDeclaration.getName.returns('class.declaration');
             mockClassDeclaration.getIdentifierFieldName.returns('resourceId');
-
         });
 
-        it('should generate a valid resource with undefined', () => {
-
+        it('should generate a valid resource with an empty ID', () => {
+            let mockField = {
+                getValidator: () => {
+                    return true;
+                }
+            };
+            mockClassDeclaration.getOwnProperty.returns(mockField);",,2017-11-01 17:35:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/148319277,https://github.com/hyperledger/composer/pull/2521#discussion_r148319277,bestbeforetoday
https://github.com/hyperledger/composer/pull/2521,https://github.com/hyperledger/composer/pull/2521,Same comment as above.,1b976a270657a57219d881217784dab482f5ae37,2017-11-01 17:00:16,148319650,"@@ -289,7 +295,51 @@ describe('ResourceComponent', () => {
 
         });
 
+        it('should generate a valid resource with a random 4-digit ID', () => {
+            let mockField = {
+                getValidator: () => {
+                    return false;
+                }
+            };
+            mockClassDeclaration.getOwnProperty.returns(mockField);",,2017-11-01 17:35:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/148319650,https://github.com/hyperledger/composer/pull/2521#discussion_r148319650,bestbeforetoday
https://github.com/hyperledger/composer/pull/2521,https://github.com/hyperledger/composer/pull/2521,Same comment as above.,1b976a270657a57219d881217784dab482f5ae37,2017-11-01 17:01:15,148319894,"@@ -289,7 +295,51 @@ describe('ResourceComponent', () => {
 
         });
 
+        it('should generate a valid resource with a random 4-digit ID', () => {
+            let mockField = {
+                getValidator: () => {
+                    return false;
+                }
+            };
+            mockClassDeclaration.getOwnProperty.returns(mockField);
+            mockSerializer.toJSON.returns({$class: 'com.org'});
+            mockSerializer.fromJSON.returns(mockResource);
+            mockResource.validate = sandbox.stub();
+            component['resourceDeclaration'] = mockClassDeclaration;
+
+            // should start clean
+            should.not.exist(component['definitionError']);
+
+            // run method
+            component['generateResource']();
+
+            // should not result in definitionError
+            should.not.exist(component['definitionError']);
+
+            // resourceDefinition should be set as per serializer.toJSON output
+            component['resourceDefinition'].should.equal('{\n  ""$class"": ""com.org""\n}');
+
+            // We use the following internal calls
+            mockFactory.newResource.should.be.calledWith(undefined,
+                                                        'class.declaration',
+                                                        sinon.match(/[0-9]{4}/),
+                                                        {
+                                                        generate: 'empty',
+                                                        includeOptionalFields: false,
+                                                        disableValidation: true,
+                                                        allowEmptyId: true
+                                                        });
+            component.onDefinitionChanged.should.be.calledOn;
+        });
+
         it('should set definitionError on serializer fail', () => {
+            let mockField = {
+                getValidator: () => {
+                    return false;
+                }
+            };
+            mockClassDeclaration.getOwnProperty.returns(mockField);",,2017-11-01 17:35:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/148319894,https://github.com/hyperledger/composer/pull/2521#discussion_r148319894,bestbeforetoday
https://github.com/hyperledger/composer/pull/2521,https://github.com/hyperledger/composer/pull/2521,Same comment as above.,1b976a270657a57219d881217784dab482f5ae37,2017-11-01 17:01:26,148319950,"@@ -308,6 +358,13 @@ describe('ResourceComponent', () => {
         });
 
         it('should set definitionError on validation fail', () => {
+            let mockField = {
+                getValidator: () => {
+                    return false;
+                }
+            };
+            mockClassDeclaration.getOwnProperty.returns(mockField);",,2017-11-01 17:35:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/148319950,https://github.com/hyperledger/composer/pull/2521#discussion_r148319950,bestbeforetoday
https://github.com/hyperledger/composer/pull/2521,https://github.com/hyperledger/composer/pull/2521,Might be worth creating a Sinon stub instance of `Field` just as a safety net to make sure the function you're stubbing exists -- I think Sinon will complain if you add a `returns()` to a function it hasn't stubbed through introspection. Maybe that's overkill though. Your call.,1b976a270657a57219d881217784dab482f5ae37,2017-11-01 17:03:53,148320573,"@@ -289,7 +295,51 @@ describe('ResourceComponent', () => {
 
         });
 
+        it('should generate a valid resource with a random 4-digit ID', () => {
+            let mockField = {",,2017-11-01 17:35:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/148320573,https://github.com/hyperledger/composer/pull/2521#discussion_r148320573,bestbeforetoday
https://github.com/hyperledger/composer/pull/2521,https://github.com/hyperledger/composer/pull/2521,ok,1b976a270657a57219d881217784dab482f5ae37,2017-11-01 17:17:29,148324266,"@@ -174,6 +175,7 @@ describe('ResourceComponent', () => {
     describe('#generateResource', () => {
         let mockClassDeclaration;
         let mockModelFile;
+        let mockValidator;",,2017-11-01 17:35:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/148324266,https://github.com/hyperledger/composer/pull/2521#discussion_r148324266,samjsmith
https://github.com/hyperledger/composer/pull/2521,https://github.com/hyperledger/composer/pull/2521,yep,1b976a270657a57219d881217784dab482f5ae37,2017-11-01 17:17:33,148324289,"@@ -182,11 +184,15 @@ describe('ResourceComponent', () => {
             mockClassDeclaration.getModelFile.returns(mockModelFile);
             mockClassDeclaration.getName.returns('class.declaration');
             mockClassDeclaration.getIdentifierFieldName.returns('resourceId');
-
         });
 
-        it('should generate a valid resource with undefined', () => {
-
+        it('should generate a valid resource with an empty ID', () => {
+            let mockField = {
+                getValidator: () => {
+                    return true;",,2017-11-01 17:35:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/148324289,https://github.com/hyperledger/composer/pull/2521#discussion_r148324289,samjsmith
https://github.com/hyperledger/composer/pull/2521,https://github.com/hyperledger/composer/pull/2521,ok,1b976a270657a57219d881217784dab482f5ae37,2017-11-01 17:36:08,148329377,"@@ -182,11 +184,15 @@ describe('ResourceComponent', () => {
             mockClassDeclaration.getModelFile.returns(mockModelFile);
             mockClassDeclaration.getName.returns('class.declaration');
             mockClassDeclaration.getIdentifierFieldName.returns('resourceId');
-
         });
 
-        it('should generate a valid resource with undefined', () => {
-
+        it('should generate a valid resource with an empty ID', () => {
+            let mockField = {
+                getValidator: () => {
+                    return true;
+                }
+            };
+            mockClassDeclaration.getOwnProperty.returns(mockField);",,2017-11-01 17:36:08,https://api.github.com/repos/hyperledger/composer/pulls/comments/148329377,https://github.com/hyperledger/composer/pull/2521#discussion_r148329377,samjsmith
https://github.com/hyperledger/composer/pull/2521,https://github.com/hyperledger/composer/pull/2521,ok,1b976a270657a57219d881217784dab482f5ae37,2017-11-01 17:36:11,148329395,"@@ -289,7 +295,51 @@ describe('ResourceComponent', () => {
 
         });
 
+        it('should generate a valid resource with a random 4-digit ID', () => {
+            let mockField = {",,2017-11-01 17:36:11,https://api.github.com/repos/hyperledger/composer/pulls/comments/148329395,https://github.com/hyperledger/composer/pull/2521#discussion_r148329395,samjsmith
https://github.com/hyperledger/composer/pull/2521,https://github.com/hyperledger/composer/pull/2521,ok,1b976a270657a57219d881217784dab482f5ae37,2017-11-01 17:36:16,148329419,"@@ -289,7 +295,51 @@ describe('ResourceComponent', () => {
 
         });
 
+        it('should generate a valid resource with a random 4-digit ID', () => {
+            let mockField = {
+                getValidator: () => {
+                    return false;
+                }
+            };
+            mockClassDeclaration.getOwnProperty.returns(mockField);",,2017-11-01 17:36:16,https://api.github.com/repos/hyperledger/composer/pulls/comments/148329419,https://github.com/hyperledger/composer/pull/2521#discussion_r148329419,samjsmith
https://github.com/hyperledger/composer/pull/2521,https://github.com/hyperledger/composer/pull/2521,ok,1b976a270657a57219d881217784dab482f5ae37,2017-11-01 17:36:21,148329458,"@@ -289,7 +295,51 @@ describe('ResourceComponent', () => {
 
         });
 
+        it('should generate a valid resource with a random 4-digit ID', () => {
+            let mockField = {
+                getValidator: () => {
+                    return false;
+                }
+            };
+            mockClassDeclaration.getOwnProperty.returns(mockField);
+            mockSerializer.toJSON.returns({$class: 'com.org'});
+            mockSerializer.fromJSON.returns(mockResource);
+            mockResource.validate = sandbox.stub();
+            component['resourceDeclaration'] = mockClassDeclaration;
+
+            // should start clean
+            should.not.exist(component['definitionError']);
+
+            // run method
+            component['generateResource']();
+
+            // should not result in definitionError
+            should.not.exist(component['definitionError']);
+
+            // resourceDefinition should be set as per serializer.toJSON output
+            component['resourceDefinition'].should.equal('{\n  ""$class"": ""com.org""\n}');
+
+            // We use the following internal calls
+            mockFactory.newResource.should.be.calledWith(undefined,
+                                                        'class.declaration',
+                                                        sinon.match(/[0-9]{4}/),
+                                                        {
+                                                        generate: 'empty',
+                                                        includeOptionalFields: false,
+                                                        disableValidation: true,
+                                                        allowEmptyId: true
+                                                        });
+            component.onDefinitionChanged.should.be.calledOn;
+        });
+
         it('should set definitionError on serializer fail', () => {
+            let mockField = {
+                getValidator: () => {
+                    return false;
+                }
+            };
+            mockClassDeclaration.getOwnProperty.returns(mockField);",,2017-11-01 17:36:21,https://api.github.com/repos/hyperledger/composer/pulls/comments/148329458,https://github.com/hyperledger/composer/pull/2521#discussion_r148329458,samjsmith
https://github.com/hyperledger/composer/pull/2521,https://github.com/hyperledger/composer/pull/2521,plz re-review,1b976a270657a57219d881217784dab482f5ae37,2017-11-01 17:36:30,148329499,"@@ -308,6 +358,13 @@ describe('ResourceComponent', () => {
         });
 
         it('should set definitionError on validation fail', () => {
+            let mockField = {
+                getValidator: () => {
+                    return false;
+                }
+            };
+            mockClassDeclaration.getOwnProperty.returns(mockField);",,2017-11-01 17:36:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/148329499,https://github.com/hyperledger/composer/pull/2521#discussion_r148329499,samjsmith
https://github.com/hyperledger/composer/pull/2515,https://github.com/hyperledger/composer/pull/2515,I don't think you will care about the time it takes to create a composite key. This is actually a very simple method that just does string concatenation.,ca6fad285c9db49922aa0da0eb9173748850629f,2017-11-01 11:47:51,148240306,"@@ -121,23 +133,35 @@ func (dataCollection *DataCollection) getAll(vm *duktape.Context) (result int) {
 
 	}
 
+	logger.Debug(""@perf DataCollection.getAll key-iterator duration for ["", dataCollection.CollectionID, ""] and transaction ["", dataCollection.Stub.GetTxID(),""] :"", time.Now().Sub(increment))
+	increment = time.Now();
+
 	// Call the callback.
 	vm.Dup(0)
 	vm.PushNull()
 	vm.Dup(arrIdx)
 	vm.Pcall(2)
+
+	logger.Debug(""@perf DataCollection.getAll callback duration for ["", dataCollection.CollectionID, ""] and transaction ["", dataCollection.Stub.GetTxID(),""] :"", time.Now().Sub(increment))
+	
 	return 0
 }
 
 // get retrieves a specific object in this collection from the world state.
 func (dataCollection *DataCollection) get(vm *duktape.Context) (result int) {
 	logger.Debug(""Entering DataCollection.get"", vm)
+
+	start := time.Now()
+	defer func() { logger.Debug(""@perf DataCollection.get total duration for ["", dataCollection.CollectionID, ""] and transaction ["", dataCollection.Stub.GetTxID(),""] :"", time.Now().Sub(start)) }()
+	
 	defer func() { logger.Debug(""Exiting DataCollection.get"", result) }()
 
 	// Validate the arguments from JavaScript.
 	id := vm.RequireString(0)
 	vm.RequireFunction(1)
 
+	increment := time.Now();",,2017-11-01 15:15:59,https://api.github.com/repos/hyperledger/composer/pulls/comments/148240306,https://github.com/hyperledger/composer/pull/2515#discussion_r148240306,davidkel
https://github.com/hyperledger/composer/pull/2515,https://github.com/hyperledger/composer/pull/2515,same comment about createCompositeKey,ca6fad285c9db49922aa0da0eb9173748850629f,2017-11-01 11:48:32,148240429,"@@ -203,6 +241,9 @@ func (dataCollection *DataCollection) exists(vm *duktape.Context) (result int) {
 		return 0
 	}
 
+	logger.Debug(""@perf DataCollection.get CreateCompositeKey duration for ["", dataCollection.CollectionID, ""] and transaction ["", dataCollection.Stub.GetTxID(),""] :"", time.Now().Sub(increment))",,2017-11-01 15:15:59,https://api.github.com/repos/hyperledger/composer/pulls/comments/148240429,https://github.com/hyperledger/composer/pull/2515#discussion_r148240429,davidkel
https://github.com/hyperledger/composer/pull/2515,https://github.com/hyperledger/composer/pull/2515,same about createCompositeKey,ca6fad285c9db49922aa0da0eb9173748850629f,2017-11-01 11:49:00,148240503,"@@ -252,6 +304,8 @@ func (dataCollection *DataCollection) add(vm *duktape.Context) (result int) {
 		return 0
 	}
 
+	logger.Debug(""@perf DataCollection.get CreateCompositeKey duration for ["", dataCollection.CollectionID, ""] and transaction ["", dataCollection.Stub.GetTxID(),""] :"", time.Now().Sub(increment))",,2017-11-01 15:15:59,https://api.github.com/repos/hyperledger/composer/pulls/comments/148240503,https://github.com/hyperledger/composer/pull/2515#discussion_r148240503,davidkel
https://github.com/hyperledger/composer/pull/2515,https://github.com/hyperledger/composer/pull/2515,same comment about createCompositeKey,ca6fad285c9db49922aa0da0eb9173748850629f,2017-11-01 11:49:39,148240606,"@@ -319,6 +387,9 @@ func (dataCollection *DataCollection) update(vm *duktape.Context) (result int) {
 		return 0
 	}
 
+	logger.Debug(""@perf DataCollection.update CreateCompositeKey duration for collection ["",dataCollection.CollectionID, ""] and transaction ["", dataCollection.Stub.GetTxID(),""] :"", time.Now().Sub(increment))",,2017-11-01 15:15:59,https://api.github.com/repos/hyperledger/composer/pulls/comments/148240606,https://github.com/hyperledger/composer/pull/2515#discussion_r148240606,davidkel
https://github.com/hyperledger/composer/pull/2515,https://github.com/hyperledger/composer/pull/2515,same comment about createCompositeKey,ca6fad285c9db49922aa0da0eb9173748850629f,2017-11-01 11:50:21,148240742,"@@ -378,6 +463,9 @@ func (dataCollection *DataCollection) remove(vm *duktape.Context) (result int) {
 		return 0
 	}
 
+	logger.Debug(""@perf DataCollection.remove CreateCompositeKey duration for collection ["",dataCollection.CollectionID, ""] and transaction ["", dataCollection.Stub.GetTxID(),""] :"", time.Now().Sub(increment))",,2017-11-01 15:15:59,https://api.github.com/repos/hyperledger/composer/pulls/comments/148240742,https://github.com/hyperledger/composer/pull/2515#discussion_r148240742,davidkel
https://github.com/hyperledger/composer/pull/2515,https://github.com/hyperledger/composer/pull/2515,minor spelling mistake :-),ca6fad285c9db49922aa0da0eb9173748850629f,2017-11-01 11:53:21,148241267,"@@ -254,18 +279,26 @@ func (dataService *DataService) getCollection(vm *duktape.Context) (result int)
 	if vm.Pcall(2) == duktape.ExecError {
 		panic(vm.ToString(-1))
 	}
+	
+	logger.Debug(""@perf DataService.getCollection callback duraion for txnId ["", dataService.Stub.GetTxID(), ""] : "", time.Now().Sub(increment))",,2017-11-01 15:15:59,https://api.github.com/repos/hyperledger/composer/pulls/comments/148241267,https://github.com/hyperledger/composer/pull/2515#discussion_r148241267,davidkel
https://github.com/hyperledger/composer/pull/2515,https://github.com/hyperledger/composer/pull/2515,createCompositeKey comment,ca6fad285c9db49922aa0da0eb9173748850629f,2017-11-01 11:53:38,148241311,"@@ -278,6 +311,9 @@ func (dataService *DataService) existsCollection(vm *duktape.Context) (result in
 		return 0
 	}
 
+	logger.Debug(""@perf DataService.existsCollection CreateCompositeKey duration for txnId ["", dataService.Stub.GetTxID(), ""] : "", time.Now().Sub(increment))",,2017-11-01 15:15:59,https://api.github.com/repos/hyperledger/composer/pulls/comments/148241311,https://github.com/hyperledger/composer/pull/2515#discussion_r148241311,davidkel
https://github.com/hyperledger/composer/pull/2515,https://github.com/hyperledger/composer/pull/2515,missed a colon,ca6fad285c9db49922aa0da0eb9173748850629f,2017-11-01 11:57:28,148242004,"@@ -350,28 +400,43 @@ func (dataService *DataService) executeQuery(vm *duktape.Context) (result int) {
 		arrNum++
 	}
 
+	logger.Debug(""@perf DataService.executeQuery resultsIterator.HasNext() duration for txnId ["", dataService.Stub.GetTxID(), ""] : "", time.Now().Sub(increment))
+	increment = time.Now();
+
 	// Call the callback.
 	vm.Dup(1)
 	vm.PushNull() // no error
 	vm.Dup(arrIdx)
 	if vm.Pcall(2) == duktape.ExecError {
 		panic(vm.ToString(-1))
 	}
+
+	logger.Debug(""@perf DataService.executeQuery callback execution duration for txnId ["", dataService.Stub.GetTxID(), ""] : "", time.Now().Sub(increment))
+	
 	return 0
 }
 
 // clearCollection is called to clear all objects from a collection.
 func (dataService *DataService) clearCollection(collectionID string) (err error) {
 	logger.Debug(""Entering DataService.clearCollection"", collectionID)
+
+	start := time.Now()
+	defer func() { logger.Debug(""@perf DataService.clearCollection total duration for txnId ["", dataService.Stub.GetTxID(), ""] : "", time.Now().Sub(start)) }()
+
 	defer func() { logger.Debug(""Exiting DataService.clearCollection"", err) }()
 
+	increment = time.Now();",,2017-11-01 15:15:59,https://api.github.com/repos/hyperledger/composer/pulls/comments/148242004,https://github.com/hyperledger/composer/pull/2515#discussion_r148242004,davidkel
https://github.com/hyperledger/composer/pull/2509,https://github.com/hyperledger/composer/pull/2509,Should this perhaps say `A business network card that you can use in Playground to connect to a business network`?,226068e337c9d798c6a9ca0e046d8b39bc6d48a8,2017-11-01 10:15:46,148223655,"@@ -16,15 +16,17 @@
                     <div class=""file-types-list"">
                         <div class=""file-types-list-item"">
                             <input type=""radio"" id=""participantCard"" name=""participant-type"" [checked]=""true""
-                                (change)=""useParticipantCardType(true)"">
+                                   (change)=""useParticipantCardType(true)"">
                             <label class=""radio-label"" for=""participantCard""><h3>Participant Card</h3></label>
-                            <div class=""description""><p>A business network card that is bound to a participant</p></div>
+                            <div class=""description""><p>A business network card that can connect to a business",,2017-11-01 11:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148223655,https://github.com/hyperledger/composer/pull/2509#discussion_r148223655,samjsmith
https://github.com/hyperledger/composer/pull/2509,https://github.com/hyperledger/composer/pull/2509,ditto the above `A business network card that can be used in Playground to install and start.....`,226068e337c9d798c6a9ca0e046d8b39bc6d48a8,2017-11-01 10:16:53,148223869,"@@ -16,15 +16,17 @@
                     <div class=""file-types-list"">
                         <div class=""file-types-list-item"">
                             <input type=""radio"" id=""participantCard"" name=""participant-type"" [checked]=""true""
-                                (change)=""useParticipantCardType(true)"">
+                                   (change)=""useParticipantCardType(true)"">
                             <label class=""radio-label"" for=""participantCard""><h3>Participant Card</h3></label>
-                            <div class=""description""><p>A business network card that is bound to a participant</p></div>
+                            <div class=""description""><p>A business network card that can connect to a business
+                                network.</p></div>
                         </div>
                         <div class=""file-types-list-item"">
                             <input type=""radio"" id=""adminCard"" name=""participant-type""
-                                (change)=""useParticipantCardType(false)"">
+                                   (change)=""useParticipantCardType(false)"">
                             <label class=""radio-label"" for=""adminCard""><h3>Admin Card</h3></label>
-                            <div class=""description""><p>A business network card that is not bound to a participant.</p></div>
+                            <div class=""description""><p>A business network card that can install and start",,2017-11-01 11:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148223869,https://github.com/hyperledger/composer/pull/2509#discussion_r148223869,samjsmith
https://github.com/hyperledger/composer/pull/2509,https://github.com/hyperledger/composer/pull/2509,"I wonder if this should be `credential` rather than `information`?
",226068e337c9d798c6a9ca0e046d8b39bc6d48a8,2017-11-01 10:20:10,148224472,"@@ -4,7 +4,7 @@
         <section class=""profiles section"">
             <div class=""description upper""><b>Provide security credentials</b></div>
             <div>
-                <p>You must provide one of two types of information to create an ID card:</p>
+                <p>You must provide one of two types of information to create a business network card:</p>",,2017-11-01 11:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148224472,https://github.com/hyperledger/composer/pull/2509#discussion_r148224472,samjsmith
https://github.com/hyperledger/composer/pull/2509,https://github.com/hyperledger/composer/pull/2509,yes i'll changes this,226068e337c9d798c6a9ca0e046d8b39bc6d48a8,2017-11-01 10:25:10,148225374,"@@ -4,7 +4,7 @@
         <section class=""profiles section"">
             <div class=""description upper""><b>Provide security credentials</b></div>
             <div>
-                <p>You must provide one of two types of information to create an ID card:</p>
+                <p>You must provide one of two types of information to create a business network card:</p>",,2017-11-01 11:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148225374,https://github.com/hyperledger/composer/pull/2509#discussion_r148225374,cazfletch
https://github.com/hyperledger/composer/pull/2509,https://github.com/hyperledger/composer/pull/2509,no because you will be able to use cards on the command line soon,226068e337c9d798c6a9ca0e046d8b39bc6d48a8,2017-11-01 10:25:32,148225442,"@@ -16,15 +16,17 @@
                     <div class=""file-types-list"">
                         <div class=""file-types-list-item"">
                             <input type=""radio"" id=""participantCard"" name=""participant-type"" [checked]=""true""
-                                (change)=""useParticipantCardType(true)"">
+                                   (change)=""useParticipantCardType(true)"">
                             <label class=""radio-label"" for=""participantCard""><h3>Participant Card</h3></label>
-                            <div class=""description""><p>A business network card that is bound to a participant</p></div>
+                            <div class=""description""><p>A business network card that can connect to a business",,2017-11-01 11:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148225442,https://github.com/hyperledger/composer/pull/2509#discussion_r148225442,cazfletch
https://github.com/hyperledger/composer/pull/2509,https://github.com/hyperledger/composer/pull/2509,ditto,226068e337c9d798c6a9ca0e046d8b39bc6d48a8,2017-11-01 10:25:41,148225476,"@@ -16,15 +16,17 @@
                     <div class=""file-types-list"">
                         <div class=""file-types-list-item"">
                             <input type=""radio"" id=""participantCard"" name=""participant-type"" [checked]=""true""
-                                (change)=""useParticipantCardType(true)"">
+                                   (change)=""useParticipantCardType(true)"">
                             <label class=""radio-label"" for=""participantCard""><h3>Participant Card</h3></label>
-                            <div class=""description""><p>A business network card that is bound to a participant</p></div>
+                            <div class=""description""><p>A business network card that can connect to a business
+                                network.</p></div>
                         </div>
                         <div class=""file-types-list-item"">
                             <input type=""radio"" id=""adminCard"" name=""participant-type""
-                                (change)=""useParticipantCardType(false)"">
+                                   (change)=""useParticipantCardType(false)"">
                             <label class=""radio-label"" for=""adminCard""><h3>Admin Card</h3></label>
-                            <div class=""description""><p>A business network card that is not bound to a participant.</p></div>
+                            <div class=""description""><p>A business network card that can install and start",,2017-11-01 11:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148225476,https://github.com/hyperledger/composer/pull/2509#discussion_r148225476,cazfletch
https://github.com/hyperledger/composer/pull/2509,https://github.com/hyperledger/composer/pull/2509,we agreed to remove the `in Playground` bit :),226068e337c9d798c6a9ca0e046d8b39bc6d48a8,2017-11-01 10:28:28,148226134,"@@ -16,15 +16,17 @@
                     <div class=""file-types-list"">
                         <div class=""file-types-list-item"">
                             <input type=""radio"" id=""participantCard"" name=""participant-type"" [checked]=""true""
-                                (change)=""useParticipantCardType(true)"">
+                                   (change)=""useParticipantCardType(true)"">
                             <label class=""radio-label"" for=""participantCard""><h3>Participant Card</h3></label>
-                            <div class=""description""><p>A business network card that is bound to a participant</p></div>
+                            <div class=""description""><p>A business network card that can connect to a business",,2017-11-01 11:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148226134,https://github.com/hyperledger/composer/pull/2509#discussion_r148226134,samjsmith
https://github.com/hyperledger/composer/pull/2509,https://github.com/hyperledger/composer/pull/2509,we agreed to remove the `in Playground` bit :),226068e337c9d798c6a9ca0e046d8b39bc6d48a8,2017-11-01 10:28:35,148226156,"@@ -16,15 +16,17 @@
                     <div class=""file-types-list"">
                         <div class=""file-types-list-item"">
                             <input type=""radio"" id=""participantCard"" name=""participant-type"" [checked]=""true""
-                                (change)=""useParticipantCardType(true)"">
+                                   (change)=""useParticipantCardType(true)"">
                             <label class=""radio-label"" for=""participantCard""><h3>Participant Card</h3></label>
-                            <div class=""description""><p>A business network card that is bound to a participant</p></div>
+                            <div class=""description""><p>A business network card that can connect to a business
+                                network.</p></div>
                         </div>
                         <div class=""file-types-list-item"">
                             <input type=""radio"" id=""adminCard"" name=""participant-type""
-                                (change)=""useParticipantCardType(false)"">
+                                   (change)=""useParticipantCardType(false)"">
                             <label class=""radio-label"" for=""adminCard""><h3>Admin Card</h3></label>
-                            <div class=""description""><p>A business network card that is not bound to a participant.</p></div>
+                            <div class=""description""><p>A business network card that can install and start",,2017-11-01 11:26:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148226156,https://github.com/hyperledger/composer/pull/2509#discussion_r148226156,samjsmith
https://github.com/hyperledger/composer/pull/2508,https://github.com/hyperledger/composer/pull/2508,How does Success become a failure...?,3c89e29ee21d56de930f772a3b0c56f1f4a2aad9,2017-10-31 09:57:54,147939500,"@@ -1647,13 +1603,13 @@ describe('HLFConnection', () => {
             mockChannel.sendInstantiateProposal.resolves([ proposalResponses, proposal, header ]);
             // This is the commit proposal and response (from the orderer).
             const response = {
-                status: 'FAILURE'
+                status: 'SUCCESS'",226,2017-10-31 09:57:55,https://api.github.com/repos/hyperledger/composer/pulls/comments/147939500,https://github.com/hyperledger/composer/pull/2508#discussion_r147939500,mbwhite
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,See #2487 for parameters run by EdM.,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 13:58:33,148003482,"@@ -15,15 +15,44 @@
 'use strict';
 
 const Create = require ('./lib/create.js');
+const permittedRoles = ['peeradmin','channeladmin','issuer'];
+
+const checkFn = (argv,options)=>{
+
+    if (argv.roles){
+        let r = argv.roles.toLowerCase().split(',');
+        let valid = r.every((e)=>{
+            return permittedRoles.includes(e);
+        });
+        if(!valid) {
+            throw new Error('Invalid role given :'+argv.roles);
+        }
+    }
+    return true;
+};
+
+module.exports._checkFn =checkFn;
 
 module.exports.command = 'create [options]';
 module.exports.describe = 'Creates a business network card from individual components';
-module.exports.builder = {
-    file: {alias: 'f', required: true, describe: 'The card file name', type: 'string' },
-    businessNetworkName: {alias: 'n', required: true, describe: 'The business network name', type: 'string' },
-    connectionProfileFile: {alias: 'j', required: false, describe: 'Filename of the connection profile json file', type: 'string' },
-    enrollId: { alias: 'i', required: false, describe: 'The enrollment ID of the user', type: 'string' },
-    enrollSecret: { alias: 's', required: false, describe: 'The enrollment secret of the user', type: 'string' }
+module.exports.builder = function (yargs) {
+    yargs.options({
+        file: {alias: 'f', required: false, describe: 'File name of the card archive to be created', type: 'string' },
+        businessNetworkName: {alias: 'n', required: false, describe: 'The business network name', type: 'string' },
+        connectionProfileFile: {alias: 'j', required: true, describe: 'Filename of the connection profile json file', type: 'string' },",39,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148003482,https://github.com/hyperledger/composer/pull/2507#discussion_r148003482,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,"Right now, Playground deals with roles case-sensitively and expects exactly _PeerAdmin_, _ChannelAdmin_ etc. I'm not convinced that is a great thing to be doing but a consideration here.",7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 13:59:41,148003788,"@@ -15,15 +15,44 @@
 'use strict';
 
 const Create = require ('./lib/create.js');
+const permittedRoles = ['peeradmin','channeladmin','issuer'];
+
+const checkFn = (argv,options)=>{
+
+    if (argv.roles){
+        let r = argv.roles.toLowerCase().split(',');",,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148003788,https://github.com/hyperledger/composer/pull/2507#discussion_r148003788,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,`metadata.roles` is an array.,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:01:39,148004296,"@@ -25,21 +25,33 @@ const path = require('path');
 class Create {
   /**
     * Command implementation.
-    * @param {Object} args argument list from composer command
+    * @param {Object} argv argument list from composer command
     * @return {Promise} promise when command complete
     */
-    static handler(args) {
+    static handler(argv) {
+
+        let profileFile  = argv.connectionProfileFile;
+        let user = argv.user;
+
+        let businessNetworkName = argv.businessNetworkName || '';
+        let fileName = argv.file || '';
+        let enrollSecret = argv.enrollSecret || '';
+        let certificate = argv.certificate || '';
+        let privateKey = argv.privateKey || '';
+        let roles = argv.roles || '';
+
+        // user & profileFile are required, others are optional
 
-        let profileFile  = args.connectionProfileFile;
-        let businessNetworkName = args.businessNetworkName;
-        let fileName = args.file;
 
         let metadata= {
-            userName : args.enrollId,
+            userName : user,
             version : 1,
-            enrollmentSecret:args.enrollSecret,
-            businessNetwork : businessNetworkName
+            enrollmentSecret: enrollSecret,
+            businessNetwork : businessNetworkName,
+            roles : roles",,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148004296,https://github.com/hyperledger/composer/pull/2507#discussion_r148004296,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,Would `p` be a better short name for connection **P**rofile?,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:06:23,148005613,"@@ -15,15 +15,44 @@
 'use strict';
 
 const Create = require ('./lib/create.js');
+const permittedRoles = ['peeradmin','channeladmin','issuer'];
+
+const checkFn = (argv,options)=>{
+
+    if (argv.roles){
+        let r = argv.roles.toLowerCase().split(',');
+        let valid = r.every((e)=>{
+            return permittedRoles.includes(e);
+        });
+        if(!valid) {
+            throw new Error('Invalid role given :'+argv.roles);
+        }
+    }
+    return true;
+};
+
+module.exports._checkFn =checkFn;
 
 module.exports.command = 'create [options]';
 module.exports.describe = 'Creates a business network card from individual components';
-module.exports.builder = {
-    file: {alias: 'f', required: true, describe: 'The card file name', type: 'string' },
-    businessNetworkName: {alias: 'n', required: true, describe: 'The business network name', type: 'string' },
-    connectionProfileFile: {alias: 'j', required: false, describe: 'Filename of the connection profile json file', type: 'string' },
-    enrollId: { alias: 'i', required: false, describe: 'The enrollment ID of the user', type: 'string' },
-    enrollSecret: { alias: 's', required: false, describe: 'The enrollment secret of the user', type: 'string' }
+module.exports.builder = function (yargs) {
+    yargs.options({
+        file: {alias: 'f', required: false, describe: 'File name of the card archive to be created', type: 'string' },
+        businessNetworkName: {alias: 'n', required: false, describe: 'The business network name', type: 'string' },
+        connectionProfileFile: {alias: 'j', required: true, describe: 'Filename of the connection profile json file', type: 'string' },",39,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148005613,https://github.com/hyperledger/composer/pull/2507#discussion_r148005613,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,What if only one is set? I guess an error is most helpful.,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:20:32,148009821,"@@ -51,15 +63,54 @@ class Create {
                     profileData.name =  path.parse(filePath).dir.split(path.sep).slice(-1)[0];
                 }
 
+                // setup the id card with the meta data
                 let idCard = new IdCard(metadata,profileData);
+
+                // certificates & privateKey
+                if (certificate && privateKey){",,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148009821,https://github.com/hyperledger/composer/pull/2507#discussion_r148009821,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,I don't think it is a good idea to be setting these values in the metadata at all if they are not specified. These default (empty string) values will still get written to the JSON when they aren't actually set at all.,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:22:28,148010361,"@@ -25,21 +25,33 @@ const path = require('path');
 class Create {
   /**
     * Command implementation.
-    * @param {Object} args argument list from composer command
+    * @param {Object} argv argument list from composer command
     * @return {Promise} promise when command complete
     */
-    static handler(args) {
+    static handler(argv) {
+
+        let profileFile  = argv.connectionProfileFile;
+        let user = argv.user;
+
+        let businessNetworkName = argv.businessNetworkName || '';
+        let fileName = argv.file || '';
+        let enrollSecret = argv.enrollSecret || '';",,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148010361,https://github.com/hyperledger/composer/pull/2507#discussion_r148010361,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,Is this testing our code or testing testing the behaviour of yargs?,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:27:05,148011857,"@@ -0,0 +1,72 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+
+const cardCommand = require('../../lib/cmds/card/createCommand.js');
+const yargs = require('yargs');
+require('chai').should();
+const chai = require('chai');
+const sinon = require('sinon');
+chai.should();
+chai.use(require('chai-things'));
+chai.use(require('chai-as-promised'));
+
+
+describe('composer participant cmd launcher unit tests', function () {
+
+    let sandbox;
+
+    beforeEach(() => {
+        sandbox = sinon.sandbox.create();
+
+        sandbox.stub(yargs, 'check').returns(yargs);
+        sandbox.stub(yargs, 'conflicts').returns(yargs);
+        sandbox.stub(yargs, 'group').returns(yargs);
+        sandbox.stub(yargs, 'options').returns(yargs);
+    });
+
+    afterEach(() => {
+        sandbox.restore();
+    });
+
+    it('should drive the yargs builder fn correctly',()=>{",45,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148011857,https://github.com/hyperledger/composer/pull/2507#discussion_r148011857,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,I don't think writing a file returns the file contents.,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:31:23,148013197,"@@ -50,24 +51,173 @@ describe('composer card import CLI', function() {
         sandbox.restore();
     });
 
-    it('should create a valid card file with supplied details', function() {
+    it('should create a valid card file with (secret) supplied details', function() {
         sandbox.stub(fs, 'writeFileSync').withArgs(cardFileName).returns(cardBuffer);
         sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
         sandbox.stub(JSON, 'parse').returns({name:'network'});
         const args = {
             connectionProfileFile: 'filename',
-            businessNetworkName : 'network',
             file: 'filename',
             enrollSecret:'password',
-            enrollId:'fred'
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options - user and profile',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options & with the profile having no name',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);",,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148013197,https://github.com/hyperledger/composer/pull/2507#discussion_r148013197,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,I don't think writing a file returns the file contents.,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:31:48,148013319,"@@ -50,24 +51,173 @@ describe('composer card import CLI', function() {
         sandbox.restore();
     });
 
-    it('should create a valid card file with supplied details', function() {
+    it('should create a valid card file with (secret) supplied details', function() {
         sandbox.stub(fs, 'writeFileSync').withArgs(cardFileName).returns(cardBuffer);
         sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
         sandbox.stub(JSON, 'parse').returns({name:'network'});
         const args = {
             connectionProfileFile: 'filename',
-            businessNetworkName : 'network',
             file: 'filename',
             enrollSecret:'password',
-            enrollId:'fred'
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options - user and profile',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);",,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148013319,https://github.com/hyperledger/composer/pull/2507#discussion_r148013319,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,No assert that the correct card gets written.,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:34:24,148014122,"@@ -50,24 +51,173 @@ describe('composer card import CLI', function() {
         sandbox.restore();
     });
 
-    it('should create a valid card file with supplied details', function() {
+    it('should create a valid card file with (secret) supplied details', function() {
         sandbox.stub(fs, 'writeFileSync').withArgs(cardFileName).returns(cardBuffer);
         sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
         sandbox.stub(JSON, 'parse').returns({name:'network'});
         const args = {
             connectionProfileFile: 'filename',
-            businessNetworkName : 'network',
             file: 'filename',
             enrollSecret:'password',
-            enrollId:'fred'
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {",36,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148014122,https://github.com/hyperledger/composer/pull/2507#discussion_r148014122,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,No assert that the correct card gets written.,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:35:07,148014326,"@@ -50,24 +51,173 @@ describe('composer card import CLI', function() {
         sandbox.restore();
     });
 
-    it('should create a valid card file with supplied details', function() {
+    it('should create a valid card file with (secret) supplied details', function() {
         sandbox.stub(fs, 'writeFileSync').withArgs(cardFileName).returns(cardBuffer);
         sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
         sandbox.stub(JSON, 'parse').returns({name:'network'});
         const args = {
             connectionProfileFile: 'filename',
-            businessNetworkName : 'network',
             file: 'filename',
             enrollSecret:'password',
-            enrollId:'fred'
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options - user and profile',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {",53,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148014326,https://github.com/hyperledger/composer/pull/2507#discussion_r148014326,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,No assert that the correct card gets written.,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:36:41,148014840,"@@ -50,24 +51,173 @@ describe('composer card import CLI', function() {
         sandbox.restore();
     });
 
-    it('should create a valid card file with supplied details', function() {
+    it('should create a valid card file with (secret) supplied details', function() {
         sandbox.stub(fs, 'writeFileSync').withArgs(cardFileName).returns(cardBuffer);
         sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
         sandbox.stub(JSON, 'parse').returns({name:'network'});
         const args = {
             connectionProfileFile: 'filename',
-            businessNetworkName : 'network',
             file: 'filename',
             enrollSecret:'password',
-            enrollId:'fred'
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options - user and profile',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options & with the profile having no name',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({anonymus:'network'});
+        const args = {
+            connectionProfileFile: '/fred/filename',
+            user:'fred'
         };
 
         return CreateCmd.handler(args).then(() => {",,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148014840,https://github.com/hyperledger/composer/pull/2507#discussion_r148014840,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,Wrong return.,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:38:40,148015500,"@@ -50,24 +51,173 @@ describe('composer card import CLI', function() {
         sandbox.restore();
     });
 
-    it('should create a valid card file with supplied details', function() {
+    it('should create a valid card file with (secret) supplied details', function() {
         sandbox.stub(fs, 'writeFileSync').withArgs(cardFileName).returns(cardBuffer);
         sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
         sandbox.stub(JSON, 'parse').returns({name:'network'});
         const args = {
             connectionProfileFile: 'filename',
-            businessNetworkName : 'network',
             file: 'filename',
             enrollSecret:'password',
-            enrollId:'fred'
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options - user and profile',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options & with the profile having no name',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({anonymus:'network'});
+        const args = {
+            connectionProfileFile: '/fred/filename',
+            user:'fred'
         };
 
         return CreateCmd.handler(args).then(() => {
             sinon.assert.calledOnce(fs.readFileSync);
             sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
-            sinon.assert.calledWith(consoleLogSpy, sinon.match('Successfully created business network card'));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+
+
+    it('create card with certificate and private key',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);",,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148015500,https://github.com/hyperledger/composer/pull/2507#discussion_r148015500,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,No assert that the correct card gets written.,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:39:22,148015745,"@@ -50,24 +51,173 @@ describe('composer card import CLI', function() {
         sandbox.restore();
     });
 
-    it('should create a valid card file with supplied details', function() {
+    it('should create a valid card file with (secret) supplied details', function() {
         sandbox.stub(fs, 'writeFileSync').withArgs(cardFileName).returns(cardBuffer);
         sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
         sandbox.stub(JSON, 'parse').returns({name:'network'});
         const args = {
             connectionProfileFile: 'filename',
-            businessNetworkName : 'network',
             file: 'filename',
             enrollSecret:'password',
-            enrollId:'fred'
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options - user and profile',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options & with the profile having no name',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({anonymus:'network'});
+        const args = {
+            connectionProfileFile: '/fred/filename',
+            user:'fred'
         };
 
         return CreateCmd.handler(args).then(() => {
             sinon.assert.calledOnce(fs.readFileSync);
             sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
-            sinon.assert.calledWith(consoleLogSpy, sinon.match('Successfully created business network card'));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+
+
+    it('create card with certificate and private key',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        let readFileStub = sandbox.stub(fs, 'readFileSync');
+        readFileStub.withArgs(sinon.match(/certfile/)).returns('I am certificate');
+        readFileStub.withArgs(sinon.match(/keyfile/)).returns('I am keyfile');
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            certificate : 'certfile',
+            privateKey:'keyfile',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {",88,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148015745,https://github.com/hyperledger/composer/pull/2507#discussion_r148015745,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,Wrong return value.,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:39:35,148015817,"@@ -50,24 +51,173 @@ describe('composer card import CLI', function() {
         sandbox.restore();
     });
 
-    it('should create a valid card file with supplied details', function() {
+    it('should create a valid card file with (secret) supplied details', function() {
         sandbox.stub(fs, 'writeFileSync').withArgs(cardFileName).returns(cardBuffer);
         sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
         sandbox.stub(JSON, 'parse').returns({name:'network'});
         const args = {
             connectionProfileFile: 'filename',
-            businessNetworkName : 'network',
             file: 'filename',
             enrollSecret:'password',
-            enrollId:'fred'
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options - user and profile',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options & with the profile having no name',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({anonymus:'network'});
+        const args = {
+            connectionProfileFile: '/fred/filename',
+            user:'fred'
         };
 
         return CreateCmd.handler(args).then(() => {
             sinon.assert.calledOnce(fs.readFileSync);
             sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
-            sinon.assert.calledWith(consoleLogSpy, sinon.match('Successfully created business network card'));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+
+
+    it('create card with certificate and private key',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        let readFileStub = sandbox.stub(fs, 'readFileSync');
+        readFileStub.withArgs(sinon.match(/certfile/)).returns('I am certificate');
+        readFileStub.withArgs(sinon.match(/keyfile/)).returns('I am keyfile');
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            certificate : 'certfile',
+            privateKey:'keyfile',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledThrice(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
         });
     });
 
+    it('create card with roles',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);",,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148015817,https://github.com/hyperledger/composer/pull/2507#discussion_r148015817,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,No assert that the correct card gets written.,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:39:48,148015893,"@@ -50,24 +51,173 @@ describe('composer card import CLI', function() {
         sandbox.restore();
     });
 
-    it('should create a valid card file with supplied details', function() {
+    it('should create a valid card file with (secret) supplied details', function() {
         sandbox.stub(fs, 'writeFileSync').withArgs(cardFileName).returns(cardBuffer);
         sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
         sandbox.stub(JSON, 'parse').returns({name:'network'});
         const args = {
             connectionProfileFile: 'filename',
-            businessNetworkName : 'network',
             file: 'filename',
             enrollSecret:'password',
-            enrollId:'fred'
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options - user and profile',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options & with the profile having no name',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({anonymus:'network'});
+        const args = {
+            connectionProfileFile: '/fred/filename',
+            user:'fred'
         };
 
         return CreateCmd.handler(args).then(() => {
             sinon.assert.calledOnce(fs.readFileSync);
             sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
-            sinon.assert.calledWith(consoleLogSpy, sinon.match('Successfully created business network card'));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+
+
+    it('create card with certificate and private key',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        let readFileStub = sandbox.stub(fs, 'readFileSync');
+        readFileStub.withArgs(sinon.match(/certfile/)).returns('I am certificate');
+        readFileStub.withArgs(sinon.match(/keyfile/)).returns('I am keyfile');
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            certificate : 'certfile',
+            privateKey:'keyfile',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledThrice(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
         });
     });
 
+    it('create card with roles',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        let readFileStub = sandbox.stub(fs, 'readFileSync');
+        readFileStub.withArgs(sinon.match(/certfile/)).returns('I am certificate');
+        readFileStub.withArgs(sinon.match(/keyfile/)).returns('I am keyfile');
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            roles : 'PeerAdmin,Issuer,ChannelAdmin',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {",,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148015893,https://github.com/hyperledger/composer/pull/2507#discussion_r148015893,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,Wrong return value.,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:39:59,148015973,"@@ -50,24 +51,173 @@ describe('composer card import CLI', function() {
         sandbox.restore();
     });
 
-    it('should create a valid card file with supplied details', function() {
+    it('should create a valid card file with (secret) supplied details', function() {
         sandbox.stub(fs, 'writeFileSync').withArgs(cardFileName).returns(cardBuffer);
         sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
         sandbox.stub(JSON, 'parse').returns({name:'network'});
         const args = {
             connectionProfileFile: 'filename',
-            businessNetworkName : 'network',
             file: 'filename',
             enrollSecret:'password',
-            enrollId:'fred'
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options - user and profile',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options & with the profile having no name',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({anonymus:'network'});
+        const args = {
+            connectionProfileFile: '/fred/filename',
+            user:'fred'
         };
 
         return CreateCmd.handler(args).then(() => {
             sinon.assert.calledOnce(fs.readFileSync);
             sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
-            sinon.assert.calledWith(consoleLogSpy, sinon.match('Successfully created business network card'));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+
+
+    it('create card with certificate and private key',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        let readFileStub = sandbox.stub(fs, 'readFileSync');
+        readFileStub.withArgs(sinon.match(/certfile/)).returns('I am certificate');
+        readFileStub.withArgs(sinon.match(/keyfile/)).returns('I am keyfile');
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            certificate : 'certfile',
+            privateKey:'keyfile',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledThrice(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
         });
     });
 
+    it('create card with roles',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        let readFileStub = sandbox.stub(fs, 'readFileSync');
+        readFileStub.withArgs(sinon.match(/certfile/)).returns('I am certificate');
+        readFileStub.withArgs(sinon.match(/keyfile/)).returns('I am keyfile');
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            roles : 'PeerAdmin,Issuer,ChannelAdmin',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('error case - check with connection profile file read fail',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);",,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148015973,https://github.com/hyperledger/composer/pull/2507#discussion_r148015973,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,Wrong return value.,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:40:15,148016085,"@@ -50,24 +51,173 @@ describe('composer card import CLI', function() {
         sandbox.restore();
     });
 
-    it('should create a valid card file with supplied details', function() {
+    it('should create a valid card file with (secret) supplied details', function() {
         sandbox.stub(fs, 'writeFileSync').withArgs(cardFileName).returns(cardBuffer);
         sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
         sandbox.stub(JSON, 'parse').returns({name:'network'});
         const args = {
             connectionProfileFile: 'filename',
-            businessNetworkName : 'network',
             file: 'filename',
             enrollSecret:'password',
-            enrollId:'fred'
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options - user and profile',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options & with the profile having no name',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({anonymus:'network'});
+        const args = {
+            connectionProfileFile: '/fred/filename',
+            user:'fred'
         };
 
         return CreateCmd.handler(args).then(() => {
             sinon.assert.calledOnce(fs.readFileSync);
             sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
-            sinon.assert.calledWith(consoleLogSpy, sinon.match('Successfully created business network card'));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+
+
+    it('create card with certificate and private key',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        let readFileStub = sandbox.stub(fs, 'readFileSync');
+        readFileStub.withArgs(sinon.match(/certfile/)).returns('I am certificate');
+        readFileStub.withArgs(sinon.match(/keyfile/)).returns('I am keyfile');
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            certificate : 'certfile',
+            privateKey:'keyfile',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledThrice(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
         });
     });
 
+    it('create card with roles',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        let readFileStub = sandbox.stub(fs, 'readFileSync');
+        readFileStub.withArgs(sinon.match(/certfile/)).returns('I am certificate');
+        readFileStub.withArgs(sinon.match(/keyfile/)).returns('I am keyfile');
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            roles : 'PeerAdmin,Issuer,ChannelAdmin',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('error case - check with connection profile file read fail',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        let readFileStub = sandbox.stub(fs, 'readFileSync');
+        readFileStub.withArgs(sinon.match(/notexist/)).throws(new Error('read failure'));
+
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'notexist',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).should.be.rejectedWith(/Unable to read/);
+    });
+
+    it('error case - check with certificate file read fail',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);",,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148016085,https://github.com/hyperledger/composer/pull/2507#discussion_r148016085,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,Wrong return value.,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:40:46,148016261,"@@ -50,24 +51,173 @@ describe('composer card import CLI', function() {
         sandbox.restore();
     });
 
-    it('should create a valid card file with supplied details', function() {
+    it('should create a valid card file with (secret) supplied details', function() {
         sandbox.stub(fs, 'writeFileSync').withArgs(cardFileName).returns(cardBuffer);
         sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
         sandbox.stub(JSON, 'parse').returns({name:'network'});
         const args = {
             connectionProfileFile: 'filename',
-            businessNetworkName : 'network',
             file: 'filename',
             enrollSecret:'password',
-            enrollId:'fred'
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options - user and profile',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options & with the profile having no name',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({anonymus:'network'});
+        const args = {
+            connectionProfileFile: '/fred/filename',
+            user:'fred'
         };
 
         return CreateCmd.handler(args).then(() => {
             sinon.assert.calledOnce(fs.readFileSync);
             sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
-            sinon.assert.calledWith(consoleLogSpy, sinon.match('Successfully created business network card'));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+
+
+    it('create card with certificate and private key',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        let readFileStub = sandbox.stub(fs, 'readFileSync');
+        readFileStub.withArgs(sinon.match(/certfile/)).returns('I am certificate');
+        readFileStub.withArgs(sinon.match(/keyfile/)).returns('I am keyfile');
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            certificate : 'certfile',
+            privateKey:'keyfile',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledThrice(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
         });
     });
 
+    it('create card with roles',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        let readFileStub = sandbox.stub(fs, 'readFileSync');
+        readFileStub.withArgs(sinon.match(/certfile/)).returns('I am certificate');
+        readFileStub.withArgs(sinon.match(/keyfile/)).returns('I am keyfile');
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            roles : 'PeerAdmin,Issuer,ChannelAdmin',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('error case - check with connection profile file read fail',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        let readFileStub = sandbox.stub(fs, 'readFileSync');
+        readFileStub.withArgs(sinon.match(/notexist/)).throws(new Error('read failure'));
+
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'notexist',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).should.be.rejectedWith(/Unable to read/);
+    });
+
+    it('error case - check with certificate file read fail',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        let readFileStub = sandbox.stub(fs, 'readFileSync');
+        readFileStub.withArgs(sinon.match(/certfile/)).throws(new Error('read failure'));
+        readFileStub.withArgs(sinon.match(/keyfile/)).returns('I am keyfile');
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            certificate : 'certfile',
+            privateKey:'keyfile',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).should.be.rejectedWith(/Unable to read/);
+    });
+
+    it('error case - check with certificate file read fail',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);",,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148016261,https://github.com/hyperledger/composer/pull/2507#discussion_r148016261,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,Wrong return value.,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:41:00,148016335,"@@ -50,24 +51,173 @@ describe('composer card import CLI', function() {
         sandbox.restore();
     });
 
-    it('should create a valid card file with supplied details', function() {
+    it('should create a valid card file with (secret) supplied details', function() {
         sandbox.stub(fs, 'writeFileSync').withArgs(cardFileName).returns(cardBuffer);
         sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
         sandbox.stub(JSON, 'parse').returns({name:'network'});
         const args = {
             connectionProfileFile: 'filename',
-            businessNetworkName : 'network',
             file: 'filename',
             enrollSecret:'password',
-            enrollId:'fred'
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options - user and profile',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options & with the profile having no name',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({anonymus:'network'});
+        const args = {
+            connectionProfileFile: '/fred/filename',
+            user:'fred'
         };
 
         return CreateCmd.handler(args).then(() => {
             sinon.assert.calledOnce(fs.readFileSync);
             sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
-            sinon.assert.calledWith(consoleLogSpy, sinon.match('Successfully created business network card'));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+
+
+    it('create card with certificate and private key',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        let readFileStub = sandbox.stub(fs, 'readFileSync');
+        readFileStub.withArgs(sinon.match(/certfile/)).returns('I am certificate');
+        readFileStub.withArgs(sinon.match(/keyfile/)).returns('I am keyfile');
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            certificate : 'certfile',
+            privateKey:'keyfile',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledThrice(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
         });
     });
 
+    it('create card with roles',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        let readFileStub = sandbox.stub(fs, 'readFileSync');
+        readFileStub.withArgs(sinon.match(/certfile/)).returns('I am certificate');
+        readFileStub.withArgs(sinon.match(/keyfile/)).returns('I am keyfile');
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            roles : 'PeerAdmin,Issuer,ChannelAdmin',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('error case - check with connection profile file read fail',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        let readFileStub = sandbox.stub(fs, 'readFileSync');
+        readFileStub.withArgs(sinon.match(/notexist/)).throws(new Error('read failure'));
+
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'notexist',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).should.be.rejectedWith(/Unable to read/);
+    });
+
+    it('error case - check with certificate file read fail',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        let readFileStub = sandbox.stub(fs, 'readFileSync');
+        readFileStub.withArgs(sinon.match(/certfile/)).throws(new Error('read failure'));
+        readFileStub.withArgs(sinon.match(/keyfile/)).returns('I am keyfile');
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            certificate : 'certfile',
+            privateKey:'keyfile',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).should.be.rejectedWith(/Unable to read/);
+    });
+
+    it('error case - check with certificate file read fail',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        let readFileStub = sandbox.stub(fs, 'readFileSync');
+        readFileStub.withArgs(sinon.match(/certfile/)).returns('I am certificate');
+        readFileStub.withArgs(sinon.match(/keyfile/)).throws(new Error('read failure'));
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            certificate : 'certfile',
+            privateKey:'keyfile',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).should.be.rejectedWith(/Unable to read/);
+    });
+
+    it('write valid card with default filename - based on network name',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);",,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148016335,https://github.com/hyperledger/composer/pull/2507#discussion_r148016335,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,Wrong return value.,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:41:28,148016520,"@@ -50,24 +51,173 @@ describe('composer card import CLI', function() {
         sandbox.restore();
     });
 
-    it('should create a valid card file with supplied details', function() {
+    it('should create a valid card file with (secret) supplied details', function() {
         sandbox.stub(fs, 'writeFileSync').withArgs(cardFileName).returns(cardBuffer);
         sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
         sandbox.stub(JSON, 'parse').returns({name:'network'});
         const args = {
             connectionProfileFile: 'filename',
-            businessNetworkName : 'network',
             file: 'filename',
             enrollSecret:'password',
-            enrollId:'fred'
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options - user and profile',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options & with the profile having no name',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({anonymus:'network'});
+        const args = {
+            connectionProfileFile: '/fred/filename',
+            user:'fred'
         };
 
         return CreateCmd.handler(args).then(() => {
             sinon.assert.calledOnce(fs.readFileSync);
             sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
-            sinon.assert.calledWith(consoleLogSpy, sinon.match('Successfully created business network card'));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+
+
+    it('create card with certificate and private key',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        let readFileStub = sandbox.stub(fs, 'readFileSync');
+        readFileStub.withArgs(sinon.match(/certfile/)).returns('I am certificate');
+        readFileStub.withArgs(sinon.match(/keyfile/)).returns('I am keyfile');
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            certificate : 'certfile',
+            privateKey:'keyfile',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledThrice(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
         });
     });
 
+    it('create card with roles',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        let readFileStub = sandbox.stub(fs, 'readFileSync');
+        readFileStub.withArgs(sinon.match(/certfile/)).returns('I am certificate');
+        readFileStub.withArgs(sinon.match(/keyfile/)).returns('I am keyfile');
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            roles : 'PeerAdmin,Issuer,ChannelAdmin',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('error case - check with connection profile file read fail',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        let readFileStub = sandbox.stub(fs, 'readFileSync');
+        readFileStub.withArgs(sinon.match(/notexist/)).throws(new Error('read failure'));
+
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'notexist',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).should.be.rejectedWith(/Unable to read/);
+    });
+
+    it('error case - check with certificate file read fail',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        let readFileStub = sandbox.stub(fs, 'readFileSync');
+        readFileStub.withArgs(sinon.match(/certfile/)).throws(new Error('read failure'));
+        readFileStub.withArgs(sinon.match(/keyfile/)).returns('I am keyfile');
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            certificate : 'certfile',
+            privateKey:'keyfile',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).should.be.rejectedWith(/Unable to read/);
+    });
+
+    it('error case - check with certificate file read fail',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        let readFileStub = sandbox.stub(fs, 'readFileSync');
+        readFileStub.withArgs(sinon.match(/certfile/)).returns('I am certificate');
+        readFileStub.withArgs(sinon.match(/keyfile/)).throws(new Error('read failure'));
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            certificate : 'certfile',
+            privateKey:'keyfile',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).should.be.rejectedWith(/Unable to read/);
+    });
+
+    it('write valid card with default filename - based on network name',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            businessNetworkName: 'penguin-network',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.writeFileSync,sinon.match(/fred@penguin-network.card/),sinon.match.any);
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+    it('write valid card with default filename - based on profile name',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);",,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148016520,https://github.com/hyperledger/composer/pull/2507#discussion_r148016520,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,"The product needs to be consistent; so if playground today treats these with case sensitivity, the CLI should as well.

If this isn't liked by users it's a future feature to adjust them; in fact I'd rather have a yargs choices here (enumeration) rather than having the user type them in by hand. ",7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:46:06,148017948,"@@ -15,15 +15,44 @@
 'use strict';
 
 const Create = require ('./lib/create.js');
+const permittedRoles = ['peeradmin','channeladmin','issuer'];
+
+const checkFn = (argv,options)=>{
+
+    if (argv.roles){
+        let r = argv.roles.toLowerCase().split(',');",,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148017948,https://github.com/hyperledger/composer/pull/2507#discussion_r148017948,mbwhite
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,I decided that p wouldn't be suitable in this case is this parameter is pointing to a file and not a reference to the profile name.  i.e.  *~/hlfv1/connection.json* rather than *hlfv1*,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:48:04,148018584,"@@ -15,15 +15,44 @@
 'use strict';
 
 const Create = require ('./lib/create.js');
+const permittedRoles = ['peeradmin','channeladmin','issuer'];
+
+const checkFn = (argv,options)=>{
+
+    if (argv.roles){
+        let r = argv.roles.toLowerCase().split(',');
+        let valid = r.every((e)=>{
+            return permittedRoles.includes(e);
+        });
+        if(!valid) {
+            throw new Error('Invalid role given :'+argv.roles);
+        }
+    }
+    return true;
+};
+
+module.exports._checkFn =checkFn;
 
 module.exports.command = 'create [options]';
 module.exports.describe = 'Creates a business network card from individual components';
-module.exports.builder = {
-    file: {alias: 'f', required: true, describe: 'The card file name', type: 'string' },
-    businessNetworkName: {alias: 'n', required: true, describe: 'The business network name', type: 'string' },
-    connectionProfileFile: {alias: 'j', required: false, describe: 'Filename of the connection profile json file', type: 'string' },
-    enrollId: { alias: 'i', required: false, describe: 'The enrollment ID of the user', type: 'string' },
-    enrollSecret: { alias: 's', required: false, describe: 'The enrollment secret of the user', type: 'string' }
+module.exports.builder = function (yargs) {
+    yargs.options({
+        file: {alias: 'f', required: false, describe: 'File name of the card archive to be created', type: 'string' },
+        businessNetworkName: {alias: 'n', required: false, describe: 'The business network name', type: 'string' },
+        connectionProfileFile: {alias: 'j', required: true, describe: 'Filename of the connection profile json file', type: 'string' },",39,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148018584,https://github.com/hyperledger/composer/pull/2507#discussion_r148018584,mbwhite
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,That can be changed; the contract for the constructor of the IdCard is a little odd - in that it takes the metadat and uses that as it's internal data representation.  Would have expected this to be a set/get property pattern ,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:52:56,148020372,"@@ -25,21 +25,33 @@ const path = require('path');
 class Create {
   /**
     * Command implementation.
-    * @param {Object} args argument list from composer command
+    * @param {Object} argv argument list from composer command
     * @return {Promise} promise when command complete
     */
-    static handler(args) {
+    static handler(argv) {
+
+        let profileFile  = argv.connectionProfileFile;
+        let user = argv.user;
+
+        let businessNetworkName = argv.businessNetworkName || '';
+        let fileName = argv.file || '';
+        let enrollSecret = argv.enrollSecret || '';",,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148020372,https://github.com/hyperledger/composer/pull/2507#discussion_r148020372,mbwhite
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,Good spot; more reason to move to using Yargs choices here. ,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:53:18,148020480,"@@ -25,21 +25,33 @@ const path = require('path');
 class Create {
   /**
     * Command implementation.
-    * @param {Object} args argument list from composer command
+    * @param {Object} argv argument list from composer command
     * @return {Promise} promise when command complete
     */
-    static handler(args) {
+    static handler(argv) {
+
+        let profileFile  = argv.connectionProfileFile;
+        let user = argv.user;
+
+        let businessNetworkName = argv.businessNetworkName || '';
+        let fileName = argv.file || '';
+        let enrollSecret = argv.enrollSecret || '';
+        let certificate = argv.certificate || '';
+        let privateKey = argv.privateKey || '';
+        let roles = argv.roles || '';
+
+        // user & profileFile are required, others are optional
 
-        let profileFile  = args.connectionProfileFile;
-        let businessNetworkName = args.businessNetworkName;
-        let fileName = args.file;
 
         let metadata= {
-            userName : args.enrollId,
+            userName : user,
             version : 1,
-            enrollmentSecret:args.enrollSecret,
-            businessNetwork : businessNetworkName
+            enrollmentSecret: enrollSecret,
+            businessNetwork : businessNetworkName,
+            roles : roles",,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148020480,https://github.com/hyperledger/composer/pull/2507#discussion_r148020480,mbwhite
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,"if you have one you need both
",7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:53:35,148020580,"@@ -51,15 +63,54 @@ class Create {
                     profileData.name =  path.parse(filePath).dir.split(path.sep).slice(-1)[0];
                 }
 
+                // setup the id card with the meta data
                 let idCard = new IdCard(metadata,profileData);
+
+                // certificates & privateKey
+                if (certificate && privateKey){",,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148020580,https://github.com/hyperledger/composer/pull/2507#discussion_r148020580,mbwhite
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,It's testing our code. ,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-10-31 14:53:45,148020643,"@@ -0,0 +1,72 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+
+const cardCommand = require('../../lib/cmds/card/createCommand.js');
+const yargs = require('yargs');
+require('chai').should();
+const chai = require('chai');
+const sinon = require('sinon');
+chai.should();
+chai.use(require('chai-things'));
+chai.use(require('chai-as-promised'));
+
+
+describe('composer participant cmd launcher unit tests', function () {
+
+    let sandbox;
+
+    beforeEach(() => {
+        sandbox = sinon.sandbox.create();
+
+        sandbox.stub(yargs, 'check').returns(yargs);
+        sandbox.stub(yargs, 'conflicts').returns(yargs);
+        sandbox.stub(yargs, 'group').returns(yargs);
+        sandbox.stub(yargs, 'options').returns(yargs);
+    });
+
+    afterEach(() => {
+        sandbox.restore();
+    });
+
+    it('should drive the yargs builder fn correctly',()=>{",45,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148020643,https://github.com/hyperledger/composer/pull/2507#discussion_r148020643,mbwhite
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,added in https://github.com/hyperledger/composer/pull/2507/commits/a6b6c4ffc3e8f47fdc22407592c3358ab2b28c5b,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-11-01 08:46:34,148206506,"@@ -50,24 +51,173 @@ describe('composer card import CLI', function() {
         sandbox.restore();
     });
 
-    it('should create a valid card file with supplied details', function() {
+    it('should create a valid card file with (secret) supplied details', function() {
         sandbox.stub(fs, 'writeFileSync').withArgs(cardFileName).returns(cardBuffer);
         sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
         sandbox.stub(JSON, 'parse').returns({name:'network'});
         const args = {
             connectionProfileFile: 'filename',
-            businessNetworkName : 'network',
             file: 'filename',
             enrollSecret:'password',
-            enrollId:'fred'
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match(/Successfully created business network card/));
+        });
+    });
+
+    it('create card with minimal options - user and profile',()=>{
+        sandbox.stub(fs, 'writeFileSync').returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {",53,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148206506,https://github.com/hyperledger/composer/pull/2507#discussion_r148206506,mbwhite
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,added in https://github.com/hyperledger/composer/pull/2507/commits/a6b6c4ffc3e8f47fdc22407592c3358ab2b28c5b,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-11-01 08:46:41,148206521,"@@ -50,24 +51,173 @@ describe('composer card import CLI', function() {
         sandbox.restore();
     });
 
-    it('should create a valid card file with supplied details', function() {
+    it('should create a valid card file with (secret) supplied details', function() {
         sandbox.stub(fs, 'writeFileSync').withArgs(cardFileName).returns(cardBuffer);
         sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
         sandbox.stub(JSON, 'parse').returns({name:'network'});
         const args = {
             connectionProfileFile: 'filename',
-            businessNetworkName : 'network',
             file: 'filename',
             enrollSecret:'password',
-            enrollId:'fred'
+            user:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {",36,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148206521,https://github.com/hyperledger/composer/pull/2507#discussion_r148206521,mbwhite
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,the  yargs builder function is our code that does enhanced options checking over and above what yargs offers 'out of the box',7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-11-01 08:47:16,148206617,"@@ -0,0 +1,72 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+
+const cardCommand = require('../../lib/cmds/card/createCommand.js');
+const yargs = require('yargs');
+require('chai').should();
+const chai = require('chai');
+const sinon = require('sinon');
+chai.should();
+chai.use(require('chai-things'));
+chai.use(require('chai-as-promised'));
+
+
+describe('composer participant cmd launcher unit tests', function () {
+
+    let sandbox;
+
+    beforeEach(() => {
+        sandbox = sinon.sandbox.create();
+
+        sandbox.stub(yargs, 'check').returns(yargs);
+        sandbox.stub(yargs, 'conflicts').returns(yargs);
+        sandbox.stub(yargs, 'group').returns(yargs);
+        sandbox.stub(yargs, 'options').returns(yargs);
+    });
+
+    afterEach(() => {
+        sandbox.restore();
+    });
+
+    it('should drive the yargs builder fn correctly',()=>{",45,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148206617,https://github.com/hyperledger/composer/pull/2507#discussion_r148206617,mbwhite
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,"I don't think this is helpful to the user. There is every chance the silently generated name will not be what they want, and it will be an empty string if they point at a file in the root directory.",7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-11-01 14:15:26,148271191,"@@ -30,35 +30,33 @@ class Create {
     */
     static handler(argv) {
 
-        let profileFile  = argv.connectionProfileFile;
-        let user = argv.user;
+        // set if the options have been given into the metadata
+        let metadata= { version:1,
+            userName : argv.user };
 
-        let businessNetworkName = argv.businessNetworkName || '';
-        let fileName = argv.file || '';
-        let enrollSecret = argv.enrollSecret || '';
-        let certificate = argv.certificate || '';
-        let privateKey = argv.privateKey || '';
-        let roles = argv.roles || '';
+        if (argv.role){
+            metadata.roles = argv.role;
+        }
 
-        // user & profileFile are required, others are optional
+        if (argv.enrollSecret){
+            metadata.enrollmentSecret = argv.enrollSecret;
+        }
 
+        if (argv.businessNetworkName){
+            metadata.businessNetwork = argv.businessNetworkName;
+        }
 
-        let metadata= {
-            userName : user,
-            version : 1,
-            enrollmentSecret: enrollSecret,
-            businessNetwork : businessNetworkName,
-            roles : roles
-        };
+        // used in confirmation message so define here
+        let fileName = argv.file;
 
-        //
-        const filePath = path.resolve(profileFile);
+        // handle the connection profile - read from a file
+        // start the promise chain to all sync errors are converted to rejected promises
         return Promise.resolve()
             .then( ()=>{
-                return this.readJsonFromFile(filePath);
-            })
-            .then((profileData) =>{
-                // if there is no name, take the name from the directory the profilefile is in
+                const filePath = path.resolve(argv.connectionProfileFile);
+                let profileData = JSON.parse(this.readFile(filePath));
+
+                // if there is no name, take the name from the directory the profile file is in",,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148271191,https://github.com/hyperledger/composer/pull/2507#discussion_r148271191,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,It doesn't hurt but the initial assignment is redundant.,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-11-01 14:19:17,148272290,"@@ -96,8 +96,7 @@ class Create {
      * @param {String} filePath file to load
      * @return {String} with contents or throws an error
      */
-    static readCredentialFile(filePath){
-        console.log(filePath);
+    static readFile(filePath){
         let content='';",,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148272290,https://github.com/hyperledger/composer/pull/2507#discussion_r148272290,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,"There are two separate tests rolled into this one test case. Failing the first will obscure the state of the second, and any failure will require diagnosis to determine which one failed.",7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-11-01 14:21:47,148272930,"@@ -51,22 +51,41 @@ describe('composer participant cmd launcher unit tests', function () {
     });
 
     it('should drive the yargs builder check fn correctly',()=>{
-        cardCommand._checkFn({somethingelse:'PeerAdmin'},{}).should.equal(true);
-        cardCommand._checkFn({roles:'PeerAdmin'},{}).should.equal(true);
-        cardCommand._checkFn({roles:'PeerAdmin,ChannelAdmin'},{}).should.equal(true);
-        cardCommand._checkFn({roles:'Issuer,PeerAdmin,ChannelAdmin'},{}).should.equal(true);
+        cardCommand._checkFn({s:'secret',somethingelse:'PeerAdmin'},{}).should.equal(true);
+        cardCommand._checkFn({s:'secret',roles:'PeerAdmin'},{}).should.equal(true);
+        cardCommand._checkFn({s:'secret',roles:'PeerAdmin,ChannelAdmin'},{}).should.equal(true);
+        cardCommand._checkFn({s:'secret',roles:'Issuer,PeerAdmin,ChannelAdmin'},{}).should.equal(true);
+    });
 
+    it('should enforce that both key and cert should be given together',()=>{",,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148272930,https://github.com/hyperledger/composer/pull/2507#discussion_r148272930,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,The wording doesn't describe the test.,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-11-01 14:24:19,148273578,"@@ -51,22 +51,41 @@ describe('composer participant cmd launcher unit tests', function () {
     });
 
     it('should drive the yargs builder check fn correctly',()=>{
-        cardCommand._checkFn({somethingelse:'PeerAdmin'},{}).should.equal(true);
-        cardCommand._checkFn({roles:'PeerAdmin'},{}).should.equal(true);
-        cardCommand._checkFn({roles:'PeerAdmin,ChannelAdmin'},{}).should.equal(true);
-        cardCommand._checkFn({roles:'Issuer,PeerAdmin,ChannelAdmin'},{}).should.equal(true);
+        cardCommand._checkFn({s:'secret',somethingelse:'PeerAdmin'},{}).should.equal(true);
+        cardCommand._checkFn({s:'secret',roles:'PeerAdmin'},{}).should.equal(true);
+        cardCommand._checkFn({s:'secret',roles:'PeerAdmin,ChannelAdmin'},{}).should.equal(true);
+        cardCommand._checkFn({s:'secret',roles:'Issuer,PeerAdmin,ChannelAdmin'},{}).should.equal(true);
+    });
 
+    it('should enforce that both key and cert should be given together',()=>{
+        (()=>{
+            cardCommand._checkFn({k:'key'});
+        }).should.throw(/privateKey and certificate should both be specified/);
         (()=>{
-            cardCommand._checkFn({roles:'Fred'},{});
-        }).should.throw(/Invalid role given/);
+            cardCommand._checkFn({c:'cert'});
+        }).should.throw(/privateKey and certificate should both be specified/);
+
+        cardCommand._checkFn({k:'key',c:'cert'}).should.equal(true);
+
+    });
 
+    it('should allow a secret to be specified but with a certificate or private key file', ()=>{",,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148273578,https://github.com/hyperledger/composer/pull/2507#discussion_r148273578,bestbeforetoday
https://github.com/hyperledger/composer/pull/2507,https://github.com/hyperledger/composer/pull/2507,There are three distinct tests rolled into this one test case.,7a90dbb5330ff6b6dad41fc1bcbcec55f1f0d6a1,2017-11-01 14:24:41,148273676,"@@ -51,22 +51,41 @@ describe('composer participant cmd launcher unit tests', function () {
     });
 
     it('should drive the yargs builder check fn correctly',()=>{
-        cardCommand._checkFn({somethingelse:'PeerAdmin'},{}).should.equal(true);
-        cardCommand._checkFn({roles:'PeerAdmin'},{}).should.equal(true);
-        cardCommand._checkFn({roles:'PeerAdmin,ChannelAdmin'},{}).should.equal(true);
-        cardCommand._checkFn({roles:'Issuer,PeerAdmin,ChannelAdmin'},{}).should.equal(true);
+        cardCommand._checkFn({s:'secret',somethingelse:'PeerAdmin'},{}).should.equal(true);
+        cardCommand._checkFn({s:'secret',roles:'PeerAdmin'},{}).should.equal(true);
+        cardCommand._checkFn({s:'secret',roles:'PeerAdmin,ChannelAdmin'},{}).should.equal(true);
+        cardCommand._checkFn({s:'secret',roles:'Issuer,PeerAdmin,ChannelAdmin'},{}).should.equal(true);
+    });
 
+    it('should enforce that both key and cert should be given together',()=>{
+        (()=>{
+            cardCommand._checkFn({k:'key'});
+        }).should.throw(/privateKey and certificate should both be specified/);
         (()=>{
-            cardCommand._checkFn({roles:'Fred'},{});
-        }).should.throw(/Invalid role given/);
+            cardCommand._checkFn({c:'cert'});
+        }).should.throw(/privateKey and certificate should both be specified/);
+
+        cardCommand._checkFn({k:'key',c:'cert'}).should.equal(true);
+
+    });
 
+    it('should allow a secret to be specified but with a certificate or private key file', ()=>{",,2017-11-01 16:36:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/148273676,https://github.com/hyperledger/composer/pull/2507#discussion_r148273676,bestbeforetoday
https://github.com/hyperledger/composer/pull/2498,https://github.com/hyperledger/composer/pull/2498,Shouldn't this return the name as well ?,6a6edceff42b9d4a402a103cf64df8f392baaf58,2017-10-31 09:49:33,147937550,"@@ -129,9 +129,25 @@ class AdminConnection {
             const locationName = card.getBusinessNetworkName() || card.getConnectionProfile().name;
             name = card.getUserName() + '@' + locationName;
         }
-        return this.cardStore.put(name, card).then(() => {
-            return name;
-        });
+        let connectionProfileData;
+        return this.cardStore.put(name, card)
+            .then(() => {
+                connectionProfileData = card.getConnectionProfile();
+                connectionProfileData.cardName=name;
+                return this.connectionProfileManager.getConnectionManagerByType(connectionProfileData.type);
+            })
+            .then((connectionManager)=>{
+                let certificate = card.getCredentials().certificate;
+                let privateKey = card.getCredentials().privateKey;
+                if (certificate && privateKey){
+                    return connectionManager.importIdentity(connectionProfileData.name,connectionProfileData, card.getUserName(), certificate, privateKey);
+                } else {
+                    return; // use secret",20,2017-10-31 12:21:14,https://api.github.com/repos/hyperledger/composer/pulls/comments/147937550,https://github.com/hyperledger/composer/pull/2498#discussion_r147937550,davidkel
https://github.com/hyperledger/composer/pull/2498,https://github.com/hyperledger/composer/pull/2498,"what if there are still no credentials to export ? what will result be ? 
should we check that there is still a secret as in the card ? otherwise the card is going to be useless.",6a6edceff42b9d4a402a103cf64df8f392baaf58,2017-10-31 09:52:02,147938137,"@@ -143,6 +159,44 @@ class AdminConnection {
         return this.cardStore.get(cardName);
     }
 
+    /** Exports an network card.
+     * Should the card not actually contain the certificates in the card, a exportIdentity will be
+     * performed to get the details of the cards
+     * @private
+     * @param {String} cardName The name of the card that needs to be exported
+     * @return {Promise} resolved with an instance of the network id card populated
+     */
+    exportCard(cardName) {
+        let card;
+        return this.cardStore.get(cardName)
+            .then((result)=>{
+                card=result;
+                let credentials = card.getCredentials();
+                //anything set? if so don't go and get the credentials again
+                if (Object.keys(credentials).length!==0){
+                    return card;
+                } else {
+                    // check to make sure the credentials are present and if not then extract them.
+                    let connectionProfileData = card.getConnectionProfile();
+                    connectionProfileData.cardName = cardName;
+                    return this.connectionProfileManager.getConnectionManagerByType(connectionProfileData.type)
+                        .then((connectionManager)=>{
+                            return connectionManager.exportIdentity(connectionProfileData.name, connectionProfileData, card.getUserName());
+                        }).
+                        then( (result)=>{",,2017-10-31 12:21:14,https://api.github.com/repos/hyperledger/composer/pulls/comments/147938137,https://github.com/hyperledger/composer/pull/2498#discussion_r147938137,davidkel
https://github.com/hyperledger/composer/pull/2498,https://github.com/hyperledger/composer/pull/2498,The return is handled in the next step in the promise chain... ,6a6edceff42b9d4a402a103cf64df8f392baaf58,2017-10-31 09:59:55,147939996,"@@ -129,9 +129,25 @@ class AdminConnection {
             const locationName = card.getBusinessNetworkName() || card.getConnectionProfile().name;
             name = card.getUserName() + '@' + locationName;
         }
-        return this.cardStore.put(name, card).then(() => {
-            return name;
-        });
+        let connectionProfileData;
+        return this.cardStore.put(name, card)
+            .then(() => {
+                connectionProfileData = card.getConnectionProfile();
+                connectionProfileData.cardName=name;
+                return this.connectionProfileManager.getConnectionManagerByType(connectionProfileData.type);
+            })
+            .then((connectionManager)=>{
+                let certificate = card.getCredentials().certificate;
+                let privateKey = card.getCredentials().privateKey;
+                if (certificate && privateKey){
+                    return connectionManager.importIdentity(connectionProfileData.name,connectionProfileData, card.getUserName(), certificate, privateKey);
+                } else {
+                    return; // use secret",20,2017-10-31 12:21:14,https://api.github.com/repos/hyperledger/composer/pulls/comments/147939996,https://github.com/hyperledger/composer/pull/2498#discussion_r147939996,mbwhite
https://github.com/hyperledger/composer/pull/2498,https://github.com/hyperledger/composer/pull/2498,"If there are no credentials or secret it will be pretty blank that is true.

Quesiton if what would be do if that was the case?  Could fail to export but maybe this is an export to get what is there and then fix it manually.

Will look at what export identity does",6a6edceff42b9d4a402a103cf64df8f392baaf58,2017-10-31 10:02:44,147940662,"@@ -143,6 +159,44 @@ class AdminConnection {
         return this.cardStore.get(cardName);
     }
 
+    /** Exports an network card.
+     * Should the card not actually contain the certificates in the card, a exportIdentity will be
+     * performed to get the details of the cards
+     * @private
+     * @param {String} cardName The name of the card that needs to be exported
+     * @return {Promise} resolved with an instance of the network id card populated
+     */
+    exportCard(cardName) {
+        let card;
+        return this.cardStore.get(cardName)
+            .then((result)=>{
+                card=result;
+                let credentials = card.getCredentials();
+                //anything set? if so don't go and get the credentials again
+                if (Object.keys(credentials).length!==0){
+                    return card;
+                } else {
+                    // check to make sure the credentials are present and if not then extract them.
+                    let connectionProfileData = card.getConnectionProfile();
+                    connectionProfileData.cardName = cardName;
+                    return this.connectionProfileManager.getConnectionManagerByType(connectionProfileData.type)
+                        .then((connectionManager)=>{
+                            return connectionManager.exportIdentity(connectionProfileData.name, connectionProfileData, card.getUserName());
+                        }).
+                        then( (result)=>{",,2017-10-31 12:21:14,https://api.github.com/repos/hyperledger/composer/pulls/comments/147940662,https://github.com/hyperledger/composer/pull/2498#discussion_r147940662,mbwhite
https://github.com/hyperledger/composer/pull/2498,https://github.com/hyperledger/composer/pull/2498,Unnecessary. The card is only used in the `.then()` block to which it is provided as an argument.,6a6edceff42b9d4a402a103cf64df8f392baaf58,2017-10-31 11:48:14,147968772,"@@ -143,6 +159,49 @@ class AdminConnection {
         return this.cardStore.get(cardName);
     }
 
+    /** Exports an network card.
+     * Should the card not actually contain the certificates in the card, a exportIdentity will be
+     * performed to get the details of the cards
+     * @private
+     * @param {String} cardName The name of the card that needs to be exported
+     * @return {Promise} resolved with an instance of the network id card populated
+     */
+    exportCard(cardName) {
+        let card;",41,2017-10-31 13:31:26,https://api.github.com/repos/hyperledger/composer/pulls/comments/147968772,https://github.com/hyperledger/composer/pull/2498#discussion_r147968772,bestbeforetoday
https://github.com/hyperledger/composer/pull/2498,https://github.com/hyperledger/composer/pull/2498,"Just a niggle... these could be `const` rather than `let`, but probably fine either way really.",6a6edceff42b9d4a402a103cf64df8f392baaf58,2017-10-31 11:50:15,147969169,"@@ -129,9 +129,25 @@ class AdminConnection {
             const locationName = card.getBusinessNetworkName() || card.getConnectionProfile().name;
             name = card.getUserName() + '@' + locationName;
         }
-        return this.cardStore.put(name, card).then(() => {
-            return name;
-        });
+        let connectionProfileData;
+        return this.cardStore.put(name, card)
+            .then(() => {
+                connectionProfileData = card.getConnectionProfile();
+                connectionProfileData.cardName=name;
+                return this.connectionProfileManager.getConnectionManagerByType(connectionProfileData.type);
+            })
+            .then((connectionManager)=>{
+                let certificate = card.getCredentials().certificate;",15,2017-10-31 13:31:26,https://api.github.com/repos/hyperledger/composer/pulls/comments/147969169,https://github.com/hyperledger/composer/pull/2498#discussion_r147969169,bestbeforetoday
https://github.com/hyperledger/composer/pull/2498,https://github.com/hyperledger/composer/pull/2498,The card probably isn't very useful but somehow it has already been successfully imported / created and is visible to the user so I don't think we should prevent it from being exported.,6a6edceff42b9d4a402a103cf64df8f392baaf58,2017-10-31 11:52:39,147969563,"@@ -143,6 +159,49 @@ class AdminConnection {
         return this.cardStore.get(cardName);
     }
 
+    /** Exports an network card.
+     * Should the card not actually contain the certificates in the card, a exportIdentity will be
+     * performed to get the details of the cards
+     * @private
+     * @param {String} cardName The name of the card that needs to be exported
+     * @return {Promise} resolved with an instance of the network id card populated
+     */
+    exportCard(cardName) {
+        let card;
+        return this.cardStore.get(cardName)
+            .then((result)=>{
+                card=result;
+                let credentials = card.getCredentials();
+                //anything set? if so don't go and get the credentials again
+                if (Object.keys(credentials).length!==0){
+                    return card;
+                } else {
+                    // check to make sure the credentials are present and if not then extract them.
+                    let connectionProfileData = card.getConnectionProfile();
+                    connectionProfileData.cardName = cardName;
+                    return this.connectionProfileManager.getConnectionManagerByType(connectionProfileData.type)
+                        .then((connectionManager)=>{
+                            return connectionManager.exportIdentity(connectionProfileData.name, connectionProfileData, card.getUserName());
+                        })
+                        .then( (result)=>{
+                            if (result){
+                                //{ certificate: String, privateKey: String }
+                                card.setCredentials(result);
+                                // put back the card, so that it has the ceritificates sotre
+                                return this.cardStore.put(cardName,card);
+                            } else {
+                                if(!card.getEnrollmentCredentials()){
+                                    // no secret either!
+                                    throw new Error(`Card ${cardName} has no credentials or secret so is invalid`);",66,2017-10-31 13:31:26,https://api.github.com/repos/hyperledger/composer/pulls/comments/147969563,https://github.com/hyperledger/composer/pull/2498#discussion_r147969563,bestbeforetoday
https://github.com/hyperledger/composer/pull/2498,https://github.com/hyperledger/composer/pull/2498,Typo-tastic ;),6a6edceff42b9d4a402a103cf64df8f392baaf58,2017-10-31 11:53:46,147969774,"@@ -143,6 +159,49 @@ class AdminConnection {
         return this.cardStore.get(cardName);
     }
 
+    /** Exports an network card.
+     * Should the card not actually contain the certificates in the card, a exportIdentity will be
+     * performed to get the details of the cards
+     * @private
+     * @param {String} cardName The name of the card that needs to be exported
+     * @return {Promise} resolved with an instance of the network id card populated
+     */
+    exportCard(cardName) {
+        let card;
+        return this.cardStore.get(cardName)
+            .then((result)=>{
+                card=result;
+                let credentials = card.getCredentials();
+                //anything set? if so don't go and get the credentials again
+                if (Object.keys(credentials).length!==0){
+                    return card;
+                } else {
+                    // check to make sure the credentials are present and if not then extract them.
+                    let connectionProfileData = card.getConnectionProfile();
+                    connectionProfileData.cardName = cardName;
+                    return this.connectionProfileManager.getConnectionManagerByType(connectionProfileData.type)
+                        .then((connectionManager)=>{
+                            return connectionManager.exportIdentity(connectionProfileData.name, connectionProfileData, card.getUserName());
+                        })
+                        .then( (result)=>{
+                            if (result){
+                                //{ certificate: String, privateKey: String }
+                                card.setCredentials(result);
+                                // put back the card, so that it has the ceritificates sotre",61,2017-10-31 13:31:26,https://api.github.com/repos/hyperledger/composer/pulls/comments/147969774,https://github.com/hyperledger/composer/pull/2498#discussion_r147969774,bestbeforetoday
https://github.com/hyperledger/composer/pull/2498,https://github.com/hyperledger/composer/pull/2498,Needs to assert that the credentials from the card have been passed to `importIdentity()`.,6a6edceff42b9d4a402a103cf64df8f392baaf58,2017-10-31 11:58:45,147970710,"@@ -970,6 +972,20 @@ describe('AdminConnection', () => {
         });
 
         describe('#importCard', function() {
+
+            beforeEach(()=>{
+                mockConnectionManager.importIdentity.resolves();
+                sinon.spy(userCard,'getCredentials');
+            });
+
+            it('should import card with name & credentials', function() {",30,2017-10-31 13:31:26,https://api.github.com/repos/hyperledger/composer/pulls/comments/147970710,https://github.com/hyperledger/composer/pull/2498#discussion_r147970710,bestbeforetoday
https://github.com/hyperledger/composer/pull/2498,https://github.com/hyperledger/composer/pull/2498,"I think we should testing that credentials are added to a card on export. In which case I think the right assertion is that `getCredentials()` on the exported card equals the credentials returned from `exportIdentity()`, without the need to spy on calls.",6a6edceff42b9d4a402a103cf64df8f392baaf58,2017-10-31 12:04:28,147971810,"@@ -1050,6 +1066,78 @@ describe('AdminConnection', () => {
                 });
             });
         });
+
+        describe('#exportCard', ()=> {
+
+            it('Card exists, but no credentials, call to export identity is correct executed',()=>{",48,2017-10-31 13:31:26,https://api.github.com/repos/hyperledger/composer/pulls/comments/147971810,https://github.com/hyperledger/composer/pull/2498#discussion_r147971810,bestbeforetoday
https://github.com/hyperledger/composer/pull/2498,https://github.com/hyperledger/composer/pull/2498,Should this be testing that existing credentials don't get blatted as part of the export process?,6a6edceff42b9d4a402a103cf64df8f392baaf58,2017-10-31 12:06:20,147972173,"@@ -1050,6 +1066,78 @@ describe('AdminConnection', () => {
                 });
             });
         });
+
+        describe('#exportCard', ()=> {
+
+            it('Card exists, but no credentials, call to export identity is correct executed',()=>{
+                mockConnectionManager.exportIdentity = sinon.stub();
+                mockConnectionManager.exportIdentity.resolves({ certificate: 'String', privateKey: 'String' });
+                adminConnection.connection = mockConnection;
+                adminConnection.securityContext = mockSecurityContext;
+
+                sinon.spy(userCard,'setCredentials');
+                return cardStore.put(userCardExpectedName, userCard).then(() => {
+                    return adminConnection.exportCard(userCardExpectedName);
+                }).then((result) => {
+                    result.should.be.instanceOf(IdCard);
+                    result.getUserName().should.deep.equal('user');
+                    sinon.assert.calledOnce(mockConnectionManager.exportIdentity);
+                    sinon.assert.calledWith(userCard.setCredentials,{ certificate: 'String', privateKey: 'String' });
+                });
+
+            });
+
+            it('Card exists, but with credentials',()=>{",66,2017-10-31 13:31:26,https://api.github.com/repos/hyperledger/composer/pulls/comments/147972173,https://github.com/hyperledger/composer/pull/2498#discussion_r147972173,bestbeforetoday
https://github.com/hyperledger/composer/pull/2498,https://github.com/hyperledger/composer/pull/2498,I don't think this is desirable behaviour -- see code comments.,6a6edceff42b9d4a402a103cf64df8f392baaf58,2017-10-31 12:06:45,147972257,"@@ -1050,6 +1066,78 @@ describe('AdminConnection', () => {
                 });
             });
         });
+
+        describe('#exportCard', ()=> {
+
+            it('Card exists, but no credentials, call to export identity is correct executed',()=>{
+                mockConnectionManager.exportIdentity = sinon.stub();
+                mockConnectionManager.exportIdentity.resolves({ certificate: 'String', privateKey: 'String' });
+                adminConnection.connection = mockConnection;
+                adminConnection.securityContext = mockSecurityContext;
+
+                sinon.spy(userCard,'setCredentials');
+                return cardStore.put(userCardExpectedName, userCard).then(() => {
+                    return adminConnection.exportCard(userCardExpectedName);
+                }).then((result) => {
+                    result.should.be.instanceOf(IdCard);
+                    result.getUserName().should.deep.equal('user');
+                    sinon.assert.calledOnce(mockConnectionManager.exportIdentity);
+                    sinon.assert.calledWith(userCard.setCredentials,{ certificate: 'String', privateKey: 'String' });
+                });
+
+            });
+
+            it('Card exists, but with credentials',()=>{
+                mockConnectionManager.exportIdentity = sinon.stub();
+                userCard.setCredentials({ certificate: 'String', privateKey: 'String' });
+                adminConnection.connection = mockConnection;
+                adminConnection.securityContext = mockSecurityContext;
+
+                return cardStore.put(userCardExpectedName, userCard).then(() => {
+                    return adminConnection.exportCard(userCardExpectedName);
+                }).then((result) => {
+                    result.should.be.instanceOf(IdCard);
+                    result.getUserName().should.deep.equal('user');
+                });
+
+            });
+
+            it('Card exists, but with no credentials or secret',()=>{",81,2017-10-31 13:31:26,https://api.github.com/repos/hyperledger/composer/pulls/comments/147972257,https://github.com/hyperledger/composer/pull/2498#discussion_r147972257,bestbeforetoday
https://github.com/hyperledger/composer/pull/2498,https://github.com/hyperledger/composer/pull/2498,"Without a failure path, this might end up close enough to the first test above that it isn't worth having",6a6edceff42b9d4a402a103cf64df8f392baaf58,2017-10-31 13:20:52,147991763,"@@ -1050,6 +1066,78 @@ describe('AdminConnection', () => {
                 });
             });
         });
+
+        describe('#exportCard', ()=> {
+
+            it('Card exists, but no credentials, call to export identity is correct executed',()=>{
+                mockConnectionManager.exportIdentity = sinon.stub();
+                mockConnectionManager.exportIdentity.resolves({ certificate: 'String', privateKey: 'String' });
+                adminConnection.connection = mockConnection;
+                adminConnection.securityContext = mockSecurityContext;
+
+                sinon.spy(userCard,'setCredentials');
+                return cardStore.put(userCardExpectedName, userCard).then(() => {
+                    return adminConnection.exportCard(userCardExpectedName);
+                }).then((result) => {
+                    result.should.be.instanceOf(IdCard);
+                    result.getUserName().should.deep.equal('user');
+                    sinon.assert.calledOnce(mockConnectionManager.exportIdentity);
+                    sinon.assert.calledWith(userCard.setCredentials,{ certificate: 'String', privateKey: 'String' });
+                });
+
+            });
+
+            it('Card exists, but with credentials',()=>{
+                mockConnectionManager.exportIdentity = sinon.stub();
+                userCard.setCredentials({ certificate: 'String', privateKey: 'String' });
+                adminConnection.connection = mockConnection;
+                adminConnection.securityContext = mockSecurityContext;
+
+                return cardStore.put(userCardExpectedName, userCard).then(() => {
+                    return adminConnection.exportCard(userCardExpectedName);
+                }).then((result) => {
+                    result.should.be.instanceOf(IdCard);
+                    result.getUserName().should.deep.equal('user');
+                });
+
+            });
+
+            it('Card exists, but with no credentials or secret',()=>{
+                mockConnectionManager.exportIdentity = sinon.stub();
+                adminConnection.connection = mockConnection;
+                adminConnection.securityContext = mockSecurityContext;
+
+                return cardStore.put(userCardExpectedName, userCard).then(() => {
+                    return adminConnection.exportCard(userCardExpectedName);
+                }).should.eventually.be.rejectedWith(/no credentials or secret so is invalid/);
+
+            });
+
+            it('Card exists, but with no credentials but does have secret',()=>{",92,2017-10-31 13:31:26,https://api.github.com/repos/hyperledger/composer/pulls/comments/147991763,https://github.com/hyperledger/composer/pull/2498#discussion_r147991763,bestbeforetoday
https://github.com/hyperledger/composer/pull/2498,https://github.com/hyperledger/composer/pull/2498,"I think some of the parameter naming might be more verbose than they need to be to convey the meaning. See the design in #2487, which has been run by EdM.",6a6edceff42b9d4a402a103cf64df8f392baaf58,2017-10-31 13:24:08,147992640,"@@ -23,7 +23,9 @@ module.exports.builder = {
     businessNetworkName: {alias: 'n', required: true, describe: 'The business network name', type: 'string' },
     connectionProfileFile: {alias: 'j', required: false, describe: 'Filename of the connection profile json file', type: 'string' },
     enrollId: { alias: 'i', required: false, describe: 'The enrollment ID of the user', type: 'string' },
-    enrollSecret: { alias: 's', required: false, describe: 'The enrollment secret of the user', type: 'string' }
+    enrollSecret: { alias: 's', required: false, describe: 'The enrollment secret of the user', type: 'string' },
+    certificateFile: { alias: 'c', required: false, describe: 'File containing the certificate', type: 'string' },",6,2017-10-31 13:31:26,https://api.github.com/repos/hyperledger/composer/pulls/comments/147992640,https://github.com/hyperledger/composer/pull/2498#discussion_r147992640,bestbeforetoday
https://github.com/hyperledger/composer/pull/2498,https://github.com/hyperledger/composer/pull/2498,Is a `roles` parameter coming in a later pull request or should this one complete the create command?,6a6edceff42b9d4a402a103cf64df8f392baaf58,2017-10-31 13:26:34,147993355,"@@ -23,7 +23,9 @@ module.exports.builder = {
     businessNetworkName: {alias: 'n', required: true, describe: 'The business network name', type: 'string' },
     connectionProfileFile: {alias: 'j', required: false, describe: 'Filename of the connection profile json file', type: 'string' },
     enrollId: { alias: 'i', required: false, describe: 'The enrollment ID of the user', type: 'string' },
-    enrollSecret: { alias: 's', required: false, describe: 'The enrollment secret of the user', type: 'string' }
+    enrollSecret: { alias: 's', required: false, describe: 'The enrollment secret of the user', type: 'string' },
+    certificateFile: { alias: 'c', required: false, describe: 'File containing the certificate', type: 'string' },",6,2017-10-31 13:31:26,https://api.github.com/repos/hyperledger/composer/pulls/comments/147993355,https://github.com/hyperledger/composer/pull/2498#discussion_r147993355,bestbeforetoday
https://github.com/hyperledger/composer/pull/2498,https://github.com/hyperledger/composer/pull/2498,I think the connection profile is required?,6a6edceff42b9d4a402a103cf64df8f392baaf58,2017-10-31 13:27:24,147993587,"@@ -23,7 +23,9 @@ module.exports.builder = {
     businessNetworkName: {alias: 'n', required: true, describe: 'The business network name', type: 'string' },
     connectionProfileFile: {alias: 'j', required: false, describe: 'Filename of the connection profile json file', type: 'string' },
     enrollId: { alias: 'i', required: false, describe: 'The enrollment ID of the user', type: 'string' },
-    enrollSecret: { alias: 's', required: false, describe: 'The enrollment secret of the user', type: 'string' }
+    enrollSecret: { alias: 's', required: false, describe: 'The enrollment secret of the user', type: 'string' },
+    certificateFile: { alias: 'c', required: false, describe: 'File containing the certificate', type: 'string' },",6,2017-10-31 13:31:26,https://api.github.com/repos/hyperledger/composer/pulls/comments/147993587,https://github.com/hyperledger/composer/pull/2498#discussion_r147993587,bestbeforetoday
https://github.com/hyperledger/composer/pull/2498,https://github.com/hyperledger/composer/pull/2498,should copy?,6a6edceff42b9d4a402a103cf64df8f392baaf58,2017-10-31 13:30:30,147994593,"@@ -57,12 +57,22 @@ describe('composer card import CLI', function() {
             name : 'CARD_NAME'
         };
 
-        adminConnectionStub.getCard.resolves(testCard);
+        adminConnectionStub.exportCard.resolves(testCard);
         return ExportCmd.handler(args).then(() => {
-            sinon.assert.calledOnce(adminConnectionStub.getCard);
+            sinon.assert.calledOnce(adminConnectionStub.exportCard);
             sinon.assert.calledWith(consoleLogSpy, sinon.match('CARD_NAME'));
         });
     });
 
+    it('should copy with the file system write failing', function() {",13,2017-10-31 13:31:26,https://api.github.com/repos/hyperledger/composer/pulls/comments/147994593,https://github.com/hyperledger/composer/pull/2498#discussion_r147994593,bestbeforetoday
https://github.com/hyperledger/composer/pull/2498,https://github.com/hyperledger/composer/pull/2498,Is this intentional?,6a6edceff42b9d4a402a103cf64df8f392baaf58,2017-10-31 13:31:18,147995009,"@@ -50,6 +50,7 @@ class Factory {
      * <strong>Note: Only to be called by framework code. Applications should
      * retrieve instances from {@link Hyperledger-Composer}</strong>
      * </p>
+     * @private",,2017-10-31 13:31:26,https://api.github.com/repos/hyperledger/composer/pulls/comments/147995009,https://github.com/hyperledger/composer/pull/2498#discussion_r147995009,bestbeforetoday
https://github.com/hyperledger/composer/pull/2495,https://github.com/hyperledger/composer/pull/2495,Do we need this Promise.resolve() ? can't the initial function of the promise chain be the adminConnection.connect ?,a7741ac9663fd370f13ca03821bb074d1e5eb1a3,2017-10-30 12:42:56,147691050,"@@ -43,48 +39,15 @@ class Deploy {
                                   ? true
                                   : false;
         let businessNetworkDefinition;
-
         let adminConnection;
-        let enrollId;
-        let enrollSecret;
-        let connectionProfileName = argv.connectionProfileName;
         let businessNetworkName;
         let spinner;
-        let loglevel;
-
+        let loglevel = argv.loglevel;
         let cardName = argv.card;
-        let usingCard = !(cardName===undefined);
-
-        if (argv.loglevel) {
-            // validate log level as yargs cannot at this time
-            // https://github.com/yargs/yargs/issues/849
-            loglevel = argv.loglevel.toUpperCase();
-            if (!LogLevel.validLogLevel(loglevel)) {
-                return Promise.reject(new Error('loglevel unspecified or not one of (INFO|WARNING|ERROR|DEBUG)'));
-            }
-        }
 
-        return (() => {
-            console.log(chalk.blue.bold('Deploying business network from archive: ')+argv.archiveFile);
-
-            if (!argv.enrollSecret && !usingCard) {
-                return cmdUtil.prompt({
-                    name: 'enrollmentSecret',
-                    description: 'What is the enrollment secret of the user?',
-                    required: true,
-                    hidden: true,
-                    replace: '*'
-                })
-                .then((result) => {
-                    argv.enrollSecret = result.enrollmentSecret;
-                });
-            } else {
-                return Promise.resolve();
-            }
-        })()
+        return  Promise.resolve()",,2017-10-30 13:46:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/147691050,https://github.com/hyperledger/composer/pull/2495#discussion_r147691050,davidkel
https://github.com/hyperledger/composer/pull/2495,https://github.com/hyperledger/composer/pull/2495,"case was changed, it should still be logLevel, not loglevel",a7741ac9663fd370f13ca03821bb074d1e5eb1a3,2017-10-30 12:50:35,147692548,"@@ -113,7 +74,7 @@ class Deploy {
                 // Build the deploy options.
                 let deployOptions = cmdUtil.parseOptions(argv);
                 if (loglevel) {
-                    deployOptions.logLevel = loglevel;
+                    deployOptions.loglevel = loglevel;",,2017-10-30 13:46:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/147692548,https://github.com/hyperledger/composer/pull/2495#discussion_r147692548,davidkel
https://github.com/hyperledger/composer/pull/2495,https://github.com/hyperledger/composer/pull/2495,Do we need to start with a Promise.resolve() ?,a7741ac9663fd370f13ca03821bb074d1e5eb1a3,2017-10-30 12:51:18,147692683,"@@ -36,46 +36,22 @@ class List {
     static handler(argv) {
 
         let businessNetworkConnection;
-        let enrollId;
-        let enrollSecret;
-        let connectionProfileName = argv.connectionProfileName;
+
         let businessNetworkName = argv.businessNetworkName;
         let businessNetworkDefinition;
         let listOutput;
         let spinner;
         let cardName = argv.card;
 
-        let usingCard = !(cardName===undefined);
-
-        return (() => {
-            spinner = ora('List business network '+ (usingCard ?  'from card ""'+ cardName +'""' : 'with name ""'+businessNetworkName+'""' ));
-
-            if (!argv.enrollSecret && !usingCard) {
-                return cmdUtil.prompt({
-                    name: 'enrollmentSecret',
-                    description: 'What is the enrollment secret of the user?',
-                    required: true,
-                    hidden: true,
-                    replace: '*'
-                })
-                .then((result) => {
-                    argv.enrollSecret = result.enrollmentSecret;
-                });
-            } else {
-                return Promise.resolve();
-            }
-        })()
-        .then (() => {
+
+
+        return Promise.resolve()",,2017-10-30 13:46:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/147692683,https://github.com/hyperledger/composer/pull/2495#discussion_r147692683,davidkel
https://github.com/hyperledger/composer/pull/2495,https://github.com/hyperledger/composer/pull/2495,same as above about Promise.resolve(),a7741ac9663fd370f13ca03821bb074d1e5eb1a3,2017-10-30 12:51:49,147692786,"@@ -37,39 +37,19 @@ class Download {
     */
     static handler(argv) {
 
-
         let businessNetworkDefinition;
         let businessNetworkName;
         let spinner;
         let cardName = argv.card;
-        let usingCard = !(cardName===undefined);
+
         let businessNetworkConnection = cmdUtil.createBusinessNetworkConnection();
 
-        return (() => {
-
-
-            if (!argv.enrollSecret && !usingCard) {
-                return cmdUtil.prompt({
-                    name: 'enrollmentSecret',
-                    description: 'What is the enrollment secret of the user?',
-                    required: true,
-                    hidden: true,
-                    replace: '*'
-                })
-                .then((result) => {
-                    argv.enrollSecret = result.enrollmentSecret;
-                });
-            } else {
-                return Promise.resolve();
-            }
-        })()
+        return Promise.resolve()",,2017-10-30 13:46:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/147692786,https://github.com/hyperledger/composer/pull/2495#discussion_r147692786,davidkel
https://github.com/hyperledger/composer/pull/2495,https://github.com/hyperledger/composer/pull/2495,same comment about Promise.resolve(),a7741ac9663fd370f13ca03821bb074d1e5eb1a3,2017-10-30 12:52:33,147692976,"@@ -32,50 +32,15 @@ class LogLevel {
     */
     static handler(argv) {
         let adminConnection;
-        let enrollId;
-        let enrollSecret;
-        let connectionProfileName;
         let businessNetworkName;
-        let newlevel;
+        let newlevel =argv.newlevel;
         let cardName = argv.card;
-        let usingCard = !(cardName===undefined);
 
-        if (argv.newlevel) {
-            // validate log level as yargs cannot at this time
-            // https://github.com/yargs/yargs/issues/849
-            newlevel = argv.newlevel.toUpperCase();
-            if (!LogLevel.validLogLevel(newlevel)) {
-                return Promise.reject(new Error('newlevel unspecified or not one of (INFO|WARNING|ERROR|DEBUG)'));
-            }
-        }
 
-        return (() => {
-            if (!argv.enrollSecret && !usingCard) {
-                return cmdUtil.prompt({
-                    name: 'enrollmentSecret',
-                    description: 'What is the enrollment secret of the user?',
-                    required: true,
-                    hidden: true,
-                    replace: '*'
-                })
-                .then((result) => {
-                    argv.enrollSecret = result.enrollmentSecret;
-                });
-            } else {
-                return Promise.resolve();
-            }
-        })()
+        return Promise.resolve()",,2017-10-30 13:46:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/147692976,https://github.com/hyperledger/composer/pull/2495#discussion_r147692976,davidkel
https://github.com/hyperledger/composer/pull/2495,https://github.com/hyperledger/composer/pull/2495,missing a space :-),a7741ac9663fd370f13ca03821bb074d1e5eb1a3,2017-10-30 12:52:44,147693037,"@@ -32,50 +32,15 @@ class LogLevel {
     */
     static handler(argv) {
         let adminConnection;
-        let enrollId;
-        let enrollSecret;
-        let connectionProfileName;
         let businessNetworkName;
-        let newlevel;
+        let newlevel =argv.newlevel;",,2017-10-30 13:46:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/147693037,https://github.com/hyperledger/composer/pull/2495#discussion_r147693037,davidkel
https://github.com/hyperledger/composer/pull/2495,https://github.com/hyperledger/composer/pull/2495,same comment about Promise.resolve(),a7741ac9663fd370f13ca03821bb074d1e5eb1a3,2017-10-30 12:53:21,147693222,"@@ -33,45 +33,20 @@ class Ping {
     */
     static handler(argv) {
         let businessNetworkConnection;
-        let enrollId;
-        let enrollSecret;
-        let connectionProfileName = argv.connectionProfileName;
-        let businessNetworkName;
+        let businessNetworkDefinition;
         let cardName = argv.card;
-        let usingCard = !(cardName===undefined);
 
-        return (() => {
-            if (!argv.enrollSecret && !usingCard) {
-                return cmdUtil.prompt({
-                    name: 'enrollmentSecret',
-                    description: 'What is the enrollment secret of the user?',
-                    required: true,
-                    hidden: true,
-                    replace: '*'
-                })
-                .then((result) => {
-                    argv.enrollSecret = result.enrollmentSecret;
-                });
-            } else {
-                return Promise.resolve();
-            }
-        })()
+        return Promise.resolve()",,2017-10-30 13:46:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/147693222,https://github.com/hyperledger/composer/pull/2495#discussion_r147693222,davidkel
https://github.com/hyperledger/composer/pull/2495,https://github.com/hyperledger/composer/pull/2495,Promise.resolve() comment,a7741ac9663fd370f13ca03821bb074d1e5eb1a3,2017-10-30 12:54:00,147693353,"@@ -32,56 +32,24 @@ class Reset {
     */
     static handler(argv) {
         let adminConnection;
-        let enrollId;
-        let enrollSecret;
-        let connectionProfileName = argv.connectionProfileName;
-        let businessNetworkName;
         let cardName = argv.card;
-        let usingCard = !(cardName===undefined);
         let spinner;
 
-        return (() => {
-            if (!argv.enrollSecret && !usingCard) {
-                return cmdUtil.prompt({
-                    name: 'enrollmentSecret',
-                    description: 'What is the enrollment secret of the user?',
-                    required: true,
-                    hidden: true,
-                    replace: '*'
-                })
-                .then((result) => {
-                    argv.enrollSecret = result.enrollmentSecret;
-                });
-            } else {
-                return Promise.resolve();
-            }
-        })()
-        .then(() => {
-
-            enrollId = argv.enrollId;
-            enrollSecret = argv.enrollSecret;
-            businessNetworkName = argv.businessNetworkName;
-            adminConnection = cmdUtil.createAdminConnection();
-            if (!cardName){
-                return adminConnection.connect(connectionProfileName, enrollId, enrollSecret,  businessNetworkName);
-            } else {
+        return Promise.resolve()",,2017-10-30 13:46:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/147693353,https://github.com/hyperledger/composer/pull/2495#discussion_r147693353,davidkel
https://github.com/hyperledger/composer/pull/2495,https://github.com/hyperledger/composer/pull/2495,same comment about Promise.resolve(),a7741ac9663fd370f13ca03821bb074d1e5eb1a3,2017-10-30 12:55:02,147693600,"@@ -46,26 +45,16 @@ class Start {
         let adminConnection;
         let businessNetworkName;
         let spinner;
-        let loglevel;
+        let loglevel = argv.loglevel;
         let cardName = argv.card;
-        let usingCard = !(cardName===undefined);
-
-        if (argv.loglevel) {
-            // validate log level as yargs cannot at this time
-            // https://github.com/yargs/yargs/issues/849
-            loglevel = argv.loglevel.toUpperCase();
-            if (!LogLevel.validLogLevel(loglevel)) {
-                return Promise.reject(new Error('loglevel unspecified or not one of (INFO|WARNING|ERROR|DEBUG)'));
-            }
-        }
 
-        return (() => {
+        return Promise.resolve().then(() => {",,2017-10-30 13:46:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/147693600,https://github.com/hyperledger/composer/pull/2495#discussion_r147693600,davidkel
https://github.com/hyperledger/composer/pull/2495,https://github.com/hyperledger/composer/pull/2495,"case change, I think it is still logLevel",a7741ac9663fd370f13ca03821bb074d1e5eb1a3,2017-10-30 12:55:28,147693738,"@@ -87,7 +73,7 @@ class Start {
                 // Build the start options.
                 let startOptions = cmdUtil.parseOptions(argv);
                 if (loglevel) {
-                    startOptions.logLevel = loglevel;
+                    startOptions.loglevel = loglevel;",,2017-10-30 13:46:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/147693738,https://github.com/hyperledger/composer/pull/2495#discussion_r147693738,davidkel
https://github.com/hyperledger/composer/pull/2495,https://github.com/hyperledger/composer/pull/2495,Promise.resolve(),a7741ac9663fd370f13ca03821bb074d1e5eb1a3,2017-10-30 12:55:40,147693807,"@@ -32,56 +32,25 @@ class Undeploy {
     */
     static handler(argv) {
         let adminConnection;
-        let enrollId;
-        let enrollSecret;
-        let connectionProfileName = argv.connectionProfileName;
-        let businessNetworkName;
         let cardName = argv.card;
-        let usingCard = !(cardName===undefined);
         let spinner;
 
-        return (() => {
-            if (!argv.enrollSecret && !usingCard) {
-                return cmdUtil.prompt({
-                    name: 'enrollmentSecret',
-                    description: 'What is the enrollment secret of the user?',
-                    required: true,
-                    hidden: true,
-                    replace: '*'
-                })
-                .then((result) => {
-                    argv.enrollSecret = result.enrollmentSecret;
-                });
-            } else {
-                return Promise.resolve();
-            }
-        })()
-        .then(() => {
-            enrollId = argv.enrollId;
-            enrollSecret = argv.enrollSecret;
-            businessNetworkName = argv.businessNetworkName;
-            adminConnection = cmdUtil.createAdminConnection();
-            if (!usingCard){
-                return adminConnection.connect(connectionProfileName, enrollId, enrollSecret,  businessNetworkName);
-            } else {
+        return Promise.resolve()",,2017-10-30 13:46:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/147693807,https://github.com/hyperledger/composer/pull/2495#discussion_r147693807,davidkel
https://github.com/hyperledger/composer/pull/2495,https://github.com/hyperledger/composer/pull/2495,promise.resolve(),a7741ac9663fd370f13ca03821bb074d1e5eb1a3,2017-10-30 12:56:11,147693951,"@@ -36,29 +36,22 @@ class Upgrade {
         let spinner;
 
         let cardName = argv.card;
-        let usingCard = !(cardName===undefined);
+
 
         return Promise.resolve()",,2017-10-30 13:46:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/147693951,https://github.com/hyperledger/composer/pull/2495#discussion_r147693951,davidkel
https://github.com/hyperledger/composer/pull/2495,https://github.com/hyperledger/composer/pull/2495,Does this allow for lower case and upper case ? before we allowed both,a7741ac9663fd370f13ca03821bb074d1e5eb1a3,2017-10-30 12:57:07,147694113,"@@ -19,11 +19,7 @@ const logLevel = require ('./lib/loglevel.js');
 module.exports.command = 'loglevel [options]';
 module.exports.describe = 'Change the logging level of a business network';
 module.exports.builder = {
-    businessNetworkName: {alias: 'n', required: false, describe: 'The business network name', type: 'string' },
-    connectionProfileName: {alias: 'p', required: false, describe: 'The connection profile name', type: 'string' },
-    newlevel: { alias: 'l', optional: true, describe: 'the new logging level (INFO/WARNING/ERROR/DEBUG)', type: 'string'/*, choices : ['INFO', 'WARNING', 'ERROR', 'DEBUG'] */},
-    enrollId: { alias: 'i', required: false, describe: 'The enrollment ID of the user', type: 'string' },
-    enrollSecret: { alias: 's', required: false, describe: 'The enrollment secret of the user', type: 'string' },
+    newlevel: { alias: 'l', optional: true, describe: 'the new logging level', choices : ['INFO', 'WARNING', 'ERROR', 'DEBUG'] },",9,2017-10-30 13:46:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/147694113,https://github.com/hyperledger/composer/pull/2495#discussion_r147694113,davidkel
https://github.com/hyperledger/composer/pull/2495,https://github.com/hyperledger/composer/pull/2495,I assume the help info outputs the choices ?,a7741ac9663fd370f13ca03821bb074d1e5eb1a3,2017-10-30 12:57:53,147694284,"@@ -19,13 +19,9 @@ const Start = require ('./lib/start.js');
 module.exports.command = 'start [options]';
 module.exports.describe = 'Starts a business network';
 module.exports.builder = {
-    archiveFile: {alias: 'a', required: true, describe: 'The business network archive file name', type: 'string' },
-    connectionProfileName: {alias: 'p', required: false, describe: 'The connection profile name', type: 'string' },
-    loglevel: { alias: 'l', required: false, describe: 'The initial loglevel to set (INFO|WARNING|ERROR|DEBUG)', type: 'string' },
+    loglevel: { alias: 'l', required: false, describe: 'The initial loglevel to set', choices : ['INFO', 'WARNING', 'ERROR', 'DEBUG']},",7,2017-10-30 13:46:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/147694284,https://github.com/hyperledger/composer/pull/2495#discussion_r147694284,davidkel
https://github.com/hyperledger/composer/pull/2495,https://github.com/hyperledger/composer/pull/2495,"case change on loglevel, should be logLevel.",a7741ac9663fd370f13ca03821bb074d1e5eb1a3,2017-10-30 12:59:09,147694525,"@@ -223,21 +210,16 @@ describe('composer deploy network CLI unit tests', function () {
                 sinon.assert.calledOnce(CmdUtil.createAdminConnection);
 
                 sinon.assert.calledOnce(mockAdminConnection.connect);
-                sinon.assert.calledWith(mockAdminConnection.connect, connectionProfileName, argv.enrollId, argv.enrollSecret);
+                sinon.assert.calledWith(mockAdminConnection.connect, 'cardname');
                 sinon.assert.calledOnce(mockAdminConnection.deploy);
-                sinon.assert.calledWith(mockAdminConnection.deploy, businessNetworkDefinition, { bootstrapTransactions: [], logLevel: 'DEBUG'});
+                sinon.assert.calledWith(mockAdminConnection.deploy, businessNetworkDefinition, { bootstrapTransactions: [], loglevel: 'DEBUG'});",,2017-10-30 13:46:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/147694525,https://github.com/hyperledger/composer/pull/2495#discussion_r147694525,davidkel
https://github.com/hyperledger/composer/pull/2495,https://github.com/hyperledger/composer/pull/2495,reset still requires a parameter,a7741ac9663fd370f13ca03821bb074d1e5eb1a3,2017-10-30 13:07:06,147696192,"@@ -32,56 +32,24 @@ class Reset {
     */
     static handler(argv) {
         let adminConnection;
-        let enrollId;
-        let enrollSecret;
-        let connectionProfileName = argv.connectionProfileName;
-        let businessNetworkName;
         let cardName = argv.card;
-        let usingCard = !(cardName===undefined);
         let spinner;
 
-        return (() => {
-            if (!argv.enrollSecret && !usingCard) {
-                return cmdUtil.prompt({
-                    name: 'enrollmentSecret',
-                    description: 'What is the enrollment secret of the user?',
-                    required: true,
-                    hidden: true,
-                    replace: '*'
-                })
-                .then((result) => {
-                    argv.enrollSecret = result.enrollmentSecret;
-                });
-            } else {
-                return Promise.resolve();
-            }
-        })()
-        .then(() => {
-
-            enrollId = argv.enrollId;
-            enrollSecret = argv.enrollSecret;
-            businessNetworkName = argv.businessNetworkName;
-            adminConnection = cmdUtil.createAdminConnection();
-            if (!cardName){
-                return adminConnection.connect(connectionProfileName, enrollId, enrollSecret,  businessNetworkName);
-            } else {
+        return Promise.resolve()
+            .then(() => {
+                adminConnection = cmdUtil.createAdminConnection();
                 return adminConnection.connect(cardName);
-            }
-        })
+            })
           .then((result) => {
-
-              spinner = ora('Reseting business network definition. This may take some seconds...').start();
-              return adminConnection.reset(businessNetworkName);
-
+              spinner = ora('Resetting business network definition. This may take some seconds...').start();
+              return adminConnection.reset();",,2017-10-30 13:46:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/147696192,https://github.com/hyperledger/composer/pull/2495#discussion_r147696192,davidkel
https://github.com/hyperledger/composer/pull/2495,https://github.com/hyperledger/composer/pull/2495,undeploy still requires a parameter.,a7741ac9663fd370f13ca03821bb074d1e5eb1a3,2017-10-30 13:07:28,147696288,"@@ -32,56 +32,25 @@ class Undeploy {
     */
     static handler(argv) {
         let adminConnection;
-        let enrollId;
-        let enrollSecret;
-        let connectionProfileName = argv.connectionProfileName;
-        let businessNetworkName;
         let cardName = argv.card;
-        let usingCard = !(cardName===undefined);
         let spinner;
 
-        return (() => {
-            if (!argv.enrollSecret && !usingCard) {
-                return cmdUtil.prompt({
-                    name: 'enrollmentSecret',
-                    description: 'What is the enrollment secret of the user?',
-                    required: true,
-                    hidden: true,
-                    replace: '*'
-                })
-                .then((result) => {
-                    argv.enrollSecret = result.enrollmentSecret;
-                });
-            } else {
-                return Promise.resolve();
-            }
-        })()
-        .then(() => {
-            enrollId = argv.enrollId;
-            enrollSecret = argv.enrollSecret;
-            businessNetworkName = argv.businessNetworkName;
-            adminConnection = cmdUtil.createAdminConnection();
-            if (!usingCard){
-                return adminConnection.connect(connectionProfileName, enrollId, enrollSecret,  businessNetworkName);
-            } else {
+        return Promise.resolve()
+            .then(() => {
+                adminConnection = cmdUtil.createAdminConnection();
                 return adminConnection.connect(cardName);
-            }
-        })
-          .then((result) => {
-              spinner = ora('Undeploying business network definition. This may take some seconds...').start();
-              return adminConnection.undeploy(businessNetworkName);
-
-          }).then((result) => {
-              spinner.succeed();
-              return result;
-          }).catch((error) => {
-
-              if (spinner) {
-                  spinner.fail();
-              }
-
-              throw error;
-          });
+            })
+            .then((result) => {
+                spinner = ora('Undeploying business network definition. This may take some seconds...').start();
+                return adminConnection.undeploy();",,2017-10-30 13:46:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/147696288,https://github.com/hyperledger/composer/pull/2495#discussion_r147696288,davidkel
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,This is not correct. connect() has been changed and getCard() added.,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 08:13:48,147071826,"@@ -11,6 +11,11 @@
 #
 # Note that the latest public API is documented using JSDocs and is available in api.txt.
 #
+
+Version 0.14.1 {4d2de763c61ba58a8b8a80c83bf9e84a} 2017-10-23
+ - Update to have connectWithCard",6,2017-10-26 14:40:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/147071826,https://github.com/hyperledger/composer/pull/2456#discussion_r147071826,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,"This parameter list makes me sad. It's also incorrect. Other APIs I've seen that overload a function call at least document the correct number and meaning of the parameters. You can specify alternative types for a single parameter, e.g. {(String|Boolean)}.

The boolean parameter for an update is also kinda yukky. A connect() and connectForUpdate() would read better to me if they really need to be different.",b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 08:19:52,147073160,"@@ -245,6 +259,106 @@ class AdminConnection {
             });
     }
 
+     /**
+     * Connects and logs in to the Hyperledger Fabric using a named connection
+     * profile.
+     * EITHER, the cardName, and updateflag , OR
+     * the connectionProfile, enrollmentID, enrollmentSecret and businessNetworkIdentifier
+     * Should be specified. NOT both
+     * @example
+     * // Connect to Hyperledger Fabric
+     * var adminConnection = new AdminConnection();
+     * adminConnection.connect('testprofile', 'WebAppAdmin', 'DJY27pEnl16d')
+     * .then(function(){
+     *     // Connected.
+     * })
+     * .catch(function(error){
+     *     // Add optional error handling here.
+     * });
+     * // Connect to Hyperledger Fabric
+     * var adminConnection = new AdminConnection();
+     * adminConnection.connect('testprofile', 'WebAppAdmin', 'DJY27pEnl16d')
+     * .then(function(){
+     *     // Connected.
+     * })
+     * .catch(function(error){
+     *     // Add optional error handling here.
+     * });
+     *
+     * @param {string} connectionProfile - The name of the connection profile
+     * @param {string} enrollmentID the enrollment ID of the user
+     * @param {string} enrollmentSecret the enrollment secret of the user
+     * @param {string} businessNetworkIdentifier the id of the network (for update) or null
+     * @param {String} cardName - The name of the business network card
+     * @param {boolean} update true if this is for an update operation
+     * @return {Promise} A promise that indicates the connection is complete
+     */
+    connect(connectionProfile, enrollmentID, enrollmentSecret, businessNetworkIdentifier,cardName,update){",103,2017-10-26 14:40:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/147073160,https://github.com/hyperledger/composer/pull/2456#discussion_r147073160,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,"A better name might be ""should error if called with no arguments"".

Should there be a test for 5 arguments too? Right now it looks like this would generate an error, which is unusual for Javascript as it typically ignores additional arguments without error.",b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 08:31:20,147075746,"@@ -230,8 +230,62 @@ describe('AdminConnection', () => {
                 });
         });
 
+        it('should error if wrong number of arguments given', () => {",4,2017-10-26 14:40:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/147075746,https://github.com/hyperledger/composer/pull/2456#discussion_r147075746,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,The test asserts that ping is **not** called.,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 08:32:48,147076091,"@@ -230,8 +230,62 @@ describe('AdminConnection', () => {
                 });
         });
 
+        it('should error if wrong number of arguments given', () => {
+            return adminConnection.connect().should.be.rejectedWith(/Incorrect number of arguments/);
+        });
+
     });
 
+    describe('#connectWithCard', () =>{
+
+
+        it ('should connect, login and ping if update not specified', () => {",13,2017-10-26 14:40:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/147076091,https://github.com/hyperledger/composer/pull/2456#discussion_r147076091,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Why do we need to mock a card rather than use a real one?,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 08:34:08,147076365,"@@ -230,8 +230,62 @@ describe('AdminConnection', () => {
                 });
         });
 
+        it('should error if wrong number of arguments given', () => {
+            return adminConnection.connect().should.be.rejectedWith(/Incorrect number of arguments/);
+        });
+
     });
 
+    describe('#connectWithCard', () =>{
+
+
+        it ('should connect, login and ping if update not specified', () => {
+            sinon.spy(cardStore,'get');
+
+            let mockIdCard = sinon.createStubInstance(IdCard);",16,2017-10-26 14:40:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/147076365,https://github.com/hyperledger/composer/pull/2456#discussion_r147076365,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Duplicates set-up code in previous test.,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 08:34:33,147076462,"@@ -230,8 +230,62 @@ describe('AdminConnection', () => {
                 });
         });
 
+        it('should error if wrong number of arguments given', () => {
+            return adminConnection.connect().should.be.rejectedWith(/Incorrect number of arguments/);
+        });
+
     });
 
+    describe('#connectWithCard', () =>{
+
+
+        it ('should connect, login and ping if update not specified', () => {
+            sinon.spy(cardStore,'get');
+
+            let mockIdCard = sinon.createStubInstance(IdCard);
+            mockIdCard.getConnectionProfile.returns({});
+            mockIdCard.getUserName.returns('fred');
+            mockIdCard.getBusinessNetworkName.returns('network');
+            mockIdCard.getEnrollmentCredentials.returns({secret:'password'});
+            cardStore.put('testCardname',mockIdCard);
+
+            sinon.stub(adminConnection.connectionProfileManager, 'connectWithData').resolves(mockConnection);
+            return adminConnection.connect('testCardname').then(()=>{
+                sinon.assert.calledOnce(cardStore.get);
+                sinon.assert.calledWith(cardStore.get,'testCardname');
+                sinon.assert.calledOnce(adminConnection.connectionProfileManager.connectWithData);
+                sinon.assert.calledWith(adminConnection.connectionProfileManager.connectWithData,{},'network');
+                sinon.assert.calledOnce(mockConnection.login);
+                sinon.assert.calledWith(mockConnection.login,'fred','password');
+                sinon.assert.notCalled(mockConnection.ping);
+            });
+        });
+
+        it ('should connect, login and ping if update specified', () => {
+            sinon.spy(cardStore,'get');
+
+            let mockIdCard = sinon.createStubInstance(IdCard);",38,2017-10-26 14:40:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/147076462,https://github.com/hyperledger/composer/pull/2456#discussion_r147076462,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Previously a separate class was being stubbed; now other functions within the same class are being stubbed. Mocking external dependencies it is not practical to call for real seems reasonable. Not sure why we need to stub out our own implementation to be able to test it.,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 08:36:59,147076994,"@@ -270,8 +324,9 @@ describe('AdminConnection', () => {
     describe('#disconnect', () => {
         it('should set connection and security context to null', () => {
             let adminConnection = new AdminConnection();
-            sinon.stub(adminConnection.connectionProfileManager, 'connect').resolves(mockConnection);
-            return adminConnection.connect()
+
+            sinon.stub(adminConnection, '_connectWithCard').resolves(mockConnection);",70,2017-10-26 14:40:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/147076994,https://github.com/hyperledger/composer/pull/2456#discussion_r147076994,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Just throw inside a Promise chain to trigger a Promise rejection.,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 13:46:54,147145903,"@@ -0,0 +1,70 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const cmdUtil = require('../../utils/cmdutils');
+const fs = require('fs');
+const path = require('path');
+
+/**
+ * Composer ""card export"" command
+ * @private
+ */
+class Export {
+  /**
+    * Command implementation.
+    * @param {Object} args argument list from composer command
+    * @return {Promise} promise when command complete
+    */
+    static handler(args) {
+
+        let cardName = args.name;
+        let fileName = args.file;
+
+        const adminConnection = cmdUtil.createAdminConnection();
+        return adminConnection.getCard(cardName)
+        .then((card) =>{
+            return Export.writeCardToFile(fileName,card);
+        })
+        .then(() => {
+            console.log('Successfully exported business network card: ' + cardName+' to '+fileName);
+        });
+
+    }
+
+    /**
+     * Read a business network card file.
+     * @param {String} cardFileName absolute or relative (to current working directory) card file name
+     * @param {IdCard} card Businss Network Card to write to disk
+     * @return {Promise} Resolvesd when written to disk
+     */
+    static writeCardToFile(cardFileName,card) {
+        let cardFilePath;
+        return card.toArchive({ type: 'nodebuffer' })
+           .then( (cardBuffer)=>{
+               // got the id card to write to a buffer
+               cardFilePath = path.resolve(cardFileName);
+               try {
+                   fs.writeFileSync(cardFilePath,cardBuffer);
+               } catch (cause) {
+                   const error = new Error(`Unable to write card file: ${cardFilePath}`);
+                   error.cause = cause;
+                   return Promise.reject(error);",64,2017-10-26 15:39:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/147145903,https://github.com/hyperledger/composer/pull/2456#discussion_r147145903,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,"Maybe we should just have a (hidden?) `issueCard` command alongside the regular `issue` command for now, rather than doing unnecessary work to to shoe-horn two different sets of behaviour into the single command. We can very easily rename an `issueCard` command to `issue` later.",b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 13:51:00,147147152,"@@ -15,21 +15,59 @@
 'use strict';
 
 const Issue = require ('./lib/issue.js');
-
+const IssueCard = require ('./lib/issuecard.js');
 module.exports.command = 'issue [options]';
 module.exports.describe = 'Issue a new identity to a participant in a participant registry';
-module.exports.builder = {
-    connectionProfileName: {alias: 'p', required: true, describe: 'The connection profile name', type: 'string' },
-    businessNetworkName: {alias: 'n', required: true, describe: 'The business network name', type: 'string' },
-    enrollId: { alias: 'i', required: true, describe: 'The enrollment ID of the user', type: 'string' },
-    enrollSecret: { alias: 's', required: false, describe: 'The enrollment secret of the user', type: 'string' },
-    newUserId: { alias: 'u', required: true, describe: 'The user ID for the new identity', type: 'string' },
-    participantId: { alias: 'a', required: true, describe: 'The particpant to issue the new identity to', type: 'string' },
-    issuer: { alias: 'x', required: true, describe: 'If the new identity should be able to issue other new identities', type: 'boolean' },
-    option: { alias: 'o', required: false, describe: 'Options that are specific specific to connection. Multiple options are specified by repeating this option', type: 'string' },
-    optionsFile: { alias: 'O', required: false, describe: 'A file containing options that are specific to connection', type: 'string' }
+module.exports.builder =function (yargs) {
+    yargs.options({
+        'connectionProfileName': {alias: 'p', required: false, describe: 'The connection profile name', type: 'string' },
+        'businessNetworkName': {alias: 'n', required: false, describe: 'The business network name', type: 'string' },
+        'enrollId': { alias: 'i', required: false, describe: 'The enrollment ID of the user', type: 'string' },
+        'enrollSecret': { alias: 's', required: false, describe: 'The enrollment secret of the user', type: 'string' },
+        'newUserId': { alias: 'u', required: false, describe: 'The user ID for the new identity', type: 'string' },
+        'participantId': { alias: 'a', required: true, describe: 'The particpant to issue the new identity to', type: 'string' },
+        'issuer': { alias: 'x', required: false, describe: 'If the new identity should be able to issue other new identities', type: 'boolean' },
+        'option': { alias: 'o', required: false, describe: 'Options that are specific specific to connection. Multiple options are specified by repeating this option', type: 'string' },
+        'optionsFile': { alias: 'O', required: false, describe: 'A file containing options that are specific to connection', type: 'string' },
+        'card': {alias: 'c', required: false, describe: 'Name of the network card to use for issuing', type: 'string'},",29,2017-10-26 15:39:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/147147152,https://github.com/hyperledger/composer/pull/2456#discussion_r147147152,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Needs to be able to include credentials too (certificate and private key).,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 13:55:11,147148385,"@@ -0,0 +1,78 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const IdCard = require('composer-common').IdCard;
+const Export = require('./export');
+const fs = require('fs');
+const path = require('path');
+/**
+ * Composer ""card import"" command
+ * @private
+ */
+class Create {
+  /**
+    * Command implementation.
+    * @param {Object} args argument list from composer command
+    * @return {Promise} promise when command complete
+    */
+    static handler(args) {
+
+        let profileFile  = args.connectionProfileFile;
+        let businessNetworkName = args.businessNetworkName;
+        let fileName = args.file;
+
+        let metadata= {
+            userName : args.enrollId,
+            version : 1,
+            enrollmentSecret:args.enrollSecret,
+            businessNetwork : businessNetworkName
+        };
+
+        return Promise.resolve()
+            .then( ()=>{
+                return this.readJsonFromFile(profileFile);
+            })
+            .then((profileData) =>{
+                let idCard = new IdCard(metadata,profileData);",,2017-10-26 15:39:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/147148385,https://github.com/hyperledger/composer/pull/2456#discussion_r147148385,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,"As above, separate command for cards could save us work to unpick later.",b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 13:59:38,147149705,"@@ -64,7 +67,7 @@ class Deploy {
         return (() => {
             console.log(chalk.blue.bold('Deploying business network from archive: ')+argv.archiveFile);
 
-            if (!argv.enrollSecret) {
+            if (!argv.enrollSecret && !usingCard) {",15,2017-10-26 15:39:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/147149705,https://github.com/hyperledger/composer/pull/2456#discussion_r147149705,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,"Create, not import",b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 14:04:58,147151219,"@@ -0,0 +1,73 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+const CmdUtil = require('../../lib/cmds/utils/cmdutils.js');
+const fs = require('fs');
+const IdCard = require('composer-common').IdCard;
+const CreateCmd = require('../../lib/cmds/card/createCommand.js');
+
+
+const chai = require('chai');
+const sinon = require('sinon');
+chai.should();
+chai.use(require('chai-as-promised'));
+
+describe('composer card import CLI', function() {",29,2017-10-26 15:39:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/147151219,https://github.com/hyperledger/composer/pull/2456#discussion_r147151219,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,fs.writeFileSync does not return the file content,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 14:08:47,147152325,"@@ -0,0 +1,73 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+const CmdUtil = require('../../lib/cmds/utils/cmdutils.js');
+const fs = require('fs');
+const IdCard = require('composer-common').IdCard;
+const CreateCmd = require('../../lib/cmds/card/createCommand.js');
+
+
+const chai = require('chai');
+const sinon = require('sinon');
+chai.should();
+chai.use(require('chai-as-promised'));
+
+describe('composer card import CLI', function() {
+    const sandbox = sinon.sandbox.create();
+    const cardFileName = '/TestCard.card';
+    let cardBuffer;
+    let adminConnectionStub;
+    let consoleLogSpy;
+    let testCard;
+
+    beforeEach(function() {
+        adminConnectionStub = sinon.createStubInstance(AdminConnection);
+        sandbox.stub(CmdUtil, 'createAdminConnection').returns(adminConnectionStub);
+        consoleLogSpy = sandbox.spy(console, 'log');
+        sandbox.stub(process, 'exit');
+
+        testCard = new IdCard({ userName: 'conga' }, { name: 'profileName' });
+        return testCard.toArchive({ type:'nodebuffer' }).then(buffer => {
+            cardBuffer = buffer;
+        });
+    });
+
+    afterEach(function() {
+        sandbox.restore();
+    });
+
+    it('should create a valid card file with supplied details', function() {
+        sandbox.stub(fs, 'writeFileSync').withArgs(cardFileName).returns(cardBuffer);",54,2017-10-26 15:39:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/147152325,https://github.com/hyperledger/composer/pull/2456#discussion_r147152325,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Not checking the write happened,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 14:14:31,147154157,"@@ -0,0 +1,73 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+const CmdUtil = require('../../lib/cmds/utils/cmdutils.js');
+const fs = require('fs');
+const IdCard = require('composer-common').IdCard;
+const CreateCmd = require('../../lib/cmds/card/createCommand.js');
+
+
+const chai = require('chai');
+const sinon = require('sinon');
+chai.should();
+chai.use(require('chai-as-promised'));
+
+describe('composer card import CLI', function() {
+    const sandbox = sinon.sandbox.create();
+    const cardFileName = '/TestCard.card';
+    let cardBuffer;
+    let adminConnectionStub;
+    let consoleLogSpy;
+    let testCard;
+
+    beforeEach(function() {
+        adminConnectionStub = sinon.createStubInstance(AdminConnection);
+        sandbox.stub(CmdUtil, 'createAdminConnection').returns(adminConnectionStub);
+        consoleLogSpy = sandbox.spy(console, 'log');
+        sandbox.stub(process, 'exit');
+
+        testCard = new IdCard({ userName: 'conga' }, { name: 'profileName' });
+        return testCard.toArchive({ type:'nodebuffer' }).then(buffer => {
+            cardBuffer = buffer;
+        });
+    });
+
+    afterEach(function() {
+        sandbox.restore();
+    });
+
+    it('should create a valid card file with supplied details', function() {
+        sandbox.stub(fs, 'writeFileSync').withArgs(cardFileName).returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            businessNetworkName : 'network',
+            file: 'filename',
+            enrollSecret:'password',
+            enrollId:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));",67,2017-10-26 15:39:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/147154157,https://github.com/hyperledger/composer/pull/2456#discussion_r147154157,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Export,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 14:15:14,147154403,"@@ -0,0 +1,68 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+const CmdUtil = require('../../lib/cmds/utils/cmdutils.js');
+const fs = require('fs');
+const IdCard = require('composer-common').IdCard;
+const ExportCmd = require('../../lib/cmds/card/exportCommand.js');
+
+
+const chai = require('chai');
+const sinon = require('sinon');
+chai.should();
+chai.use(require('chai-as-promised'));
+
+describe('composer card import CLI', function() {",29,2017-10-26 15:39:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/147154403,https://github.com/hyperledger/composer/pull/2456#discussion_r147154403,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Test for unable to write output file?,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 14:24:56,147157487,"@@ -0,0 +1,73 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+const CmdUtil = require('../../lib/cmds/utils/cmdutils.js');
+const fs = require('fs');
+const IdCard = require('composer-common').IdCard;
+const CreateCmd = require('../../lib/cmds/card/createCommand.js');
+
+
+const chai = require('chai');
+const sinon = require('sinon');
+chai.should();
+chai.use(require('chai-as-promised'));
+
+describe('composer card import CLI', function() {
+    const sandbox = sinon.sandbox.create();
+    const cardFileName = '/TestCard.card';
+    let cardBuffer;
+    let adminConnectionStub;
+    let consoleLogSpy;
+    let testCard;
+
+    beforeEach(function() {
+        adminConnectionStub = sinon.createStubInstance(AdminConnection);
+        sandbox.stub(CmdUtil, 'createAdminConnection').returns(adminConnectionStub);
+        consoleLogSpy = sandbox.spy(console, 'log');
+        sandbox.stub(process, 'exit');
+
+        testCard = new IdCard({ userName: 'conga' }, { name: 'profileName' });
+        return testCard.toArchive({ type:'nodebuffer' }).then(buffer => {
+            cardBuffer = buffer;
+        });
+    });
+
+    afterEach(function() {
+        sandbox.restore();
+    });
+
+    it('should create a valid card file with supplied details', function() {
+        sandbox.stub(fs, 'writeFileSync').withArgs(cardFileName).returns(cardBuffer);
+        sandbox.stub(fs, 'readFileSync').returns(cardBuffer);
+        sandbox.stub(JSON, 'parse').returns({name:'network'});
+        const args = {
+            connectionProfileFile: 'filename',
+            businessNetworkName : 'network',
+            file: 'filename',
+            enrollSecret:'password',
+            enrollId:'fred'
+        };
+
+        return CreateCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(fs.readFileSync);
+            sinon.assert.calledWith(fs.readFileSync,sinon.match(/filename/));
+            sinon.assert.calledWith(consoleLogSpy, sinon.match('Successfully created business network card'));
+        });
+    });
+
+
+});",73,2017-10-26 15:39:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/147157487,https://github.com/hyperledger/composer/pull/2456#discussion_r147157487,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Write does not return file content.,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 14:26:06,147157989,"@@ -0,0 +1,68 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+const CmdUtil = require('../../lib/cmds/utils/cmdutils.js');
+const fs = require('fs');
+const IdCard = require('composer-common').IdCard;
+const ExportCmd = require('../../lib/cmds/card/exportCommand.js');
+
+
+const chai = require('chai');
+const sinon = require('sinon');
+chai.should();
+chai.use(require('chai-as-promised'));
+
+describe('composer card import CLI', function() {
+    const sandbox = sinon.sandbox.create();
+    const cardFileName = '/TestCard.card';
+    let cardBuffer;
+    let adminConnectionStub;
+    let consoleLogSpy;
+    let testCard;
+
+    beforeEach(function() {
+        adminConnectionStub = sinon.createStubInstance(AdminConnection);
+        sandbox.stub(CmdUtil, 'createAdminConnection').returns(adminConnectionStub);
+        consoleLogSpy = sandbox.spy(console, 'log');
+        sandbox.stub(process, 'exit');
+
+        testCard = new IdCard({ userName: 'conga' }, { name: 'profileName' });
+        return testCard.toArchive({ type:'nodebuffer' }).then(buffer => {
+            cardBuffer = buffer;
+        });
+    });
+
+    afterEach(function() {
+        sandbox.restore();
+    });
+
+    it('should export valid card file with default name', function() {
+        sandbox.stub(fs, 'writeFileSync').withArgs(cardFileName).returns(cardBuffer);",54,2017-10-26 15:39:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/147157989,https://github.com/hyperledger/composer/pull/2456#discussion_r147157989,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Not sure of the value of this assertion,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 14:26:56,147158363,"@@ -0,0 +1,68 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+const CmdUtil = require('../../lib/cmds/utils/cmdutils.js');
+const fs = require('fs');
+const IdCard = require('composer-common').IdCard;
+const ExportCmd = require('../../lib/cmds/card/exportCommand.js');
+
+
+const chai = require('chai');
+const sinon = require('sinon');
+chai.should();
+chai.use(require('chai-as-promised'));
+
+describe('composer card import CLI', function() {
+    const sandbox = sinon.sandbox.create();
+    const cardFileName = '/TestCard.card';
+    let cardBuffer;
+    let adminConnectionStub;
+    let consoleLogSpy;
+    let testCard;
+
+    beforeEach(function() {
+        adminConnectionStub = sinon.createStubInstance(AdminConnection);
+        sandbox.stub(CmdUtil, 'createAdminConnection').returns(adminConnectionStub);
+        consoleLogSpy = sandbox.spy(console, 'log');
+        sandbox.stub(process, 'exit');
+
+        testCard = new IdCard({ userName: 'conga' }, { name: 'profileName' });
+        return testCard.toArchive({ type:'nodebuffer' }).then(buffer => {
+            cardBuffer = buffer;
+        });
+    });
+
+    afterEach(function() {
+        sandbox.restore();
+    });
+
+    it('should export valid card file with default name', function() {
+        sandbox.stub(fs, 'writeFileSync').withArgs(cardFileName).returns(cardBuffer);
+        const args = {
+            file: cardFileName,
+            name : 'CARD_NAME'
+        };
+
+        adminConnectionStub.getCard.resolves(testCard);
+        return ExportCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(adminConnectionStub.getCard);",62,2017-10-26 15:39:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/147158363,https://github.com/hyperledger/composer/pull/2456#discussion_r147158363,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,No test that a file is written,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 14:27:18,147158560,"@@ -0,0 +1,68 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+const CmdUtil = require('../../lib/cmds/utils/cmdutils.js');
+const fs = require('fs');
+const IdCard = require('composer-common').IdCard;
+const ExportCmd = require('../../lib/cmds/card/exportCommand.js');
+
+
+const chai = require('chai');
+const sinon = require('sinon');
+chai.should();
+chai.use(require('chai-as-promised'));
+
+describe('composer card import CLI', function() {
+    const sandbox = sinon.sandbox.create();
+    const cardFileName = '/TestCard.card';
+    let cardBuffer;
+    let adminConnectionStub;
+    let consoleLogSpy;
+    let testCard;
+
+    beforeEach(function() {
+        adminConnectionStub = sinon.createStubInstance(AdminConnection);
+        sandbox.stub(CmdUtil, 'createAdminConnection').returns(adminConnectionStub);
+        consoleLogSpy = sandbox.spy(console, 'log');
+        sandbox.stub(process, 'exit');
+
+        testCard = new IdCard({ userName: 'conga' }, { name: 'profileName' });
+        return testCard.toArchive({ type:'nodebuffer' }).then(buffer => {
+            cardBuffer = buffer;
+        });
+    });
+
+    afterEach(function() {
+        sandbox.restore();
+    });
+
+    it('should export valid card file with default name', function() {
+        sandbox.stub(fs, 'writeFileSync').withArgs(cardFileName).returns(cardBuffer);
+        const args = {
+            file: cardFileName,
+            name : 'CARD_NAME'
+        };
+
+        adminConnectionStub.getCard.resolves(testCard);
+        return ExportCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(adminConnectionStub.getCard);
+            sinon.assert.calledWith(consoleLogSpy, sinon.match('CARD_NAME'));",63,2017-10-26 15:39:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/147158560,https://github.com/hyperledger/composer/pull/2456#discussion_r147158560,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Write error scenario?,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 14:27:29,147158646,"@@ -0,0 +1,68 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const AdminConnection = require('composer-admin').AdminConnection;
+const CmdUtil = require('../../lib/cmds/utils/cmdutils.js');
+const fs = require('fs');
+const IdCard = require('composer-common').IdCard;
+const ExportCmd = require('../../lib/cmds/card/exportCommand.js');
+
+
+const chai = require('chai');
+const sinon = require('sinon');
+chai.should();
+chai.use(require('chai-as-promised'));
+
+describe('composer card import CLI', function() {
+    const sandbox = sinon.sandbox.create();
+    const cardFileName = '/TestCard.card';
+    let cardBuffer;
+    let adminConnectionStub;
+    let consoleLogSpy;
+    let testCard;
+
+    beforeEach(function() {
+        adminConnectionStub = sinon.createStubInstance(AdminConnection);
+        sandbox.stub(CmdUtil, 'createAdminConnection').returns(adminConnectionStub);
+        consoleLogSpy = sandbox.spy(console, 'log');
+        sandbox.stub(process, 'exit');
+
+        testCard = new IdCard({ userName: 'conga' }, { name: 'profileName' });
+        return testCard.toArchive({ type:'nodebuffer' }).then(buffer => {
+            cardBuffer = buffer;
+        });
+    });
+
+    afterEach(function() {
+        sandbox.restore();
+    });
+
+    it('should export valid card file with default name', function() {
+        sandbox.stub(fs, 'writeFileSync').withArgs(cardFileName).returns(cardBuffer);
+        const args = {
+            file: cardFileName,
+            name : 'CARD_NAME'
+        };
+
+        adminConnectionStub.getCard.resolves(testCard);
+        return ExportCmd.handler(args).then(() => {
+            sinon.assert.calledOnce(adminConnectionStub.getCard);
+            sinon.assert.calledWith(consoleLogSpy, sinon.match('CARD_NAME'));
+        });
+    });
+
+
+});",68,2017-10-26 15:39:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/147158646,https://github.com/hyperledger/composer/pull/2456#discussion_r147158646,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Mixing unrelated work into a pull request is something to avoid.,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 14:30:46,147159945,"@@ -35,19 +35,7 @@ let results = yargs
     .alias('v', 'version')
     .version(version)
     .describe('v', 'show version information')
-    .command(",4,2017-10-26 15:39:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/147159945,https://github.com/hyperledger/composer/pull/2456#discussion_r147159945,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,"Not checking that a card file pops out the end of this process, which is the whole point of the command.",b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 14:35:40,147161440,"@@ -179,4 +203,24 @@ describe('composer identity issue CLI unit tests', () => {
             .should.be.rejectedWith(/such error/);
     });
 
+    it('should issue a new card using the specified profile', () => {
+        let argv = {
+            c: 'cardname',card:'cardname',   // needed as yargs would do this
+            file: 'filename',
+            newUserId: 'dogeid1',
+            participantId: 'org.doge.Doge#DOGE_1'
+        };
+        sandbox.stub(fs,'readFileSync').resolves();
+        sandbox.stub(Export,'writeCardToFile').resolves();
+        mockIdCard.getBusinessNetworkName.returns('networkname');
+        mockIdCard.getConnectionProfile.returns({name:'networkname'});
+        return Issue.handler(argv)
+            .then((res) => {
+                sinon.assert.calledOnce(mockBusinessNetworkConnection.connect);
+                sinon.assert.calledWith(mockBusinessNetworkConnection.connect, 'cardname');
+                sinon.assert.calledOnce(mockBusinessNetworkConnection.issueIdentity);
+                sinon.assert.calledWith(mockBusinessNetworkConnection.issueIdentity, 'org.doge.Doge#DOGE_1', 'dogeid1', { issuer: false });
+            });",82,2017-10-26 15:39:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/147161440,https://github.com/hyperledger/composer/pull/2456#discussion_r147161440,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Error case testing?,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 14:36:24,147161663,"@@ -179,4 +203,24 @@ describe('composer identity issue CLI unit tests', () => {
             .should.be.rejectedWith(/such error/);
     });
 
+    it('should issue a new card using the specified profile', () => {
+        let argv = {
+            c: 'cardname',card:'cardname',   // needed as yargs would do this
+            file: 'filename',
+            newUserId: 'dogeid1',
+            participantId: 'org.doge.Doge#DOGE_1'
+        };
+        sandbox.stub(fs,'readFileSync').resolves();
+        sandbox.stub(Export,'writeCardToFile').resolves();
+        mockIdCard.getBusinessNetworkName.returns('networkname');
+        mockIdCard.getConnectionProfile.returns({name:'networkname'});
+        return Issue.handler(argv)
+            .then((res) => {
+                sinon.assert.calledOnce(mockBusinessNetworkConnection.connect);
+                sinon.assert.calledWith(mockBusinessNetworkConnection.connect, 'cardname');
+                sinon.assert.calledOnce(mockBusinessNetworkConnection.issueIdentity);
+                sinon.assert.calledWith(mockBusinessNetworkConnection.issueIdentity, 'org.doge.Doge#DOGE_1', 'dogeid1', { issuer: false });
+            });
+    });
+",84,2017-10-26 15:39:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/147161663,https://github.com/hyperledger/composer/pull/2456#discussion_r147161663,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Stubbing out parts of the code we are trying to test sounds worrying,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 14:37:35,147162005,"@@ -413,4 +413,41 @@ describe('composer deploy network CLI unit tests', function () {
 
     });
 
+    describe('using business network card',()=>{
+        it('Good path', function () {
+
+
+            let argv = {card: 'cardName'};
+
+            sandbox.stub(Deploy, 'getArchiveFileContents');",10,2017-10-26 15:39:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/147162005,https://github.com/hyperledger/composer/pull/2456#discussion_r147162005,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Could we stub out the call that we expect to fail within the function rather than stubbing out the implementation we are trying to test?,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 14:42:50,147163686,"@@ -413,4 +413,41 @@ describe('composer deploy network CLI unit tests', function () {
 
     });
 
+    describe('using business network card',()=>{
+        it('Good path', function () {
+
+
+            let argv = {card: 'cardName'};
+
+            sandbox.stub(Deploy, 'getArchiveFileContents');
+
+            Deploy.getArchiveFileContents.withArgs(argv.archiveFile).returns(testBusinessNetworkArchive);
+
+            return DeployCmd.handler(argv)
+            .then ((result) => {
+                argv.thePromise.should.be.a('promise');
+                sinon.assert.calledOnce(BusinessNetworkDefinition.fromArchive);
+                sinon.assert.calledWith(BusinessNetworkDefinition.fromArchive, testBusinessNetworkArchive);
+                sinon.assert.calledOnce(CmdUtil.createAdminConnection);
+
+                sinon.assert.calledOnce(mockAdminConnection.connect);
+                sinon.assert.calledWith(mockAdminConnection.connect,'cardName');
+                sinon.assert.calledOnce(mockAdminConnection.deploy);
+                sinon.assert.calledWith(mockAdminConnection.deploy, businessNetworkDefinition, { bootstrapTransactions: [] });
+            });
+        });
+        it('Failure of the archive functions', function () {
+
+
+            let argv = {card: 'cardName'};
+
+            sandbox.stub(Deploy, 'getArchiveFileContents');
+
+            Deploy.getArchiveFileContents.withArgs(argv.archiveFile).throws(new Error('failure'));",34,2017-10-26 15:39:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/147163686,https://github.com/hyperledger/composer/pull/2456#discussion_r147163686,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Worth testing an error scenario?,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 14:46:08,147164801,"@@ -76,6 +76,28 @@ describe('composer network download CLI unit tests', function () {
             });
         });
 
+        it('Good path, all parms correctly specified. No enroll secret', function () {
+
+            let argv = {enrollId: 'WebAppAdmin'
+                                   ,archiveFile: 'testArchiveFile.zip'
+                                   ,connectionProfileName: 'someOtherProfile'};
+
+            sandbox.stub(CmdUtil, 'prompt').resolves({enrollmentSecret:'usersresponse'});
+
+            return DownloadCmd.handler(argv)
+                        .then ((result) => {
+                            argv.thePromise.should.be.a('promise');
+                            sinon.assert.calledOnce(fs.writeFileSync);
+                        });
+        });
+
+        it('Good path, all parms correctly specified with card.', function () {",19,2017-10-26 15:39:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/147164801,https://github.com/hyperledger/composer/pull/2456#discussion_r147164801,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Guessing this is just boosting coverage for existing code as it's not obviously (to me) part of the card support?,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 14:52:15,147167117,"@@ -76,6 +76,28 @@ describe('composer network download CLI unit tests', function () {
             });
         });
 
+        it('Good path, all parms correctly specified. No enroll secret', function () {",4,2017-10-26 15:39:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/147167117,https://github.com/hyperledger/composer/pull/2456#discussion_r147167117,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,No test that an update happened?,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 15:01:17,147170425,"@@ -82,4 +83,28 @@ describe('composer update network CLI unit tests', function () {
 
     });
 
+    describe('using network cards', ()=>{
+        it('Good path with update enabled', function () {
+            let businessNetworkDefinition = new BusinessNetworkDefinition('my-network@1.0.0');
+
+            let testBusinessNetworkArchive;
+            sandbox.stub(BusinessNetworkDefinition, 'fromArchive').resolves(businessNetworkDefinition);
+            let argv = {card: 'cardName'};
+            sandbox.stub(Deploy, 'getArchiveFileContents');
+            Deploy.getArchiveFileContents.withArgs(argv.archiveFile).returns(testBusinessNetworkArchive);
+
+            return businessNetworkDefinition.toArchive()
+                .then((archive) => {
+                    testBusinessNetworkArchive = archive;
+                    return UpdateCMD.handler(argv,true);
+                })
+                .then ((result) => {
+                    argv.thePromise.should.be.a('promise');
+                    sinon.assert.calledOnce(CmdUtil.createAdminConnection);
+                    sinon.assert.calledOnce(mockAdminConnection.connect);
+                    sinon.assert.calledWith(mockAdminConnection.connect,'cardName');",34,2017-10-26 15:39:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/147170425,https://github.com/hyperledger/composer/pull/2456#discussion_r147170425,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Test that install happened?,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 15:02:43,147170854,"@@ -71,22 +69,35 @@ describe('composer install runtime CLI unit tests', function () {
             });
         });
 
+        it('Good path, all params correctly specified (card base)', function () {
+
+            let argv = {card:'cardname'};
+            return InstallCmd.handler(argv)
+                        .then ((result) => {
+                            argv.thePromise.should.be.a('promise');
+                            sinon.assert.calledOnce(mockAdminConnection.connect);
+                            sinon.assert.calledWith(mockAdminConnection.connect, 'cardname');",20,2017-10-26 15:39:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/147170854,https://github.com/hyperledger/composer/pull/2456#discussion_r147170854,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Same comments as for `AdminConnection.connect`,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 15:28:15,147178921,"@@ -396,24 +396,73 @@ class BusinessNetworkConnection extends EventEmitter {
 
     /**
      * Connects to a business network using a connection profile, and authenticates to the Hyperledger Fabric.
+     * EITHER, the cardName, and additional connect options, OR
+     * the connectionProfile, businessNetwork, enrollmentID, enrollmentSecret and additional connect options
+     * Should be specified. NOT both
      * @example
      * // Connect and log in to HLF
      * var businessNetwork = new BusinessNetworkConnection();
      * return businessNetwork.connect('testprofile', 'businessNetworkIdentifier', 'WebAppAdmin', 'DJY27pEnl16d')
      * .then(function(businessNetworkDefinition){
      *     // Connected
      * });
+     * // Connect and log in to HLF
+     * var businessNetwork = new BusinessNetworkConnection();
+     * return businessNetwork.connect('cardName')
+     * .then(function(businessNetworkDefinition){
+     *     // Connected
+     * });
      * @param {string} connectionProfile - The name of the connection profile
      * @param {string} businessNetwork - The identifier of the business network
      * @param {string} enrollmentID the enrolment ID of the user
      * @param {string} enrollmentSecret the enrolment secret of the user
      * @param {Object} [additionalConnectOptions] Additional configuration options supplied
+     * @param {String} cardName  businessNetworkCard Name (must have been imported already)
      * at runtime that override options set in the connection profile.
      * which will override those in the specified connection profile.
      * @return {Promise} A promise to a BusinessNetworkDefinition that indicates the connection is complete
      */
-    connect(connectionProfile, businessNetwork, enrollmentID, enrollmentSecret, additionalConnectOptions) {
-        const method = 'connect';
+    connect(connectionProfile, businessNetwork, enrollmentID, enrollmentSecret, additionalConnectOptions,cardName){",32,2017-10-26 15:39:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/147178921,https://github.com/hyperledger/composer/pull/2456#discussion_r147178921,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Same comments as for adminconnection,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 15:29:06,147179220,"@@ -228,6 +228,11 @@ describe('BusinessNetworkConnection', () => {
                 ev2.getIdentifier().should.equal('event2');
             });
         });
+
+        it('should fail with the wrong number of arguments', ()=>{",5,2017-10-26 15:39:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/147179220,https://github.com/hyperledger/composer/pull/2456#discussion_r147179220,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Do we need to check that something happens with the additional options; otherwise why have them here?,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 15:33:52,147180816,"@@ -264,16 +269,19 @@ describe('BusinessNetworkConnection', () => {
             sandbox.reset();
         });
 
-        it('Connect with existing card name',()=>{
-            return businessNetworkConnection.connectWithCard('cardName')
+
+        it('Correct with with existing card name & additional options',()=>{",19,2017-10-26 15:39:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/147180816,https://github.com/hyperledger/composer/pull/2456#discussion_r147180816,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Remove this?,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 15:34:19,147181000,"@@ -87,6 +87,7 @@ class IdCard {
             throw new Error('Required metadata field not found: userName');
         }
         if (!(connectionProfile && connectionProfile.name)) {
+            // console.log('FYI - no connection profile name given');",4,2017-10-26 15:39:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/147181000,https://github.com/hyperledger/composer/pull/2456#discussion_r147181000,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Is removing the trailing newline intended?,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 15:35:00,147181226,"@@ -328,4 +328,4 @@ class AssetRegistry {
 
 }
 
-module.exports = AssetRegistry;
+module.exports = AssetRegistry;",5,2017-10-26 15:39:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/147181226,https://github.com/hyperledger/composer/pull/2456#discussion_r147181226,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Is removing the trailing newline intended?,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 15:35:06,147181248,"@@ -328,4 +328,4 @@ class ParticipantRegistry {
 
 }
 
-module.exports = ParticipantRegistry;
+module.exports = ParticipantRegistry;",5,2017-10-26 15:39:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/147181248,https://github.com/hyperledger/composer/pull/2456#discussion_r147181248,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Is removing the trailing newline intended?,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 15:35:14,147181298,"@@ -62,4 +62,4 @@ class Query {
 
 }
 
-module.exports = Query;
+module.exports = Query;",5,2017-10-26 15:39:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/147181298,https://github.com/hyperledger/composer/pull/2456#discussion_r147181298,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,Is removing the trailing newline intended?,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 15:35:21,147181338,"@@ -103,4 +103,4 @@ class Serializer {
 
 }
 
-module.exports = Serializer;
+module.exports = Serializer;",5,2017-10-26 15:39:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/147181338,https://github.com/hyperledger/composer/pull/2456#discussion_r147181338,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,"Was changing this file intentional? Seems unrelated to anything else in this pull request, and not sure why the trailing newline is removed.",b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-26 15:36:05,147181545,"@@ -69,4 +69,4 @@ index-order: {{index}}
 
 No parameters
 {% endif %}
-{% endfor %}
+{% endfor %}",5,2017-10-26 15:39:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/147181545,https://github.com/hyperledger/composer/pull/2456#discussion_r147181545,bestbeforetoday
https://github.com/hyperledger/composer/pull/2456,https://github.com/hyperledger/composer/pull/2456,The existing connect() keyed the update on whether or not a business network name was specified. Note that cards do not always include a business network name so perhaps the same logic applies and an explicit update parameter is not required.,b56f60f485c06e99fa893db2a465c4d412bd6374,2017-10-27 06:13:27,147329521,"@@ -245,6 +259,106 @@ class AdminConnection {
             });
     }
 
+     /**
+     * Connects and logs in to the Hyperledger Fabric using a named connection
+     * profile.
+     * EITHER, the cardName, and updateflag , OR
+     * the connectionProfile, enrollmentID, enrollmentSecret and businessNetworkIdentifier
+     * Should be specified. NOT both
+     * @example
+     * // Connect to Hyperledger Fabric
+     * var adminConnection = new AdminConnection();
+     * adminConnection.connect('testprofile', 'WebAppAdmin', 'DJY27pEnl16d')
+     * .then(function(){
+     *     // Connected.
+     * })
+     * .catch(function(error){
+     *     // Add optional error handling here.
+     * });
+     * // Connect to Hyperledger Fabric
+     * var adminConnection = new AdminConnection();
+     * adminConnection.connect('testprofile', 'WebAppAdmin', 'DJY27pEnl16d')
+     * .then(function(){
+     *     // Connected.
+     * })
+     * .catch(function(error){
+     *     // Add optional error handling here.
+     * });
+     *
+     * @param {string} connectionProfile - The name of the connection profile
+     * @param {string} enrollmentID the enrollment ID of the user
+     * @param {string} enrollmentSecret the enrollment secret of the user
+     * @param {string} businessNetworkIdentifier the id of the network (for update) or null
+     * @param {String} cardName - The name of the business network card
+     * @param {boolean} update true if this is for an update operation
+     * @return {Promise} A promise that indicates the connection is complete
+     */
+    connect(connectionProfile, enrollmentID, enrollmentSecret, businessNetworkIdentifier,cardName,update){",103,2017-10-27 06:13:51,https://api.github.com/repos/hyperledger/composer/pulls/comments/147329521,https://github.com/hyperledger/composer/pull/2456#discussion_r147329521,bestbeforetoday
https://github.com/hyperledger/composer/pull/2442,https://github.com/hyperledger/composer/pull/2442,Why have we stopped testing the error message in these tests? How do we know that the new information you've added is being printed out as part of the error message?,adb78929e6c4fd0415b9c20119689445b2ec558e,2017-10-31 14:14:15,148008032,"@@ -152,7 +152,7 @@ describe('ModelManager', () => {
             mf1.getNamespace.returns('org.acme.base');
             (() => {
                 modelManager.addModelFile(modelBase);
-            }).should.throw(/namespace already exists/);
+            }).should.throw();",5,2017-10-31 14:14:34,https://api.github.com/repos/hyperledger/composer/pulls/comments/148008032,https://github.com/hyperledger/composer/pull/2442#discussion_r148008032,sstone1
https://github.com/hyperledger/composer/pull/2442,https://github.com/hyperledger/composer/pull/2442,"Earlier, the model manager used to raise the error as a fixed string ""namespace already exists"" in case of duplicate namespaces in cto files. Now with changed code, the model manager includes the file names of cto files in the error strings resulting in error string of variable length and contents. So, here we are now just checking if the error is thrown in case of duplicate namespaces or not.",adb78929e6c4fd0415b9c20119689445b2ec558e,2017-11-02 08:26:05,148465713,"@@ -152,7 +152,7 @@ describe('ModelManager', () => {
             mf1.getNamespace.returns('org.acme.base');
             (() => {
                 modelManager.addModelFile(modelBase);
-            }).should.throw(/namespace already exists/);
+            }).should.throw();",5,2017-11-02 08:26:05,https://api.github.com/repos/hyperledger/composer/pulls/comments/148465713,https://github.com/hyperledger/composer/pull/2442#discussion_r148465713,shacshar
https://github.com/hyperledger/composer/pull/2442,https://github.com/hyperledger/composer/pull/2442,How do you know that the right error is being thrown? The test would still pass if either a syntax error (from invalid code) or a namespace clash is thrown. The regex tests that the correct error is being thrown - please add a suitable regex test back in to the tests.,adb78929e6c4fd0415b9c20119689445b2ec558e,2017-11-02 08:50:48,148470094,"@@ -152,7 +152,7 @@ describe('ModelManager', () => {
             mf1.getNamespace.returns('org.acme.base');
             (() => {
                 modelManager.addModelFile(modelBase);
-            }).should.throw(/namespace already exists/);
+            }).should.throw();",5,2017-11-02 08:50:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/148470094,https://github.com/hyperledger/composer/pull/2442#discussion_r148470094,sstone1
https://github.com/hyperledger/composer/pull/2432,https://github.com/hyperledger/composer/pull/2432,slight formatting problem here,bfd5065ca2e7710836aa674d416377b496848fdd,2017-10-22 12:41:27,146130537,"@@ -100,8 +100,7 @@ class InstanceGenerator {
         let type = field.getFullyQualifiedTypeName();
 
         if (ModelUtil.isPrimitiveType(type)) {
-            switch(type) {
-            case 'DateTime':
+            switch (type) {                case 'DateTime':",,2017-11-01 09:31:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/146130537,https://github.com/hyperledger/composer/pull/2432#discussion_r146130537,davidkel
https://github.com/hyperledger/composer/pull/2432,https://github.com/hyperledger/composer/pull/2432,console.log here which should be removed,bfd5065ca2e7710836aa674d416377b496848fdd,2017-10-22 12:42:03,146130549,"@@ -124,16 +123,34 @@ class InstanceGenerator {
         }
 
         classDeclaration = this.findConcreteSubclass(classDeclaration);
-
-        if (classDeclaration.isConcept()) {
-            let concept = parameters.factory.newConcept(classDeclaration.getNamespace(), classDeclaration.getName());
-            parameters.stack.push(concept);
-            return classDeclaration.accept(this, parameters);
+        let fqn = classDeclaration.getFullyQualifiedName();
+        // before doing any form of check for conept or class we want to check if this
+        // has been seen before or not
+        console.log(field);",,2017-11-01 09:31:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/146130549,https://github.com/hyperledger/composer/pull/2432#discussion_r146130549,davidkel
https://github.com/hyperledger/composer/pull/2432,https://github.com/hyperledger/composer/pull/2432,comment still required ?,bfd5065ca2e7710836aa674d416377b496848fdd,2017-10-22 12:42:26,146130560,"@@ -124,16 +123,34 @@ class InstanceGenerator {
         }
 
         classDeclaration = this.findConcreteSubclass(classDeclaration);
-
-        if (classDeclaration.isConcept()) {
-            let concept = parameters.factory.newConcept(classDeclaration.getNamespace(), classDeclaration.getName());
-            parameters.stack.push(concept);
-            return classDeclaration.accept(this, parameters);
+        let fqn = classDeclaration.getFullyQualifiedName();
+        // before doing any form of check for conept or class we want to check if this
+        // has been seen before or not
+        console.log(field);
+        if (!parameters.seen.find((e) => {
+            return fqn === e;
+        })) {
+
+            parameters.seen.push(fqn);
+            if (classDeclaration.isConcept()) {
+                let concept = parameters.factory.newConcept(classDeclaration.getNamespace(), classDeclaration.getName());
+                parameters.stack.push(concept);
+                return classDeclaration.accept(this, parameters);
+            } else {
+                const id = this.generateRandomId(classDeclaration);
+                let resource = parameters.factory.newResource(classDeclaration.getNamespace(), classDeclaration.getName(), id);
+                parameters.stack.push(resource);
+                return classDeclaration.accept(this, parameters);
+            }
         } else {
-            const id = this.generateRandomId(classDeclaration);
-            let resource = parameters.factory.newResource(classDeclaration.getNamespace(), classDeclaration.getName(), id);
-            parameters.stack.push(resource);
-            return classDeclaration.accept(this, parameters);
+            if (field.isArray()){
+                return;
+            }
+            if (field.isOptional()){
+                return null;
+            }
+            throw new Error('Model is recursive.');
+            //todo",,2017-11-01 09:31:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/146130560,https://github.com/hyperledger/composer/pull/2432#discussion_r146130560,davidkel
https://github.com/hyperledger/composer/pull/2432,https://github.com/hyperledger/composer/pull/2432,console.log needs to be removed.,bfd5065ca2e7710836aa674d416377b496848fdd,2017-10-23 09:49:08,146215578,"@@ -194,7 +194,14 @@ class SampleValueGenerator extends EmptyValueGenerator {
      * @return {Array} an array
      */
     getArray(valueSupplier) {
-        return [valueSupplier()];
+        let value = valueSupplier();
+        console.log(value);",,2017-11-01 09:31:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/146215578,https://github.com/hyperledger/composer/pull/2432#discussion_r146215578,davidkel
https://github.com/hyperledger/composer/pull/2432,https://github.com/hyperledger/composer/pull/2432,"Why are we creating valueSupplier functions that return `undefined`? And if one has been written to supply `undefined` as a value, why are we ignoring that?",bfd5065ca2e7710836aa674d416377b496848fdd,2017-10-23 20:38:03,146386664,"@@ -194,7 +194,14 @@ class SampleValueGenerator extends EmptyValueGenerator {
      * @return {Array} an array
      */
     getArray(valueSupplier) {
-        return [valueSupplier()];
+        let value = valueSupplier();
+        console.log(value);
+        if (value !== undefined) {",,2017-11-01 09:31:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/146386664,https://github.com/hyperledger/composer/pull/2432#discussion_r146386664,bestbeforetoday
https://github.com/hyperledger/composer/pull/2431,https://github.com/hyperledger/composer/pull/2431,"Would prefer if, instead of asserting that the card was called, this test asserted that the information obtained from the card was correctly used to invoke the `login` function.",e908f17f41dd4ae43e623c8daef0383afb0758ad,2017-10-20 14:18:26,145975165,"@@ -228,6 +230,42 @@ describe('BusinessNetworkConnection', () => {
         });
     });
 
+    describe('#connectWithCard',()=>{
+
+        it('Correct with with existing card name',()=>{
+            sandbox.stub(businessNetworkConnection.connectionProfileManager, 'connectWithData').resolves(mockConnection);
+            let mockCardStore = sinon.createStubInstance(CardStore);
+            let mockIdCard = sinon.createStubInstance(IdCard);
+            mockCardStore.get.resolves(mockIdCard);
+            mockIdCard.getEnrollmentCredentials.returns({secret:'password'});
+
+            businessNetworkConnection.cardStore = mockCardStore;
+
+            mockConnection.login.resolves(mockSecurityContext);
+            mockConnection.ping.resolves();
+            const buffer = Buffer.from(JSON.stringify({
+                data: 'aGVsbG8='
+            }));
+            sandbox.stub(Util, 'queryChainCode').withArgs(mockSecurityContext, 'getBusinessNetwork', []).resolves(buffer);
+            sandbox.stub(BusinessNetworkDefinition, 'fromArchive').resolves(mockBusinessNetworkDefinition);
+            const cb = sinon.stub();
+            businessNetworkConnection.on('event', cb);
+            mockConnection.on.withArgs('events', sinon.match.func).yields([
+                { $class: 'org.acme.sample.SampleEvent', eventId: 'event1' },
+                { $class: 'org.acme.sample.SampleEvent', eventId: 'event2' }
+            ]);
+
+            return businessNetworkConnection.connectWithCard('cardName')
+                .then((result)=>{
+                    sinon.assert.calledOnce(mockCardStore.get);",46,2017-10-20 14:36:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/145975165,https://github.com/hyperledger/composer/pull/2431#discussion_r145975165,bestbeforetoday
https://github.com/hyperledger/composer/pull/2400,https://github.com/hyperledger/composer/pull/2400,"Would it still work ok if we declared it the same way as node sdk does ?
""grpc"": "">=1.3.5 <2.0.0"",",b5520a1ee9787502b482729cc3606a2d249a2a80,2017-10-18 11:26:44,145385509,"@@ -42,10 +42,10 @@
   ""dependencies"": {
     ""composer-common"": ""0.14.0"",
     ""composer-runtime-hlfv1"": ""0.14.0"",
-    ""fabric-ca-client"": ""1.0.1"",
-    ""fabric-client"": ""1.0.1"",
+    ""fabric-ca-client"": ""1.0.2"",
+    ""fabric-client"": ""1.0.2"",
     ""fs-extra"": ""1.0.0"",
-    ""grpc"": ""1.6.0"",
+    ""grpc"": ""^1.6.0"",",,2017-10-19 19:58:50,https://api.github.com/repos/hyperledger/composer/pulls/comments/145385509,https://github.com/hyperledger/composer/pull/2400#discussion_r145385509,davidkel
https://github.com/hyperledger/composer/pull/2395,https://github.com/hyperledger/composer/pull/2395,don't we need to check the type of the cardstore provided in the options here?,3ac2be1b79a06465baf6b361c9f374fb5856f585,2017-10-17 15:12:52,145161831,"@@ -73,10 +77,13 @@ class AdminConnection {
                 envConnectionProfileStore
             );
         }
+
+        this.cardStore = options.cardStore || new FileSystemCardStore();",26,2017-10-18 08:53:45,https://api.github.com/repos/hyperledger/composer/pulls/comments/145161831,https://github.com/hyperledger/composer/pull/2395#discussion_r145161831,samjsmith
https://github.com/hyperledger/composer/pull/2395,https://github.com/hyperledger/composer/pull/2395,do we need to test for invalid card stores being passed in?,3ac2be1b79a06465baf6b361c9f374fb5856f585,2017-10-17 15:16:14,145162935,"@@ -137,6 +195,16 @@ describe('AdminConnection', () => {
             adminConnection.connectionProfileManager.should.not.be.null;
         });
 
+        it('should allow valid card store implementation to be specified', function() {",99,2017-10-18 08:53:45,https://api.github.com/repos/hyperledger/composer/pulls/comments/145162935,https://github.com/hyperledger/composer/pull/2395#discussion_r145162935,samjsmith
https://github.com/hyperledger/composer/pull/2395,https://github.com/hyperledger/composer/pull/2395,"I think we need some error testing added here for things like directory permissions etc. so I guess you'd define empty stub methods for get/put etc. then sinon.stub them with Promise.reject etc.
",3ac2be1b79a06465baf6b361c9f374fb5856f585,2017-10-17 15:23:53,145165334,"@@ -35,6 +38,56 @@ chai.use(require('chai-as-promised'));
 chai.use(require('chai-things'));
 const sinon = require('sinon');
 
+/**
+ * Stub card store implementation.
+ */
+class StubCardStore extends BusinessNetworkCardStore {",24,2017-10-18 08:53:45,https://api.github.com/repos/hyperledger/composer/pulls/comments/145165334,https://github.com/hyperledger/composer/pull/2395#discussion_r145165334,samjsmith
https://github.com/hyperledger/composer/pull/2395,https://github.com/hyperledger/composer/pull/2395,I did have these but removed them because... JavaScript (see above),3ac2be1b79a06465baf6b361c9f374fb5856f585,2017-10-17 16:43:25,145187275,"@@ -137,6 +195,16 @@ describe('AdminConnection', () => {
             adminConnection.connectionProfileManager.should.not.be.null;
         });
 
+        it('should allow valid card store implementation to be specified', function() {",99,2017-10-18 08:53:45,https://api.github.com/repos/hyperledger/composer/pulls/comments/145187275,https://github.com/hyperledger/composer/pull/2395#discussion_r145187275,bestbeforetoday
https://github.com/hyperledger/composer/pull/2395,https://github.com/hyperledger/composer/pull/2395,"I did have code in there to do this by checking if what was passed in was an instanceof BusinessNetworkCardStore. Then I thought JavaScript doesn't really have this kind of strong typing, and it would be valid for somebody to pass in any object that happened to implement the same functions, so I was worried this might be too restrictive a test. Really not sure what is the best approach here though.",3ac2be1b79a06465baf6b361c9f374fb5856f585,2017-10-17 17:19:13,145196093,"@@ -73,10 +77,13 @@ class AdminConnection {
                 envConnectionProfileStore
             );
         }
+
+        this.cardStore = options.cardStore || new FileSystemCardStore();",26,2017-10-18 08:53:45,https://api.github.com/repos/hyperledger/composer/pulls/comments/145196093,https://github.com/hyperledger/composer/pull/2395#discussion_r145196093,bestbeforetoday
https://github.com/hyperledger/composer/pull/2395,https://github.com/hyperledger/composer/pull/2395,"Those things get tested further down the stack, where the code actually deals with reading/writing to the filesystem. So IdCard.toDirectory(). It might be worth having some tests here to check that errors get propagated out though.",3ac2be1b79a06465baf6b361c9f374fb5856f585,2017-10-17 17:20:13,145196349,"@@ -35,6 +38,56 @@ chai.use(require('chai-as-promised'));
 chai.use(require('chai-things'));
 const sinon = require('sinon');
 
+/**
+ * Stub card store implementation.
+ */
+class StubCardStore extends BusinessNetworkCardStore {",24,2017-10-18 08:53:45,https://api.github.com/repos/hyperledger/composer/pulls/comments/145196349,https://github.com/hyperledger/composer/pull/2395#discussion_r145196349,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,The only access for this.businessNetworkIdentifier look to be here (where it is set to a value) and in `disconnect` (where it is set to `null`). Does it serve any purpose?,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 16:32:49,143783119,"@@ -193,8 +167,44 @@ class AdminConnection {
         return this.connectionProfileManager.getConnectionProfileStore().loadAll();
     }
 
+    // admin connection methods...
+
     /**
-     * Disconnects this connection.
+     * Connects and logs in to the Hyperledger Fabric using a named connection
+     * profile. The connection profile must exist in the profile store.
+     * @example
+     * // Connect to Hyperledger Fabric
+     * var adminConnection = new AdminConnection();
+     * adminConnection.connect('testprofile', 'WebAppAdmin', 'DJY27pEnl16d')
+     * .then(function(){
+     *     // Connected.
+     * })
+     * .catch(function(error){
+     *     // Add optional error handling here.
+     * });
+     * @param {string} connectionProfile - The name of the connection profile
+     * @param {string} enrollmentID the enrollment ID of the user
+     * @param {string} enrollmentSecret the enrollment secret of the user
+     * @param {string} businessNetworkIdentifier the id of the network (for update) or null
+     * @return {Promise} A promise that indicates the connection is complete
+     */
+    connect(connectionProfile, enrollmentID, enrollmentSecret, businessNetworkIdentifier) {
+        return this.connectionProfileManager.connect(connectionProfile, businessNetworkIdentifier)
+            .then((connection) => {
+                this.connection = connection;
+                this.businessNetworkIdentifier = businessNetworkIdentifier;",,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143783119,https://github.com/hyperledger/composer/pull/2341#discussion_r143783119,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,This change introduces `connection.setLogLevel` but not `connection.getLogLevel`. Worth considering for consistency? Just asking! :),9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 16:34:03,143783437,"@@ -629,11 +680,14 @@ class AdminConnection {
      * @memberof AdminConnection
      */
     getLogLevel() {
-        Util.securityCheck(this.securityContext);
-        return this.connection.queryChainCode(this.securityContext, 'getLogLevel', [])
-            .then((response) => {
-                return Promise.resolve(JSON.parse(response));
-            });
+        return Promise.resolve().then(()=>{
+            Util.securityCheck(this.securityContext);
+            return this.connection.queryChainCode(this.securityContext, 'getLogLevel', []);",229,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143783437,https://github.com/hyperledger/composer/pull/2341#discussion_r143783437,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,I don't see a test for promise rejection based on security failure,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 16:39:11,143784773,"@@ -241,8 +252,10 @@ class AdminConnection {
      * deployed.
      */
     install(businessNetworkIdentifier, installOptions) {
-        Util.securityCheck(this.securityContext);
-        return this.connection.install(this.securityContext, businessNetworkIdentifier, installOptions);
+        return Promise.resolve().then(()=>{",104,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143784773,https://github.com/hyperledger/composer/pull/2341#discussion_r143784773,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,I don't see a test for promise rejection based on security failure,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 16:39:24,143784835,"@@ -454,13 +467,15 @@ class AdminConnection {
      * .catch(function(error){
      *     // Add optional error handling here.
      * })
-     * @param {string} businessNetworkIdentifier - The identifier of the network to undeploy
+     * @param {BusinessNetworkIdentifier} businessNetworkIdentifier - The name of business network that will be used to start this runtime.
      * @return {Promise} A promise that will be fufilled when the business network has been
      * undeployed.
      */
     undeploy(businessNetworkIdentifier) {
-        Util.securityCheck(this.securityContext);
-        return this.connection.undeploy(this.securityContext, businessNetworkIdentifier);
+        return Promise.resolve().then(()=>{",123,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143784835,https://github.com/hyperledger/composer/pull/2341#discussion_r143784835,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,I don't see a test for promise rejection based on security failure,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 16:39:34,143784869,"@@ -482,8 +497,38 @@ class AdminConnection {
      * updated.
      */
     update(businessNetworkDefinition) {
-        Util.securityCheck(this.securityContext);
-        return this.connection.update(this.securityContext, businessNetworkDefinition);
+        return Promise.resolve().then(()=>{",136,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143784869,https://github.com/hyperledger/composer/pull/2341#discussion_r143784869,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,I don't see a test for promise rejection based on security failure,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 16:39:46,143784924,"@@ -482,8 +497,38 @@ class AdminConnection {
      * updated.
      */
     update(businessNetworkDefinition) {
-        Util.securityCheck(this.securityContext);
-        return this.connection.update(this.securityContext, businessNetworkDefinition);
+        return Promise.resolve().then(()=>{
+            Util.securityCheck(this.securityContext);
+            return this.connection.update(this.securityContext, businessNetworkDefinition);
+        });
+    }
+
+    /**
+     * Resets an existing BusinessNetworkDefinition on the Hyperledger Fabric. The BusinessNetworkDefinition
+     * must have been previously deployed.
+     *
+     * Note this will remove ALL the contents of the network registries, but not any system registries
+     *
+     * @example
+     * // Updates a Business Network Definition
+     * var adminConnection = new AdminConnection();
+     * var businessNetworkDefinition = BusinessNetworkDefinition.fromArchive(myArchive);
+     * return adminConnection.reset(businessNetworkDefinition)
+     * .then(function(){
+     *     // Business network definition updated
+     * })
+     * .catch(function(error){
+     *     // Add optional error handling here.
+     * });
+     * @param {BusinessNetworkIdentifier} businessNetworkIdentifier - The name of business network that will be reset
+     * @return {Promise} A promise that will be fufilled when the business network has been
+     * updated.
+     */
+    reset(businessNetworkIdentifier){
+        return Promise.resolve().then(()=>{",164,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143784924,https://github.com/hyperledger/composer/pull/2341#discussion_r143784924,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,I don't see a test for promise rejection based on security failure,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 16:39:53,143784947,"@@ -510,8 +555,10 @@ class AdminConnection {
      * @memberof AdminConnection
      */
     upgrade() {
-        Util.securityCheck(this.securityContext);
-        return this.connection.upgrade(this.securityContext);
+        return Promise.resolve().then(()=>{",177,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143784947,https://github.com/hyperledger/composer/pull/2341#discussion_r143784947,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,I don't see a test for promise rejection based on security failure,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 16:40:05,143785000,"@@ -560,12 +607,14 @@ class AdminConnection {
     pingInner() {
         const method = 'pingInner';
         LOG.entry(method);
-        Util.securityCheck(this.securityContext);
-        return this.connection.ping(this.securityContext)
-            .then((result) => {
-                LOG.exit(method, result);
-                return result;
-            });
+        return Promise.resolve().then(()=>{",194,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143785000,https://github.com/hyperledger/composer/pull/2341#discussion_r143785000,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,I don't see a test for promise rejection based on security failure,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 16:40:13,143785037,"@@ -607,8 +656,10 @@ class AdminConnection {
      * @memberof AdminConnection
      */
     setLogLevel(newLogLevel) {
-        Util.securityCheck(this.securityContext);
-        return this.connection.invokeChainCode(this.securityContext, 'setLogLevel' , [newLogLevel]);
+        return Promise.resolve().then(()=>{",211,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143785037,https://github.com/hyperledger/composer/pull/2341#discussion_r143785037,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,I don't see a test for promise rejection based on security failure,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 16:40:21,143785068,"@@ -629,11 +680,14 @@ class AdminConnection {
      * @memberof AdminConnection
      */
     getLogLevel() {
-        Util.securityCheck(this.securityContext);
-        return this.connection.queryChainCode(this.securityContext, 'getLogLevel', [])
-            .then((response) => {
-                return Promise.resolve(JSON.parse(response));
-            });
+        return Promise.resolve().then(()=>{",227,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143785068,https://github.com/hyperledger/composer/pull/2341#discussion_r143785068,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,I don't see a test for promise rejection based on security failure,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 16:40:34,143785132,"@@ -656,8 +710,10 @@ class AdminConnection {
      * business network identifiers, or rejected with an error.
      */
     list() {
-        Util.securityCheck(this.securityContext);
-        return this.connection.list(this.securityContext);
+        return Promise.resolve().then(()=>{",244,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143785132,https://github.com/hyperledger/composer/pull/2341#discussion_r143785132,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,"var declarations make sense at the top of the function. let declarations could be in the block scope where they are needed. Just a style thing, but not sure all the variables need to be declared up here.",9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 16:44:58,143786209,"@@ -0,0 +1,86 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const cmdUtil = require('../../utils/cmdutils');
+const ora = require('ora');
+
+/**
+ * <p>
+ * Composer ""network network reset"" command
+ * </p>
+ * @private
+ */
+class Reset {
+
+  /**
+    * Command process for reset command
+    * @param {string} argv argument list from composer command
+    * @return {Promise} promise when command complete
+    */
+    static handler(argv) {
+        let adminConnection;",34,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143786209,https://github.com/hyperledger/composer/pull/2341#discussion_r143786209,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,No assertion?,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 16:53:19,143788346,"@@ -0,0 +1,108 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const Admin = require('composer-admin');
+
+const ResetCMD = require('../../lib/cmds/network/resetCommand.js');
+const CmdUtil = require('../../lib/cmds/utils/cmdutils.js');
+const Reset = require('../../lib/cmds/network/lib/reset.js');
+const ora = require('ora');
+
+require('chai').should();
+
+const chai = require('chai');
+const sinon = require('sinon');
+chai.should();
+chai.use(require('chai-things'));
+chai.use(require('chai-as-promised'));
+
+
+let mockAdminConnection;
+
+describe('composer reset network CLI unit tests', function () {
+
+    let sandbox;
+
+    beforeEach(() => {
+        sandbox = sinon.sandbox.create();
+
+        mockAdminConnection = sinon.createStubInstance(Admin.AdminConnection);
+        mockAdminConnection.createProfile.resolves();
+        mockAdminConnection.connect.resolves();
+        mockAdminConnection.undeploy.resolves();
+        sandbox.stub(CmdUtil, 'createAdminConnection').returns(mockAdminConnection);
+        sandbox.stub(process, 'exit');
+
+
+    });
+
+    afterEach(() => {
+        sandbox.restore();
+    });
+
+
+    describe('update command method tests', () => {
+
+        it('should contain update in the command and describe', () => {
+            ResetCMD.command.should.include('reset');
+            ResetCMD.describe.should.match(/Resets/);
+        });
+
+        it('should invoke the Update handler correctly', () => {
+            sandbox.stub(Reset, 'handler');
+            let argv = {};
+            ResetCMD.handler(argv);
+            sinon.assert.calledOnce(Reset.handler);
+            sinon.assert.calledWith(Reset.handler, argv);
+            argv.should.have.property('thePromise');
+        });
+
+
+    });
+
+    describe('test main reset logic', () =>{
+        it('main line code path', ()=>{
+            let argv = {'businessNetworkName':'networkname','connectionProfileName':'hlfv1','enrollId':'admin','enrollSecret':'adminpw'};
+
+            return Reset.handler(argv);",,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143788346,https://github.com/hyperledger/composer/pull/2341#discussion_r143788346,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,No assertion?,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 16:53:33,143788409,"@@ -0,0 +1,108 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const Admin = require('composer-admin');
+
+const ResetCMD = require('../../lib/cmds/network/resetCommand.js');
+const CmdUtil = require('../../lib/cmds/utils/cmdutils.js');
+const Reset = require('../../lib/cmds/network/lib/reset.js');
+const ora = require('ora');
+
+require('chai').should();
+
+const chai = require('chai');
+const sinon = require('sinon');
+chai.should();
+chai.use(require('chai-things'));
+chai.use(require('chai-as-promised'));
+
+
+let mockAdminConnection;
+
+describe('composer reset network CLI unit tests', function () {
+
+    let sandbox;
+
+    beforeEach(() => {
+        sandbox = sinon.sandbox.create();
+
+        mockAdminConnection = sinon.createStubInstance(Admin.AdminConnection);
+        mockAdminConnection.createProfile.resolves();
+        mockAdminConnection.connect.resolves();
+        mockAdminConnection.undeploy.resolves();
+        sandbox.stub(CmdUtil, 'createAdminConnection').returns(mockAdminConnection);
+        sandbox.stub(process, 'exit');
+
+
+    });
+
+    afterEach(() => {
+        sandbox.restore();
+    });
+
+
+    describe('update command method tests', () => {
+
+        it('should contain update in the command and describe', () => {
+            ResetCMD.command.should.include('reset');
+            ResetCMD.describe.should.match(/Resets/);
+        });
+
+        it('should invoke the Update handler correctly', () => {
+            sandbox.stub(Reset, 'handler');
+            let argv = {};
+            ResetCMD.handler(argv);
+            sinon.assert.calledOnce(Reset.handler);
+            sinon.assert.calledWith(Reset.handler, argv);
+            argv.should.have.property('thePromise');
+        });
+
+
+    });
+
+    describe('test main reset logic', () =>{
+        it('main line code path', ()=>{
+            let argv = {'businessNetworkName':'networkname','connectionProfileName':'hlfv1','enrollId':'admin','enrollSecret':'adminpw'};
+
+            return Reset.handler(argv);
+        });
+
+        it('no secret given', ()=>{
+            let argv = {'businessNetworkName':'networkname','connectionProfileName':'hlfv1','enrollId':'admin'};
+            sandbox.stub(CmdUtil, 'prompt').resolves({'enrollmentSecret':'adminpw'});
+
+            return Reset.handler(argv);",90,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143788409,https://github.com/hyperledger/composer/pull/2341#discussion_r143788409,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,A more descriptive name would help,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 16:54:15,143788597,"@@ -0,0 +1,108 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const Admin = require('composer-admin');
+
+const ResetCMD = require('../../lib/cmds/network/resetCommand.js');
+const CmdUtil = require('../../lib/cmds/utils/cmdutils.js');
+const Reset = require('../../lib/cmds/network/lib/reset.js');
+const ora = require('ora');
+
+require('chai').should();
+
+const chai = require('chai');
+const sinon = require('sinon');
+chai.should();
+chai.use(require('chai-things'));
+chai.use(require('chai-as-promised'));
+
+
+let mockAdminConnection;
+
+describe('composer reset network CLI unit tests', function () {
+
+    let sandbox;
+
+    beforeEach(() => {
+        sandbox = sinon.sandbox.create();
+
+        mockAdminConnection = sinon.createStubInstance(Admin.AdminConnection);
+        mockAdminConnection.createProfile.resolves();
+        mockAdminConnection.connect.resolves();
+        mockAdminConnection.undeploy.resolves();
+        sandbox.stub(CmdUtil, 'createAdminConnection').returns(mockAdminConnection);
+        sandbox.stub(process, 'exit');
+
+
+    });
+
+    afterEach(() => {
+        sandbox.restore();
+    });
+
+
+    describe('update command method tests', () => {
+
+        it('should contain update in the command and describe', () => {
+            ResetCMD.command.should.include('reset');
+            ResetCMD.describe.should.match(/Resets/);
+        });
+
+        it('should invoke the Update handler correctly', () => {
+            sandbox.stub(Reset, 'handler');
+            let argv = {};
+            ResetCMD.handler(argv);
+            sinon.assert.calledOnce(Reset.handler);
+            sinon.assert.calledWith(Reset.handler, argv);
+            argv.should.have.property('thePromise');
+        });
+
+
+    });
+
+    describe('test main reset logic', () =>{
+        it('main line code path', ()=>{
+            let argv = {'businessNetworkName':'networkname','connectionProfileName':'hlfv1','enrollId':'admin','enrollSecret':'adminpw'};
+
+            return Reset.handler(argv);
+        });
+
+        it('no secret given', ()=>{
+            let argv = {'businessNetworkName':'networkname','connectionProfileName':'hlfv1','enrollId':'admin'};
+            sandbox.stub(CmdUtil, 'prompt').resolves({'enrollmentSecret':'adminpw'});
+
+            return Reset.handler(argv);
+
+        });
+        it('error path', ()=>{",,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143788597,https://github.com/hyperledger/composer/pull/2341#discussion_r143788597,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,A more descriptive name would help,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 16:54:21,143788630,"@@ -0,0 +1,108 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const Admin = require('composer-admin');
+
+const ResetCMD = require('../../lib/cmds/network/resetCommand.js');
+const CmdUtil = require('../../lib/cmds/utils/cmdutils.js');
+const Reset = require('../../lib/cmds/network/lib/reset.js');
+const ora = require('ora');
+
+require('chai').should();
+
+const chai = require('chai');
+const sinon = require('sinon');
+chai.should();
+chai.use(require('chai-things'));
+chai.use(require('chai-as-promised'));
+
+
+let mockAdminConnection;
+
+describe('composer reset network CLI unit tests', function () {
+
+    let sandbox;
+
+    beforeEach(() => {
+        sandbox = sinon.sandbox.create();
+
+        mockAdminConnection = sinon.createStubInstance(Admin.AdminConnection);
+        mockAdminConnection.createProfile.resolves();
+        mockAdminConnection.connect.resolves();
+        mockAdminConnection.undeploy.resolves();
+        sandbox.stub(CmdUtil, 'createAdminConnection').returns(mockAdminConnection);
+        sandbox.stub(process, 'exit');
+
+
+    });
+
+    afterEach(() => {
+        sandbox.restore();
+    });
+
+
+    describe('update command method tests', () => {
+
+        it('should contain update in the command and describe', () => {
+            ResetCMD.command.should.include('reset');
+            ResetCMD.describe.should.match(/Resets/);
+        });
+
+        it('should invoke the Update handler correctly', () => {
+            sandbox.stub(Reset, 'handler');
+            let argv = {};
+            ResetCMD.handler(argv);
+            sinon.assert.calledOnce(Reset.handler);
+            sinon.assert.calledWith(Reset.handler, argv);
+            argv.should.have.property('thePromise');
+        });
+
+
+    });
+
+    describe('test main reset logic', () =>{
+        it('main line code path', ()=>{
+            let argv = {'businessNetworkName':'networkname','connectionProfileName':'hlfv1','enrollId':'admin','enrollSecret':'adminpw'};
+
+            return Reset.handler(argv);
+        });
+
+        it('no secret given', ()=>{
+            let argv = {'businessNetworkName':'networkname','connectionProfileName':'hlfv1','enrollId':'admin'};
+            sandbox.stub(CmdUtil, 'prompt').resolves({'enrollmentSecret':'adminpw'});
+
+            return Reset.handler(argv);
+
+        });
+        it('error path', ()=>{
+            let argv = {'businessNetworkName':'networkname','connectionProfileName':'hlfv1','enrollId':'admin'};
+            sandbox.stub(CmdUtil, 'prompt').rejects(new Error('computer says no'));
+
+            return Reset.handler(argv).should.eventually.be.rejectedWith(/computer says no/);
+
+        });
+        it('error path #2', ()=>{",,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143788630,https://github.com/hyperledger/composer/pull/2341#discussion_r143788630,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,I think you can just use `.should.be.rejectedWith`,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 16:55:29,143788900,"@@ -0,0 +1,108 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const Admin = require('composer-admin');
+
+const ResetCMD = require('../../lib/cmds/network/resetCommand.js');
+const CmdUtil = require('../../lib/cmds/utils/cmdutils.js');
+const Reset = require('../../lib/cmds/network/lib/reset.js');
+const ora = require('ora');
+
+require('chai').should();
+
+const chai = require('chai');
+const sinon = require('sinon');
+chai.should();
+chai.use(require('chai-things'));
+chai.use(require('chai-as-promised'));
+
+
+let mockAdminConnection;
+
+describe('composer reset network CLI unit tests', function () {
+
+    let sandbox;
+
+    beforeEach(() => {
+        sandbox = sinon.sandbox.create();
+
+        mockAdminConnection = sinon.createStubInstance(Admin.AdminConnection);
+        mockAdminConnection.createProfile.resolves();
+        mockAdminConnection.connect.resolves();
+        mockAdminConnection.undeploy.resolves();
+        sandbox.stub(CmdUtil, 'createAdminConnection').returns(mockAdminConnection);
+        sandbox.stub(process, 'exit');
+
+
+    });
+
+    afterEach(() => {
+        sandbox.restore();
+    });
+
+
+    describe('update command method tests', () => {
+
+        it('should contain update in the command and describe', () => {
+            ResetCMD.command.should.include('reset');
+            ResetCMD.describe.should.match(/Resets/);
+        });
+
+        it('should invoke the Update handler correctly', () => {
+            sandbox.stub(Reset, 'handler');
+            let argv = {};
+            ResetCMD.handler(argv);
+            sinon.assert.calledOnce(Reset.handler);
+            sinon.assert.calledWith(Reset.handler, argv);
+            argv.should.have.property('thePromise');
+        });
+
+
+    });
+
+    describe('test main reset logic', () =>{
+        it('main line code path', ()=>{
+            let argv = {'businessNetworkName':'networkname','connectionProfileName':'hlfv1','enrollId':'admin','enrollSecret':'adminpw'};
+
+            return Reset.handler(argv);
+        });
+
+        it('no secret given', ()=>{
+            let argv = {'businessNetworkName':'networkname','connectionProfileName':'hlfv1','enrollId':'admin'};
+            sandbox.stub(CmdUtil, 'prompt').resolves({'enrollmentSecret':'adminpw'});
+
+            return Reset.handler(argv);
+
+        });
+        it('error path', ()=>{
+            let argv = {'businessNetworkName':'networkname','connectionProfileName':'hlfv1','enrollId':'admin'};
+            sandbox.stub(CmdUtil, 'prompt').rejects(new Error('computer says no'));
+
+            return Reset.handler(argv).should.eventually.be.rejectedWith(/computer says no/);",,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143788900,https://github.com/hyperledger/composer/pull/2341#discussion_r143788900,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,More descriptive naming would be good,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 16:57:00,143789359,"@@ -69,6 +71,22 @@ describe('composer install runtime CLI unit tests', function () {
             });
         });
 
+        it('error path #1', ()=>{",,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143789359,https://github.com/hyperledger/composer/pull/2341#discussion_r143789359,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,More descriptive naming would be good,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 16:57:09,143789411,"@@ -69,6 +71,22 @@ describe('composer install runtime CLI unit tests', function () {
             });
         });
 
+        it('error path #1', ()=>{
+            let argv = {'businessNetworkName':'networkname','connectionProfileName':'hlfv1','enrollId':'admin','enrollSecret':'adminpw'};
+            mockAdminConnection.connect.rejects(new Error('computer says no'));
+            return InstallCmd.handler(argv).should.eventually.be.rejectedWith(/computer says no/);
+
+        });
+
+        it('error path #2', ()=>{",,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143789411,https://github.com/hyperledger/composer/pull/2341#discussion_r143789411,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,I don't understand having both `reset` and `_resetTx`. The pattern used by other functions is for the underscore-prefixed variant to take a callback function as the last parameter while the one without prefix wraps the call in Promises.,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 17:02:24,143790781,"@@ -314,8 +314,121 @@ class Connection extends EventEmitter {
             let data = currentDeployedNetwork.getSerializer().toJSON(transaction);
             return Util.invokeChainCode(securityContext, 'submitTransaction', [JSON.stringify(data)]);
         });
+    }
+
+    /**
+     * Resets an existing deployed business network definition.
+     * @abstract
+     * @param {SecurityContext} securityContext The participant's security context.
+     * @param {String} businessNetworkIdentifier The identifier of the business network
+     * @return {Promise} A promise that is resolved once the business network
+     * artefacts have been reset, or rejected with an error.
+     */
+    reset(securityContext, businessNetworkIdentifier) {",,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143790781,https://github.com/hyperledger/composer/pull/2341#discussion_r143790781,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,There looks to be lots of similarity between the set up of the tests in this suite. Any scope for refactoring?,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 17:07:29,143792078,"@@ -250,6 +250,123 @@ describe('Connection', () => {
 
     });
 
+    describe('#reset', () => {
+
+        it('should call _update and handle no error', () => {
+            sinon.stub(connection, '_resetTx').resolves();
+            return connection.reset(mockSecurityContext, mockBusinessNetworkDefinition)
+                        .then(() => {
+                            sinon.assert.calledWith(connection._resetTx, mockSecurityContext, mockBusinessNetworkDefinition);
+                        });
+        });
+
+        it('should call _reset and handle an error', () => {
+            sinon.stub(connection, '_resetTx').rejects(new Error('error'));
+            return connection.reset(mockSecurityContext, mockBusinessNetworkDefinition)
+                        .should.be.rejectedWith(/error/)
+                        .then(() => {
+                            sinon.assert.calledWith(connection._resetTx, mockSecurityContext, mockBusinessNetworkDefinition);
+                        });
+        });
+
+    });
+
+    describe('#_resetTx', () => {",,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143792078,https://github.com/hyperledger/composer/pull/2341#discussion_r143792078,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,Quite a lot of similar code between this test and the one below. Could any of it be refactored out to common code?,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 17:09:20,143792536,"@@ -606,4 +723,86 @@ describe('Connection', () => {
 
     });
 
+    describe('#setLogLevel', () => {
+
+        it('should call _update and handle no error', () => {
+            sinon.stub(connection, '_setLogLevel').resolves();
+            return connection.setLogLevel(mockSecurityContext, mockBusinessNetworkDefinition)
+                                .then(() => {
+                                    sinon.assert.calledWith(connection._setLogLevel, mockSecurityContext, mockBusinessNetworkDefinition);
+                                });
+        });
+
+        it('should call _reset and handle an error', () => {
+            sinon.stub(connection, '_setLogLevel').rejects(new Error('error'));
+            return connection.setLogLevel(mockSecurityContext, mockBusinessNetworkDefinition)
+                                .should.be.rejectedWith(/error/)
+                                .then(() => {
+                                    sinon.assert.calledWith(connection._setLogLevel, mockSecurityContext, mockBusinessNetworkDefinition);
+                                });
+        });
+
+    });
+
+    describe('#_setLogLevel', () => {
+
+        it('should throw an error when no loglevel given', ()=>{
+            return connection._setLogLevel(mockSecurityContext).should.eventually.be.rejectedWith(/not specified/);
+        });
+        it('should handle setting to a new level', () => {",,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143792536,https://github.com/hyperledger/composer/pull/2341#discussion_r143792536,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,"Typo: ""conneted"" -> ""connected""",9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 17:10:13,143792755,"@@ -32,6 +32,7 @@
         ""composer-connect-nomembersrvcurl"": ""connectOptions.membershipServicesURL not specified"",
         ""composer-connect-nopeerurl"": ""connectOptions.peerURL not specified"",
         ""composer-connect-noeventhuburl"": ""connectOptions.eventHubURL not specified"",
+        ""composer-connect-notconnected"": ""Connection needs to be conneted. Call connect(..)"",",,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143792755,https://github.com/hyperledger/composer/pull/2341#discussion_r143792755,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,No likey commented out code. Does it really need to be there?,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 17:11:57,143793230,"@@ -289,10 +289,10 @@ export class ClientService {
         return this.connectingPromise;
     }
 
-    reset(): Promise<any> {
-        // TODO: hack hack hack, this should be in the admin API.
-        return Util.invokeChainCode((<any> (this.getBusinessNetworkConnection())).securityContext, 'resetBusinessNetwork', []);
-    }
+    // reset(): Promise<any> {",,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143793230,https://github.com/hyperledger/composer/pull/2341#discussion_r143793230,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,Should this be a `calledWith` assertion since the call to `adminService.reset` supplies an argument now?,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 17:14:09,143793819,"@@ -314,7 +314,7 @@ describe('SampleBusinessNetworkService', () => {
             adminMock.connect.should.have.been.calledWith('myNetwork', true);
             adminMock.update.should.have.been.called;
             clientMock.refresh.should.have.been.called;
-            clientMock.reset.should.have.been.called;
+            adminMock.reset.should.have.been.called;",,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143793819,https://github.com/hyperledger/composer/pull/2341#discussion_r143793819,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,"Missing an assertion, and I suspect you are trying to test the case where no log level has been set so the test description should state that this is the _behaviour_ being tested.",9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 17:15:18,143794163,"@@ -89,5 +89,15 @@ describe('EmbeddedLoggingService', () => {
         });
 
     });
+    describe('#loglevel', () => {
 
+        it('setLogLevel', () => {
+            loggingService.setLogLevel('doge');
+            loggingService.getLogLevel().should.equal('doge');
+        });
+        it('getLogLevel', () => {
+            loggingService.getLogLevel();",,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143794163,https://github.com/hyperledger/composer/pull/2341#discussion_r143794163,bestbeforetoday
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,Probably yes; but not something I wanted to tackle as part of this PR. ,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 20:04:13,143837007,"@@ -250,6 +250,123 @@ describe('Connection', () => {
 
     });
 
+    describe('#reset', () => {
+
+        it('should call _update and handle no error', () => {
+            sinon.stub(connection, '_resetTx').resolves();
+            return connection.reset(mockSecurityContext, mockBusinessNetworkDefinition)
+                        .then(() => {
+                            sinon.assert.calledWith(connection._resetTx, mockSecurityContext, mockBusinessNetworkDefinition);
+                        });
+        });
+
+        it('should call _reset and handle an error', () => {
+            sinon.stub(connection, '_resetTx').rejects(new Error('error'));
+            return connection.reset(mockSecurityContext, mockBusinessNetworkDefinition)
+                        .should.be.rejectedWith(/error/)
+                        .then(() => {
+                            sinon.assert.calledWith(connection._resetTx, mockSecurityContext, mockBusinessNetworkDefinition);
+                        });
+        });
+
+    });
+
+    describe('#_resetTx', () => {",,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143837007,https://github.com/hyperledger/composer/pull/2341#discussion_r143837007,mbwhite
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,Probably yes; but not something I wanted to tackle as part of this PR. ,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 20:04:18,143837021,"@@ -606,4 +723,86 @@ describe('Connection', () => {
 
     });
 
+    describe('#setLogLevel', () => {
+
+        it('should call _update and handle no error', () => {
+            sinon.stub(connection, '_setLogLevel').resolves();
+            return connection.setLogLevel(mockSecurityContext, mockBusinessNetworkDefinition)
+                                .then(() => {
+                                    sinon.assert.calledWith(connection._setLogLevel, mockSecurityContext, mockBusinessNetworkDefinition);
+                                });
+        });
+
+        it('should call _reset and handle an error', () => {
+            sinon.stub(connection, '_setLogLevel').rejects(new Error('error'));
+            return connection.setLogLevel(mockSecurityContext, mockBusinessNetworkDefinition)
+                                .should.be.rejectedWith(/error/)
+                                .then(() => {
+                                    sinon.assert.calledWith(connection._setLogLevel, mockSecurityContext, mockBusinessNetworkDefinition);
+                                });
+        });
+
+    });
+
+    describe('#_setLogLevel', () => {
+
+        it('should throw an error when no loglevel given', ()=>{
+            return connection._setLogLevel(mockSecurityContext).should.eventually.be.rejectedWith(/not specified/);
+        });
+        it('should handle setting to a new level', () => {",,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143837021,https://github.com/hyperledger/composer/pull/2341#discussion_r143837021,mbwhite
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,I was following the established pattern rather than attempting a refactor of the code. This code might change with the node.js runtime. ,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 20:05:39,143837347,"@@ -314,8 +314,121 @@ class Connection extends EventEmitter {
             let data = currentDeployedNetwork.getSerializer().toJSON(transaction);
             return Util.invokeChainCode(securityContext, 'submitTransaction', [JSON.stringify(data)]);
         });
+    }
+
+    /**
+     * Resets an existing deployed business network definition.
+     * @abstract
+     * @param {SecurityContext} securityContext The participant's security context.
+     * @param {String} businessNetworkIdentifier The identifier of the business network
+     * @return {Promise} A promise that is resolved once the business network
+     * artefacts have been reset, or rejected with an error.
+     */
+    reset(securityContext, businessNetworkIdentifier) {",,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143837347,https://github.com/hyperledger/composer/pull/2341#discussion_r143837347,mbwhite
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,Believe I tried that and it didn't work as expected. ,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 20:08:32,143837990,"@@ -0,0 +1,108 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const Admin = require('composer-admin');
+
+const ResetCMD = require('../../lib/cmds/network/resetCommand.js');
+const CmdUtil = require('../../lib/cmds/utils/cmdutils.js');
+const Reset = require('../../lib/cmds/network/lib/reset.js');
+const ora = require('ora');
+
+require('chai').should();
+
+const chai = require('chai');
+const sinon = require('sinon');
+chai.should();
+chai.use(require('chai-things'));
+chai.use(require('chai-as-promised'));
+
+
+let mockAdminConnection;
+
+describe('composer reset network CLI unit tests', function () {
+
+    let sandbox;
+
+    beforeEach(() => {
+        sandbox = sinon.sandbox.create();
+
+        mockAdminConnection = sinon.createStubInstance(Admin.AdminConnection);
+        mockAdminConnection.createProfile.resolves();
+        mockAdminConnection.connect.resolves();
+        mockAdminConnection.undeploy.resolves();
+        sandbox.stub(CmdUtil, 'createAdminConnection').returns(mockAdminConnection);
+        sandbox.stub(process, 'exit');
+
+
+    });
+
+    afterEach(() => {
+        sandbox.restore();
+    });
+
+
+    describe('update command method tests', () => {
+
+        it('should contain update in the command and describe', () => {
+            ResetCMD.command.should.include('reset');
+            ResetCMD.describe.should.match(/Resets/);
+        });
+
+        it('should invoke the Update handler correctly', () => {
+            sandbox.stub(Reset, 'handler');
+            let argv = {};
+            ResetCMD.handler(argv);
+            sinon.assert.calledOnce(Reset.handler);
+            sinon.assert.calledWith(Reset.handler, argv);
+            argv.should.have.property('thePromise');
+        });
+
+
+    });
+
+    describe('test main reset logic', () =>{
+        it('main line code path', ()=>{
+            let argv = {'businessNetworkName':'networkname','connectionProfileName':'hlfv1','enrollId':'admin','enrollSecret':'adminpw'};
+
+            return Reset.handler(argv);
+        });
+
+        it('no secret given', ()=>{
+            let argv = {'businessNetworkName':'networkname','connectionProfileName':'hlfv1','enrollId':'admin'};
+            sandbox.stub(CmdUtil, 'prompt').resolves({'enrollmentSecret':'adminpw'});
+
+            return Reset.handler(argv);
+
+        });
+        it('error path', ()=>{
+            let argv = {'businessNetworkName':'networkname','connectionProfileName':'hlfv1','enrollId':'admin'};
+            sandbox.stub(CmdUtil, 'prompt').rejects(new Error('computer says no'));
+
+            return Reset.handler(argv).should.eventually.be.rejectedWith(/computer says no/);",,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143837990,https://github.com/hyperledger/composer/pull/2341#discussion_r143837990,mbwhite
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,A copy of the style of the other commands. ,9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 20:14:30,143839518,"@@ -0,0 +1,86 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const cmdUtil = require('../../utils/cmdutils');
+const ora = require('ora');
+
+/**
+ * <p>
+ * Composer ""network network reset"" command
+ * </p>
+ * @private
+ */
+class Reset {
+
+  /**
+    * Command process for reset command
+    * @param {string} argv argument list from composer command
+    * @return {Promise} promise when command complete
+    */
+    static handler(argv) {
+        let adminConnection;",34,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143839518,https://github.com/hyperledger/composer/pull/2341#discussion_r143839518,mbwhite
https://github.com/hyperledger/composer/pull/2341,https://github.com/hyperledger/composer/pull/2341,"Yes, there's a lot about this class that is possibly redudant - but wasn't wanting to go too far..
",9a663a967925194bce8ebd2c82a1708a39dc3565,2017-10-10 20:16:10,143839896,"@@ -193,8 +167,44 @@ class AdminConnection {
         return this.connectionProfileManager.getConnectionProfileStore().loadAll();
     }
 
+    // admin connection methods...
+
     /**
-     * Disconnects this connection.
+     * Connects and logs in to the Hyperledger Fabric using a named connection
+     * profile. The connection profile must exist in the profile store.
+     * @example
+     * // Connect to Hyperledger Fabric
+     * var adminConnection = new AdminConnection();
+     * adminConnection.connect('testprofile', 'WebAppAdmin', 'DJY27pEnl16d')
+     * .then(function(){
+     *     // Connected.
+     * })
+     * .catch(function(error){
+     *     // Add optional error handling here.
+     * });
+     * @param {string} connectionProfile - The name of the connection profile
+     * @param {string} enrollmentID the enrollment ID of the user
+     * @param {string} enrollmentSecret the enrollment secret of the user
+     * @param {string} businessNetworkIdentifier the id of the network (for update) or null
+     * @return {Promise} A promise that indicates the connection is complete
+     */
+    connect(connectionProfile, enrollmentID, enrollmentSecret, businessNetworkIdentifier) {
+        return this.connectionProfileManager.connect(connectionProfile, businessNetworkIdentifier)
+            .then((connection) => {
+                this.connection = connection;
+                this.businessNetworkIdentifier = businessNetworkIdentifier;",,2017-10-11 10:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/143839896,https://github.com/hyperledger/composer/pull/2341#discussion_r143839896,mbwhite
https://github.com/hyperledger/composer/pull/2338,https://github.com/hyperledger/composer/pull/2338,"I think `undefined !== true` will evaluate to true anyway, so the `typeof` test is redundant?",f49f47d3beeedaeb7004396815ff516568914f4e,2017-10-13 14:37:56,144571725,"@@ -73,20 +73,22 @@ class Factory {
      * @throws {TypeNotFoundException} if the type is not registered with the ModelManager
      */
     newResource(ns, type, id, options) {
-        if(!id || typeof(id) !== 'string') {
-            let formatter = Globalize.messageFormatter('factory-newinstance-invalididentifier');
-            throw new Error(formatter({
-                namespace: ns,
-                type: type
-            }));
-        }
-
-        if(id.trim().length === 0) {
-            let formatter = Globalize.messageFormatter('factory-newinstance-missingidentifier');
-            throw new Error(formatter({
-                namespace: ns,
-                type: type
-            }));
+        options = options || {};
+        if(typeof options.allowNoIdentifier==='undefined' || options.allowNoIdentifier!==true) {",,2017-10-17 10:24:26,https://api.github.com/repos/hyperledger/composer/pulls/comments/144571725,https://github.com/hyperledger/composer/pull/2338#discussion_r144571725,bestbeforetoday
https://github.com/hyperledger/composer/pull/2338,https://github.com/hyperledger/composer/pull/2338,"I think skipping this test if `options.allowNoIdentifier` is `true` will allow identifiers to be set that are not strings, which is not permitted.",f49f47d3beeedaeb7004396815ff516568914f4e,2017-10-13 14:42:21,144573095,"@@ -73,20 +73,22 @@ class Factory {
      * @throws {TypeNotFoundException} if the type is not registered with the ModelManager
      */
     newResource(ns, type, id, options) {
-        if(!id || typeof(id) !== 'string') {
-            let formatter = Globalize.messageFormatter('factory-newinstance-invalididentifier');
-            throw new Error(formatter({
-                namespace: ns,
-                type: type
-            }));
-        }
-
-        if(id.trim().length === 0) {
-            let formatter = Globalize.messageFormatter('factory-newinstance-missingidentifier');
-            throw new Error(formatter({
-                namespace: ns,
-                type: type
-            }));
+        options = options || {};
+        if(typeof options.allowNoIdentifier==='undefined' || options.allowNoIdentifier!==true) {
+            if(!id || typeof(id) !== 'string') {",,2017-10-17 10:24:26,https://api.github.com/repos/hyperledger/composer/pulls/comments/144573095,https://github.com/hyperledger/composer/pull/2338#discussion_r144573095,bestbeforetoday
https://github.com/hyperledger/composer/pull/2338,https://github.com/hyperledger/composer/pull/2338,"Yes, agreed, that test can be removed. I think that this was me being overcautious and not wanting to change too much so just surrounding the existing code with a new test to cover the case that I wanted. ",f49f47d3beeedaeb7004396815ff516568914f4e,2017-10-13 16:52:04,144604925,"@@ -73,20 +73,22 @@ class Factory {
      * @throws {TypeNotFoundException} if the type is not registered with the ModelManager
      */
     newResource(ns, type, id, options) {
-        if(!id || typeof(id) !== 'string') {
-            let formatter = Globalize.messageFormatter('factory-newinstance-invalididentifier');
-            throw new Error(formatter({
-                namespace: ns,
-                type: type
-            }));
-        }
-
-        if(id.trim().length === 0) {
-            let formatter = Globalize.messageFormatter('factory-newinstance-missingidentifier');
-            throw new Error(formatter({
-                namespace: ns,
-                type: type
-            }));
+        options = options || {};
+        if(typeof options.allowNoIdentifier==='undefined' || options.allowNoIdentifier!==true) {",,2017-10-17 10:24:26,https://api.github.com/repos/hyperledger/composer/pulls/comments/144604925,https://github.com/hyperledger/composer/pull/2338#discussion_r144604925,samjsmith
https://github.com/hyperledger/composer/pull/2338,https://github.com/hyperledger/composer/pull/2338,"Yes, good point.  I was forgetting this is in common so you're right, I'll add that test back in to the else branch. The UI sets the id to be an empty string now so the validators error as soon as it's displayed but yes, programmatically, you could allowNoIdentifier and then set it to be a non-string value. Good spot.",f49f47d3beeedaeb7004396815ff516568914f4e,2017-10-13 16:57:09,144606028,"@@ -73,20 +73,22 @@ class Factory {
      * @throws {TypeNotFoundException} if the type is not registered with the ModelManager
      */
     newResource(ns, type, id, options) {
-        if(!id || typeof(id) !== 'string') {
-            let formatter = Globalize.messageFormatter('factory-newinstance-invalididentifier');
-            throw new Error(formatter({
-                namespace: ns,
-                type: type
-            }));
-        }
-
-        if(id.trim().length === 0) {
-            let formatter = Globalize.messageFormatter('factory-newinstance-missingidentifier');
-            throw new Error(formatter({
-                namespace: ns,
-                type: type
-            }));
+        options = options || {};
+        if(typeof options.allowNoIdentifier==='undefined' || options.allowNoIdentifier!==true) {
+            if(!id || typeof(id) !== 'string') {",,2017-10-17 10:24:26,https://api.github.com/repos/hyperledger/composer/pulls/comments/144606028,https://github.com/hyperledger/composer/pull/2338#discussion_r144606028,samjsmith
https://github.com/hyperledger/composer/pull/2338,https://github.com/hyperledger/composer/pull/2338,"Not sure what you're suggesting here Mark, I was trying to test if the client hadn't set the option at all or if they have, whether they'd set it to somthing other than boolean true (ie. set it wrongly to 'true' or something). ",f49f47d3beeedaeb7004396815ff516568914f4e,2017-10-13 17:04:38,144607656,"@@ -73,20 +73,22 @@ class Factory {
      * @throws {TypeNotFoundException} if the type is not registered with the ModelManager
      */
     newResource(ns, type, id, options) {
-        if(!id || typeof(id) !== 'string') {
-            let formatter = Globalize.messageFormatter('factory-newinstance-invalididentifier');
-            throw new Error(formatter({
-                namespace: ns,
-                type: type
-            }));
-        }
-
-        if(id.trim().length === 0) {
-            let formatter = Globalize.messageFormatter('factory-newinstance-missingidentifier');
-            throw new Error(formatter({
-                namespace: ns,
-                type: type
-            }));
+        options = options || {};
+        if(typeof options.allowNoIdentifier==='undefined' || options.allowNoIdentifier!==true) {",,2017-10-17 10:24:26,https://api.github.com/repos/hyperledger/composer/pulls/comments/144607656,https://github.com/hyperledger/composer/pull/2338#discussion_r144607656,samjsmith
https://github.com/hyperledger/composer/pull/2290,https://github.com/hyperledger/composer/pull/2290,"This test should be in the _describe_ that tests `update`, not in the suite that tests `add`.",e155bcb3ca6c2e1497acfa7927694a1665ab19a8,2017-10-13 15:16:36,144582394,"@@ -339,6 +339,17 @@ describe('Registry', () => {
                 .should.be.rejectedWith(AccessException);
         });
 
+        it('should throw if resource not specified', () => {
+
+            return registry.add({})
+                .should.be.rejectedWith(/Expected a Resource or Concept./);
+        });
+
+        it('should throw if resource not specified', () => {",,2017-10-16 13:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/144582394,https://github.com/hyperledger/composer/pull/2290#discussion_r144582394,bestbeforetoday
https://github.com/hyperledger/composer/pull/2290,https://github.com/hyperledger/composer/pull/2290,The error says it expects a `Resource` or `Concept` but the test only allows a `Resource`. Tests should cover all the allowable types.,e155bcb3ca6c2e1497acfa7927694a1665ab19a8,2017-10-13 15:17:54,144582728,"@@ -228,13 +236,23 @@ class Registry extends EventEmitter {
      * with an error.
      */
     update(resource, options) {
-        options = options || {};
-        let id = resource.getIdentifier();
-        let object = this.serializer.toJSON(resource, {
-            convertResourcesToRelationships: options.convertResourcesToRelationships
-        });
-        object = this.addInternalProperties(object);
-        return this.dataCollection.get(id)
+        let id;
+        let object;
+        return Promise.resolve().then(() => {
+            if (!(resource instanceof Resource)) {",43,2017-10-16 13:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/144582728,https://github.com/hyperledger/composer/pull/2290#discussion_r144582728,bestbeforetoday
https://github.com/hyperledger/composer/pull/2290,https://github.com/hyperledger/composer/pull/2290,The error says it expects a `Resource` or `Concept` but the test only allows a `Resource`. Tests should cover all the allowable types.,e155bcb3ca6c2e1497acfa7927694a1665ab19a8,2017-10-13 15:19:07,144583046,"@@ -172,9 +172,17 @@ class Registry extends EventEmitter {
      * with an error.
      */
     add(resource, options) {
-        return this.accessController.check(resource, 'CREATE')
+
+        return Promise.resolve().then(() => {
+            if (!(resource instanceof Resource)) {",16,2017-10-16 13:40:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/144583046,https://github.com/hyperledger/composer/pull/2290#discussion_r144583046,bestbeforetoday
https://github.com/hyperledger/composer/pull/2273,https://github.com/hyperledger/composer/pull/2273,variable names should be camel case,0dba290fe6b9dfef38db5899b80ab90dbc0fd1ef,2017-10-04 07:57:39,142602870,"@@ -459,62 +459,76 @@ class ModelFile {
 
     /**
      * Get the AssetDeclarations defined in this ModelFile
+     * @param {Boolean} include_system_types - Include the decalarations of system type in returned data
      * @return {AssetDeclaration[]} the AssetDeclarations defined in the model file
      */
-    getAssetDeclarations() {
-        return this.getDeclarations(AssetDeclaration);
+    getAssetDeclarations(include_system_types) {",,2017-10-11 09:28:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/142602870,https://github.com/hyperledger/composer/pull/2273#discussion_r142602870,cazfletch
https://github.com/hyperledger/composer/pull/2273,https://github.com/hyperledger/composer/pull/2273,instead of doing this you should set a default parameter to set it to true by default,0dba290fe6b9dfef38db5899b80ab90dbc0fd1ef,2017-10-04 07:59:10,142603145,"@@ -459,62 +459,76 @@ class ModelFile {
 
     /**
      * Get the AssetDeclarations defined in this ModelFile
+     * @param {Boolean} include_system_types - Include the decalarations of system type in returned data
      * @return {AssetDeclaration[]} the AssetDeclarations defined in the model file
      */
-    getAssetDeclarations() {
-        return this.getDeclarations(AssetDeclaration);
+    getAssetDeclarations(include_system_types) {
+        include_system_types = (typeof include_system_types === 'undefined') ? true : include_system_types;
+        return this.getDeclarations(AssetDeclaration, include_system_types);
     }
 
     /**
      * Get the TransactionDeclarations defined in this ModelFile
+     * @param {Boolean} include_system_types - Include the decalarations of system type in returned data
      * @return {TransactionDeclaration[]} the TransactionDeclarations defined in the model file
      */
-    getTransactionDeclarations() {
-        return this.getDeclarations(TransactionDeclaration);
+    getTransactionDeclarations(include_system_types) {
+        include_system_types = (typeof include_system_types === 'undefined') ? true : include_system_types;",,2017-10-11 09:28:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/142603145,https://github.com/hyperledger/composer/pull/2273#discussion_r142603145,cazfletch
https://github.com/hyperledger/composer/pull/2273,https://github.com/hyperledger/composer/pull/2273,These should return something to check tyou are doing the right thing with the result,0dba290fe6b9dfef38db5899b80ab90dbc0fd1ef,2017-10-04 08:08:07,142604887,"@@ -210,13 +215,17 @@ describe('UpdateComponent', () => {
 
     describe('selectNetwork', () => {
         it('should select the network', fakeAsync(() => {
-            mockBusinessNetworkService.getChosenSample.returns(Promise.resolve({network: 'myNetwork'}));
-            component.selectNetwork('bob');
+          mockModelManager.getParticipantDeclarations.returns([]);",,2017-10-11 09:28:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/142604887,https://github.com/hyperledger/composer/pull/2273#discussion_r142604887,cazfletch
https://github.com/hyperledger/composer/pull/2273,https://github.com/hyperledger/composer/pull/2273,this should check that the system types are included,0dba290fe6b9dfef38db5899b80ab90dbc0fd1ef,2017-10-04 12:17:35,142653331,"@@ -553,6 +554,16 @@ describe('ModelFile', () => {
 
     });
 
+    describe('#getEnumDeclarations', () => {
+
+        it('should return the expected number of Enum declarations with system types', () => {
+            let modelFile = new ModelFile(mockModelManager, carLeaseModel);
+            let decls = modelFile.getEnumDeclarations();
+            decls.should.all.be.an.instanceOf(EnumDeclaration);",41,2017-10-11 09:28:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/142653331,https://github.com/hyperledger/composer/pull/2273#discussion_r142653331,cazfletch
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,Can you fix this error message? It should say `all` not `destroyAll`.,e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-26 19:15:06,141156028,"@@ -297,10 +300,14 @@ class BusinessNetworkConnector extends Connector {
                         throw new Error('The destroyAll operation without a where clause is not supported');",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141156028,https://github.com/hyperledger/composer/pull/2229#discussion_r141156028,sstone1
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,"This code can now be broken because it is possible to have a `filter.where` which does not contain `identifierField`. This would result in `doResolve` equal to `true` and `objectId` equal to `null`.
If `doResolve` is equal to true, you need to ensure that the identifier is set and that no other properties are set.",e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-26 19:18:20,141156789,"@@ -297,10 +300,14 @@ class BusinessNetworkConnector extends Connector {
                         throw new Error('The destroyAll operation without a where clause is not supported');
                     }
                     let identifierField = this.getClassIdentifier(composerModelName);
-                    if(!filter.where[identifierField]) {
-                        throw new Error('The specified filter does not match the identifier in the model');
+                    let query = null;
+                    if(!filter.where[identifierField]){
+                        const queryString = FilterParser.parseFilter(filter, composerModelName);
+                        query = networkConnection.buildQuery(queryString);
+                        if(query === null || typeof query === 'undefined') {
+                            throw new Error('The specified filter:' + keys[0] + ' does not match the identifier or any property in the model');
+                        }
                     }
-
                     // Check we have the right identifier for the object type
                     let objectId = filter.where[identifierField];
                     if(doResolve) {",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141156789,https://github.com/hyperledger/composer/pull/2229#discussion_r141156789,sstone1
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,This code needs to check that the `filter.where` contains `identifierField` but does not contain any other properties. At the moment it just throws away any other properties if `identifierField` is provided.,e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-26 19:20:00,141157202,"@@ -310,12 +317,20 @@ class BusinessNetworkConnector extends Connector {
                                 return [ result ];
                             });
 
-                    } else {
+                    } else if(filter.where[identifierField]){",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141157202,https://github.com/hyperledger/composer/pull/2229#discussion_r141157202,sstone1
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,This `buildQuery` section would be better placed below inside the `else` block as that is the only place the `query` can be used.,e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-26 19:21:03,141157446,"@@ -297,10 +300,14 @@ class BusinessNetworkConnector extends Connector {
                         throw new Error('The destroyAll operation without a where clause is not supported');
                     }
                     let identifierField = this.getClassIdentifier(composerModelName);
-                    if(!filter.where[identifierField]) {
-                        throw new Error('The specified filter does not match the identifier in the model');
+                    let query = null;",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141157446,https://github.com/hyperledger/composer/pull/2229#discussion_r141157446,sstone1
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,"This method isn't needed as far as I can tell, because everything is static, so just remove it.",e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-26 19:21:31,141157560,"@@ -0,0 +1,150 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const Logger = require('composer-common').Logger;
+const LOG = Logger.getLog('FilterParser');
+const operationmap = {'=': '==', 'gt': '>', 'gte': '>=', 'lt': '<', 'lte': '<=', 'between': 'between', 'neq': '!='};
+const operationmapKeys = Object.keys(operationmap);
+const arrayCombinationOperators = {
+    'and': 'AND',
+    'or': 'OR'
+};
+
+/**
+ * The fillter parser parse the filter where string and translate the filter JSON object to be a composer query statement
+ ** @class
+ *
+ */
+class FilterParser {
+    /**
+     * Constructor.
+     *
+     * @private
+     */
+    constructor() {",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141157560,https://github.com/hyperledger/composer/pull/2229#discussion_r141157560,sstone1
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,Double `**` in comment not needed.,e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-26 19:21:56,141157672,"@@ -0,0 +1,150 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const Logger = require('composer-common').Logger;
+const LOG = Logger.getLog('FilterParser');
+const operationmap = {'=': '==', 'gt': '>', 'gte': '>=', 'lt': '<', 'lte': '<=', 'between': 'between', 'neq': '!='};
+const operationmapKeys = Object.keys(operationmap);
+const arrayCombinationOperators = {
+    'and': 'AND',
+    'or': 'OR'
+};
+
+/**
+ * The fillter parser parse the filter where string and translate the filter JSON object to be a composer query statement
+ ** @class",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141157672,https://github.com/hyperledger/composer/pull/2229#discussion_r141157672,sstone1
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,Could this not be a constant at the top like `operationmapKeys`?,e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-26 19:23:09,141157970,"@@ -0,0 +1,150 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const Logger = require('composer-common').Logger;
+const LOG = Logger.getLog('FilterParser');
+const operationmap = {'=': '==', 'gt': '>', 'gte': '>=', 'lt': '<', 'lte': '<=', 'between': 'between', 'neq': '!='};
+const operationmapKeys = Object.keys(operationmap);
+const arrayCombinationOperators = {
+    'and': 'AND',
+    'or': 'OR'
+};
+
+/**
+ * The fillter parser parse the filter where string and translate the filter JSON object to be a composer query statement
+ ** @class
+ *
+ */
+class FilterParser {
+    /**
+     * Constructor.
+     *
+     * @private
+     */
+    constructor() {
+        const method = 'constructor';
+        LOG.entry(method);
+        LOG.exit(method);
+    }
+    /**
+     * parse a filter string and convert the where conditions to be a composer query statement
+     * examples of the where filter:
+     * filter0 = {'where':{'field1':'value1'}}
+     * filter1 = {'where':{'field1':{'between':'[value1:value2]'}}}
+     * filter2 = {'where':{'or':[{'field1':{'gt':'value1'}},{'field2':{'lte':'value2'}}]}}
+     * filter4 = {'where': {'and':[{'or':[{'f1':{'gt':'v1'}}, {'f2':{'lt':'v2'}}]}, {'and':[{'f3':{'lte':'v3'}},{'or':[{'f4':{'neq':'v4'}}, {'f5':{'lt':'v5'}}]}]}]}}
+     * @param {Object} filter The filter being parsed.
+     * @param {string} resourceType The type of the resource: asset or participant
+     * @return {string} The result of filter parser, or null.
+     * @public
+     */
+    static parseFilter(filter, resourceType) {
+        const method = 'parseFilter';
+        LOG.entry(method, JSON.stringify(filter));
+
+        let result = null;
+        let filterKeys = Object.keys(filter);
+
+        if (filterKeys.indexOf('where') >= 0) {
+            result = this.parseWhereCondition(filter.where);
+            // if there is an op
+            result = 'SELECT ' + resourceType + ' WHERE ' + result;
+        } else{
+            throw new Error('The filter does not contain the where key');
+        }
+        LOG.exit(method);
+        return result;
+    }
+    /**
+     * parse the filter where conditions and convert the conditions to be the query language statement
+     * @example the filter conditions
+     * {""f1"":""v1""} or {""f1"":{""op"":""v1""}} or
+     * {""and|or"":[{""f1"":{""op"":""v1""}}, {""f2"":{""op"":""v2""}}]}, or
+     * {'and|or':[{'and|or':[{'f1':{'op':'v1'}}, {'f2':{'op':'v2'}}]}, {'f3':{'op':'v3'}}]};
+     * and so on with nested structures
+     * @param {Object} whereObject  is a JSON object with the format as above examples
+     * @return {string} a string condition (f1 == v1) or (f1 > v1) or recurively call this function, throw exceptions when the operators are not supported
+     * @public
+     */
+    static parseWhereCondition(whereObject) {
+        const method = 'parseWhereCondition';
+        LOG.entry(method, JSON.stringify(whereObject));
+        if(typeof whereObject === 'undefined'|| whereObject === null){
+            throw new Error('The where object is not specified');
+        }
+        const keys = Object.keys(whereObject);
+        const combinationOperatorKeys = Object.keys(arrayCombinationOperators);",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141157970,https://github.com/hyperledger/composer/pull/2229#discussion_r141157970,sstone1
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,"What happens if multiple properties are provided in the `whereObject`?
This is supported as per the following example in the LoopBack documentation which queries `userId` and `time`:

```
transaction.find({
      where: {
        userId: user.id,
        time: {gt: Date.now() - ONE_MONTH}
      }
    }
```",e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-26 19:31:50,141160056,"@@ -0,0 +1,150 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const Logger = require('composer-common').Logger;
+const LOG = Logger.getLog('FilterParser');
+const operationmap = {'=': '==', 'gt': '>', 'gte': '>=', 'lt': '<', 'lte': '<=', 'between': 'between', 'neq': '!='};
+const operationmapKeys = Object.keys(operationmap);
+const arrayCombinationOperators = {
+    'and': 'AND',
+    'or': 'OR'
+};
+
+/**
+ * The fillter parser parse the filter where string and translate the filter JSON object to be a composer query statement
+ ** @class
+ *
+ */
+class FilterParser {
+    /**
+     * Constructor.
+     *
+     * @private
+     */
+    constructor() {
+        const method = 'constructor';
+        LOG.entry(method);
+        LOG.exit(method);
+    }
+    /**
+     * parse a filter string and convert the where conditions to be a composer query statement
+     * examples of the where filter:
+     * filter0 = {'where':{'field1':'value1'}}
+     * filter1 = {'where':{'field1':{'between':'[value1:value2]'}}}
+     * filter2 = {'where':{'or':[{'field1':{'gt':'value1'}},{'field2':{'lte':'value2'}}]}}
+     * filter4 = {'where': {'and':[{'or':[{'f1':{'gt':'v1'}}, {'f2':{'lt':'v2'}}]}, {'and':[{'f3':{'lte':'v3'}},{'or':[{'f4':{'neq':'v4'}}, {'f5':{'lt':'v5'}}]}]}]}}
+     * @param {Object} filter The filter being parsed.
+     * @param {string} resourceType The type of the resource: asset or participant
+     * @return {string} The result of filter parser, or null.
+     * @public
+     */
+    static parseFilter(filter, resourceType) {
+        const method = 'parseFilter';
+        LOG.entry(method, JSON.stringify(filter));
+
+        let result = null;
+        let filterKeys = Object.keys(filter);
+
+        if (filterKeys.indexOf('where') >= 0) {
+            result = this.parseWhereCondition(filter.where);
+            // if there is an op
+            result = 'SELECT ' + resourceType + ' WHERE ' + result;
+        } else{
+            throw new Error('The filter does not contain the where key');
+        }
+        LOG.exit(method);
+        return result;
+    }
+    /**
+     * parse the filter where conditions and convert the conditions to be the query language statement
+     * @example the filter conditions
+     * {""f1"":""v1""} or {""f1"":{""op"":""v1""}} or
+     * {""and|or"":[{""f1"":{""op"":""v1""}}, {""f2"":{""op"":""v2""}}]}, or
+     * {'and|or':[{'and|or':[{'f1':{'op':'v1'}}, {'f2':{'op':'v2'}}]}, {'f3':{'op':'v3'}}]};
+     * and so on with nested structures
+     * @param {Object} whereObject  is a JSON object with the format as above examples
+     * @return {string} a string condition (f1 == v1) or (f1 > v1) or recurively call this function, throw exceptions when the operators are not supported
+     * @public
+     */
+    static parseWhereCondition(whereObject) {
+        const method = 'parseWhereCondition';
+        LOG.entry(method, JSON.stringify(whereObject));
+        if(typeof whereObject === 'undefined'|| whereObject === null){
+            throw new Error('The where object is not specified');
+        }
+        const keys = Object.keys(whereObject);
+        const combinationOperatorKeys = Object.keys(arrayCombinationOperators);
+        if(keys.length === 1){",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141160056,https://github.com/hyperledger/composer/pull/2229#discussion_r141160056,sstone1
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,This isn't needed and can be removed?,e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-26 19:36:24,141161056,"@@ -0,0 +1,161 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const FilterParser = require('../lib/filterparser');
+
+const chai = require('chai');
+chai.should();
+chai.use(require('chai-as-promised'));
+const resourceType = 'org.acme.base.TestAsset';
+let whereObject;
+let whereCondition;
+
+describe('FilterParser', () => {
+    beforeEach(() => {
+        new FilterParser();",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141161056,https://github.com/hyperledger/composer/pull/2229#discussion_r141161056,sstone1
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,"The LoopBack documentation says that you can have more than two conditions in `and`/`or`, note the `...` here:

`{where: {<and|or>: [condition1, condition2, ...]}}`

",e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-26 19:43:38,141162823,"@@ -0,0 +1,150 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const Logger = require('composer-common').Logger;
+const LOG = Logger.getLog('FilterParser');
+const operationmap = {'=': '==', 'gt': '>', 'gte': '>=', 'lt': '<', 'lte': '<=', 'between': 'between', 'neq': '!='};
+const operationmapKeys = Object.keys(operationmap);
+const arrayCombinationOperators = {
+    'and': 'AND',
+    'or': 'OR'
+};
+
+/**
+ * The fillter parser parse the filter where string and translate the filter JSON object to be a composer query statement
+ ** @class
+ *
+ */
+class FilterParser {
+    /**
+     * Constructor.
+     *
+     * @private
+     */
+    constructor() {
+        const method = 'constructor';
+        LOG.entry(method);
+        LOG.exit(method);
+    }
+    /**
+     * parse a filter string and convert the where conditions to be a composer query statement
+     * examples of the where filter:
+     * filter0 = {'where':{'field1':'value1'}}
+     * filter1 = {'where':{'field1':{'between':'[value1:value2]'}}}
+     * filter2 = {'where':{'or':[{'field1':{'gt':'value1'}},{'field2':{'lte':'value2'}}]}}
+     * filter4 = {'where': {'and':[{'or':[{'f1':{'gt':'v1'}}, {'f2':{'lt':'v2'}}]}, {'and':[{'f3':{'lte':'v3'}},{'or':[{'f4':{'neq':'v4'}}, {'f5':{'lt':'v5'}}]}]}]}}
+     * @param {Object} filter The filter being parsed.
+     * @param {string} resourceType The type of the resource: asset or participant
+     * @return {string} The result of filter parser, or null.
+     * @public
+     */
+    static parseFilter(filter, resourceType) {
+        const method = 'parseFilter';
+        LOG.entry(method, JSON.stringify(filter));
+
+        let result = null;
+        let filterKeys = Object.keys(filter);
+
+        if (filterKeys.indexOf('where') >= 0) {
+            result = this.parseWhereCondition(filter.where);
+            // if there is an op
+            result = 'SELECT ' + resourceType + ' WHERE ' + result;
+        } else{
+            throw new Error('The filter does not contain the where key');
+        }
+        LOG.exit(method);
+        return result;
+    }
+    /**
+     * parse the filter where conditions and convert the conditions to be the query language statement
+     * @example the filter conditions
+     * {""f1"":""v1""} or {""f1"":{""op"":""v1""}} or
+     * {""and|or"":[{""f1"":{""op"":""v1""}}, {""f2"":{""op"":""v2""}}]}, or
+     * {'and|or':[{'and|or':[{'f1':{'op':'v1'}}, {'f2':{'op':'v2'}}]}, {'f3':{'op':'v3'}}]};
+     * and so on with nested structures
+     * @param {Object} whereObject  is a JSON object with the format as above examples
+     * @return {string} a string condition (f1 == v1) or (f1 > v1) or recurively call this function, throw exceptions when the operators are not supported
+     * @public
+     */
+    static parseWhereCondition(whereObject) {
+        const method = 'parseWhereCondition';
+        LOG.entry(method, JSON.stringify(whereObject));
+        if(typeof whereObject === 'undefined'|| whereObject === null){
+            throw new Error('The where object is not specified');
+        }
+        const keys = Object.keys(whereObject);
+        const combinationOperatorKeys = Object.keys(arrayCombinationOperators);
+        if(keys.length === 1){
+
+            if(keys[0].trim() ===''){
+                throw new Error('The where object key is invalid');
+            }
+
+            let values = whereObject[keys[0]];
+            if( values === null || values === undefined){
+                throw new Error('The object value is invalid');
+            }
+
+            if (typeof values === 'string') {
+                if(values.startsWith('_$')){
+                    throw new Error('The filter where does not support a parameter');
+                }
+                values = '\''+ values +'\'';
+                const result = '(' + keys[0] + '==' + values + ')';
+                return result;
+            } else if (typeof values === 'number' || typeof values === 'boolean'){
+                const result = '(' + keys[0] + '==' + values + ')';
+                return result;
+            }
+            else if(typeof values === 'object' && !(values instanceof Array)) {
+                let op = Object.keys(values);
+                if( typeof op ==='undefined' || op === null || op.length !== 1){
+                    throw new Error('An invalid operator for the object value');
+                }
+                const opValue = values[op[0]];
+                if(!operationmapKeys.includes(op[0])){
+                    throw new Error('The key ' + op[0] + ' operator is not supported by the Composer filter where');
+                }
+                let queryOp = operationmap[op[0]];
+                let result;
+                if(queryOp ==='between'){
+                    // parse the first string format array object ""[1, 10]"" to an array
+                    let theValue = JSON.parse(opValue);
+                    result = '(' + keys[0] + '>=' + theValue[0] +' AND '+ keys[0] + '<=' + theValue[1] +')';
+                }else{
+                    result = '(' + keys[0] + queryOp + opValue + ')';
+                }
+                return result;
+            } else{
+                //values are the instance of array
+                if(!combinationOperatorKeys.includes(keys[0])){
+                    throw new Error('The combination operator: ' +keys[0] + ' is not supported by the Composer filter where');
+                }
+                if( values.length !==2){",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141162823,https://github.com/hyperledger/composer/pull/2229#discussion_r141162823,sstone1
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,Need error handling here to check that the result is an array and contains two values.,e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-26 19:44:13,141162953,"@@ -0,0 +1,150 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const Logger = require('composer-common').Logger;
+const LOG = Logger.getLog('FilterParser');
+const operationmap = {'=': '==', 'gt': '>', 'gte': '>=', 'lt': '<', 'lte': '<=', 'between': 'between', 'neq': '!='};
+const operationmapKeys = Object.keys(operationmap);
+const arrayCombinationOperators = {
+    'and': 'AND',
+    'or': 'OR'
+};
+
+/**
+ * The fillter parser parse the filter where string and translate the filter JSON object to be a composer query statement
+ ** @class
+ *
+ */
+class FilterParser {
+    /**
+     * Constructor.
+     *
+     * @private
+     */
+    constructor() {
+        const method = 'constructor';
+        LOG.entry(method);
+        LOG.exit(method);
+    }
+    /**
+     * parse a filter string and convert the where conditions to be a composer query statement
+     * examples of the where filter:
+     * filter0 = {'where':{'field1':'value1'}}
+     * filter1 = {'where':{'field1':{'between':'[value1:value2]'}}}
+     * filter2 = {'where':{'or':[{'field1':{'gt':'value1'}},{'field2':{'lte':'value2'}}]}}
+     * filter4 = {'where': {'and':[{'or':[{'f1':{'gt':'v1'}}, {'f2':{'lt':'v2'}}]}, {'and':[{'f3':{'lte':'v3'}},{'or':[{'f4':{'neq':'v4'}}, {'f5':{'lt':'v5'}}]}]}]}}
+     * @param {Object} filter The filter being parsed.
+     * @param {string} resourceType The type of the resource: asset or participant
+     * @return {string} The result of filter parser, or null.
+     * @public
+     */
+    static parseFilter(filter, resourceType) {
+        const method = 'parseFilter';
+        LOG.entry(method, JSON.stringify(filter));
+
+        let result = null;
+        let filterKeys = Object.keys(filter);
+
+        if (filterKeys.indexOf('where') >= 0) {
+            result = this.parseWhereCondition(filter.where);
+            // if there is an op
+            result = 'SELECT ' + resourceType + ' WHERE ' + result;
+        } else{
+            throw new Error('The filter does not contain the where key');
+        }
+        LOG.exit(method);
+        return result;
+    }
+    /**
+     * parse the filter where conditions and convert the conditions to be the query language statement
+     * @example the filter conditions
+     * {""f1"":""v1""} or {""f1"":{""op"":""v1""}} or
+     * {""and|or"":[{""f1"":{""op"":""v1""}}, {""f2"":{""op"":""v2""}}]}, or
+     * {'and|or':[{'and|or':[{'f1':{'op':'v1'}}, {'f2':{'op':'v2'}}]}, {'f3':{'op':'v3'}}]};
+     * and so on with nested structures
+     * @param {Object} whereObject  is a JSON object with the format as above examples
+     * @return {string} a string condition (f1 == v1) or (f1 > v1) or recurively call this function, throw exceptions when the operators are not supported
+     * @public
+     */
+    static parseWhereCondition(whereObject) {
+        const method = 'parseWhereCondition';
+        LOG.entry(method, JSON.stringify(whereObject));
+        if(typeof whereObject === 'undefined'|| whereObject === null){
+            throw new Error('The where object is not specified');
+        }
+        const keys = Object.keys(whereObject);
+        const combinationOperatorKeys = Object.keys(arrayCombinationOperators);
+        if(keys.length === 1){
+
+            if(keys[0].trim() ===''){
+                throw new Error('The where object key is invalid');
+            }
+
+            let values = whereObject[keys[0]];
+            if( values === null || values === undefined){
+                throw new Error('The object value is invalid');
+            }
+
+            if (typeof values === 'string') {
+                if(values.startsWith('_$')){
+                    throw new Error('The filter where does not support a parameter');
+                }
+                values = '\''+ values +'\'';
+                const result = '(' + keys[0] + '==' + values + ')';
+                return result;
+            } else if (typeof values === 'number' || typeof values === 'boolean'){
+                const result = '(' + keys[0] + '==' + values + ')';
+                return result;
+            }
+            else if(typeof values === 'object' && !(values instanceof Array)) {
+                let op = Object.keys(values);
+                if( typeof op ==='undefined' || op === null || op.length !== 1){
+                    throw new Error('An invalid operator for the object value');
+                }
+                const opValue = values[op[0]];
+                if(!operationmapKeys.includes(op[0])){
+                    throw new Error('The key ' + op[0] + ' operator is not supported by the Composer filter where');
+                }
+                let queryOp = operationmap[op[0]];
+                let result;
+                if(queryOp ==='between'){
+                    // parse the first string format array object ""[1, 10]"" to an array
+                    let theValue = JSON.parse(opValue);",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141162953,https://github.com/hyperledger/composer/pull/2229#discussion_r141162953,sstone1
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,yup- this can be corrected.,e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-26 20:04:28,141168094,"@@ -297,10 +300,14 @@ class BusinessNetworkConnector extends Connector {
                         throw new Error('The destroyAll operation without a where clause is not supported');",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141168094,https://github.com/hyperledger/composer/pull/2229#discussion_r141168094,fenglianxu
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,removed the extra *,e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-26 20:14:28,141170507,"@@ -0,0 +1,150 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const Logger = require('composer-common').Logger;
+const LOG = Logger.getLog('FilterParser');
+const operationmap = {'=': '==', 'gt': '>', 'gte': '>=', 'lt': '<', 'lte': '<=', 'between': 'between', 'neq': '!='};
+const operationmapKeys = Object.keys(operationmap);
+const arrayCombinationOperators = {
+    'and': 'AND',
+    'or': 'OR'
+};
+
+/**
+ * The fillter parser parse the filter where string and translate the filter JSON object to be a composer query statement
+ ** @class",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141170507,https://github.com/hyperledger/composer/pull/2229#discussion_r141170507,fenglianxu
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,moved it to the top.,e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-26 20:16:35,141171043,"@@ -0,0 +1,150 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const Logger = require('composer-common').Logger;
+const LOG = Logger.getLog('FilterParser');
+const operationmap = {'=': '==', 'gt': '>', 'gte': '>=', 'lt': '<', 'lte': '<=', 'between': 'between', 'neq': '!='};
+const operationmapKeys = Object.keys(operationmap);
+const arrayCombinationOperators = {
+    'and': 'AND',
+    'or': 'OR'
+};
+
+/**
+ * The fillter parser parse the filter where string and translate the filter JSON object to be a composer query statement
+ ** @class
+ *
+ */
+class FilterParser {
+    /**
+     * Constructor.
+     *
+     * @private
+     */
+    constructor() {
+        const method = 'constructor';
+        LOG.entry(method);
+        LOG.exit(method);
+    }
+    /**
+     * parse a filter string and convert the where conditions to be a composer query statement
+     * examples of the where filter:
+     * filter0 = {'where':{'field1':'value1'}}
+     * filter1 = {'where':{'field1':{'between':'[value1:value2]'}}}
+     * filter2 = {'where':{'or':[{'field1':{'gt':'value1'}},{'field2':{'lte':'value2'}}]}}
+     * filter4 = {'where': {'and':[{'or':[{'f1':{'gt':'v1'}}, {'f2':{'lt':'v2'}}]}, {'and':[{'f3':{'lte':'v3'}},{'or':[{'f4':{'neq':'v4'}}, {'f5':{'lt':'v5'}}]}]}]}}
+     * @param {Object} filter The filter being parsed.
+     * @param {string} resourceType The type of the resource: asset or participant
+     * @return {string} The result of filter parser, or null.
+     * @public
+     */
+    static parseFilter(filter, resourceType) {
+        const method = 'parseFilter';
+        LOG.entry(method, JSON.stringify(filter));
+
+        let result = null;
+        let filterKeys = Object.keys(filter);
+
+        if (filterKeys.indexOf('where') >= 0) {
+            result = this.parseWhereCondition(filter.where);
+            // if there is an op
+            result = 'SELECT ' + resourceType + ' WHERE ' + result;
+        } else{
+            throw new Error('The filter does not contain the where key');
+        }
+        LOG.exit(method);
+        return result;
+    }
+    /**
+     * parse the filter where conditions and convert the conditions to be the query language statement
+     * @example the filter conditions
+     * {""f1"":""v1""} or {""f1"":{""op"":""v1""}} or
+     * {""and|or"":[{""f1"":{""op"":""v1""}}, {""f2"":{""op"":""v2""}}]}, or
+     * {'and|or':[{'and|or':[{'f1':{'op':'v1'}}, {'f2':{'op':'v2'}}]}, {'f3':{'op':'v3'}}]};
+     * and so on with nested structures
+     * @param {Object} whereObject  is a JSON object with the format as above examples
+     * @return {string} a string condition (f1 == v1) or (f1 > v1) or recurively call this function, throw exceptions when the operators are not supported
+     * @public
+     */
+    static parseWhereCondition(whereObject) {
+        const method = 'parseWhereCondition';
+        LOG.entry(method, JSON.stringify(whereObject));
+        if(typeof whereObject === 'undefined'|| whereObject === null){
+            throw new Error('The where object is not specified');
+        }
+        const keys = Object.keys(whereObject);
+        const combinationOperatorKeys = Object.keys(arrayCombinationOperators);",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141171043,https://github.com/hyperledger/composer/pull/2229#discussion_r141171043,fenglianxu
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,removed this in the test.,e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-26 20:18:06,141171464,"@@ -0,0 +1,161 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const FilterParser = require('../lib/filterparser');
+
+const chai = require('chai');
+chai.should();
+chai.use(require('chai-as-promised'));
+const resourceType = 'org.acme.base.TestAsset';
+let whereObject;
+let whereCondition;
+
+describe('FilterParser', () => {
+    beforeEach(() => {
+        new FilterParser();",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141171464,https://github.com/hyperledger/composer/pull/2229#discussion_r141171464,fenglianxu
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,agree and will update the code to handle multiple conditions for the combination operators: and/or ,e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-26 20:30:42,141174690,"@@ -0,0 +1,150 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const Logger = require('composer-common').Logger;
+const LOG = Logger.getLog('FilterParser');
+const operationmap = {'=': '==', 'gt': '>', 'gte': '>=', 'lt': '<', 'lte': '<=', 'between': 'between', 'neq': '!='};
+const operationmapKeys = Object.keys(operationmap);
+const arrayCombinationOperators = {
+    'and': 'AND',
+    'or': 'OR'
+};
+
+/**
+ * The fillter parser parse the filter where string and translate the filter JSON object to be a composer query statement
+ ** @class
+ *
+ */
+class FilterParser {
+    /**
+     * Constructor.
+     *
+     * @private
+     */
+    constructor() {
+        const method = 'constructor';
+        LOG.entry(method);
+        LOG.exit(method);
+    }
+    /**
+     * parse a filter string and convert the where conditions to be a composer query statement
+     * examples of the where filter:
+     * filter0 = {'where':{'field1':'value1'}}
+     * filter1 = {'where':{'field1':{'between':'[value1:value2]'}}}
+     * filter2 = {'where':{'or':[{'field1':{'gt':'value1'}},{'field2':{'lte':'value2'}}]}}
+     * filter4 = {'where': {'and':[{'or':[{'f1':{'gt':'v1'}}, {'f2':{'lt':'v2'}}]}, {'and':[{'f3':{'lte':'v3'}},{'or':[{'f4':{'neq':'v4'}}, {'f5':{'lt':'v5'}}]}]}]}}
+     * @param {Object} filter The filter being parsed.
+     * @param {string} resourceType The type of the resource: asset or participant
+     * @return {string} The result of filter parser, or null.
+     * @public
+     */
+    static parseFilter(filter, resourceType) {
+        const method = 'parseFilter';
+        LOG.entry(method, JSON.stringify(filter));
+
+        let result = null;
+        let filterKeys = Object.keys(filter);
+
+        if (filterKeys.indexOf('where') >= 0) {
+            result = this.parseWhereCondition(filter.where);
+            // if there is an op
+            result = 'SELECT ' + resourceType + ' WHERE ' + result;
+        } else{
+            throw new Error('The filter does not contain the where key');
+        }
+        LOG.exit(method);
+        return result;
+    }
+    /**
+     * parse the filter where conditions and convert the conditions to be the query language statement
+     * @example the filter conditions
+     * {""f1"":""v1""} or {""f1"":{""op"":""v1""}} or
+     * {""and|or"":[{""f1"":{""op"":""v1""}}, {""f2"":{""op"":""v2""}}]}, or
+     * {'and|or':[{'and|or':[{'f1':{'op':'v1'}}, {'f2':{'op':'v2'}}]}, {'f3':{'op':'v3'}}]};
+     * and so on with nested structures
+     * @param {Object} whereObject  is a JSON object with the format as above examples
+     * @return {string} a string condition (f1 == v1) or (f1 > v1) or recurively call this function, throw exceptions when the operators are not supported
+     * @public
+     */
+    static parseWhereCondition(whereObject) {
+        const method = 'parseWhereCondition';
+        LOG.entry(method, JSON.stringify(whereObject));
+        if(typeof whereObject === 'undefined'|| whereObject === null){
+            throw new Error('The where object is not specified');
+        }
+        const keys = Object.keys(whereObject);
+        const combinationOperatorKeys = Object.keys(arrayCombinationOperators);
+        if(keys.length === 1){
+
+            if(keys[0].trim() ===''){
+                throw new Error('The where object key is invalid');
+            }
+
+            let values = whereObject[keys[0]];
+            if( values === null || values === undefined){
+                throw new Error('The object value is invalid');
+            }
+
+            if (typeof values === 'string') {
+                if(values.startsWith('_$')){
+                    throw new Error('The filter where does not support a parameter');
+                }
+                values = '\''+ values +'\'';
+                const result = '(' + keys[0] + '==' + values + ')';
+                return result;
+            } else if (typeof values === 'number' || typeof values === 'boolean'){
+                const result = '(' + keys[0] + '==' + values + ')';
+                return result;
+            }
+            else if(typeof values === 'object' && !(values instanceof Array)) {
+                let op = Object.keys(values);
+                if( typeof op ==='undefined' || op === null || op.length !== 1){
+                    throw new Error('An invalid operator for the object value');
+                }
+                const opValue = values[op[0]];
+                if(!operationmapKeys.includes(op[0])){
+                    throw new Error('The key ' + op[0] + ' operator is not supported by the Composer filter where');
+                }
+                let queryOp = operationmap[op[0]];
+                let result;
+                if(queryOp ==='between'){
+                    // parse the first string format array object ""[1, 10]"" to an array
+                    let theValue = JSON.parse(opValue);
+                    result = '(' + keys[0] + '>=' + theValue[0] +' AND '+ keys[0] + '<=' + theValue[1] +')';
+                }else{
+                    result = '(' + keys[0] + queryOp + opValue + ')';
+                }
+                return result;
+            } else{
+                //values are the instance of array
+                if(!combinationOperatorKeys.includes(keys[0])){
+                    throw new Error('The combination operator: ' +keys[0] + ' is not supported by the Composer filter where');
+                }
+                if( values.length !==2){",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141174690,https://github.com/hyperledger/composer/pull/2229#discussion_r141174690,fenglianxu
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,please remove comments,e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-27 08:54:50,141281449,"@@ -0,0 +1,161 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const FilterParser = require('../lib/filterparser');
+
+const chai = require('chai');
+chai.should();
+chai.use(require('chai-as-promised'));
+const resourceType = 'org.acme.base.TestAsset';
+let whereObject;
+let whereCondition;
+
+describe('FilterParser', () => {
+    beforeEach(() => {
+        new FilterParser();
+        // const filter1 = {'f1':'v1'};
+        // const filter2 = {'f1':{'gt':'v1'}} ;
+        // const filter3 = {'and|or':[{'f1':{'lte':'v1'}}, {'f2':{'neq':'v2'}}]};
+        // const filter4 =  {'and|or':[{'and|or':[{'f1':{'op':'v1'}}, {'f2':{'op':'v2'}}]}, {'f3':{'op':'v3'}}]};
+        // const queryString ={",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141281449,https://github.com/hyperledger/composer/pull/2229#discussion_r141281449,nklincoln
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,could you break this onto multiple lines to follow the structure/format used in tests lower down as it increases readability,e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-27 08:55:34,141281627,"@@ -0,0 +1,161 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const FilterParser = require('../lib/filterparser');
+
+const chai = require('chai');
+chai.should();
+chai.use(require('chai-as-promised'));
+const resourceType = 'org.acme.base.TestAsset';
+let whereObject;
+let whereCondition;
+
+describe('FilterParser', () => {
+    beforeEach(() => {
+        new FilterParser();
+        // const filter1 = {'f1':'v1'};
+        // const filter2 = {'f1':{'gt':'v1'}} ;
+        // const filter3 = {'and|or':[{'f1':{'lte':'v1'}}, {'f2':{'neq':'v2'}}]};
+        // const filter4 =  {'and|or':[{'and|or':[{'f1':{'op':'v1'}}, {'f2':{'op':'v2'}}]}, {'f3':{'op':'v3'}}]};
+        // const queryString ={
+        //     filter1: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)',
+        //     filter2: 'SELECT org.acme.base.TestAsset WHERE (f1 <= v1)',
+        //     filter3: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)',
+        //     filter4: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)'
+        // };
+    });
+
+    describe('#parseFilter', () => {
+        it('should return the correct select statement', () => {
+            const filter1 = {'where':{'f1':'v1'}};
+            const queryString = 'SELECT org.acme.base.TestAsset WHERE (f1==\'v1\')';
+            FilterParser.parseFilter(filter1, resourceType).should.equal(queryString);
+        });
+
+        it('should throw when the where object is not specified', () => {
+            const filter1 = {'nowhere':{'f1':'v1'}};
+            (() => {FilterParser.parseFilter(filter1, resourceType);",38,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141281627,https://github.com/hyperledger/composer/pull/2229#discussion_r141281627,nklincoln
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,line break here,e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-27 08:56:00,141281804,"@@ -0,0 +1,161 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const FilterParser = require('../lib/filterparser');
+
+const chai = require('chai');
+chai.should();
+chai.use(require('chai-as-promised'));
+const resourceType = 'org.acme.base.TestAsset';
+let whereObject;
+let whereCondition;
+
+describe('FilterParser', () => {
+    beforeEach(() => {
+        new FilterParser();
+        // const filter1 = {'f1':'v1'};
+        // const filter2 = {'f1':{'gt':'v1'}} ;
+        // const filter3 = {'and|or':[{'f1':{'lte':'v1'}}, {'f2':{'neq':'v2'}}]};
+        // const filter4 =  {'and|or':[{'and|or':[{'f1':{'op':'v1'}}, {'f2':{'op':'v2'}}]}, {'f3':{'op':'v3'}}]};
+        // const queryString ={
+        //     filter1: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)',
+        //     filter2: 'SELECT org.acme.base.TestAsset WHERE (f1 <= v1)',
+        //     filter3: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)',
+        //     filter4: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)'
+        // };
+    });
+
+    describe('#parseFilter', () => {
+        it('should return the correct select statement', () => {
+            const filter1 = {'where':{'f1':'v1'}};
+            const queryString = 'SELECT org.acme.base.TestAsset WHERE (f1==\'v1\')';
+            FilterParser.parseFilter(filter1, resourceType).should.equal(queryString);
+        });
+
+        it('should throw when the where object is not specified', () => {
+            const filter1 = {'nowhere':{'f1':'v1'}};
+            (() => {FilterParser.parseFilter(filter1, resourceType);
+            }).should.throw(/The filter does not contain the where key/);
+        });
+
+    });
+
+    describe('#parseWhereCondition', () => {
+        it('should return the string value of a where condition', () => {
+            whereObject = {'f1':'v1'};
+            whereCondition = '(f1==\'v1\')';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should return an integer value of a where condition', () => {
+            whereObject = {'f1':10};
+            whereCondition = '(f1==10)';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should return a where condition with a great than operator', () => {
+            whereObject = {'f1':{'gt':'v1'}};
+            whereCondition = '(f1>v1)';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should throw when a where condition with a parameter', () => {
+            (() => {
+                whereObject = {'f1':'_$param'};
+                FilterParser.parseWhereCondition(whereObject);
+            }).should.throw(/The filter where does not support a parameter/);
+        });
+
+        it('should throw when a where condition with an unsupported operator', () => {
+            (() => {
+                whereObject = {'f1':{'unknown':'v1'}};
+                FilterParser.parseWhereCondition(whereObject);
+            }).should.throw(/The key unknown operator is not supported by the Composer filter where/);
+        });",93,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141281804,https://github.com/hyperledger/composer/pull/2229#discussion_r141281804,nklincoln
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,line break,e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-27 08:56:10,141281875,"@@ -0,0 +1,161 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const FilterParser = require('../lib/filterparser');
+
+const chai = require('chai');
+chai.should();
+chai.use(require('chai-as-promised'));
+const resourceType = 'org.acme.base.TestAsset';
+let whereObject;
+let whereCondition;
+
+describe('FilterParser', () => {
+    beforeEach(() => {
+        new FilterParser();
+        // const filter1 = {'f1':'v1'};
+        // const filter2 = {'f1':{'gt':'v1'}} ;
+        // const filter3 = {'and|or':[{'f1':{'lte':'v1'}}, {'f2':{'neq':'v2'}}]};
+        // const filter4 =  {'and|or':[{'and|or':[{'f1':{'op':'v1'}}, {'f2':{'op':'v2'}}]}, {'f3':{'op':'v3'}}]};
+        // const queryString ={
+        //     filter1: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)',
+        //     filter2: 'SELECT org.acme.base.TestAsset WHERE (f1 <= v1)',
+        //     filter3: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)',
+        //     filter4: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)'
+        // };
+    });
+
+    describe('#parseFilter', () => {
+        it('should return the correct select statement', () => {
+            const filter1 = {'where':{'f1':'v1'}};
+            const queryString = 'SELECT org.acme.base.TestAsset WHERE (f1==\'v1\')';
+            FilterParser.parseFilter(filter1, resourceType).should.equal(queryString);
+        });
+
+        it('should throw when the where object is not specified', () => {
+            const filter1 = {'nowhere':{'f1':'v1'}};
+            (() => {FilterParser.parseFilter(filter1, resourceType);
+            }).should.throw(/The filter does not contain the where key/);
+        });
+
+    });
+
+    describe('#parseWhereCondition', () => {
+        it('should return the string value of a where condition', () => {
+            whereObject = {'f1':'v1'};
+            whereCondition = '(f1==\'v1\')';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should return an integer value of a where condition', () => {
+            whereObject = {'f1':10};
+            whereCondition = '(f1==10)';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should return a where condition with a great than operator', () => {
+            whereObject = {'f1':{'gt':'v1'}};
+            whereCondition = '(f1>v1)';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should throw when a where condition with a parameter', () => {
+            (() => {
+                whereObject = {'f1':'_$param'};
+                FilterParser.parseWhereCondition(whereObject);
+            }).should.throw(/The filter where does not support a parameter/);
+        });
+
+        it('should throw when a where condition with an unsupported operator', () => {
+            (() => {
+                whereObject = {'f1':{'unknown':'v1'}};
+                FilterParser.parseWhereCondition(whereObject);
+            }).should.throw(/The key unknown operator is not supported by the Composer filter where/);
+        });
+        it('should throw when a field value has more than one keys', () => {
+            (() => {
+                whereObject = {'f1':{'lte':'v1', 'gt':'v2'}};
+                FilterParser.parseWhereCondition(whereObject);
+            }).should.throw(/An invalid operator for the object value/);
+        });
+
+        it('should return when a where condition with a between operator', () => {
+            whereObject = {'f1':{'between':'[1,10]'}};
+            whereCondition = '(f1>=1 AND f1<=10)';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should return when a where condition with a combination of the and operation', () => {
+            whereObject = {'and':[{'f1':{'lte':'v1'}}, {'f2':{'neq':'v2'}}]};
+            whereCondition = '((f1<=v1) AND (f2!=v2))';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+        it('should return when a where condition with a combination of the or operation', () => {",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141281875,https://github.com/hyperledger/composer/pull/2229#discussion_r141281875,nklincoln
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,line break,e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-27 08:56:19,141281916,"@@ -0,0 +1,161 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const FilterParser = require('../lib/filterparser');
+
+const chai = require('chai');
+chai.should();
+chai.use(require('chai-as-promised'));
+const resourceType = 'org.acme.base.TestAsset';
+let whereObject;
+let whereCondition;
+
+describe('FilterParser', () => {
+    beforeEach(() => {
+        new FilterParser();
+        // const filter1 = {'f1':'v1'};
+        // const filter2 = {'f1':{'gt':'v1'}} ;
+        // const filter3 = {'and|or':[{'f1':{'lte':'v1'}}, {'f2':{'neq':'v2'}}]};
+        // const filter4 =  {'and|or':[{'and|or':[{'f1':{'op':'v1'}}, {'f2':{'op':'v2'}}]}, {'f3':{'op':'v3'}}]};
+        // const queryString ={
+        //     filter1: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)',
+        //     filter2: 'SELECT org.acme.base.TestAsset WHERE (f1 <= v1)',
+        //     filter3: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)',
+        //     filter4: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)'
+        // };
+    });
+
+    describe('#parseFilter', () => {
+        it('should return the correct select statement', () => {
+            const filter1 = {'where':{'f1':'v1'}};
+            const queryString = 'SELECT org.acme.base.TestAsset WHERE (f1==\'v1\')';
+            FilterParser.parseFilter(filter1, resourceType).should.equal(queryString);
+        });
+
+        it('should throw when the where object is not specified', () => {
+            const filter1 = {'nowhere':{'f1':'v1'}};
+            (() => {FilterParser.parseFilter(filter1, resourceType);
+            }).should.throw(/The filter does not contain the where key/);
+        });
+
+    });
+
+    describe('#parseWhereCondition', () => {
+        it('should return the string value of a where condition', () => {
+            whereObject = {'f1':'v1'};
+            whereCondition = '(f1==\'v1\')';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should return an integer value of a where condition', () => {
+            whereObject = {'f1':10};
+            whereCondition = '(f1==10)';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should return a where condition with a great than operator', () => {
+            whereObject = {'f1':{'gt':'v1'}};
+            whereCondition = '(f1>v1)';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should throw when a where condition with a parameter', () => {
+            (() => {
+                whereObject = {'f1':'_$param'};
+                FilterParser.parseWhereCondition(whereObject);
+            }).should.throw(/The filter where does not support a parameter/);
+        });
+
+        it('should throw when a where condition with an unsupported operator', () => {
+            (() => {
+                whereObject = {'f1':{'unknown':'v1'}};
+                FilterParser.parseWhereCondition(whereObject);
+            }).should.throw(/The key unknown operator is not supported by the Composer filter where/);
+        });
+        it('should throw when a field value has more than one keys', () => {
+            (() => {
+                whereObject = {'f1':{'lte':'v1', 'gt':'v2'}};
+                FilterParser.parseWhereCondition(whereObject);
+            }).should.throw(/An invalid operator for the object value/);
+        });
+
+        it('should return when a where condition with a between operator', () => {
+            whereObject = {'f1':{'between':'[1,10]'}};
+            whereCondition = '(f1>=1 AND f1<=10)';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should return when a where condition with a combination of the and operation', () => {
+            whereObject = {'and':[{'f1':{'lte':'v1'}}, {'f2':{'neq':'v2'}}]};
+            whereCondition = '((f1<=v1) AND (f2!=v2))';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+        it('should return when a where condition with a combination of the or operation', () => {
+            whereObject = {'or':[{'f1':{'lte':'v1'}}, {'f2':{'neq':'v2'}}]};
+            whereCondition = '((f1<=v1) OR (f2!=v2))';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should throw when a where condition with an unknown combination operator', () => {
+            whereObject = {'unknown':[{'f1':{'lte':'v1'}}, {'f2':{'neq':'v2'}}]};
+            (() => {
+                FilterParser.parseWhereCondition(whereObject);
+            }).should.throw(/The combination operator: unknown is not supported by the Composer filter where/);
+        });
+
+        it('should throw when a where condition with a valid combination operator but with only one condiiton', () => {
+            whereObject = {'and':[{'f1':{'lte':'v1'}}, ]};
+            (() => {
+                FilterParser.parseWhereCondition(whereObject);
+            }).should.throw(/The combination operator: and should have two conditions/);
+        });
+
+        it('should throw when the where object is null', () => {
+            (() => {
+                FilterParser.parseWhereCondition(null);
+            }).should.throw(/The where object is not specified/);
+        });
+
+        it('should throw when the where object is undefined', () => {
+            (() => {
+                FilterParser.parseWhereCondition(undefined);
+            }).should.throw(/The where object is not specified/);
+        });
+
+        it('should throw when the where object has an empty key', () => {
+            (() => {
+                FilterParser.parseWhereCondition({});
+            }).should.throw(/The where object does not have one key/);
+        });
+        it('should throw when the where object key is undefind', () => {",189,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141281916,https://github.com/hyperledger/composer/pull/2229#discussion_r141281916,nklincoln
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,line break,e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-27 08:56:28,141281955,"@@ -0,0 +1,161 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const FilterParser = require('../lib/filterparser');
+
+const chai = require('chai');
+chai.should();
+chai.use(require('chai-as-promised'));
+const resourceType = 'org.acme.base.TestAsset';
+let whereObject;
+let whereCondition;
+
+describe('FilterParser', () => {
+    beforeEach(() => {
+        new FilterParser();
+        // const filter1 = {'f1':'v1'};
+        // const filter2 = {'f1':{'gt':'v1'}} ;
+        // const filter3 = {'and|or':[{'f1':{'lte':'v1'}}, {'f2':{'neq':'v2'}}]};
+        // const filter4 =  {'and|or':[{'and|or':[{'f1':{'op':'v1'}}, {'f2':{'op':'v2'}}]}, {'f3':{'op':'v3'}}]};
+        // const queryString ={
+        //     filter1: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)',
+        //     filter2: 'SELECT org.acme.base.TestAsset WHERE (f1 <= v1)',
+        //     filter3: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)',
+        //     filter4: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)'
+        // };
+    });
+
+    describe('#parseFilter', () => {
+        it('should return the correct select statement', () => {
+            const filter1 = {'where':{'f1':'v1'}};
+            const queryString = 'SELECT org.acme.base.TestAsset WHERE (f1==\'v1\')';
+            FilterParser.parseFilter(filter1, resourceType).should.equal(queryString);
+        });
+
+        it('should throw when the where object is not specified', () => {
+            const filter1 = {'nowhere':{'f1':'v1'}};
+            (() => {FilterParser.parseFilter(filter1, resourceType);
+            }).should.throw(/The filter does not contain the where key/);
+        });
+
+    });
+
+    describe('#parseWhereCondition', () => {
+        it('should return the string value of a where condition', () => {
+            whereObject = {'f1':'v1'};
+            whereCondition = '(f1==\'v1\')';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should return an integer value of a where condition', () => {
+            whereObject = {'f1':10};
+            whereCondition = '(f1==10)';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should return a where condition with a great than operator', () => {
+            whereObject = {'f1':{'gt':'v1'}};
+            whereCondition = '(f1>v1)';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should throw when a where condition with a parameter', () => {
+            (() => {
+                whereObject = {'f1':'_$param'};
+                FilterParser.parseWhereCondition(whereObject);
+            }).should.throw(/The filter where does not support a parameter/);
+        });
+
+        it('should throw when a where condition with an unsupported operator', () => {
+            (() => {
+                whereObject = {'f1':{'unknown':'v1'}};
+                FilterParser.parseWhereCondition(whereObject);
+            }).should.throw(/The key unknown operator is not supported by the Composer filter where/);
+        });
+        it('should throw when a field value has more than one keys', () => {
+            (() => {
+                whereObject = {'f1':{'lte':'v1', 'gt':'v2'}};
+                FilterParser.parseWhereCondition(whereObject);
+            }).should.throw(/An invalid operator for the object value/);
+        });
+
+        it('should return when a where condition with a between operator', () => {
+            whereObject = {'f1':{'between':'[1,10]'}};
+            whereCondition = '(f1>=1 AND f1<=10)';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should return when a where condition with a combination of the and operation', () => {
+            whereObject = {'and':[{'f1':{'lte':'v1'}}, {'f2':{'neq':'v2'}}]};
+            whereCondition = '((f1<=v1) AND (f2!=v2))';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+        it('should return when a where condition with a combination of the or operation', () => {
+            whereObject = {'or':[{'f1':{'lte':'v1'}}, {'f2':{'neq':'v2'}}]};
+            whereCondition = '((f1<=v1) OR (f2!=v2))';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should throw when a where condition with an unknown combination operator', () => {
+            whereObject = {'unknown':[{'f1':{'lte':'v1'}}, {'f2':{'neq':'v2'}}]};
+            (() => {
+                FilterParser.parseWhereCondition(whereObject);
+            }).should.throw(/The combination operator: unknown is not supported by the Composer filter where/);
+        });
+
+        it('should throw when a where condition with a valid combination operator but with only one condiiton', () => {
+            whereObject = {'and':[{'f1':{'lte':'v1'}}, ]};
+            (() => {
+                FilterParser.parseWhereCondition(whereObject);
+            }).should.throw(/The combination operator: and should have two conditions/);
+        });
+
+        it('should throw when the where object is null', () => {
+            (() => {
+                FilterParser.parseWhereCondition(null);
+            }).should.throw(/The where object is not specified/);
+        });
+
+        it('should throw when the where object is undefined', () => {
+            (() => {
+                FilterParser.parseWhereCondition(undefined);
+            }).should.throw(/The where object is not specified/);
+        });
+
+        it('should throw when the where object has an empty key', () => {
+            (() => {
+                FilterParser.parseWhereCondition({});
+            }).should.throw(/The where object does not have one key/);
+        });
+        it('should throw when the where object key is undefind', () => {
+            (() => {
+                FilterParser.parseWhereCondition({'' :'v1'});
+            }).should.throw(/The where object key is invalid/);
+        });
+
+        it('should throw when the where object value is null', () => {
+            (() => {
+                FilterParser.parseWhereCondition({'key1' : null});
+            }).should.throw(/The object value is invalid/);
+        });",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141281955,https://github.com/hyperledger/composer/pull/2229#discussion_r141281955,nklincoln
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,"Looking at the error messages coming back, it is difficult to see exactly what the wrong 'item' that is causing the error actually is - the actual item causing the rejection should be indicated by enclosing it within quotes or square brackets",e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-27 09:08:57,141285306,"@@ -0,0 +1,161 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const FilterParser = require('../lib/filterparser');
+
+const chai = require('chai');
+chai.should();
+chai.use(require('chai-as-promised'));
+const resourceType = 'org.acme.base.TestAsset';
+let whereObject;
+let whereCondition;
+
+describe('FilterParser', () => {
+    beforeEach(() => {
+        new FilterParser();
+        // const filter1 = {'f1':'v1'};
+        // const filter2 = {'f1':{'gt':'v1'}} ;
+        // const filter3 = {'and|or':[{'f1':{'lte':'v1'}}, {'f2':{'neq':'v2'}}]};
+        // const filter4 =  {'and|or':[{'and|or':[{'f1':{'op':'v1'}}, {'f2':{'op':'v2'}}]}, {'f3':{'op':'v3'}}]};
+        // const queryString ={
+        //     filter1: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)',
+        //     filter2: 'SELECT org.acme.base.TestAsset WHERE (f1 <= v1)',
+        //     filter3: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)',
+        //     filter4: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)'
+        // };
+    });
+
+    describe('#parseFilter', () => {
+        it('should return the correct select statement', () => {
+            const filter1 = {'where':{'f1':'v1'}};
+            const queryString = 'SELECT org.acme.base.TestAsset WHERE (f1==\'v1\')';
+            FilterParser.parseFilter(filter1, resourceType).should.equal(queryString);
+        });
+
+        it('should throw when the where object is not specified', () => {
+            const filter1 = {'nowhere':{'f1':'v1'}};
+            (() => {FilterParser.parseFilter(filter1, resourceType);
+            }).should.throw(/The filter does not contain the where key/);
+        });
+
+    });
+
+    describe('#parseWhereCondition', () => {
+        it('should return the string value of a where condition', () => {
+            whereObject = {'f1':'v1'};
+            whereCondition = '(f1==\'v1\')';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should return an integer value of a where condition', () => {
+            whereObject = {'f1':10};
+            whereCondition = '(f1==10)';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should return a where condition with a great than operator', () => {
+            whereObject = {'f1':{'gt':'v1'}};
+            whereCondition = '(f1>v1)';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should throw when a where condition with a parameter', () => {
+            (() => {
+                whereObject = {'f1':'_$param'};
+                FilterParser.parseWhereCondition(whereObject);
+            }).should.throw(/The filter where does not support a parameter/);
+        });
+
+        it('should throw when a where condition with an unsupported operator', () => {
+            (() => {
+                whereObject = {'f1':{'unknown':'v1'}};
+                FilterParser.parseWhereCondition(whereObject);
+            }).should.throw(/The key unknown operator is not supported by the Composer filter where/);
+        });
+        it('should throw when a field value has more than one keys', () => {
+            (() => {
+                whereObject = {'f1':{'lte':'v1', 'gt':'v2'}};
+                FilterParser.parseWhereCondition(whereObject);
+            }).should.throw(/An invalid operator for the object value/);
+        });
+
+        it('should return when a where condition with a between operator', () => {
+            whereObject = {'f1':{'between':'[1,10]'}};
+            whereCondition = '(f1>=1 AND f1<=10)';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should return when a where condition with a combination of the and operation', () => {
+            whereObject = {'and':[{'f1':{'lte':'v1'}}, {'f2':{'neq':'v2'}}]};
+            whereCondition = '((f1<=v1) AND (f2!=v2))';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+        it('should return when a where condition with a combination of the or operation', () => {
+            whereObject = {'or':[{'f1':{'lte':'v1'}}, {'f2':{'neq':'v2'}}]};
+            whereCondition = '((f1<=v1) OR (f2!=v2))';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should throw when a where condition with an unknown combination operator', () => {
+            whereObject = {'unknown':[{'f1':{'lte':'v1'}}, {'f2':{'neq':'v2'}}]};
+            (() => {
+                FilterParser.parseWhereCondition(whereObject);
+            }).should.throw(/The combination operator: unknown is not supported by the Composer filter where/);",162,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141285306,https://github.com/hyperledger/composer/pull/2229#discussion_r141285306,nklincoln
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,"The above example is shown in the document but then the doc says using the time property for querying.  Also the LoopBack document refers below syntax for the query:
`{where: {property: value}}`
or
`{where: {property: {op: value}}}`
It does not mention the multiple properties here. We can support multiple primitive properties 
here. 
We can use the `and`operation as an alternative way to query multiple properties.

",e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-27 09:15:32,141286969,"@@ -0,0 +1,150 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const Logger = require('composer-common').Logger;
+const LOG = Logger.getLog('FilterParser');
+const operationmap = {'=': '==', 'gt': '>', 'gte': '>=', 'lt': '<', 'lte': '<=', 'between': 'between', 'neq': '!='};
+const operationmapKeys = Object.keys(operationmap);
+const arrayCombinationOperators = {
+    'and': 'AND',
+    'or': 'OR'
+};
+
+/**
+ * The fillter parser parse the filter where string and translate the filter JSON object to be a composer query statement
+ ** @class
+ *
+ */
+class FilterParser {
+    /**
+     * Constructor.
+     *
+     * @private
+     */
+    constructor() {
+        const method = 'constructor';
+        LOG.entry(method);
+        LOG.exit(method);
+    }
+    /**
+     * parse a filter string and convert the where conditions to be a composer query statement
+     * examples of the where filter:
+     * filter0 = {'where':{'field1':'value1'}}
+     * filter1 = {'where':{'field1':{'between':'[value1:value2]'}}}
+     * filter2 = {'where':{'or':[{'field1':{'gt':'value1'}},{'field2':{'lte':'value2'}}]}}
+     * filter4 = {'where': {'and':[{'or':[{'f1':{'gt':'v1'}}, {'f2':{'lt':'v2'}}]}, {'and':[{'f3':{'lte':'v3'}},{'or':[{'f4':{'neq':'v4'}}, {'f5':{'lt':'v5'}}]}]}]}}
+     * @param {Object} filter The filter being parsed.
+     * @param {string} resourceType The type of the resource: asset or participant
+     * @return {string} The result of filter parser, or null.
+     * @public
+     */
+    static parseFilter(filter, resourceType) {
+        const method = 'parseFilter';
+        LOG.entry(method, JSON.stringify(filter));
+
+        let result = null;
+        let filterKeys = Object.keys(filter);
+
+        if (filterKeys.indexOf('where') >= 0) {
+            result = this.parseWhereCondition(filter.where);
+            // if there is an op
+            result = 'SELECT ' + resourceType + ' WHERE ' + result;
+        } else{
+            throw new Error('The filter does not contain the where key');
+        }
+        LOG.exit(method);
+        return result;
+    }
+    /**
+     * parse the filter where conditions and convert the conditions to be the query language statement
+     * @example the filter conditions
+     * {""f1"":""v1""} or {""f1"":{""op"":""v1""}} or
+     * {""and|or"":[{""f1"":{""op"":""v1""}}, {""f2"":{""op"":""v2""}}]}, or
+     * {'and|or':[{'and|or':[{'f1':{'op':'v1'}}, {'f2':{'op':'v2'}}]}, {'f3':{'op':'v3'}}]};
+     * and so on with nested structures
+     * @param {Object} whereObject  is a JSON object with the format as above examples
+     * @return {string} a string condition (f1 == v1) or (f1 > v1) or recurively call this function, throw exceptions when the operators are not supported
+     * @public
+     */
+    static parseWhereCondition(whereObject) {
+        const method = 'parseWhereCondition';
+        LOG.entry(method, JSON.stringify(whereObject));
+        if(typeof whereObject === 'undefined'|| whereObject === null){
+            throw new Error('The where object is not specified');
+        }
+        const keys = Object.keys(whereObject);
+        const combinationOperatorKeys = Object.keys(arrayCombinationOperators);
+        if(keys.length === 1){",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141286969,https://github.com/hyperledger/composer/pull/2229#discussion_r141286969,fenglianxu
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,added an error check here.,e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-27 09:16:16,141287144,"@@ -0,0 +1,150 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const Logger = require('composer-common').Logger;
+const LOG = Logger.getLog('FilterParser');
+const operationmap = {'=': '==', 'gt': '>', 'gte': '>=', 'lt': '<', 'lte': '<=', 'between': 'between', 'neq': '!='};
+const operationmapKeys = Object.keys(operationmap);
+const arrayCombinationOperators = {
+    'and': 'AND',
+    'or': 'OR'
+};
+
+/**
+ * The fillter parser parse the filter where string and translate the filter JSON object to be a composer query statement
+ ** @class
+ *
+ */
+class FilterParser {
+    /**
+     * Constructor.
+     *
+     * @private
+     */
+    constructor() {
+        const method = 'constructor';
+        LOG.entry(method);
+        LOG.exit(method);
+    }
+    /**
+     * parse a filter string and convert the where conditions to be a composer query statement
+     * examples of the where filter:
+     * filter0 = {'where':{'field1':'value1'}}
+     * filter1 = {'where':{'field1':{'between':'[value1:value2]'}}}
+     * filter2 = {'where':{'or':[{'field1':{'gt':'value1'}},{'field2':{'lte':'value2'}}]}}
+     * filter4 = {'where': {'and':[{'or':[{'f1':{'gt':'v1'}}, {'f2':{'lt':'v2'}}]}, {'and':[{'f3':{'lte':'v3'}},{'or':[{'f4':{'neq':'v4'}}, {'f5':{'lt':'v5'}}]}]}]}}
+     * @param {Object} filter The filter being parsed.
+     * @param {string} resourceType The type of the resource: asset or participant
+     * @return {string} The result of filter parser, or null.
+     * @public
+     */
+    static parseFilter(filter, resourceType) {
+        const method = 'parseFilter';
+        LOG.entry(method, JSON.stringify(filter));
+
+        let result = null;
+        let filterKeys = Object.keys(filter);
+
+        if (filterKeys.indexOf('where') >= 0) {
+            result = this.parseWhereCondition(filter.where);
+            // if there is an op
+            result = 'SELECT ' + resourceType + ' WHERE ' + result;
+        } else{
+            throw new Error('The filter does not contain the where key');
+        }
+        LOG.exit(method);
+        return result;
+    }
+    /**
+     * parse the filter where conditions and convert the conditions to be the query language statement
+     * @example the filter conditions
+     * {""f1"":""v1""} or {""f1"":{""op"":""v1""}} or
+     * {""and|or"":[{""f1"":{""op"":""v1""}}, {""f2"":{""op"":""v2""}}]}, or
+     * {'and|or':[{'and|or':[{'f1':{'op':'v1'}}, {'f2':{'op':'v2'}}]}, {'f3':{'op':'v3'}}]};
+     * and so on with nested structures
+     * @param {Object} whereObject  is a JSON object with the format as above examples
+     * @return {string} a string condition (f1 == v1) or (f1 > v1) or recurively call this function, throw exceptions when the operators are not supported
+     * @public
+     */
+    static parseWhereCondition(whereObject) {
+        const method = 'parseWhereCondition';
+        LOG.entry(method, JSON.stringify(whereObject));
+        if(typeof whereObject === 'undefined'|| whereObject === null){
+            throw new Error('The where object is not specified');
+        }
+        const keys = Object.keys(whereObject);
+        const combinationOperatorKeys = Object.keys(arrayCombinationOperators);
+        if(keys.length === 1){
+
+            if(keys[0].trim() ===''){
+                throw new Error('The where object key is invalid');
+            }
+
+            let values = whereObject[keys[0]];
+            if( values === null || values === undefined){
+                throw new Error('The object value is invalid');
+            }
+
+            if (typeof values === 'string') {
+                if(values.startsWith('_$')){
+                    throw new Error('The filter where does not support a parameter');
+                }
+                values = '\''+ values +'\'';
+                const result = '(' + keys[0] + '==' + values + ')';
+                return result;
+            } else if (typeof values === 'number' || typeof values === 'boolean'){
+                const result = '(' + keys[0] + '==' + values + ')';
+                return result;
+            }
+            else if(typeof values === 'object' && !(values instanceof Array)) {
+                let op = Object.keys(values);
+                if( typeof op ==='undefined' || op === null || op.length !== 1){
+                    throw new Error('An invalid operator for the object value');
+                }
+                const opValue = values[op[0]];
+                if(!operationmapKeys.includes(op[0])){
+                    throw new Error('The key ' + op[0] + ' operator is not supported by the Composer filter where');
+                }
+                let queryOp = operationmap[op[0]];
+                let result;
+                if(queryOp ==='between'){
+                    // parse the first string format array object ""[1, 10]"" to an array
+                    let theValue = JSON.parse(opValue);",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141287144,https://github.com/hyperledger/composer/pull/2229#discussion_r141287144,fenglianxu
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,"also need tests for double, long and datetime data-types",e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-27 09:16:38,141287220,"@@ -0,0 +1,161 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const FilterParser = require('../lib/filterparser');
+
+const chai = require('chai');
+chai.should();
+chai.use(require('chai-as-promised'));
+const resourceType = 'org.acme.base.TestAsset';
+let whereObject;
+let whereCondition;
+
+describe('FilterParser', () => {
+    beforeEach(() => {
+        new FilterParser();
+        // const filter1 = {'f1':'v1'};
+        // const filter2 = {'f1':{'gt':'v1'}} ;
+        // const filter3 = {'and|or':[{'f1':{'lte':'v1'}}, {'f2':{'neq':'v2'}}]};
+        // const filter4 =  {'and|or':[{'and|or':[{'f1':{'op':'v1'}}, {'f2':{'op':'v2'}}]}, {'f3':{'op':'v3'}}]};
+        // const queryString ={
+        //     filter1: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)',
+        //     filter2: 'SELECT org.acme.base.TestAsset WHERE (f1 <= v1)',
+        //     filter3: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)',
+        //     filter4: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)'
+        // };
+    });
+
+    describe('#parseFilter', () => {
+        it('should return the correct select statement', () => {
+            const filter1 = {'where':{'f1':'v1'}};
+            const queryString = 'SELECT org.acme.base.TestAsset WHERE (f1==\'v1\')';
+            FilterParser.parseFilter(filter1, resourceType).should.equal(queryString);
+        });
+
+        it('should throw when the where object is not specified', () => {
+            const filter1 = {'nowhere':{'f1':'v1'}};
+            (() => {FilterParser.parseFilter(filter1, resourceType);
+            }).should.throw(/The filter does not contain the where key/);
+        });
+
+    });
+
+    describe('#parseWhereCondition', () => {
+        it('should return the string value of a where condition', () => {
+            whereObject = {'f1':'v1'};
+            whereCondition = '(f1==\'v1\')';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should return an integer value of a where condition', () => {
+            whereObject = {'f1':10};
+            whereCondition = '(f1==10)';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+",56,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141287220,https://github.com/hyperledger/composer/pull/2229#discussion_r141287220,nklincoln
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,"also need tests for >=, <, <=",e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-27 09:17:27,141287440,"@@ -0,0 +1,161 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const FilterParser = require('../lib/filterparser');
+
+const chai = require('chai');
+chai.should();
+chai.use(require('chai-as-promised'));
+const resourceType = 'org.acme.base.TestAsset';
+let whereObject;
+let whereCondition;
+
+describe('FilterParser', () => {
+    beforeEach(() => {
+        new FilterParser();
+        // const filter1 = {'f1':'v1'};
+        // const filter2 = {'f1':{'gt':'v1'}} ;
+        // const filter3 = {'and|or':[{'f1':{'lte':'v1'}}, {'f2':{'neq':'v2'}}]};
+        // const filter4 =  {'and|or':[{'and|or':[{'f1':{'op':'v1'}}, {'f2':{'op':'v2'}}]}, {'f3':{'op':'v3'}}]};
+        // const queryString ={
+        //     filter1: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)',
+        //     filter2: 'SELECT org.acme.base.TestAsset WHERE (f1 <= v1)',
+        //     filter3: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)',
+        //     filter4: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)'
+        // };
+    });
+
+    describe('#parseFilter', () => {
+        it('should return the correct select statement', () => {
+            const filter1 = {'where':{'f1':'v1'}};
+            const queryString = 'SELECT org.acme.base.TestAsset WHERE (f1==\'v1\')';
+            FilterParser.parseFilter(filter1, resourceType).should.equal(queryString);
+        });
+
+        it('should throw when the where object is not specified', () => {
+            const filter1 = {'nowhere':{'f1':'v1'}};
+            (() => {FilterParser.parseFilter(filter1, resourceType);
+            }).should.throw(/The filter does not contain the where key/);
+        });
+
+    });
+
+    describe('#parseWhereCondition', () => {
+        it('should return the string value of a where condition', () => {
+            whereObject = {'f1':'v1'};
+            whereCondition = '(f1==\'v1\')';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should return an integer value of a where condition', () => {
+            whereObject = {'f1':10};
+            whereCondition = '(f1==10)';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should return a where condition with a great than operator', () => {
+            whereObject = {'f1':{'gt':'v1'}};
+            whereCondition = '(f1>v1)';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141287440,https://github.com/hyperledger/composer/pull/2229#discussion_r141287440,nklincoln
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,"also need tests for:
- complex and|or 
- complex nested structure (also with and|or)",e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-27 09:20:06,141288046,"@@ -0,0 +1,161 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const FilterParser = require('../lib/filterparser');
+
+const chai = require('chai');
+chai.should();
+chai.use(require('chai-as-promised'));
+const resourceType = 'org.acme.base.TestAsset';
+let whereObject;
+let whereCondition;
+
+describe('FilterParser', () => {
+    beforeEach(() => {
+        new FilterParser();
+        // const filter1 = {'f1':'v1'};
+        // const filter2 = {'f1':{'gt':'v1'}} ;
+        // const filter3 = {'and|or':[{'f1':{'lte':'v1'}}, {'f2':{'neq':'v2'}}]};
+        // const filter4 =  {'and|or':[{'and|or':[{'f1':{'op':'v1'}}, {'f2':{'op':'v2'}}]}, {'f3':{'op':'v3'}}]};
+        // const queryString ={
+        //     filter1: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)',
+        //     filter2: 'SELECT org.acme.base.TestAsset WHERE (f1 <= v1)',
+        //     filter3: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)',
+        //     filter4: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)'
+        // };
+    });
+
+    describe('#parseFilter', () => {
+        it('should return the correct select statement', () => {
+            const filter1 = {'where':{'f1':'v1'}};
+            const queryString = 'SELECT org.acme.base.TestAsset WHERE (f1==\'v1\')';
+            FilterParser.parseFilter(filter1, resourceType).should.equal(queryString);
+        });
+
+        it('should throw when the where object is not specified', () => {
+            const filter1 = {'nowhere':{'f1':'v1'}};
+            (() => {FilterParser.parseFilter(filter1, resourceType);
+            }).should.throw(/The filter does not contain the where key/);
+        });
+
+    });
+
+    describe('#parseWhereCondition', () => {
+        it('should return the string value of a where condition', () => {
+            whereObject = {'f1':'v1'};
+            whereCondition = '(f1==\'v1\')';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should return an integer value of a where condition', () => {
+            whereObject = {'f1':10};
+            whereCondition = '(f1==10)';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+
+        it('should return a where condition with a great than operator', () => {
+            whereObject = {'f1':{'gt':'v1'}};
+            whereCondition = '(f1>v1)';
+            FilterParser.parseWhereCondition(whereObject).should.equal(whereCondition);
+        });
+",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141288046,https://github.com/hyperledger/composer/pull/2229#discussion_r141288046,nklincoln
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,"As the filter supports both id and other properties now, we need to validate if the query property fields are valid in the class. This buildQuery provides this function, so I moved the BuildQuery outside the else block. I will take a look at this again to see if I can move it back.",e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-27 09:25:32,141289447,"@@ -297,10 +300,14 @@ class BusinessNetworkConnector extends Connector {
                         throw new Error('The destroyAll operation without a where clause is not supported');
                     }
                     let identifierField = this.getClassIdentifier(composerModelName);
-                    if(!filter.where[identifierField]) {
-                        throw new Error('The specified filter does not match the identifier in the model');
+                    let query = null;",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141289447,https://github.com/hyperledger/composer/pull/2229#discussion_r141289447,fenglianxu
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,newline here please (line break between tests),e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-27 09:36:43,141292209,"@@ -549,6 +550,27 @@ describe('BusinessNetworkConnector', () => {
                     result[0].theValue.should.equal('myId');
                 });
         });
+        it('should retrieve a specific Asset for a given string type property in a where clause', () => {",12,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141292209,https://github.com/hyperledger/composer/pull/2229#discussion_r141292209,nklincoln
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,would the test name not be more accurate as 'should retrieve a specific Asset for a given string type property in a filter clause'? (or similar ... mainly thinking that the 'where' item is the 'filter',e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-27 09:46:53,141294979,"@@ -549,6 +550,27 @@ describe('BusinessNetworkConnector', () => {
                     result[0].theValue.should.equal('myId');
                 });
         });
+        it('should retrieve a specific Asset for a given string type property in a where clause', () => {",12,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141294979,https://github.com/hyperledger/composer/pull/2229#discussion_r141294979,nklincoln
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,"whilst changing this, can u also delete the mock reject in line 597 - (mockAssetRegistry.get.rejects(new Error('expected test error'));  in test 'should handle an error when an invalid model name is specified')  it is not required",e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-27 09:58:39,141297812,"@@ -549,6 +550,27 @@ describe('BusinessNetworkConnector', () => {
                     result[0].theValue.should.equal('myId');
                 });
         });
+        it('should retrieve a specific Asset for a given string type property in a where clause', () => {",12,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141297812,https://github.com/hyperledger/composer/pull/2229#discussion_r141297812,nklincoln
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,"We need to support multiple properties like this:
`{where: {property: value, property2: value2, property3: value3}}`

It's not just the example I pasted above, the MongoDB connector also supports multiple properties in the where clause:
https://github.com/strongloop/loopback-connector-mongodb/blob/master/lib/mongodb.js#L687",e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-09-27 10:43:42,141306908,"@@ -0,0 +1,150 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const Logger = require('composer-common').Logger;
+const LOG = Logger.getLog('FilterParser');
+const operationmap = {'=': '==', 'gt': '>', 'gte': '>=', 'lt': '<', 'lte': '<=', 'between': 'between', 'neq': '!='};
+const operationmapKeys = Object.keys(operationmap);
+const arrayCombinationOperators = {
+    'and': 'AND',
+    'or': 'OR'
+};
+
+/**
+ * The fillter parser parse the filter where string and translate the filter JSON object to be a composer query statement
+ ** @class
+ *
+ */
+class FilterParser {
+    /**
+     * Constructor.
+     *
+     * @private
+     */
+    constructor() {
+        const method = 'constructor';
+        LOG.entry(method);
+        LOG.exit(method);
+    }
+    /**
+     * parse a filter string and convert the where conditions to be a composer query statement
+     * examples of the where filter:
+     * filter0 = {'where':{'field1':'value1'}}
+     * filter1 = {'where':{'field1':{'between':'[value1:value2]'}}}
+     * filter2 = {'where':{'or':[{'field1':{'gt':'value1'}},{'field2':{'lte':'value2'}}]}}
+     * filter4 = {'where': {'and':[{'or':[{'f1':{'gt':'v1'}}, {'f2':{'lt':'v2'}}]}, {'and':[{'f3':{'lte':'v3'}},{'or':[{'f4':{'neq':'v4'}}, {'f5':{'lt':'v5'}}]}]}]}}
+     * @param {Object} filter The filter being parsed.
+     * @param {string} resourceType The type of the resource: asset or participant
+     * @return {string} The result of filter parser, or null.
+     * @public
+     */
+    static parseFilter(filter, resourceType) {
+        const method = 'parseFilter';
+        LOG.entry(method, JSON.stringify(filter));
+
+        let result = null;
+        let filterKeys = Object.keys(filter);
+
+        if (filterKeys.indexOf('where') >= 0) {
+            result = this.parseWhereCondition(filter.where);
+            // if there is an op
+            result = 'SELECT ' + resourceType + ' WHERE ' + result;
+        } else{
+            throw new Error('The filter does not contain the where key');
+        }
+        LOG.exit(method);
+        return result;
+    }
+    /**
+     * parse the filter where conditions and convert the conditions to be the query language statement
+     * @example the filter conditions
+     * {""f1"":""v1""} or {""f1"":{""op"":""v1""}} or
+     * {""and|or"":[{""f1"":{""op"":""v1""}}, {""f2"":{""op"":""v2""}}]}, or
+     * {'and|or':[{'and|or':[{'f1':{'op':'v1'}}, {'f2':{'op':'v2'}}]}, {'f3':{'op':'v3'}}]};
+     * and so on with nested structures
+     * @param {Object} whereObject  is a JSON object with the format as above examples
+     * @return {string} a string condition (f1 == v1) or (f1 > v1) or recurively call this function, throw exceptions when the operators are not supported
+     * @public
+     */
+    static parseWhereCondition(whereObject) {
+        const method = 'parseWhereCondition';
+        LOG.entry(method, JSON.stringify(whereObject));
+        if(typeof whereObject === 'undefined'|| whereObject === null){
+            throw new Error('The where object is not specified');
+        }
+        const keys = Object.keys(whereObject);
+        const combinationOperatorKeys = Object.keys(arrayCombinationOperators);
+        if(keys.length === 1){",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/141306908,https://github.com/hyperledger/composer/pull/2229#discussion_r141306908,sstone1
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,Please delete commented out code lines,e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-10-03 14:56:19,142426786,"@@ -24,19 +24,17 @@ let whereObject;
 let whereCondition;
 
 describe('FilterParser', () => {
-    beforeEach(() => {
-        new FilterParser();
-        // const filter1 = {'f1':'v1'};
-        // const filter2 = {'f1':{'gt':'v1'}} ;
-        // const filter3 = {'and|or':[{'f1':{'lte':'v1'}}, {'f2':{'neq':'v2'}}]};
-        // const filter4 =  {'and|or':[{'and|or':[{'f1':{'op':'v1'}}, {'f2':{'op':'v2'}}]}, {'f3':{'op':'v3'}}]};
-        // const queryString ={
-        //     filter1: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)',
-        //     filter2: 'SELECT org.acme.base.TestAsset WHERE (f1 <= v1)',
-        //     filter3: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)',
-        //     filter4: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)'
-        // };
-    });
+
+    // const filter1 = {'f1':'v1'};
+    // const filter2 = {'f1':{'gt':'v1'}} ;
+    // const filter3 = {'and|or':[{'f1':{'lte':'v1'}}, {'f2':{'neq':'v2'}}]};
+    // const filter4 =  {'and|or':[{'and|or':[{'f1':{'op':'v1'}}, {'f2':{'op':'v2'}}]}, {'f3':{'op':'v3'}}]};",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/142426786,https://github.com/hyperledger/composer/pull/2229#discussion_r142426786,nklincoln
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,"This code is still broken from my previous review!

> This code needs to check that the filter.where contains identifierField but does not contain any other properties. At the moment it just throws away any other properties if identifierField is provided.",e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-10-03 16:19:49,142450625,"@@ -310,12 +310,25 @@ class BusinessNetworkConnector extends Connector {
                                 return [ result ];
                             });
 
-                    } else {
+                    } else if(objectId){",55,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/142450625,https://github.com/hyperledger/composer/pull/2229#discussion_r142450625,sstone1
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,"This code is still broken from my previous review!

> This code can now be broken because it is possible to have a filter.where which does not contain identifierField. This would result in doResolve equal to true and objectId equal to null.
If doResolve is equal to true, you need to ensure that the identifier is set and that no other properties are set.",e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-10-03 16:22:47,142451412,"@@ -294,14 +297,11 @@ class BusinessNetworkConnector extends Connector {
                 if(filterKeys.indexOf('where') >= 0) {
                     const keys = Object.keys(filter.where);
                     if (keys.length === 0) {
-                        throw new Error('The destroyAll operation without a where clause is not supported');
+                        throw new Error('The all operation without a where clause is not supported');
                     }
                     let identifierField = this.getClassIdentifier(composerModelName);
-                    if(!filter.where[identifierField]) {
-                        throw new Error('The specified filter does not match the identifier in the model');
-                    }
 
-                    // Check we have the right identifier for the object type
+                    // Check if the filter is a simple ID query
                     let objectId = filter.where[identifierField];
                     if(doResolve) {",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/142451412,https://github.com/hyperledger/composer/pull/2229#discussion_r142451412,sstone1
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,This shouldn't be possible; `buildQuery` should throw an error if `queryString` is invalid. You should not need this `if`.,e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-10-03 16:25:14,142452037,"@@ -310,12 +310,25 @@ class BusinessNetworkConnector extends Connector {
                                 return [ result ];
                             });
 
-                    } else {
+                    } else if(objectId){
                         return registry.get(objectId)
                             .then((result) => {
                                 debug('Got Result:', result);
                                 return [ this.serializer.toJSON(result) ];
                             });
+                    } else {
+                        const queryString = FilterParser.parseFilter(filter, composerModelName);
+                        const query = networkConnection.buildQuery(queryString);
+                        if(typeof query === 'undefined'|| query === null) {",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/142452037,https://github.com/hyperledger/composer/pull/2229#discussion_r142452037,sstone1
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,removed these lines,e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-10-03 17:04:00,142461906,"@@ -24,19 +24,17 @@ let whereObject;
 let whereCondition;
 
 describe('FilterParser', () => {
-    beforeEach(() => {
-        new FilterParser();
-        // const filter1 = {'f1':'v1'};
-        // const filter2 = {'f1':{'gt':'v1'}} ;
-        // const filter3 = {'and|or':[{'f1':{'lte':'v1'}}, {'f2':{'neq':'v2'}}]};
-        // const filter4 =  {'and|or':[{'and|or':[{'f1':{'op':'v1'}}, {'f2':{'op':'v2'}}]}, {'f3':{'op':'v3'}}]};
-        // const queryString ={
-        //     filter1: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)',
-        //     filter2: 'SELECT org.acme.base.TestAsset WHERE (f1 <= v1)',
-        //     filter3: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)',
-        //     filter4: 'SELECT org.acme.base.TestAsset WHERE (f1 == v1)'
-        // };
-    });
+
+    // const filter1 = {'f1':'v1'};
+    // const filter2 = {'f1':{'gt':'v1'}} ;
+    // const filter3 = {'and|or':[{'f1':{'lte':'v1'}}, {'f2':{'neq':'v2'}}]};
+    // const filter4 =  {'and|or':[{'and|or':[{'f1':{'op':'v1'}}, {'f2':{'op':'v2'}}]}, {'f3':{'op':'v3'}}]};",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/142461906,https://github.com/hyperledger/composer/pull/2229#discussion_r142461906,fenglianxu
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,@sstone1 @nklincoln  Thank you both for reviewing the code and I have updated the code per your comments.  Please review them again.,e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-10-04 14:57:23,142695657,"@@ -310,12 +310,25 @@ class BusinessNetworkConnector extends Connector {
                                 return [ result ];
                             });
 
-                    } else {
+                    } else if(objectId){
                         return registry.get(objectId)
                             .then((result) => {
                                 debug('Got Result:', result);
                                 return [ this.serializer.toJSON(result) ];
                             });
+                    } else {
+                        const queryString = FilterParser.parseFilter(filter, composerModelName);
+                        const query = networkConnection.buildQuery(queryString);
+                        if(typeof query === 'undefined'|| query === null) {",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/142695657,https://github.com/hyperledger/composer/pull/2229#discussion_r142695657,fenglianxu
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,"@sstone1 Have updated the count function code, please review the updated code.
",e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-10-04 21:33:14,142798700,"@@ -303,9 +303,8 @@ class BusinessNetworkConnector extends Connector {
                     let identifierField = this.getClassIdentifier(composerModelName);
 
                     // when an id is specified in the filter where and
-                    // if( nKeys === 1 && keys[0] === identifierField ){
 
-                        // Check if the filter is a simple ID query
+                    // Check if the filter is a simple ID query
                     let objectId = filter.where[identifierField];
 
                     if(doResolve) {",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/142798700,https://github.com/hyperledger/composer/pull/2229#discussion_r142798700,fenglianxu
https://github.com/hyperledger/composer/pull/2229,https://github.com/hyperledger/composer/pull/2229,This is updated now,e8bf448b7a485091cbd85cb84525eb1e5729fc3d,2017-10-04 21:58:00,142803997,"@@ -294,14 +297,11 @@ class BusinessNetworkConnector extends Connector {
                 if(filterKeys.indexOf('where') >= 0) {
                     const keys = Object.keys(filter.where);
                     if (keys.length === 0) {
-                        throw new Error('The destroyAll operation without a where clause is not supported');
+                        throw new Error('The all operation without a where clause is not supported');
                     }
                     let identifierField = this.getClassIdentifier(composerModelName);
-                    if(!filter.where[identifierField]) {
-                        throw new Error('The specified filter does not match the identifier in the model');
-                    }
 
-                    // Check we have the right identifier for the object type
+                    // Check if the filter is a simple ID query
                     let objectId = filter.where[identifierField];
                     if(doResolve) {",,2017-10-05 15:29:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/142803997,https://github.com/hyperledger/composer/pull/2229#discussion_r142803997,fenglianxu
https://github.com/hyperledger/composer/pull/2212,https://github.com/hyperledger/composer/pull/2212,Ooh!,abcb5558f3de7ded0213eba9a12373051b64da7c,2017-09-22 16:36:01,140540075,"@@ -8,5 +8,5 @@ check:
     global:
         statements: 99
         branches: 96.3
-        functions: 98.9",4,2017-09-22 17:27:51,https://api.github.com/repos/hyperledger/composer/pulls/comments/140540075,https://github.com/hyperledger/composer/pull/2212#discussion_r140540075,dselman
https://github.com/hyperledger/composer/pull/2212,https://github.com/hyperledger/composer/pull/2212,"Yep...

![image](https://user-images.githubusercontent.com/3535067/30755020-e4f8d318-9fbc-11e7-85f9-3c655001e115.png)
",abcb5558f3de7ded0213eba9a12373051b64da7c,2017-09-22 16:39:09,140540727,"@@ -8,5 +8,5 @@ check:
     global:
         statements: 99
         branches: 96.3
-        functions: 98.9",4,2017-09-22 17:27:51,https://api.github.com/repos/hyperledger/composer/pulls/comments/140540727,https://github.com/hyperledger/composer/pull/2212#discussion_r140540727,jt-nti
https://github.com/hyperledger/composer/pull/2210,https://github.com/hyperledger/composer/pull/2210,This should be `options`,9ced9fcd3b908c974df39c7e64c4aefaee337fc0,2017-09-22 23:23:21,140614722,"@@ -73,22 +73,25 @@ class Util {
      * @param {SecurityContext} securityContext - The user's security context
      * @param {string} functionName - The name of the function to call.
      * @param {string[]} args - The arguments to pass to the function being called.
+     * @param {string} txId - Transaction Id to use",,2017-10-02 17:27:33,https://api.github.com/repos/hyperledger/composer/pulls/comments/140614722,https://github.com/hyperledger/composer/pull/2210#discussion_r140614722,sstone1
https://github.com/hyperledger/composer/pull/2210,https://github.com/hyperledger/composer/pull/2210,"@mbwhite another y u no run `npm test`!

```
lerna ERR! execute /home/travis/build/hyperledger/composer/packages/composer-common/lib/util.js
lerna ERR! execute   71:5  error  Expected JSDoc for 'options' but found 'txId'  valid-jsdoc
```",9ced9fcd3b908c974df39c7e64c4aefaee337fc0,2017-09-22 23:54:41,140617436,"@@ -73,22 +73,25 @@ class Util {
      * @param {SecurityContext} securityContext - The user's security context
      * @param {string} functionName - The name of the function to call.
      * @param {string[]} args - The arguments to pass to the function being called.
+     * @param {string} txId - Transaction Id to use",,2017-10-02 17:27:33,https://api.github.com/repos/hyperledger/composer/pulls/comments/140617436,https://github.com/hyperledger/composer/pull/2210#discussion_r140617436,sstone1
https://github.com/hyperledger/composer/pull/2210,https://github.com/hyperledger/composer/pull/2210,"I think we try to provide details of the options that can be accepted, for example
```
     * @param {Object} deployOptions connector specific deployment options
     * @param {string} deployOptions.logLevel the level of logging for the composer runtime
     * @param {any} deployOptions.endorsementPolicy the endorsement policy (either a JSON string or Object) as defined by fabric node sdk
     * @param {String} deployOptions.endorsementPolicyFile the endorsement policy json file containing the endorsement policy
```",9ced9fcd3b908c974df39c7e64c4aefaee337fc0,2017-09-25 13:56:28,140782684,"@@ -73,22 +73,25 @@ class Util {
      * @param {SecurityContext} securityContext - The user's security context
      * @param {string} functionName - The name of the function to call.
      * @param {string[]} args - The arguments to pass to the function being called.
+     * @param {Object} options - Any options to use for the invocation",,2017-10-02 17:27:33,https://api.github.com/repos/hyperledger/composer/pulls/comments/140782684,https://github.com/hyperledger/composer/pull/2210#discussion_r140782684,davidkel
https://github.com/hyperledger/composer/pull/2210,https://github.com/hyperledger/composer/pull/2210,"same here about possible option values, plus the text for options doesn't quite read correctly",9ced9fcd3b908c974df39c7e64c4aefaee337fc0,2017-09-25 13:57:15,140782914,"@@ -763,10 +763,11 @@ class HLFConnection extends Connection {
      * @param {SecurityContext} securityContext The participant's security context.
      * @param {string} functionName The name of the chaincode function to invoke.
      * @param {string[]} args The arguments to pass to the chaincode function.
+     * @param {object} options Options that might be requried to for this connection",,2017-10-02 17:27:33,https://api.github.com/repos/hyperledger/composer/pulls/comments/140782914,https://github.com/hyperledger/composer/pull/2210#discussion_r140782914,davidkel
https://github.com/hyperledger/composer/pull/2210,https://github.com/hyperledger/composer/pull/2210,These are optional (according to the code) so the JSDoc comments need wrapping with `[` and `]`.,9ced9fcd3b908c974df39c7e64c4aefaee337fc0,2017-10-02 10:15:43,142101277,"@@ -64,31 +64,34 @@ class Util {
             }
         });
 
-        return securityContext.getConnection().queryChainCode(securityContext, functionName, args)
-;
+        return securityContext.getConnection().queryChainCode(securityContext, functionName, args);
     }
 
     /**
      * Submit an invoke request to the chain-code
      * @param {SecurityContext} securityContext - The user's security context
      * @param {string} functionName - The name of the function to call.
      * @param {string[]} args - The arguments to pass to the function being called.
+     * @param {Object} options - options to pass to the invoking chain code
+     * @param {Object} options.transactionId Transaction Id to use.",15,2017-10-02 17:27:33,https://api.github.com/repos/hyperledger/composer/pulls/comments/142101277,https://github.com/hyperledger/composer/pull/2210#discussion_r142101277,sstone1
https://github.com/hyperledger/composer/pull/2210,https://github.com/hyperledger/composer/pull/2210,These are optional (according to the code) so the JSDoc comments need wrapping with `[` and `]`.,9ced9fcd3b908c974df39c7e64c4aefaee337fc0,2017-10-02 10:15:48,142101292,"@@ -507,9 +509,11 @@ class Connection extends EventEmitter {
      * @param {SecurityContext} securityContext The participant's security context.
      * @param {string} functionName The name of the chaincode function to invoke.
      * @param {string[]} args The arguments to pass to the chaincode function.
+     * @param {Object} options options for the invoking chain code
+     * @param {Object} options.transactionId Transaction Id to use.",,2017-10-02 17:27:33,https://api.github.com/repos/hyperledger/composer/pulls/comments/142101292,https://github.com/hyperledger/composer/pull/2210#discussion_r142101292,sstone1
https://github.com/hyperledger/composer/pull/2210,https://github.com/hyperledger/composer/pull/2210,These are optional (according to the code) so the JSDoc comments need wrapping with `[` and `]`.,9ced9fcd3b908c974df39c7e64c4aefaee337fc0,2017-10-02 10:15:51,142101298,"@@ -481,12 +481,14 @@ class Connection extends EventEmitter {
      * @param {SecurityContext} securityContext The participant's security context.
      * @param {string} functionName The name of the chaincode function to invoke.
      * @param {string[]} args The arguments to pass to the chaincode function.
+     * @param {Object} options Options for the invoking chaing code to use
+     * @param {Object} options.transactionId Transaction Id to use.",,2017-10-02 17:27:33,https://api.github.com/repos/hyperledger/composer/pulls/comments/142101298,https://github.com/hyperledger/composer/pull/2210#discussion_r142101298,sstone1
https://github.com/hyperledger/composer/pull/2203,https://github.com/hyperledger/composer/pull/2203,Looks like this section needs a little more loving,249cc86dde9b82bdb6a65d53d36a9f2cdb614522,2017-09-22 10:32:28,140461490,"@@ -18,19 +18,45 @@ __Assumption__ is that stories have been closed off properly
 
 ## Process
 
-We wish to validate three core aspects:
+# Core Aspects
+We wish to validate all core aspects:
  - [User guides](./guide-validation.md)
  - [Runtime](./runtime-validation.md)
  - [Playground](./playground-validation.md)
  - [CLI](./cli-validation.md)
 
 Each link above will provide a guide for validation purposes. It should be possible to follow the guides without reaching an error case. Upon completion of the above valiadtion guides, and in the presence of a clean build, we can progress to the release phase.
 
+# New Feature Testing
+All new features added for the release, which will be named in the release notes outline, should be proven on the unstable build. At this point some exploratory testing needs to be investigated, in an attempt to break the delivered feature and/or knowingly drive it towards a state where features could be working from invalid information.
+
+# Exploratory Testing
+Different users will attempt different things, be starting from different points with different skill level. Options to consider
+
+ - Add a new asset type to a model and a new transaction, or write a new model from a different business domain
+ - Review the questions found in the week on StackOverflow & Rocket.Chat - how did the user get to the position they are in?
+ - What new PRs have gone in this week - how could they deployed and used in the existing networks?
+
 ## The Release
 
 Once validation has passed, and the consensus is to cut a release, the [release process](./release-process.md) may be followed.
 
-If a major version bump is being performed, it will be necessary to update:
+If a major version bump is being performed, it is essential to update and release:
  - composer-sample-applications
  - composer-sample-networks
-For the runtime level change, and cut a release of the items listed above.
\ No newline at end of file
+ - composer-tools
+
+## Dependencies
+
+# Vehicle Lifecycle
+This pulls the latest versions of:
+ - Composer runtime
+ - Composer playground
+ - Composer tools
+
+Consequently a major version bump in Composer *requires* Composer-tools to support the latest major version.
+
+VLC builds from static files, that define the connection profile, IDCard that enables connection, deployed base network etc. Any breaking API changes in the runtime must be accounted for in the build files that generate the specification, otherwise it simply will not work and we will be very sad.
+
+#K8s",48,2017-09-22 15:44:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/140461490,https://github.com/hyperledger/composer/pull/2203#discussion_r140461490,davidkel
https://github.com/hyperledger/composer/pull/2181,https://github.com/hyperledger/composer/pull/2181,"This is getting replaced below, resulting in the error: `Cannot load browser ""FirefoxHeadless"": it is not registered!`",51190c6c444fb91b93cd5e2266efb462cd308b68,2017-09-25 13:29:02,140775030,"@@ -76,10 +76,13 @@ module.exports = function(config) {
      * start these browsers
      * available browser launchers: https://npmjs.org/browse/keyword/karma-launcher
      */
-    browsers: [
-      'Chrome'
-    ],
-
+    browsers: ['FirefoxHeadless'],
+    customLaunchers: {",9,2017-09-25 18:58:20,https://api.github.com/repos/hyperledger/composer/pulls/comments/140775030,https://github.com/hyperledger/composer/pull/2181#discussion_r140775030,jt-nti
https://github.com/hyperledger/composer/pull/2181,https://github.com/hyperledger/composer/pull/2181,"Firefox headless option works from Version 55+ for linux per this https://developer.mozilla.org/en-US/Firefox/Headless_mode . And I see Travis CI Nodes is already equipped with Firefox 55+
Request for a re-review with new changes in. ",51190c6c444fb91b93cd5e2266efb462cd308b68,2017-09-25 18:57:48,140866994,"@@ -76,10 +76,13 @@ module.exports = function(config) {
      * start these browsers
      * available browser launchers: https://npmjs.org/browse/keyword/karma-launcher
      */
-    browsers: [
-      'Chrome'
-    ],
-
+    browsers: ['FirefoxHeadless'],
+    customLaunchers: {",9,2017-09-25 18:58:20,https://api.github.com/repos/hyperledger/composer/pulls/comments/140866994,https://github.com/hyperledger/composer/pull/2181#discussion_r140866994,harsha544
https://github.com/hyperledger/composer/pull/2181,https://github.com/hyperledger/composer/pull/2181,Doesn't look like this is necessary. configuration.browsers should already be set up for firefox above,51190c6c444fb91b93cd5e2266efb462cd308b68,2017-09-26 08:53:18,140993972,"@@ -105,7 +101,7 @@ module.exports = function(config) {
 
   if (process.env.TRAVIS){",34,2017-09-26 08:57:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/140993972,https://github.com/hyperledger/composer/pull/2181#discussion_r140993972,jt-nti
https://github.com/hyperledger/composer/pull/2181,https://github.com/hyperledger/composer/pull/2181,"Unfortunately version 56+ is required on Windows/Mac, which I think is what the majority of developers are using. Hopefully not long to wait though... https://wiki.mozilla.org/RapidRelease/Calendar",51190c6c444fb91b93cd5e2266efb462cd308b68,2017-09-26 08:56:44,140994865,"@@ -76,10 +76,13 @@ module.exports = function(config) {
      * start these browsers
      * available browser launchers: https://npmjs.org/browse/keyword/karma-launcher
      */
-    browsers: [
-      'Chrome'
-    ],
-
+    browsers: ['FirefoxHeadless'],
+    customLaunchers: {",9,2017-09-26 08:57:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/140994865,https://github.com/hyperledger/composer/pull/2181#discussion_r140994865,jt-nti
https://github.com/hyperledger/composer/pull/2176,https://github.com/hyperledger/composer/pull/2176,when with ?,5e6bfac4925b4c4d7122eb15a2e61a071e61ed08,2017-09-19 15:55:56,139736835,"@@ -1075,6 +1075,17 @@ class HLFConnection extends Connection {
             });
     }
 
+   /**
+     * Get a transaction id from the fabric client
+     * @param {any} securityContext security context
+     * @return {Promise} A promise that is resolved when with a transaction id",,2017-09-20 08:13:59,https://api.github.com/repos/hyperledger/composer/pulls/comments/139736835,https://github.com/hyperledger/composer/pull/2176#discussion_r139736835,davidkel
https://github.com/hyperledger/composer/pull/2176,https://github.com/hyperledger/composer/pull/2176,not sure this describes the test. Should list ?,5e6bfac4925b4c4d7122eb15a2e61a071e61ed08,2017-09-19 15:58:10,139737443,"@@ -1084,4 +1085,61 @@ describe('ConnectorServer', () => {
 
     });
 
+    describe('#connectionCreateTransactionId', () => {
+
+        beforeEach(() => {
+            connectorServer.connections[connectionID] = mockConnection;
+            connectorServer.securityContexts[securityContextID] = mockSecurityContext;
+        });
+
+        it('should list', () => {",,2017-09-20 08:13:59,https://api.github.com/repos/hyperledger/composer/pulls/comments/139737443,https://github.com/hyperledger/composer/pull/2176#discussion_r139737443,davidkel
https://github.com/hyperledger/composer/pull/2176,https://github.com/hyperledger/composer/pull/2176,"not sure this describes the test, should handle list errors ?",5e6bfac4925b4c4d7122eb15a2e61a071e61ed08,2017-09-19 15:58:43,139737596,"@@ -1084,4 +1085,61 @@ describe('ConnectorServer', () => {
 
     });
 
+    describe('#connectionCreateTransactionId', () => {
+
+        beforeEach(() => {
+            connectorServer.connections[connectionID] = mockConnection;
+            connectorServer.securityContexts[securityContextID] = mockSecurityContext;
+        });
+
+        it('should list', () => {
+            mockConnection.createTransactionId.withArgs(mockSecurityContext).resolves(['42']);
+            const cb = sinon.stub();
+            return connectorServer.connectionCreateTransactionId(connectionID, securityContextID, cb)
+                        .then(() => {
+                            sinon.assert.calledOnce(mockConnection.createTransactionId);
+                            sinon.assert.calledWith(mockConnection.createTransactionId, mockSecurityContext);
+                            sinon.assert.calledOnce(cb);
+                            sinon.assert.calledWith(cb, null, ['42']);
+                        });
+        });
+
+        it('should handle an invalid connection ID', () => {
+            const cb = sinon.stub();
+            return connectorServer.connectionCreateTransactionId(invalidID, securityContextID, cb)
+                        .then(() => {
+                            sinon.assert.calledOnce(cb);
+                            const serializedError = cb.args[0][0];
+                            serializedError.name.should.equal('Error');
+                            serializedError.message.should.match(/No connection found with ID/);
+                            serializedError.stack.should.be.a('string');
+                        });
+        });
+
+        it('should handle an invalid security context ID ID', () => {
+            const cb = sinon.stub();
+            return connectorServer.connectionCreateTransactionId(connectionID, invalidID, cb)
+                        .then(() => {
+                            sinon.assert.calledOnce(cb);
+                            const serializedError = cb.args[0][0];
+                            serializedError.name.should.equal('Error');
+                            serializedError.message.should.match(/No security context found with ID/);
+                            serializedError.stack.should.be.a('string');
+                        });
+        });
+
+        it('should handle list errors', () => {",,2017-09-20 08:13:59,https://api.github.com/repos/hyperledger/composer/pulls/comments/139737596,https://github.com/hyperledger/composer/pull/2176#discussion_r139737596,davidkel
https://github.com/hyperledger/composer/pull/2176,https://github.com/hyperledger/composer/pull/2176,the comment on the promise doesn't seem to match the api,5e6bfac4925b4c4d7122eb15a2e61a071e61ed08,2017-09-19 15:59:15,139737751,"@@ -489,6 +489,16 @@ class WebConnection extends Connection {
             });
     }
 
+    /**
+     * Create a new transaction id
+     * Note: as this is not a real fabric it returns null to let the composer-common use uuid to create one.
+     * @param {SecurityContext} securityContext The participant's security context.
+     * @return {Promise} A promise that is resolved with a generated user",,2017-09-20 08:13:59,https://api.github.com/repos/hyperledger/composer/pulls/comments/139737751,https://github.com/hyperledger/composer/pull/2176#discussion_r139737751,davidkel
https://github.com/hyperledger/composer/pull/2176,https://github.com/hyperledger/composer/pull/2176,"don't think it returns anything, rather it will invoke the callback with a result",5e6bfac4925b4c4d7122eb15a2e61a071e61ed08,2017-09-19 16:28:37,139745766,"@@ -594,6 +594,35 @@ class Connection extends EventEmitter {
         throw new Error('abstract function called');
     }
 
+
+    /**
+     * Create a Transaction Id
+     * @param {SecurityContext} securityContext The participant's security context.
+     * @return {Promise} A promise that will be resolved with a representation of the id
+     */
+    createTransactionId(securityContext) {
+        return new Promise((resolve, reject) => {
+            this._createTransactionId(securityContext, (error, result) => {
+                if (error) {
+                    return reject(error);
+                }
+                return resolve(result);
+            });
+        });
+    }
+
+    /**
+     * List all of the deployed business networks. The connection must
+     * be connected for this method to succeed.
+     * @abstract
+     * @param {SecurityContext} securityContext The participant's security context.
+     * @param {listCallback} callback The callback function to call when complete.
+     * @return {String} id string of the transaction id (or null which will prompt common to create one)",,2017-09-20 08:13:59,https://api.github.com/repos/hyperledger/composer/pulls/comments/139745766,https://github.com/hyperledger/composer/pull/2176#discussion_r139745766,davidkel
https://github.com/hyperledger/composer/pull/2176,https://github.com/hyperledger/composer/pull/2176,It returns a promise that will be resolved to a txn id string ?,5e6bfac4925b4c4d7122eb15a2e61a071e61ed08,2017-09-19 16:29:45,139746074,"@@ -100,6 +101,22 @@ class Util {
         return(typeof(obj) === 'undefined' || obj === null);
     }
 
+   /** Obtain a UUID for use as a TransactionId
+     * @param {SecurityContext} securityContext - The user's security context
+     * @return {Object} Object representing the transaction Id to be used later when invoking chain code",,2017-09-20 08:13:59,https://api.github.com/repos/hyperledger/composer/pulls/comments/139746074,https://github.com/hyperledger/composer/pull/2176#discussion_r139746074,davidkel
https://github.com/hyperledger/composer/pull/2176,https://github.com/hyperledger/composer/pull/2176,normal convention would be ((result) => {,5e6bfac4925b4c4d7122eb15a2e61a071e61ed08,2017-09-19 16:52:16,139752135,"@@ -81,6 +81,16 @@ describe('WebConnection', () => {
 
     });
 
+    describe('#createTransactionId', () => {
+        it('should just return null ', ()=>{
+            connection.createTransactionId(mockSecurityContext)
+            .then(result=>{",,2017-09-20 08:13:59,https://api.github.com/repos/hyperledger/composer/pulls/comments/139752135,https://github.com/hyperledger/composer/pull/2176#discussion_r139752135,davidkel
https://github.com/hyperledger/composer/pull/2176,https://github.com/hyperledger/composer/pull/2176,"yep - dogy autoformatting.
",5e6bfac4925b4c4d7122eb15a2e61a071e61ed08,2017-09-19 21:31:57,139823786,"@@ -81,6 +81,16 @@ describe('WebConnection', () => {
 
     });
 
+    describe('#createTransactionId', () => {
+        it('should just return null ', ()=>{
+            connection.createTransactionId(mockSecurityContext)
+            .then(result=>{",,2017-09-20 08:13:59,https://api.github.com/repos/hyperledger/composer/pulls/comments/139823786,https://github.com/hyperledger/composer/pull/2176#discussion_r139823786,mbwhite
https://github.com/hyperledger/composer/pull/2170,https://github.com/hyperledger/composer/pull/2170,Can you remove the console.logs please,978f401c4c67045ed0223ea3dae50dc204d3ca57,2017-09-18 16:48:42,139477345,"@@ -90,9 +92,16 @@ export class EditCardCredentialsComponent {
             text: 'Adding ID card'
         });
 
+        if (this.useCerts) {
+            this.formattedCert = this.formatCert(this.addedPublicCertificate);
+            this.formattedPrivateKey = this.formatCert(this.addedPrivateCertificate);
+            console.log(this.formattedCert);",,2017-09-21 08:16:14,https://api.github.com/repos/hyperledger/composer/pulls/comments/139477345,https://github.com/hyperledger/composer/pull/2170#discussion_r139477345,cazfletch
https://github.com/hyperledger/composer/pull/2170,https://github.com/hyperledger/composer/pull/2170,you should include tests for \r\n in a string as well as \n\r to make sure these also work.,978f401c4c67045ed0223ea3dae50dc204d3ca57,2017-09-19 07:50:00,139619397,"@@ -189,6 +189,15 @@ describe('EditCardCredentialsComponent', () => {
         }));
     });
 
+    describe('#formatCert', () => {
+
+        it('should remove all instances of \n from a given certificate', () => {
+            let testCert = 'this is the\\n\\ntest cert';",7,2017-09-21 08:16:14,https://api.github.com/repos/hyperledger/composer/pulls/comments/139619397,https://github.com/hyperledger/composer/pull/2170#discussion_r139619397,davidkel
https://github.com/hyperledger/composer/pull/2170,https://github.com/hyperledger/composer/pull/2170,"In the embedded connection manager we just strip out newline and carriage return, which I think is valid but less easy on the eye: `certificate.replace(/[\r\n]+/g, '');`

If you want to preserve the line breaks then I think that simpler regular expression form should still work for you rather than the complicated (and yet less complete) beast you have: `certificate.replace(/[\r\n]+/g, '\n');`",978f401c4c67045ed0223ea3dae50dc204d3ca57,2017-09-20 10:36:00,139933202,"@@ -123,4 +132,9 @@ export class EditCardCredentialsComponent {
                 this.idCardAdded.emit(false);
             });
     }
+
+    formatCert(unformatted: string) {
+        return  unformatted.replace(/\\r\\n|\\n\\r|\\n/g, '\n');",32,2017-09-21 08:16:14,https://api.github.com/repos/hyperledger/composer/pulls/comments/139933202,https://github.com/hyperledger/composer/pull/2170#discussion_r139933202,bestbeforetoday
https://github.com/hyperledger/composer/pull/2170,https://github.com/hyperledger/composer/pull/2170,"The solution needs to ensure that it handles the 3 cases that can occur
\r\n
\n\r
\n
To ensure that whatever soln is implemented there should be unit tests for all 3 scenarios",978f401c4c67045ed0223ea3dae50dc204d3ca57,2017-09-20 11:42:30,139945366,"@@ -123,4 +132,9 @@ export class EditCardCredentialsComponent {
                 this.idCardAdded.emit(false);
             });
     }
+
+    formatCert(unformatted: string) {
+        return  unformatted.replace(/\\r\\n|\\n\\r|\\n/g, '\n');",32,2017-09-21 08:16:14,https://api.github.com/repos/hyperledger/composer/pulls/comments/139945366,https://github.com/hyperledger/composer/pull/2170#discussion_r139945366,davidkel
https://github.com/hyperledger/composer/pull/2170,https://github.com/hyperledger/composer/pull/2170,"You would hope not, but it is possible to have just a `\r` in there. It wouldn't hurt to cope with that scenario too.",978f401c4c67045ed0223ea3dae50dc204d3ca57,2017-09-20 13:01:22,139961617,"@@ -123,4 +132,9 @@ export class EditCardCredentialsComponent {
                 this.idCardAdded.emit(false);
             });
     }
+
+    formatCert(unformatted: string) {
+        return  unformatted.replace(/\\r\\n|\\n\\r|\\n/g, '\n');",32,2017-09-21 08:16:14,https://api.github.com/repos/hyperledger/composer/pulls/comments/139961617,https://github.com/hyperledger/composer/pull/2170#discussion_r139961617,bestbeforetoday
https://github.com/hyperledger/composer/pull/2170,https://github.com/hyperledger/composer/pull/2170,"I don't think \r is valid for pem so wouldn't expect to have to cope with that for a valid pem file, but as you say it wouldn't hurt",978f401c4c67045ed0223ea3dae50dc204d3ca57,2017-09-20 14:50:24,139992638,"@@ -123,4 +132,9 @@ export class EditCardCredentialsComponent {
                 this.idCardAdded.emit(false);
             });
     }
+
+    formatCert(unformatted: string) {
+        return  unformatted.replace(/\\r\\n|\\n\\r|\\n/g, '\n');",32,2017-09-21 08:16:14,https://api.github.com/repos/hyperledger/composer/pulls/comments/139992638,https://github.com/hyperledger/composer/pull/2170#discussion_r139992638,davidkel
https://github.com/hyperledger/composer/pull/2118,https://github.com/hyperledger/composer/pull/2118,"This is still causing problems. Doing the same thing as in createNewBusinessNetwork should fix it:

`const enrollmentSecret = enrollmentCredentials ? enrollmentCredentials.secret : null;`",6adfd72510828660a91bf63bb446bae308cc2278,2017-09-15 15:25:27,139178915,"@@ -58,19 +58,20 @@ export class AdminService {
         let connectionProfile = this.identityService.getCurrentConnectionProfile();
         let connectionProfileRef = this.identityService.getCurrentQualifiedProfileName();
         let enrollmentCredentials = this.identityService.getCurrentEnrollmentCredentials();
+        const userName = this.identityService.getCurrentUserName();
 
         this.alertService.busyStatus$.next({
             title: businessNetworkName ? 'Connecting to Business Network ' + businessNetworkName : 'Connecting without a business network',
             text: 'using connection profile ' + connectionProfile.name
         });
 
         if (businessNetworkName) {
-            console.log('Connecting to business network %s with connection profile %s with id %s', businessNetworkName, connectionProfileRef, enrollmentCredentials.id);
+            console.log('Connecting to business network %s with connection profile %s with id %s', businessNetworkName, connectionProfileRef, userName);
         } else {
-            console.log('Connecting with connection profile %s with id %s', connectionProfileRef, enrollmentCredentials.id);
+            console.log('Connecting with connection profile %s with id %s', connectionProfileRef, userName);
         }
 
-        this.connectingPromise = this.getAdminConnection().connect(connectionProfileRef, enrollmentCredentials.id, enrollmentCredentials.secret, businessNetworkName)
+        this.connectingPromise = this.getAdminConnection().connect(connectionProfileRef, userName, enrollmentCredentials.secret, businessNetworkName)",,2017-09-18 08:09:36,https://api.github.com/repos/hyperledger/composer/pulls/comments/139178915,https://github.com/hyperledger/composer/pull/2118#discussion_r139178915,jt-nti
https://github.com/hyperledger/composer/pull/2118,https://github.com/hyperledger/composer/pull/2118,"I haven't seen an error from here yet, but it makes me nervous. Would be happier to have the following to be on the safe side...

`const enrollmentSecret = enrollmentCredentials ? enrollmentCredentials.secret : null;`",6adfd72510828660a91bf63bb446bae308cc2278,2017-09-15 15:27:07,139179357,"@@ -305,7 +305,7 @@ export class ClientService {
 
         return this.getBusinessNetworkConnection().disconnect()
             .then(() => {
-                return this.getBusinessNetworkConnection().connect(connectionProfileRef, businessNetworkName, enrollmentCredentials.id, enrollmentCredentials.secret);
+                return this.getBusinessNetworkConnection().connect(connectionProfileRef, businessNetworkName, userName, enrollmentCredentials.secret);",,2017-09-18 08:09:36,https://api.github.com/repos/hyperledger/composer/pulls/comments/139179357,https://github.com/hyperledger/composer/pull/2118#discussion_r139179357,jt-nti
https://github.com/hyperledger/composer/pull/2116,https://github.com/hyperledger/composer/pull/2116,"This is test code for globalized message formatting, and should not be changed.",5352eb6a3efc1b3d39e258a7e425470ee9afc9d0,2017-09-14 08:41:27,138830728,"@@ -33,16 +33,16 @@ describe('Globalization', function() {
     describe('#check globalization library works', function() {
         it('numbered variables using Array', function() {
             const formatter = Globalize('en').messageFormatter('test-hello-array');
-            formatter([ 'Wolfgang', 'Amadeus', 'Mozart' ]).should.equal('Hello, Wolfgang Amadeus Mozart');
+            formatter([ 'Wolfgang', 'Amadeus', 'animaltracking' ]).should.equal('Hello, Wolfgang Amadeus animaltracking');",,2017-09-15 12:19:15,https://api.github.com/repos/hyperledger/composer/pulls/comments/138830728,https://github.com/hyperledger/composer/pull/2116#discussion_r138830728,bestbeforetoday
https://github.com/hyperledger/composer/pull/2116,https://github.com/hyperledger/composer/pull/2116,Test code that should not be changed.,5352eb6a3efc1b3d39e258a7e425470ee9afc9d0,2017-09-14 08:43:02,138831132,"@@ -33,16 +33,16 @@ describe('Globalization', function() {
     describe('#check globalization library works', function() {
         it('numbered variables using Array', function() {
             const formatter = Globalize('en').messageFormatter('test-hello-array');
-            formatter([ 'Wolfgang', 'Amadeus', 'Mozart' ]).should.equal('Hello, Wolfgang Amadeus Mozart');
+            formatter([ 'Wolfgang', 'Amadeus', 'animaltracking' ]).should.equal('Hello, Wolfgang Amadeus animaltracking');
         });
 
         it('named variables using Object key-value pairs', function() {
             const formatter = Globalize('en').messageFormatter('test-hello-object');
             formatter({
                 first: 'Wolfgang',
                 middle: 'Amadeus',
-                last: 'Mozart'
-            }).should.equal('Hello, Wolfgang Amadeus Mozart');
+                last: 'animaltracking'",,2017-09-15 12:19:15,https://api.github.com/repos/hyperledger/composer/pulls/comments/138831132,https://github.com/hyperledger/composer/pull/2116#discussion_r138831132,bestbeforetoday
https://github.com/hyperledger/composer/pull/2116,https://github.com/hyperledger/composer/pull/2116,"This is test code for globalized message formatting, and should not be changed.",5352eb6a3efc1b3d39e258a7e425470ee9afc9d0,2017-09-14 08:43:41,138831305,"@@ -67,20 +67,20 @@ describe('Globalization', function() {
             let formatter = Globalize.messageFormatter('hello');
 
             // Numbered variables using Array.
-            formatter([ 'Wolfgang', 'Amadeus', 'Mozart' ]).should.equal('Hello, Wolfgang Amadeus Mozart');
-            // > ""Hello, Wolfgang Amadeus Mozart""
+            formatter([ 'Wolfgang', 'Amadeus', 'animaltracking' ]).should.equal('Hello, Wolfgang Amadeus animaltracking');",,2017-09-15 12:19:15,https://api.github.com/repos/hyperledger/composer/pulls/comments/138831305,https://github.com/hyperledger/composer/pull/2116#discussion_r138831305,bestbeforetoday
https://github.com/hyperledger/composer/pull/2116,https://github.com/hyperledger/composer/pull/2116,"This is test code for globalized message formatting, and should not be changed.",5352eb6a3efc1b3d39e258a7e425470ee9afc9d0,2017-09-14 08:43:54,138831359,"@@ -67,20 +67,20 @@ describe('Globalization', function() {
             let formatter = Globalize.messageFormatter('hello');
 
             // Numbered variables using Array.
-            formatter([ 'Wolfgang', 'Amadeus', 'Mozart' ]).should.equal('Hello, Wolfgang Amadeus Mozart');
-            // > ""Hello, Wolfgang Amadeus Mozart""
+            formatter([ 'Wolfgang', 'Amadeus', 'animaltracking' ]).should.equal('Hello, Wolfgang Amadeus animaltracking');
+            // > ""Hello, Wolfgang Amadeus animaltracking""
 
             // Numbered variables using function arguments.
-            formatter( 'Wolfgang', 'Amadeus', 'Mozart' ).should.equal('Hello, Wolfgang Amadeus Mozart');
-            // > ""Hello, Wolfgang Amadeus Mozart""
+            formatter( 'Wolfgang', 'Amadeus', 'animaltracking' ).should.equal('Hello, Wolfgang Amadeus animaltracking');",,2017-09-15 12:19:15,https://api.github.com/repos/hyperledger/composer/pulls/comments/138831359,https://github.com/hyperledger/composer/pull/2116#discussion_r138831359,bestbeforetoday
https://github.com/hyperledger/composer/pull/2116,https://github.com/hyperledger/composer/pull/2116,"This is test code for globalized message formatting, and should not be changed.",5352eb6a3efc1b3d39e258a7e425470ee9afc9d0,2017-09-14 08:44:05,138831403,"@@ -67,20 +67,20 @@ describe('Globalization', function() {
             let formatter = Globalize.messageFormatter('hello');
 
             // Numbered variables using Array.
-            formatter([ 'Wolfgang', 'Amadeus', 'Mozart' ]).should.equal('Hello, Wolfgang Amadeus Mozart');
-            // > ""Hello, Wolfgang Amadeus Mozart""
+            formatter([ 'Wolfgang', 'Amadeus', 'animaltracking' ]).should.equal('Hello, Wolfgang Amadeus animaltracking');
+            // > ""Hello, Wolfgang Amadeus animaltracking""
 
             // Numbered variables using function arguments.
-            formatter( 'Wolfgang', 'Amadeus', 'Mozart' ).should.equal('Hello, Wolfgang Amadeus Mozart');
-            // > ""Hello, Wolfgang Amadeus Mozart""
+            formatter( 'Wolfgang', 'Amadeus', 'animaltracking' ).should.equal('Hello, Wolfgang Amadeus animaltracking');
+            // > ""Hello, Wolfgang Amadeus animaltracking""
 
             // Named variables using Object key-value pairs.
             formatter = Globalize( 'en' ).messageFormatter( 'hey' );
             formatter({
                 first: 'Wolfgang',
                 middle: 'Amadeus',
-                last: 'Mozart'
-            }).should.equal('Hey, Wolfgang Amadeus Mozart');
+                last: 'animaltracking'",,2017-09-15 12:19:15,https://api.github.com/repos/hyperledger/composer/pulls/comments/138831403,https://github.com/hyperledger/composer/pull/2116#discussion_r138831403,bestbeforetoday
https://github.com/hyperledger/composer/pull/2112,https://github.com/hyperledger/composer/pull/2112,this makes me happy,0befbe22102e1a553b57af994bf41fcc391b691d,2017-09-13 10:58:53,138587471,"@@ -6,7 +6,7 @@ instrumentation:
         - ""docker/*""
 check:
     global:
-        statements: 98
-        branches: 94
-        functions: 96
+        statements: 99",7,2017-09-13 15:18:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/138587471,https://github.com/hyperledger/composer/pull/2112#discussion_r138587471,nklincoln
https://github.com/hyperledger/composer/pull/2112,https://github.com/hyperledger/composer/pull/2112,this also makes me happy,0befbe22102e1a553b57af994bf41fcc391b691d,2017-09-13 10:59:07,138587511,"@@ -6,7 +6,7 @@ instrumentation:
         - ""docker/*""
 check:
     global:
-        statements: 98
-        branches: 94
-        functions: 96
+        statements: 99
+        branches: 95",8,2017-09-13 15:18:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/138587511,https://github.com/hyperledger/composer/pull/2112#discussion_r138587511,nklincoln
https://github.com/hyperledger/composer/pull/2112,https://github.com/hyperledger/composer/pull/2112,ðŸŽ‰  ,0befbe22102e1a553b57af994bf41fcc391b691d,2017-09-13 10:59:26,138587567,"@@ -6,7 +6,7 @@ instrumentation:
         - ""docker/*""
 check:
     global:
-        statements: 98
-        branches: 94
-        functions: 96
+        statements: 99
+        branches: 95
+        functions: 98",9,2017-09-13 15:18:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/138587567,https://github.com/hyperledger/composer/pull/2112#discussion_r138587567,nklincoln
https://github.com/hyperledger/composer/pull/2112,https://github.com/hyperledger/composer/pull/2112,$space-large ?,0befbe22102e1a553b57af994bf41fcc391b691d,2017-09-13 11:03:02,138588233,"@@ -54,15 +54,36 @@
     input[type='text'], input[type='password'] {
         display: flex;
         align-self: center;
-        color:$primary-text;
+        color: $primary-text;
         margin-bottom: 0;
     }
 
+    .roles {
+        margin-bottom: $space-large;
+
+        p {
+            color: $primary-text;
+            margin-top: 0;
+            margin-bottom: 0;
+            font-weight: 300;
+        }
+
+        .role-list {
+            display: flex;
+            margin-top: 32px;",,2017-09-13 15:18:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/138588233,https://github.com/hyperledger/composer/pull/2112#discussion_r138588233,nklincoln
https://github.com/hyperledger/composer/pull/2101,https://github.com/hyperledger/composer/pull/2101,this one needs to stay!,5df04e04144bafa61d7168f413797f53011c7b4b,2017-09-08 18:48:10,137863962,"@@ -982,7 +982,6 @@ class BusinessNetworkConnector extends Connector {
                         queryParameters[param.name] = parseFloat(paramValue);
                         break;
                     case 'DateTime':
-                        queryParameters[param.name] = Date.parse(paramValue);",4,2017-09-11 13:35:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/137863962,https://github.com/hyperledger/composer/pull/2101#discussion_r137863962,nklincoln
https://github.com/hyperledger/composer/pull/2101,https://github.com/hyperledger/composer/pull/2101,This one needs to be removed as Date.parse(paramValue) change the string datetime value into an long integer value which does not exist in the CouchDB database and memory for PouchDB.,5df04e04144bafa61d7168f413797f53011c7b4b,2017-09-08 20:02:08,137878035,"@@ -982,7 +982,6 @@ class BusinessNetworkConnector extends Connector {
                         queryParameters[param.name] = parseFloat(paramValue);
                         break;
                     case 'DateTime':
-                        queryParameters[param.name] = Date.parse(paramValue);",4,2017-09-11 13:35:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/137878035,https://github.com/hyperledger/composer/pull/2101#discussion_r137878035,fenglianxu
https://github.com/hyperledger/composer/pull/2101,https://github.com/hyperledger/composer/pull/2101,"ah, ok - yeah, it is trying to convert to milliseconds since epoch. It would nice to retain clarity on what is going on here, so perhaps retain:

`queryParameters[param.name] = paramValue;` 

in there so we can see that there is an explicit pass through of the string date-time value. 

It is probable that we will need some kind of validation step to ensure that the date-time string being passed is valid (or at least consistent with JSON.stringify(new Date()) with what we are storing ... but that is out of scope here",5df04e04144bafa61d7168f413797f53011c7b4b,2017-09-09 05:50:37,137919343,"@@ -982,7 +982,6 @@ class BusinessNetworkConnector extends Connector {
                         queryParameters[param.name] = parseFloat(paramValue);
                         break;
                     case 'DateTime':
-                        queryParameters[param.name] = Date.parse(paramValue);",4,2017-09-11 13:35:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/137919343,https://github.com/hyperledger/composer/pull/2101#discussion_r137919343,nklincoln
https://github.com/hyperledger/composer/pull/2101,https://github.com/hyperledger/composer/pull/2101,"agree, we should have another story to validate date time format and conversion. However right now we only support the UTC or GMT format date time as String format. 
Change the statement as below:
queryParameters[param.name] = paramValue;
",5df04e04144bafa61d7168f413797f53011c7b4b,2017-09-10 12:04:23,137947760,"@@ -982,7 +982,6 @@ class BusinessNetworkConnector extends Connector {
                         queryParameters[param.name] = parseFloat(paramValue);
                         break;
                     case 'DateTime':
-                        queryParameters[param.name] = Date.parse(paramValue);",4,2017-09-11 13:35:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/137947760,https://github.com/hyperledger/composer/pull/2101#discussion_r137947760,fenglianxu
https://github.com/hyperledger/composer/pull/2063,https://github.com/hyperledger/composer/pull/2063,"Should be handled with css styling (also now a mismatch between 'IN USE' and 'In my wallet')
Hopefully this part of the page will be removed through #1976 so not too worried)",06c3c1c43ec7bace661b1caa6b5a1acfed3ddcc9,2017-09-06 16:59:39,137328512,"@@ -20,7 +20,7 @@ <h1 class=""flex"">My IDs for {{businessNetworkName}}</h1>
                     {{identityCards.get(cardRef).getName()}}
                 </div>
                 <div class=""flex"" *ngIf=""cardRef===currentIdentity"">
-                    In Use
+                    IN USE",5,2017-09-06 17:43:38,https://api.github.com/repos/hyperledger/composer/pulls/comments/137328512,https://github.com/hyperledger/composer/pull/2063#discussion_r137328512,jt-nti
https://github.com/hyperledger/composer/pull/2040,https://github.com/hyperledger/composer/pull/2040,Comment left in,34c07ce217718663ac208173f7571290d6d8b9cc,2017-09-05 09:28:04,136937296,"@@ -804,7 +804,8 @@ describe('ClientService', () => {
     describe('ensureConnected', () => {
         beforeEach(() => {
             identityServiceMock.getCurrentConnectionProfile.returns({name: 'myProfile'});
-            identityServiceMock.getCurrentEnrollmentCredentials.returns({id: 'myId'});
+            // identityServiceMock.getCurrentEnrollmentCredentials.returns({id: 'myId'});",,2017-09-05 10:56:52,https://api.github.com/repos/hyperledger/composer/pulls/comments/136937296,https://github.com/hyperledger/composer/pull/2040#discussion_r136937296,jt-nti
https://github.com/hyperledger/composer/pull/2040,https://github.com/hyperledger/composer/pull/2040,Comment left in,34c07ce217718663ac208173f7571290d6d8b9cc,2017-09-05 09:29:21,136937601,"@@ -45,12 +45,13 @@ describe('IdentityCardService', () => {
     describe('#getIdentityCard', () => {
         it('should get the specified identity card', fakeAsync(inject([IdentityCardService], (service: IdentityCardService) => {
             let mockIdCard = sinon.createStubInstance(IdCard);
-            mockIdCard.getName.returns('alice');
+            // mockIdCard.getUserName.returns('alice');",,2017-09-05 10:56:52,https://api.github.com/repos/hyperledger/composer/pulls/comments/136937601,https://github.com/hyperledger/composer/pull/2040#discussion_r136937601,jt-nti
https://github.com/hyperledger/composer/pull/2040,https://github.com/hyperledger/composer/pull/2040,Comment left in,34c07ce217718663ac208173f7571290d6d8b9cc,2017-09-05 09:29:27,136937643,"@@ -45,12 +45,13 @@ describe('IdentityCardService', () => {
     describe('#getIdentityCard', () => {
         it('should get the specified identity card', fakeAsync(inject([IdentityCardService], (service: IdentityCardService) => {
             let mockIdCard = sinon.createStubInstance(IdCard);
-            mockIdCard.getName.returns('alice');
+            // mockIdCard.getUserName.returns('alice');
             let mockCardMap = new Map<string, IdCard>();
             mockCardMap.set('test', mockIdCard);
             service['idCards'] = mockCardMap;
 
-            service.getIdentityCard('test').getName().should.equal('alice');
+            // service.getIdentityCard('test').getUserName().should.equal('alice');",,2017-09-05 10:56:52,https://api.github.com/repos/hyperledger/composer/pulls/comments/136937643,https://github.com/hyperledger/composer/pull/2040#discussion_r136937643,jt-nti
https://github.com/hyperledger/composer/pull/2040,https://github.com/hyperledger/composer/pull/2040,Comment left in,34c07ce217718663ac208173f7571290d6d8b9cc,2017-09-05 09:29:37,136937694,"@@ -61,13 +62,14 @@ describe('IdentityCardService', () => {
     describe('#getCurrentIdentityCard', () => {
         it('should get the current identity card', fakeAsync(inject([IdentityCardService], (service: IdentityCardService) => {
             let mockIdCard = sinon.createStubInstance(IdCard);
-            mockIdCard.getName.returns('alice');
+            // mockIdCard.getUserName.returns('alice');",,2017-09-05 10:56:52,https://api.github.com/repos/hyperledger/composer/pulls/comments/136937694,https://github.com/hyperledger/composer/pull/2040#discussion_r136937694,jt-nti
https://github.com/hyperledger/composer/pull/2040,https://github.com/hyperledger/composer/pull/2040,Comment left in,34c07ce217718663ac208173f7571290d6d8b9cc,2017-09-05 09:29:52,136937755,"@@ -61,13 +62,14 @@ describe('IdentityCardService', () => {
     describe('#getCurrentIdentityCard', () => {
         it('should get the current identity card', fakeAsync(inject([IdentityCardService], (service: IdentityCardService) => {
             let mockIdCard = sinon.createStubInstance(IdCard);
-            mockIdCard.getName.returns('alice');
+            // mockIdCard.getUserName.returns('alice');
             let mockCardMap = new Map<string, IdCard>();
             mockCardMap.set('test', mockIdCard);
             service['idCards'] = mockCardMap;
             service['currentCard'] = 'test';
 
-            service.getCurrentIdentityCard().getName().should.equal('alice');
+            // service.getCurrentIdentityCard().getUserName().should.equal('alice');",,2017-09-05 10:56:52,https://api.github.com/repos/hyperledger/composer/pulls/comments/136937755,https://github.com/hyperledger/composer/pull/2040#discussion_r136937755,jt-nti
https://github.com/hyperledger/composer/pull/2031,https://github.com/hyperledger/composer/pull/2031,"Could we clarify here *why* a user would not want to add an ID card to ""my wallet""?",8b240a6b651d01ffbb2ce3c7527097982ee0c1f6,2017-08-30 12:17:29,136050018,"@@ -0,0 +1,149 @@
+---
+layout: default
+title: ID Cards
+category: tasks
+section: playground
+sidebar: sidebars/accordion-toc0.md
+excerpt: ID cards combine a connection profile, identity, and certificates to allow a connection to a business network in Hyperledger Composer Playground. ID cards can be [created, exported and imported](./id-cards-playground.html) from the **My Wallet** page in Hyperledger Composer Playground.
+index-order: 401
+---
+
+# ID Cards
+
+An ID Card provides all of the information needed to connect to a blockchain business network. It is only possible to access a blockchain Business Network through a valid ID Card. An ID Card contains and Identity for a single Participant within a deployed business network. ID Cards are used in the {{site.data.conrefs.composer_full}} Playground to connect to deployed Business Networks. You can have multiple ID Cards for a single deployed Business Network, where those ID Cards belong to multiple Participants.
+
+ID Cards are grouped under a Connection Profile, and each card shows the business network that may be accessed using the displayed Identity via the _Connect now_ option. An ID Card may be deleted or exported using the icons present on the card.
+
+Here is an ID Card that may be used to connect to the business network named 'my-business-network' using the Identity 'New User'
+
+![id-card](./id-card.png)
+
+An ID Card can be created when an Identity is issued within the Playground. This ID Card can then be exported and shared with others, allowing them to connect to the business network using the issued identity. If a user is provided with a Enrollment ID and Secret by an administrator, which corresponds to a valid Identity within a business network, then an ID Card may be directly created in the Playground. It is also possible to manually create an ID Card.
+
+---
+
+
+## <a name=""provide""></a>Providing Access To Your Business Network With an ID Card 
+
+Access to your Business Network is granted to another user through the provision of an ID Card. Once created, the ID Card may be exported and provided to the user for whom the card was created.
+
+There must be a Participant existing in the business network in order to bind an Identity required to create the ID Card.
+
+When an identity is issued within Playground, there is an option to add the Identity to your Wallet. By selecting this option an ID Card is created for the issued identity that is valid for the current business network. The ID Card will appear in your wallet once you log out of the current business network, and it is from this location where it may be exported to share with another user.
+
+
+### Creating an ID Card 
+
+1. From the **My Wallet** page, select an identity to use to connect to your business network. Click **Connect Now**. _Please note:_ You must use an identity that has permission to create new identities.
+
+2. If required, create the participant to which you intend to assign the identity:
+   - Click the **Test** tab, and click **Create New Participant**.
+   - Complete the Participant defintion and click **Create New**.
+
+3. Click the name of your identity in the upper right, and click **ID Registry** within the drop down.
+
+4. Click **+Issue New ID**.
+
+5. Choose an **ID Name**, and input an existing **Participant** to associate the new identity with. A look-ahead service is provided to auto-complete on known Participants.
+
+6. Click **Create New**.
+
+7. Click **Add to My Wallet**. Adding the ID card to your wallet allows you to use it to connect to the business network, or export it for someone else to use.",,2017-08-30 13:50:05,https://api.github.com/repos/hyperledger/composer/pulls/comments/136050018,https://github.com/hyperledger/composer/pull/2031#discussion_r136050018,winslet
https://github.com/hyperledger/composer/pull/2031,https://github.com/hyperledger/composer/pull/2031,"Could we remove the ""number"" step here - use a bullet point instead",8b240a6b651d01ffbb2ce3c7527097982ee0c1f6,2017-08-30 12:18:32,136050212,"@@ -0,0 +1,149 @@
+---
+layout: default
+title: ID Cards
+category: tasks
+section: playground
+sidebar: sidebars/accordion-toc0.md
+excerpt: ID cards combine a connection profile, identity, and certificates to allow a connection to a business network in Hyperledger Composer Playground. ID cards can be [created, exported and imported](./id-cards-playground.html) from the **My Wallet** page in Hyperledger Composer Playground.
+index-order: 401
+---
+
+# ID Cards
+
+An ID Card provides all of the information needed to connect to a blockchain business network. It is only possible to access a blockchain Business Network through a valid ID Card. An ID Card contains and Identity for a single Participant within a deployed business network. ID Cards are used in the {{site.data.conrefs.composer_full}} Playground to connect to deployed Business Networks. You can have multiple ID Cards for a single deployed Business Network, where those ID Cards belong to multiple Participants.
+
+ID Cards are grouped under a Connection Profile, and each card shows the business network that may be accessed using the displayed Identity via the _Connect now_ option. An ID Card may be deleted or exported using the icons present on the card.
+
+Here is an ID Card that may be used to connect to the business network named 'my-business-network' using the Identity 'New User'
+
+![id-card](./id-card.png)
+
+An ID Card can be created when an Identity is issued within the Playground. This ID Card can then be exported and shared with others, allowing them to connect to the business network using the issued identity. If a user is provided with a Enrollment ID and Secret by an administrator, which corresponds to a valid Identity within a business network, then an ID Card may be directly created in the Playground. It is also possible to manually create an ID Card.
+
+---
+
+
+## <a name=""provide""></a>Providing Access To Your Business Network With an ID Card 
+
+Access to your Business Network is granted to another user through the provision of an ID Card. Once created, the ID Card may be exported and provided to the user for whom the card was created.
+
+There must be a Participant existing in the business network in order to bind an Identity required to create the ID Card.
+
+When an identity is issued within Playground, there is an option to add the Identity to your Wallet. By selecting this option an ID Card is created for the issued identity that is valid for the current business network. The ID Card will appear in your wallet once you log out of the current business network, and it is from this location where it may be exported to share with another user.
+
+
+### Creating an ID Card 
+
+1. From the **My Wallet** page, select an identity to use to connect to your business network. Click **Connect Now**. _Please note:_ You must use an identity that has permission to create new identities.
+
+2. If required, create the participant to which you intend to assign the identity:
+   - Click the **Test** tab, and click **Create New Participant**.
+   - Complete the Participant defintion and click **Create New**.
+
+3. Click the name of your identity in the upper right, and click **ID Registry** within the drop down.
+
+4. Click **+Issue New ID**.
+
+5. Choose an **ID Name**, and input an existing **Participant** to associate the new identity with. A look-ahead service is provided to auto-complete on known Participants.
+
+6. Click **Create New**.
+
+7. Click **Add to My Wallet**. Adding the ID card to your wallet allows you to use it to connect to the business network, or export it for someone else to use.
+
+The **My Wallet** page should now show the new ID Card.
+
+
+### Exporting an ID Card
+
+ID Cards are exported from the **My Wallet** page in Playground, through interaction with the ID Card that you wish to export and is a one-step process.
+
+1. On the **My Wallet** page, click the **Export** icon on the ID card you wish to export. The ID card should download as a `.card` file.",,2017-08-30 13:50:05,https://api.github.com/repos/hyperledger/composer/pulls/comments/136050212,https://github.com/hyperledger/composer/pull/2031#discussion_r136050212,winslet
https://github.com/hyperledger/composer/pull/2031,https://github.com/hyperledger/composer/pull/2031,"This paragraph is quite heavy on new language, is there anywhere we can link to which explains more what an ""enrolment ID and enrolment secret is? Also ""enrolment"" has one ""l"". ",8b240a6b651d01ffbb2ce3c7527097982ee0c1f6,2017-08-30 12:20:27,136050548,"@@ -0,0 +1,149 @@
+---
+layout: default
+title: ID Cards
+category: tasks
+section: playground
+sidebar: sidebars/accordion-toc0.md
+excerpt: ID cards combine a connection profile, identity, and certificates to allow a connection to a business network in Hyperledger Composer Playground. ID cards can be [created, exported and imported](./id-cards-playground.html) from the **My Wallet** page in Hyperledger Composer Playground.
+index-order: 401
+---
+
+# ID Cards
+
+An ID Card provides all of the information needed to connect to a blockchain business network. It is only possible to access a blockchain Business Network through a valid ID Card. An ID Card contains and Identity for a single Participant within a deployed business network. ID Cards are used in the {{site.data.conrefs.composer_full}} Playground to connect to deployed Business Networks. You can have multiple ID Cards for a single deployed Business Network, where those ID Cards belong to multiple Participants.
+
+ID Cards are grouped under a Connection Profile, and each card shows the business network that may be accessed using the displayed Identity via the _Connect now_ option. An ID Card may be deleted or exported using the icons present on the card.
+
+Here is an ID Card that may be used to connect to the business network named 'my-business-network' using the Identity 'New User'
+
+![id-card](./id-card.png)
+
+An ID Card can be created when an Identity is issued within the Playground. This ID Card can then be exported and shared with others, allowing them to connect to the business network using the issued identity. If a user is provided with a Enrollment ID and Secret by an administrator, which corresponds to a valid Identity within a business network, then an ID Card may be directly created in the Playground. It is also possible to manually create an ID Card.
+
+---
+
+
+## <a name=""provide""></a>Providing Access To Your Business Network With an ID Card 
+
+Access to your Business Network is granted to another user through the provision of an ID Card. Once created, the ID Card may be exported and provided to the user for whom the card was created.
+
+There must be a Participant existing in the business network in order to bind an Identity required to create the ID Card.
+
+When an identity is issued within Playground, there is an option to add the Identity to your Wallet. By selecting this option an ID Card is created for the issued identity that is valid for the current business network. The ID Card will appear in your wallet once you log out of the current business network, and it is from this location where it may be exported to share with another user.
+
+
+### Creating an ID Card 
+
+1. From the **My Wallet** page, select an identity to use to connect to your business network. Click **Connect Now**. _Please note:_ You must use an identity that has permission to create new identities.
+
+2. If required, create the participant to which you intend to assign the identity:
+   - Click the **Test** tab, and click **Create New Participant**.
+   - Complete the Participant defintion and click **Create New**.
+
+3. Click the name of your identity in the upper right, and click **ID Registry** within the drop down.
+
+4. Click **+Issue New ID**.
+
+5. Choose an **ID Name**, and input an existing **Participant** to associate the new identity with. A look-ahead service is provided to auto-complete on known Participants.
+
+6. Click **Create New**.
+
+7. Click **Add to My Wallet**. Adding the ID card to your wallet allows you to use it to connect to the business network, or export it for someone else to use.
+
+The **My Wallet** page should now show the new ID Card.
+
+
+### Exporting an ID Card
+
+ID Cards are exported from the **My Wallet** page in Playground, through interaction with the ID Card that you wish to export and is a one-step process.
+
+1. On the **My Wallet** page, click the **Export** icon on the ID card you wish to export. The ID card should download as a `.card` file.
+
+_Please note_: If you export an ID card that has never been used, for example to send to a new participant, it will contain the enrollment ID and enrollment secret required to obtain the certificate and private key which are then used to identify participants. Alternatively, if you export an ID card that has been used before, it will already contain the certificate and private key.",,2017-08-30 13:50:05,https://api.github.com/repos/hyperledger/composer/pulls/comments/136050548,https://github.com/hyperledger/composer/pull/2031#discussion_r136050548,winslet
https://github.com/hyperledger/composer/pull/2031,https://github.com/hyperledger/composer/pull/2031,"Could we change ""you should never send..."" to ""we recommend you never send..."" (or perhaps a different wording - realistically people _are_ going to email this stuff - could we provide any suggestions to people as to how they might send it?)",8b240a6b651d01ffbb2ce3c7527097982ee0c1f6,2017-08-30 12:22:33,136051018,"@@ -0,0 +1,149 @@
+---
+layout: default
+title: ID Cards
+category: tasks
+section: playground
+sidebar: sidebars/accordion-toc0.md
+excerpt: ID cards combine a connection profile, identity, and certificates to allow a connection to a business network in Hyperledger Composer Playground. ID cards can be [created, exported and imported](./id-cards-playground.html) from the **My Wallet** page in Hyperledger Composer Playground.
+index-order: 401
+---
+
+# ID Cards
+
+An ID Card provides all of the information needed to connect to a blockchain business network. It is only possible to access a blockchain Business Network through a valid ID Card. An ID Card contains and Identity for a single Participant within a deployed business network. ID Cards are used in the {{site.data.conrefs.composer_full}} Playground to connect to deployed Business Networks. You can have multiple ID Cards for a single deployed Business Network, where those ID Cards belong to multiple Participants.
+
+ID Cards are grouped under a Connection Profile, and each card shows the business network that may be accessed using the displayed Identity via the _Connect now_ option. An ID Card may be deleted or exported using the icons present on the card.
+
+Here is an ID Card that may be used to connect to the business network named 'my-business-network' using the Identity 'New User'
+
+![id-card](./id-card.png)
+
+An ID Card can be created when an Identity is issued within the Playground. This ID Card can then be exported and shared with others, allowing them to connect to the business network using the issued identity. If a user is provided with a Enrollment ID and Secret by an administrator, which corresponds to a valid Identity within a business network, then an ID Card may be directly created in the Playground. It is also possible to manually create an ID Card.
+
+---
+
+
+## <a name=""provide""></a>Providing Access To Your Business Network With an ID Card 
+
+Access to your Business Network is granted to another user through the provision of an ID Card. Once created, the ID Card may be exported and provided to the user for whom the card was created.
+
+There must be a Participant existing in the business network in order to bind an Identity required to create the ID Card.
+
+When an identity is issued within Playground, there is an option to add the Identity to your Wallet. By selecting this option an ID Card is created for the issued identity that is valid for the current business network. The ID Card will appear in your wallet once you log out of the current business network, and it is from this location where it may be exported to share with another user.
+
+
+### Creating an ID Card 
+
+1. From the **My Wallet** page, select an identity to use to connect to your business network. Click **Connect Now**. _Please note:_ You must use an identity that has permission to create new identities.
+
+2. If required, create the participant to which you intend to assign the identity:
+   - Click the **Test** tab, and click **Create New Participant**.
+   - Complete the Participant defintion and click **Create New**.
+
+3. Click the name of your identity in the upper right, and click **ID Registry** within the drop down.
+
+4. Click **+Issue New ID**.
+
+5. Choose an **ID Name**, and input an existing **Participant** to associate the new identity with. A look-ahead service is provided to auto-complete on known Participants.
+
+6. Click **Create New**.
+
+7. Click **Add to My Wallet**. Adding the ID card to your wallet allows you to use it to connect to the business network, or export it for someone else to use.
+
+The **My Wallet** page should now show the new ID Card.
+
+
+### Exporting an ID Card
+
+ID Cards are exported from the **My Wallet** page in Playground, through interaction with the ID Card that you wish to export and is a one-step process.
+
+1. On the **My Wallet** page, click the **Export** icon on the ID card you wish to export. The ID card should download as a `.card` file.
+
+_Please note_: If you export an ID card that has never been used, for example to send to a new participant, it will contain the enrollment ID and enrollment secret required to obtain the certificate and private key which are then used to identify participants. Alternatively, if you export an ID card that has been used before, it will already contain the certificate and private key.
+
+**Important**: Exported identity cards should be handled with care since they contain unprotected credentials. For example, you should never send identity cards via email or other unencrypted means of communication without first encrypting the information.",,2017-08-30 13:50:05,https://api.github.com/repos/hyperledger/composer/pulls/comments/136051018,https://github.com/hyperledger/composer/pull/2031#discussion_r136051018,winslet
https://github.com/hyperledger/composer/pull/2031,https://github.com/hyperledger/composer/pull/2031,Not sure what the `` <a name= `` is here?,8b240a6b651d01ffbb2ce3c7527097982ee0c1f6,2017-08-30 12:24:51,136051476,"@@ -0,0 +1,149 @@
+---
+layout: default
+title: ID Cards
+category: tasks
+section: playground
+sidebar: sidebars/accordion-toc0.md
+excerpt: ID cards combine a connection profile, identity, and certificates to allow a connection to a business network in Hyperledger Composer Playground. ID cards can be [created, exported and imported](./id-cards-playground.html) from the **My Wallet** page in Hyperledger Composer Playground.
+index-order: 401
+---
+
+# ID Cards
+
+An ID Card provides all of the information needed to connect to a blockchain business network. It is only possible to access a blockchain Business Network through a valid ID Card. An ID Card contains and Identity for a single Participant within a deployed business network. ID Cards are used in the {{site.data.conrefs.composer_full}} Playground to connect to deployed Business Networks. You can have multiple ID Cards for a single deployed Business Network, where those ID Cards belong to multiple Participants.
+
+ID Cards are grouped under a Connection Profile, and each card shows the business network that may be accessed using the displayed Identity via the _Connect now_ option. An ID Card may be deleted or exported using the icons present on the card.
+
+Here is an ID Card that may be used to connect to the business network named 'my-business-network' using the Identity 'New User'
+
+![id-card](./id-card.png)
+
+An ID Card can be created when an Identity is issued within the Playground. This ID Card can then be exported and shared with others, allowing them to connect to the business network using the issued identity. If a user is provided with a Enrollment ID and Secret by an administrator, which corresponds to a valid Identity within a business network, then an ID Card may be directly created in the Playground. It is also possible to manually create an ID Card.
+
+---
+
+
+## <a name=""provide""></a>Providing Access To Your Business Network With an ID Card ",26,2017-08-30 13:50:05,https://api.github.com/repos/hyperledger/composer/pulls/comments/136051476,https://github.com/hyperledger/composer/pull/2031#discussion_r136051476,winslet
https://github.com/hyperledger/composer/pull/2031,https://github.com/hyperledger/composer/pull/2031,"He's trying to leave an anchor to link to, e.g.  `[text](./link.html#provide)`. ",8b240a6b651d01ffbb2ce3c7527097982ee0c1f6,2017-08-30 12:39:14,136054625,"@@ -0,0 +1,149 @@
+---
+layout: default
+title: ID Cards
+category: tasks
+section: playground
+sidebar: sidebars/accordion-toc0.md
+excerpt: ID cards combine a connection profile, identity, and certificates to allow a connection to a business network in Hyperledger Composer Playground. ID cards can be [created, exported and imported](./id-cards-playground.html) from the **My Wallet** page in Hyperledger Composer Playground.
+index-order: 401
+---
+
+# ID Cards
+
+An ID Card provides all of the information needed to connect to a blockchain business network. It is only possible to access a blockchain Business Network through a valid ID Card. An ID Card contains and Identity for a single Participant within a deployed business network. ID Cards are used in the {{site.data.conrefs.composer_full}} Playground to connect to deployed Business Networks. You can have multiple ID Cards for a single deployed Business Network, where those ID Cards belong to multiple Participants.
+
+ID Cards are grouped under a Connection Profile, and each card shows the business network that may be accessed using the displayed Identity via the _Connect now_ option. An ID Card may be deleted or exported using the icons present on the card.
+
+Here is an ID Card that may be used to connect to the business network named 'my-business-network' using the Identity 'New User'
+
+![id-card](./id-card.png)
+
+An ID Card can be created when an Identity is issued within the Playground. This ID Card can then be exported and shared with others, allowing them to connect to the business network using the issued identity. If a user is provided with a Enrollment ID and Secret by an administrator, which corresponds to a valid Identity within a business network, then an ID Card may be directly created in the Playground. It is also possible to manually create an ID Card.
+
+---
+
+
+## <a name=""provide""></a>Providing Access To Your Business Network With an ID Card ",26,2017-08-30 13:50:05,https://api.github.com/repos/hyperledger/composer/pulls/comments/136054625,https://github.com/hyperledger/composer/pull/2031#discussion_r136054625,EdProsser
https://github.com/hyperledger/composer/pull/2031,https://github.com/hyperledger/composer/pull/2031,"Enrolment has one L in British English, our docs are written in US English.",8b240a6b651d01ffbb2ce3c7527097982ee0c1f6,2017-08-30 12:43:25,136055563,"@@ -0,0 +1,149 @@
+---
+layout: default
+title: ID Cards
+category: tasks
+section: playground
+sidebar: sidebars/accordion-toc0.md
+excerpt: ID cards combine a connection profile, identity, and certificates to allow a connection to a business network in Hyperledger Composer Playground. ID cards can be [created, exported and imported](./id-cards-playground.html) from the **My Wallet** page in Hyperledger Composer Playground.
+index-order: 401
+---
+
+# ID Cards
+
+An ID Card provides all of the information needed to connect to a blockchain business network. It is only possible to access a blockchain Business Network through a valid ID Card. An ID Card contains and Identity for a single Participant within a deployed business network. ID Cards are used in the {{site.data.conrefs.composer_full}} Playground to connect to deployed Business Networks. You can have multiple ID Cards for a single deployed Business Network, where those ID Cards belong to multiple Participants.
+
+ID Cards are grouped under a Connection Profile, and each card shows the business network that may be accessed using the displayed Identity via the _Connect now_ option. An ID Card may be deleted or exported using the icons present on the card.
+
+Here is an ID Card that may be used to connect to the business network named 'my-business-network' using the Identity 'New User'
+
+![id-card](./id-card.png)
+
+An ID Card can be created when an Identity is issued within the Playground. This ID Card can then be exported and shared with others, allowing them to connect to the business network using the issued identity. If a user is provided with a Enrollment ID and Secret by an administrator, which corresponds to a valid Identity within a business network, then an ID Card may be directly created in the Playground. It is also possible to manually create an ID Card.
+
+---
+
+
+## <a name=""provide""></a>Providing Access To Your Business Network With an ID Card 
+
+Access to your Business Network is granted to another user through the provision of an ID Card. Once created, the ID Card may be exported and provided to the user for whom the card was created.
+
+There must be a Participant existing in the business network in order to bind an Identity required to create the ID Card.
+
+When an identity is issued within Playground, there is an option to add the Identity to your Wallet. By selecting this option an ID Card is created for the issued identity that is valid for the current business network. The ID Card will appear in your wallet once you log out of the current business network, and it is from this location where it may be exported to share with another user.
+
+
+### Creating an ID Card 
+
+1. From the **My Wallet** page, select an identity to use to connect to your business network. Click **Connect Now**. _Please note:_ You must use an identity that has permission to create new identities.
+
+2. If required, create the participant to which you intend to assign the identity:
+   - Click the **Test** tab, and click **Create New Participant**.
+   - Complete the Participant defintion and click **Create New**.
+
+3. Click the name of your identity in the upper right, and click **ID Registry** within the drop down.
+
+4. Click **+Issue New ID**.
+
+5. Choose an **ID Name**, and input an existing **Participant** to associate the new identity with. A look-ahead service is provided to auto-complete on known Participants.
+
+6. Click **Create New**.
+
+7. Click **Add to My Wallet**. Adding the ID card to your wallet allows you to use it to connect to the business network, or export it for someone else to use.
+
+The **My Wallet** page should now show the new ID Card.
+
+
+### Exporting an ID Card
+
+ID Cards are exported from the **My Wallet** page in Playground, through interaction with the ID Card that you wish to export and is a one-step process.
+
+1. On the **My Wallet** page, click the **Export** icon on the ID card you wish to export. The ID card should download as a `.card` file.
+
+_Please note_: If you export an ID card that has never been used, for example to send to a new participant, it will contain the enrollment ID and enrollment secret required to obtain the certificate and private key which are then used to identify participants. Alternatively, if you export an ID card that has been used before, it will already contain the certificate and private key.",,2017-08-30 13:50:05,https://api.github.com/repos/hyperledger/composer/pulls/comments/136055563,https://github.com/hyperledger/composer/pull/2031#discussion_r136055563,EdProsser
https://github.com/hyperledger/composer/pull/2031,https://github.com/hyperledger/composer/pull/2031,https://en.oxforddictionaries.com/definition/us/enrollment,8b240a6b651d01ffbb2ce3c7527097982ee0c1f6,2017-08-30 12:43:52,136055660,"@@ -0,0 +1,149 @@
+---
+layout: default
+title: ID Cards
+category: tasks
+section: playground
+sidebar: sidebars/accordion-toc0.md
+excerpt: ID cards combine a connection profile, identity, and certificates to allow a connection to a business network in Hyperledger Composer Playground. ID cards can be [created, exported and imported](./id-cards-playground.html) from the **My Wallet** page in Hyperledger Composer Playground.
+index-order: 401
+---
+
+# ID Cards
+
+An ID Card provides all of the information needed to connect to a blockchain business network. It is only possible to access a blockchain Business Network through a valid ID Card. An ID Card contains and Identity for a single Participant within a deployed business network. ID Cards are used in the {{site.data.conrefs.composer_full}} Playground to connect to deployed Business Networks. You can have multiple ID Cards for a single deployed Business Network, where those ID Cards belong to multiple Participants.
+
+ID Cards are grouped under a Connection Profile, and each card shows the business network that may be accessed using the displayed Identity via the _Connect now_ option. An ID Card may be deleted or exported using the icons present on the card.
+
+Here is an ID Card that may be used to connect to the business network named 'my-business-network' using the Identity 'New User'
+
+![id-card](./id-card.png)
+
+An ID Card can be created when an Identity is issued within the Playground. This ID Card can then be exported and shared with others, allowing them to connect to the business network using the issued identity. If a user is provided with a Enrollment ID and Secret by an administrator, which corresponds to a valid Identity within a business network, then an ID Card may be directly created in the Playground. It is also possible to manually create an ID Card.
+
+---
+
+
+## <a name=""provide""></a>Providing Access To Your Business Network With an ID Card 
+
+Access to your Business Network is granted to another user through the provision of an ID Card. Once created, the ID Card may be exported and provided to the user for whom the card was created.
+
+There must be a Participant existing in the business network in order to bind an Identity required to create the ID Card.
+
+When an identity is issued within Playground, there is an option to add the Identity to your Wallet. By selecting this option an ID Card is created for the issued identity that is valid for the current business network. The ID Card will appear in your wallet once you log out of the current business network, and it is from this location where it may be exported to share with another user.
+
+
+### Creating an ID Card 
+
+1. From the **My Wallet** page, select an identity to use to connect to your business network. Click **Connect Now**. _Please note:_ You must use an identity that has permission to create new identities.
+
+2. If required, create the participant to which you intend to assign the identity:
+   - Click the **Test** tab, and click **Create New Participant**.
+   - Complete the Participant defintion and click **Create New**.
+
+3. Click the name of your identity in the upper right, and click **ID Registry** within the drop down.
+
+4. Click **+Issue New ID**.
+
+5. Choose an **ID Name**, and input an existing **Participant** to associate the new identity with. A look-ahead service is provided to auto-complete on known Participants.
+
+6. Click **Create New**.
+
+7. Click **Add to My Wallet**. Adding the ID card to your wallet allows you to use it to connect to the business network, or export it for someone else to use.
+
+The **My Wallet** page should now show the new ID Card.
+
+
+### Exporting an ID Card
+
+ID Cards are exported from the **My Wallet** page in Playground, through interaction with the ID Card that you wish to export and is a one-step process.
+
+1. On the **My Wallet** page, click the **Export** icon on the ID card you wish to export. The ID card should download as a `.card` file.
+
+_Please note_: If you export an ID card that has never been used, for example to send to a new participant, it will contain the enrollment ID and enrollment secret required to obtain the certificate and private key which are then used to identify participants. Alternatively, if you export an ID card that has been used before, it will already contain the certificate and private key.",,2017-08-30 13:50:05,https://api.github.com/repos/hyperledger/composer/pulls/comments/136055660,https://github.com/hyperledger/composer/pull/2031#discussion_r136055660,EdProsser
https://github.com/hyperledger/composer/pull/2031,https://github.com/hyperledger/composer/pull/2031,done,8b240a6b651d01ffbb2ce3c7527097982ee0c1f6,2017-08-30 13:50:50,136073215,"@@ -0,0 +1,149 @@
+---
+layout: default
+title: ID Cards
+category: tasks
+section: playground
+sidebar: sidebars/accordion-toc0.md
+excerpt: ID cards combine a connection profile, identity, and certificates to allow a connection to a business network in Hyperledger Composer Playground. ID cards can be [created, exported and imported](./id-cards-playground.html) from the **My Wallet** page in Hyperledger Composer Playground.
+index-order: 401
+---
+
+# ID Cards
+
+An ID Card provides all of the information needed to connect to a blockchain business network. It is only possible to access a blockchain Business Network through a valid ID Card. An ID Card contains and Identity for a single Participant within a deployed business network. ID Cards are used in the {{site.data.conrefs.composer_full}} Playground to connect to deployed Business Networks. You can have multiple ID Cards for a single deployed Business Network, where those ID Cards belong to multiple Participants.
+
+ID Cards are grouped under a Connection Profile, and each card shows the business network that may be accessed using the displayed Identity via the _Connect now_ option. An ID Card may be deleted or exported using the icons present on the card.
+
+Here is an ID Card that may be used to connect to the business network named 'my-business-network' using the Identity 'New User'
+
+![id-card](./id-card.png)
+
+An ID Card can be created when an Identity is issued within the Playground. This ID Card can then be exported and shared with others, allowing them to connect to the business network using the issued identity. If a user is provided with a Enrollment ID and Secret by an administrator, which corresponds to a valid Identity within a business network, then an ID Card may be directly created in the Playground. It is also possible to manually create an ID Card.
+
+---
+
+
+## <a name=""provide""></a>Providing Access To Your Business Network With an ID Card 
+
+Access to your Business Network is granted to another user through the provision of an ID Card. Once created, the ID Card may be exported and provided to the user for whom the card was created.
+
+There must be a Participant existing in the business network in order to bind an Identity required to create the ID Card.
+
+When an identity is issued within Playground, there is an option to add the Identity to your Wallet. By selecting this option an ID Card is created for the issued identity that is valid for the current business network. The ID Card will appear in your wallet once you log out of the current business network, and it is from this location where it may be exported to share with another user.
+
+
+### Creating an ID Card 
+
+1. From the **My Wallet** page, select an identity to use to connect to your business network. Click **Connect Now**. _Please note:_ You must use an identity that has permission to create new identities.
+
+2. If required, create the participant to which you intend to assign the identity:
+   - Click the **Test** tab, and click **Create New Participant**.
+   - Complete the Participant defintion and click **Create New**.
+
+3. Click the name of your identity in the upper right, and click **ID Registry** within the drop down.
+
+4. Click **+Issue New ID**.
+
+5. Choose an **ID Name**, and input an existing **Participant** to associate the new identity with. A look-ahead service is provided to auto-complete on known Participants.
+
+6. Click **Create New**.
+
+7. Click **Add to My Wallet**. Adding the ID card to your wallet allows you to use it to connect to the business network, or export it for someone else to use.
+
+The **My Wallet** page should now show the new ID Card.
+
+
+### Exporting an ID Card
+
+ID Cards are exported from the **My Wallet** page in Playground, through interaction with the ID Card that you wish to export and is a one-step process.
+
+1. On the **My Wallet** page, click the **Export** icon on the ID card you wish to export. The ID card should download as a `.card` file.",,2017-08-30 13:50:50,https://api.github.com/repos/hyperledger/composer/pulls/comments/136073215,https://github.com/hyperledger/composer/pull/2031#discussion_r136073215,nklincoln
https://github.com/hyperledger/composer/pull/2031,https://github.com/hyperledger/composer/pull/2031,done,8b240a6b651d01ffbb2ce3c7527097982ee0c1f6,2017-08-30 13:51:02,136073273,"@@ -0,0 +1,149 @@
+---
+layout: default
+title: ID Cards
+category: tasks
+section: playground
+sidebar: sidebars/accordion-toc0.md
+excerpt: ID cards combine a connection profile, identity, and certificates to allow a connection to a business network in Hyperledger Composer Playground. ID cards can be [created, exported and imported](./id-cards-playground.html) from the **My Wallet** page in Hyperledger Composer Playground.
+index-order: 401
+---
+
+# ID Cards
+
+An ID Card provides all of the information needed to connect to a blockchain business network. It is only possible to access a blockchain Business Network through a valid ID Card. An ID Card contains and Identity for a single Participant within a deployed business network. ID Cards are used in the {{site.data.conrefs.composer_full}} Playground to connect to deployed Business Networks. You can have multiple ID Cards for a single deployed Business Network, where those ID Cards belong to multiple Participants.
+
+ID Cards are grouped under a Connection Profile, and each card shows the business network that may be accessed using the displayed Identity via the _Connect now_ option. An ID Card may be deleted or exported using the icons present on the card.
+
+Here is an ID Card that may be used to connect to the business network named 'my-business-network' using the Identity 'New User'
+
+![id-card](./id-card.png)
+
+An ID Card can be created when an Identity is issued within the Playground. This ID Card can then be exported and shared with others, allowing them to connect to the business network using the issued identity. If a user is provided with a Enrollment ID and Secret by an administrator, which corresponds to a valid Identity within a business network, then an ID Card may be directly created in the Playground. It is also possible to manually create an ID Card.
+
+---
+
+
+## <a name=""provide""></a>Providing Access To Your Business Network With an ID Card 
+
+Access to your Business Network is granted to another user through the provision of an ID Card. Once created, the ID Card may be exported and provided to the user for whom the card was created.
+
+There must be a Participant existing in the business network in order to bind an Identity required to create the ID Card.
+
+When an identity is issued within Playground, there is an option to add the Identity to your Wallet. By selecting this option an ID Card is created for the issued identity that is valid for the current business network. The ID Card will appear in your wallet once you log out of the current business network, and it is from this location where it may be exported to share with another user.
+
+
+### Creating an ID Card 
+
+1. From the **My Wallet** page, select an identity to use to connect to your business network. Click **Connect Now**. _Please note:_ You must use an identity that has permission to create new identities.
+
+2. If required, create the participant to which you intend to assign the identity:
+   - Click the **Test** tab, and click **Create New Participant**.
+   - Complete the Participant defintion and click **Create New**.
+
+3. Click the name of your identity in the upper right, and click **ID Registry** within the drop down.
+
+4. Click **+Issue New ID**.
+
+5. Choose an **ID Name**, and input an existing **Participant** to associate the new identity with. A look-ahead service is provided to auto-complete on known Participants.
+
+6. Click **Create New**.
+
+7. Click **Add to My Wallet**. Adding the ID card to your wallet allows you to use it to connect to the business network, or export it for someone else to use.
+
+The **My Wallet** page should now show the new ID Card.
+
+
+### Exporting an ID Card
+
+ID Cards are exported from the **My Wallet** page in Playground, through interaction with the ID Card that you wish to export and is a one-step process.
+
+1. On the **My Wallet** page, click the **Export** icon on the ID card you wish to export. The ID card should download as a `.card` file.
+
+_Please note_: If you export an ID card that has never been used, for example to send to a new participant, it will contain the enrollment ID and enrollment secret required to obtain the certificate and private key which are then used to identify participants. Alternatively, if you export an ID card that has been used before, it will already contain the certificate and private key.
+
+**Important**: Exported identity cards should be handled with care since they contain unprotected credentials. For example, you should never send identity cards via email or other unencrypted means of communication without first encrypting the information.",,2017-08-30 13:51:02,https://api.github.com/repos/hyperledger/composer/pulls/comments/136073273,https://github.com/hyperledger/composer/pull/2031#discussion_r136073273,nklincoln
https://github.com/hyperledger/composer/pull/2031,https://github.com/hyperledger/composer/pull/2031,yup - linking to the relevant anchor in the page that is targetted,8b240a6b651d01ffbb2ce3c7527097982ee0c1f6,2017-08-30 13:51:32,136073424,"@@ -0,0 +1,149 @@
+---
+layout: default
+title: ID Cards
+category: tasks
+section: playground
+sidebar: sidebars/accordion-toc0.md
+excerpt: ID cards combine a connection profile, identity, and certificates to allow a connection to a business network in Hyperledger Composer Playground. ID cards can be [created, exported and imported](./id-cards-playground.html) from the **My Wallet** page in Hyperledger Composer Playground.
+index-order: 401
+---
+
+# ID Cards
+
+An ID Card provides all of the information needed to connect to a blockchain business network. It is only possible to access a blockchain Business Network through a valid ID Card. An ID Card contains and Identity for a single Participant within a deployed business network. ID Cards are used in the {{site.data.conrefs.composer_full}} Playground to connect to deployed Business Networks. You can have multiple ID Cards for a single deployed Business Network, where those ID Cards belong to multiple Participants.
+
+ID Cards are grouped under a Connection Profile, and each card shows the business network that may be accessed using the displayed Identity via the _Connect now_ option. An ID Card may be deleted or exported using the icons present on the card.
+
+Here is an ID Card that may be used to connect to the business network named 'my-business-network' using the Identity 'New User'
+
+![id-card](./id-card.png)
+
+An ID Card can be created when an Identity is issued within the Playground. This ID Card can then be exported and shared with others, allowing them to connect to the business network using the issued identity. If a user is provided with a Enrollment ID and Secret by an administrator, which corresponds to a valid Identity within a business network, then an ID Card may be directly created in the Playground. It is also possible to manually create an ID Card.
+
+---
+
+
+## <a name=""provide""></a>Providing Access To Your Business Network With an ID Card ",26,2017-08-30 13:51:32,https://api.github.com/repos/hyperledger/composer/pulls/comments/136073424,https://github.com/hyperledger/composer/pull/2031#discussion_r136073424,nklincoln
https://github.com/hyperledger/composer/pull/2031,https://github.com/hyperledger/composer/pull/2031,"in reality, there is no good reason why you wouldnt add it ... because adding it is the most convenient method to share it ... ",8b240a6b651d01ffbb2ce3c7527097982ee0c1f6,2017-08-30 13:52:19,136073628,"@@ -0,0 +1,149 @@
+---
+layout: default
+title: ID Cards
+category: tasks
+section: playground
+sidebar: sidebars/accordion-toc0.md
+excerpt: ID cards combine a connection profile, identity, and certificates to allow a connection to a business network in Hyperledger Composer Playground. ID cards can be [created, exported and imported](./id-cards-playground.html) from the **My Wallet** page in Hyperledger Composer Playground.
+index-order: 401
+---
+
+# ID Cards
+
+An ID Card provides all of the information needed to connect to a blockchain business network. It is only possible to access a blockchain Business Network through a valid ID Card. An ID Card contains and Identity for a single Participant within a deployed business network. ID Cards are used in the {{site.data.conrefs.composer_full}} Playground to connect to deployed Business Networks. You can have multiple ID Cards for a single deployed Business Network, where those ID Cards belong to multiple Participants.
+
+ID Cards are grouped under a Connection Profile, and each card shows the business network that may be accessed using the displayed Identity via the _Connect now_ option. An ID Card may be deleted or exported using the icons present on the card.
+
+Here is an ID Card that may be used to connect to the business network named 'my-business-network' using the Identity 'New User'
+
+![id-card](./id-card.png)
+
+An ID Card can be created when an Identity is issued within the Playground. This ID Card can then be exported and shared with others, allowing them to connect to the business network using the issued identity. If a user is provided with a Enrollment ID and Secret by an administrator, which corresponds to a valid Identity within a business network, then an ID Card may be directly created in the Playground. It is also possible to manually create an ID Card.
+
+---
+
+
+## <a name=""provide""></a>Providing Access To Your Business Network With an ID Card 
+
+Access to your Business Network is granted to another user through the provision of an ID Card. Once created, the ID Card may be exported and provided to the user for whom the card was created.
+
+There must be a Participant existing in the business network in order to bind an Identity required to create the ID Card.
+
+When an identity is issued within Playground, there is an option to add the Identity to your Wallet. By selecting this option an ID Card is created for the issued identity that is valid for the current business network. The ID Card will appear in your wallet once you log out of the current business network, and it is from this location where it may be exported to share with another user.
+
+
+### Creating an ID Card 
+
+1. From the **My Wallet** page, select an identity to use to connect to your business network. Click **Connect Now**. _Please note:_ You must use an identity that has permission to create new identities.
+
+2. If required, create the participant to which you intend to assign the identity:
+   - Click the **Test** tab, and click **Create New Participant**.
+   - Complete the Participant defintion and click **Create New**.
+
+3. Click the name of your identity in the upper right, and click **ID Registry** within the drop down.
+
+4. Click **+Issue New ID**.
+
+5. Choose an **ID Name**, and input an existing **Participant** to associate the new identity with. A look-ahead service is provided to auto-complete on known Participants.
+
+6. Click **Create New**.
+
+7. Click **Add to My Wallet**. Adding the ID card to your wallet allows you to use it to connect to the business network, or export it for someone else to use.",,2017-08-30 13:52:19,https://api.github.com/repos/hyperledger/composer/pulls/comments/136073628,https://github.com/hyperledger/composer/pull/2031#discussion_r136073628,nklincoln
https://github.com/hyperledger/composer/pull/2030,https://github.com/hyperledger/composer/pull/2030,user's web browser,f07426869ec684fc087f4c4228a803df6e04b815,2017-08-29 21:45:37,135920662,"@@ -73,4 +73,22 @@ This step is dependent on the configuration and behaviour of the Passport strate
 2. The REST server will redirect you to GitHub to perform the OAuth web server authentication flow. GitHub will ask you if you want to authorize the Composer application to access your account. Click the **Authorize** button.
 3. If successful, GitHub will redirect you back to the REST server.
 
-Now, navigate to the REST API explorer at http://localhost:3000/explorer/. Attempt to call one of the business network REST API operations again using the REST API explorer. This time, the calls should succeed.
\ No newline at end of file
+Now, navigate to the REST API explorer at http://localhost:3000/explorer/. Attempt to call one of the business network REST API operations again using the REST API explorer. This time, the calls should succeed.
+
+## Authenticating to the REST server using an HTTP or REST client
+
+When a user authenticates to the REST server, a unique access token is generated and assigned to the authenticated user. When the user authenticates using a web browser, the access token is stored in a cookie in the local storage of the users web browser. When the authenticated user makes a subsequent request, the access token is retrieved from the cookie, and the access token is validated instead of reauthenticating the user.",10,2017-08-29 21:45:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/135920662,https://github.com/hyperledger/composer/pull/2030#discussion_r135920662,dselman
https://github.com/hyperledger/composer/pull/2030,https://github.com/hyperledger/composer/pull/2030,provider's,f07426869ec684fc087f4c4228a803df6e04b815,2017-08-29 21:46:14,135920785,"@@ -73,4 +73,22 @@ This step is dependent on the configuration and behaviour of the Passport strate
 2. The REST server will redirect you to GitHub to perform the OAuth web server authentication flow. GitHub will ask you if you want to authorize the Composer application to access your account. Click the **Authorize** button.
 3. If successful, GitHub will redirect you back to the REST server.
 
-Now, navigate to the REST API explorer at http://localhost:3000/explorer/. Attempt to call one of the business network REST API operations again using the REST API explorer. This time, the calls should succeed.
\ No newline at end of file
+Now, navigate to the REST API explorer at http://localhost:3000/explorer/. Attempt to call one of the business network REST API operations again using the REST API explorer. This time, the calls should succeed.
+
+## Authenticating to the REST server using an HTTP or REST client
+
+When a user authenticates to the REST server, a unique access token is generated and assigned to the authenticated user. When the user authenticates using a web browser, the access token is stored in a cookie in the local storage of the users web browser. When the authenticated user makes a subsequent request, the access token is retrieved from the cookie, and the access token is validated instead of reauthenticating the user.
+
+The access token can be used to authenticate any HTTP or REST client that wishes to call the REST server. This is required when the HTTP or REST client cannot perform the authentication flow required by the configured Passport strategy. For example, all OAuth2 web authentication flows require the use of a web browser to navigate to the authentication providers website. ",12,2017-08-29 21:46:14,https://api.github.com/repos/hyperledger/composer/pulls/comments/135920785,https://github.com/hyperledger/composer/pull/2030#discussion_r135920785,dselman
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,"You can mark JSDoc parameters as optional by wrapping the parameter name in square brackets, e.g. `[includeSystem]`. ",afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 08:44:04,137738867,"@@ -38,10 +38,11 @@ class AssetRegistry extends Registry {
      * @param {Factory} factory The factory to use for this asset registry.
      * @param {Serializer} serializer The Serializer to use for this asset registry.
      * @param {BusinessNetworkConnection} bnc Instance of the BuinsssNetworkConnection
+     * @param {Boolean} includeSystem Should system registries be included? (optional, default to false)",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137738867,https://github.com/hyperledger/composer/pull/2026#discussion_r137738867,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,`[includeSystem]`,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 08:45:34,137739163,"@@ -112,13 +113,14 @@ class BusinessNetworkConnection extends EventEmitter {
      * .then(function(assetRegistries){
      *     // Retrieved Asset Registries
      * });
-     * @param {SecurityContext} securityContext - The user's security context
      * @return {Promise} - A promise that will be resolved with a list of existing
      * asset registries
+     * @param {boolean} includeSystem if true the returned list will include the system transaction registries (optional, default to false)",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137739163,https://github.com/hyperledger/composer/pull/2026#discussion_r137739163,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,`[includeSystem]`,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 08:45:40,137739181,"@@ -196,13 +198,15 @@ class BusinessNetworkConnection extends EventEmitter {
      * .then(function(participantRegistries){
      *     // Retrieved Participant Registries
      * });
-     * @param {SecurityContext} securityContext - The user's security context
+     *
      * @return {Promise} - A promise that will be resolved with a list of existing
      * participant registries
+     * @param {boolean} includeSystem if true the returned list will include the system transaction registries (optional, default to false)",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137739181,https://github.com/hyperledger/composer/pull/2026#discussion_r137739181,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,Need to fix JSDoc example!,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 08:46:04,137739269,"@@ -280,21 +284,60 @@ class BusinessNetworkConnection extends EventEmitter {
      * .then(function(transactionRegistry){
      *     // Retrieved transaction registry.
      * });
+     * @param {string} id - The unique identifier of the transaction registry
      * @return {Promise} - A promise that will be resolved to the {@link TransactionRegistry}
      */
-    getTransactionRegistry() {
+    getTransactionRegistry(id) {",59,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137739269,https://github.com/hyperledger/composer/pull/2026#discussion_r137739269,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,`businessNetwork` not `businessNetworkDefinition`,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 08:46:37,137739378,"@@ -280,21 +284,60 @@ class BusinessNetworkConnection extends EventEmitter {
      * .then(function(transactionRegistry){
      *     // Retrieved transaction registry.
      * });
+     * @param {string} id - The unique identifier of the transaction registry
      * @return {Promise} - A promise that will be resolved to the {@link TransactionRegistry}
      */
-    getTransactionRegistry() {
+    getTransactionRegistry(id) {
         Util.securityCheck(this.securityContext);
-        return TransactionRegistry
-            .getAllTransactionRegistries(this.securityContext, this.getBusinessNetwork().getModelManager(), this.getBusinessNetwork().getFactory(), this.getBusinessNetwork().getSerializer())
-            .then((transactionRegistries) => {
-                if (transactionRegistries.length >= 1) {
-                    return transactionRegistries[0];
-                } else {
-                    throw new Error('Failed to find the default transaction registry');
-                }
-            });
+        return TransactionRegistry.getTransactionRegistry(this.securityContext, id, this.getBusinessNetwork().getModelManager(), this.getBusinessNetwork().getFactory(), this.getBusinessNetwork().getSerializer(),this);
+    }
+
+    /**
+     * Get all transaction registries.
+     * @example
+     * // Get the transaction registry
+     * var businessNetwork = new BusinessNetworkConnection();
+     * return businessNetwork.connect('testprofile', 'businessNetworkIdentifier', 'WebAppAdmin', 'DJY27pEnl16d')
+     * .then(function(businessNetworkDefinition){
+     *     return businessNetworkDefinition.getAllTransactionRegistries();
+     * })
+     * .then(function(transactionRegistries){
+     *     // Retrieved transaction Registries
+     * });
+     * @param {boolean} includeSystem if true the returned list will include the system transaction registries (optional, default to false)
+     * @return {Promise} - A promise that will be resolved to the {@link TransactionRegistry}
+     */
+    getAllTransactionRegistries(includeSystem) {
+        Util.securityCheck(this.securityContext);
+        let sysReg = includeSystem || false;
+        return TransactionRegistry.getAllTransactionRegistries(this.securityContext, this.getBusinessNetwork().getModelManager(), this.getBusinessNetwork().getFactory(), this.getBusinessNetwork().getSerializer(),this,sysReg);
     }
 
+
+    /**
+     * Determine whether a transaction registry exists.
+     * @example
+     * // Determine whether an transaction registry exists
+     * var businessNetwork = new BusinessNetworkConnection();
+     * return businessNetwork.connect('testprofile', 'businessNetworkIdentifier', 'WebAppAdmin', 'DJY27pEnl16d')
+     * .then(function(businessNetworkDefinition){
+     *     return businessNetworkDefinition.transactionRegistryExists('businessNetworkIdentifier.registryId');",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137739378,https://github.com/hyperledger/composer/pull/2026#discussion_r137739378,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,"Typo on `regsitry`, needs an example if this is meant to be public API.",afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 08:48:07,137739683,"@@ -402,6 +445,33 @@ class BusinessNetworkConnection extends EventEmitter {
     }
 
     /**
+     * Given a fully qualified name, works out and looks up the regsitry that this resource will be found in.
+     * This only gives back the system default registry - it does not look in any application defined registry
+     *
+     * @param {String} fullyQualifiedName The fully qualififed name of the resources
+     * @return {Promise} resolved with the registry that this fqn could be found in by default",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137739683,https://github.com/hyperledger/composer/pull/2026#discussion_r137739683,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,"Typo and should be an Error object, plus you can just `throw new Error` here - you only need to `return Promise.reject` if you're outside of a promise chain.",afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 09:47:56,137752030,"@@ -402,6 +445,33 @@ class BusinessNetworkConnection extends EventEmitter {
     }
 
     /**
+     * Given a fully qualified name, works out and looks up the regsitry that this resource will be found in.
+     * This only gives back the system default registry - it does not look in any application defined registry
+     *
+     * @param {String} fullyQualifiedName The fully qualififed name of the resources
+     * @return {Promise} resolved with the registry that this fqn could be found in by default
+     */
+    getRegistry(fullyQualifiedName) {
+        Util.securityCheck(this.securityContext);
+
+        let type = this.getModelManager().getType(fullyQualifiedName);
+        return Registry.getRegistry(this.securityContext, type, fullyQualifiedName)
+        .then((registry) => {
+            switch (type) {
+            case 'Transaction':
+                return new TransactionRegistry(registry.id, registry.name, this.securityContext, this.getModelManager(), this.getFactory(), this.getSerializer());
+            case 'Asset':
+                return new AssetRegistry(registry.id, registry.name, this.securityContext, this.getModelManager(), this.getFactory(), this.getSerializer());
+            case 'Participant':
+                return new ParticipantRegistry(registry.id, registry.name, this.securityContext, this.getModelManager(), this.getFactory(), this.getSerializer());
+            default:
+                return Promise.reject('Unkown what type of registry this could be in');",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137752030,https://github.com/hyperledger/composer/pull/2026#discussion_r137752030,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,BOO COMMENTED CODE BOO,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 09:49:09,137752274,"@@ -16,6 +16,7 @@
 
 const Resource = require('composer-common').Resource;
 const Util = require('composer-common').Util;
+// const ModelUtil = require('composer-common').ModelUtil;",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137752274,https://github.com/hyperledger/composer/pull/2026#discussion_r137752274,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,`[includeSystem]`,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 09:50:11,137752475,"@@ -32,15 +33,17 @@ class Registry {
      * @protected
      * @param {SecurityContext} securityContext The user's security context.
      * @param {string} registryType The type of this registry.
+     * @param {boolean} includeSystem True if system regisitries should be included (optional default is false)",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137752475,https://github.com/hyperledger/composer/pull/2026#discussion_r137752475,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,BOO MORE COMMENTED CODE,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 09:50:29,137752539,"@@ -176,13 +179,14 @@ class Registry {
         if (!resources) {
             throw new Error('resources not specified');
         }
+        // console.log('Adding resources; this is a :'+this.registryType+': registry with id :'+this.id+':');",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137752539,https://github.com/hyperledger/composer/pull/2026#discussion_r137752539,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,`[includeSystem]`,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 09:50:43,137752588,"@@ -38,10 +38,11 @@ class ParticipantRegistry extends Registry {
      * @param {Factory} factory The factory to use for this participant registry.
      * @param {Serializer} serializer The Serializer to use for this participant registry.
      * @param {BusinessNetworkConnection} bnc BusinessNetworkConnection to use
+     * @param {Boolean} includeSystem Should system registries be included? (optional, default to false)",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137752588,https://github.com/hyperledger/composer/pull/2026#discussion_r137752588,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,`// stop commenting out code`,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 09:52:29,137752903,"@@ -17,6 +17,11 @@
 const ConnectionManager = require('./connectionmanager');
 const EventEmitter = require('events');
 
+// const Resource = require('composer-common').Resource;",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137752903,https://github.com/hyperledger/composer/pull/2026#discussion_r137752903,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,:rage4: ,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 09:53:00,137752989,"@@ -257,14 +262,65 @@ class Connection extends EventEmitter {
      * artifacts have been updated, or rejected with an error.
      */
     update(securityContext, businessNetworkDefinition) {
-        return new Promise((resolve, reject) => {
-            this._update(securityContext, businessNetworkDefinition, (error) => {
-                if (error) {
-                    return reject(error);
-                }
-                return resolve();
-            });
+        return this._updateTx(securityContext,businessNetworkDefinition);
+        // return new Promise((resolve, reject) => {",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137752989,https://github.com/hyperledger/composer/pull/2026#discussion_r137752989,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,"What is this array for - it's only added to, never read from?",afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 09:53:58,137753167,"@@ -95,6 +95,7 @@ class ConnectionProfileManager {
     getConnectionManager(connectionProfile) {
         const METHOD = 'getConnectionManager';
         LOG.info(METHOD,'Looking up a connection manager for profile', connectionProfile);
+        let errorList = [];",4,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137753167,https://github.com/hyperledger/composer/pull/2026#discussion_r137753167,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,`// :-(`,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 09:54:24,137753253,"@@ -14,7 +14,7 @@
 
 'use strict';
 
-const sprintf = require('sprintf-js').sprintf;
+// const sprintf = require('sprintf-js').sprintf;",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137753253,https://github.com/hyperledger/composer/pull/2026#discussion_r137753253,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,`/* no commented out code plz */`,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 09:55:47,137753514,"@@ -107,8 +107,9 @@ asset HistorianRecord identified by transactionId {
 // -----------------------------------------------------------------------------
 // System transactions that act on Registries of any type
 abstract transaction RegistryTransaction {
-  o String registryType
-  o String registryId
+  --> Registry targetRegistry
+  // o String registryType",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137753514,https://github.com/hyperledger/composer/pull/2026#discussion_r137753514,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,ðŸ¥‡ for amount of commented out code ðŸ˜‚ ,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 09:56:49,137753684,"@@ -84,6 +88,14 @@ class Util {
             }
         });
         return securityContext.getConnection().invokeChainCode(securityContext, functionName, args);
+        // .then ( (result) => {",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137753684,https://github.com/hyperledger/composer/pull/2026#discussion_r137753684,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,`should.eventually.not.be.commented.out`,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 09:57:49,137753846,"@@ -242,24 +253,58 @@ describe('Connection', () => {
     describe('#update', () => {
 
         it('should call _update and handle no error', () => {
-            sinon.stub(connection, '_update').yields(null);
+            sinon.stub(connection, '_updateTx').resolves();
             return connection.update(mockSecurityContext, mockBusinessNetworkDefinition)
                 .then(() => {
-                    sinon.assert.calledWith(connection._update, mockSecurityContext, mockBusinessNetworkDefinition);
+                    sinon.assert.calledWith(connection._updateTx, mockSecurityContext, mockBusinessNetworkDefinition);
                 });
         });
 
         it('should call _update and handle an error', () => {
-            sinon.stub(connection, '_update').yields(new Error('error'));
+            sinon.stub(connection, '_updateTx').rejects(new Error('error'));
             return connection.update(mockSecurityContext, mockBusinessNetworkDefinition)
                 .should.be.rejectedWith(/error/)
                 .then(() => {
-                    sinon.assert.calledWith(connection._update, mockSecurityContext, mockBusinessNetworkDefinition);
+                    sinon.assert.calledWith(connection._updateTx, mockSecurityContext, mockBusinessNetworkDefinition);
                 });
         });
 
     });
 
+    describe('#_updateTX', () => {
+
+        it('should throw as abstract method', () => {
+            const buffer = Buffer.from(JSON.stringify({
+                data: 'aGVsbG8='
+            }));
+
+            const buffer2 = Buffer.from(JSON.stringify({
+                data: 'aGsad33VsbG8='
+            }));
+            sandbox.stub(Util, 'queryChainCode').withArgs(mockSecurityContext, 'getBusinessNetwork', []).resolves(buffer);
+            sandbox.stub(Util, 'invokeChainCode').resolves();
+            sandbox.stub(BusinessNetworkDefinition, 'fromArchive').resolves(mockBusinessNetworkDefinition);
+            mockBusinessNetworkDefinition.toArchive.resolves(buffer2);
+            let mockFactory = sinon.createStubInstance(Factory);
+            let mockSerializer = sinon.createStubInstance(Serializer);
+            let mockTransaction = sinon.createStubInstance(Resource);
+
+            mockFactory.newTransaction.returns(mockTransaction);
+            mockBusinessNetworkDefinition.getFactory.returns(mockFactory);
+            mockBusinessNetworkDefinition.getSerializer.returns(mockSerializer);
+            mockSerializer.toJSON.returns({key:'value'});
+            mockTransaction.getIdentifier.returns('txid');
+            // (() => {
+            return connection._updateTx(mockSecurityContext, mockBusinessNetworkDefinition)
+            .then(()=>{
+                sinon.assert.called(Util.invokeChainCode);
+                sinon.assert.called(Util.queryChainCode);
+            });
+            // }).should.resolve();",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137753846,https://github.com/hyperledger/composer/pull/2026#discussion_r137753846,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,commentz,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 09:58:26,137753992,"@@ -229,12 +229,12 @@ class EmbeddedConnection extends Connection {
      * @return {Promise} A promise that is resolved once the business network
      * artifacts have been updated, or rejected with an error.
      */
-    update(securityContext, businessNetworkDefinition) {
-        return businessNetworkDefinition.toArchive({ date: new Date(545184000000) })
-            .then((buffer) => {
-                return this.invokeChainCode(securityContext, 'updateBusinessNetwork', [buffer.toString('base64')]);
-            });
-    }
+    // update(securityContext, businessNetworkDefinition) {",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137753992,https://github.com/hyperledger/composer/pull/2026#discussion_r137753992,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,commentz,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 09:58:38,137754032,"@@ -639,35 +639,33 @@ class HLFConnection extends Connection {
      * @return {Promise} A promise that is resolved once the business network
      * artifacts have been updated, or rejected with an error.
      */
-    update(securityContext, businessNetworkDefinition) {
-        const method = 'update';
-        LOG.entry(method, securityContext, businessNetworkDefinition);
-
-        // Check that a valid security context has been specified.
-        HLFUtil.securityCheck(securityContext);
-
-        // Validate all the arguments.
-        if (!businessNetworkDefinition) {
-            throw new Error('businessNetworkDefinition not specified');
-        }
-
-        // Serialize the business network.
-        return businessNetworkDefinition.toArchive()
-            .then((businessNetworkArchive) => {
-
-                // Send an update request to the chaincode.
-                return this.invokeChainCode(securityContext, 'updateBusinessNetwork', [businessNetworkArchive.toString('base64')]);
-
-            })
-            .then(() => {
-                LOG.exit(method);
-            })
-            .catch((error) => {
-                const newError = new Error('Error trying to update business network. ' + error);
-                LOG.error(method, newError);
-                throw newError;
-            });
-    }
+    // update(securityContext, businessNetworkDefinition) {",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137754032,https://github.com/hyperledger/composer/pull/2026#discussion_r137754032,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,:sob:,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 10:39:48,137761129,"@@ -15,61 +15,77 @@
 'use strict';
 
 const Logger = require('composer-common').Logger;
-const util = require('util');
+// const util = require('util');
 const fs = require('fs');
 
 const LOG = Logger.getLog('HLFConnectionManager');
 
+// global.hfc = {",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137761129,https://github.com/hyperledger/composer/pull/2026#discussion_r137761129,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,:sob:,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 10:39:58,137761158,"@@ -82,25 +82,25 @@ describe('HLFConnectionManager', () => {
         it('should insert a debug logger', () => {
             sandbox.stub(LOG, 'debug');
             global.hfc.logger.debug('hello %s', 'world');
-            sinon.assert.calledOnce(LOG.debug);
+            // sinon.assert.calledOnce(LOG.debug);",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137761158,https://github.com/hyperledger/composer/pull/2026#discussion_r137761158,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,This is inconsistent with the other changes to add a `mocha` target?,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 10:40:58,137761315,"@@ -19,6 +19,7 @@
     ""postdoc"": ""npm run browserify"",
     ""browserify"": ""browserify ./index.js -t [ babelify --presets [ latest ] ] > ./out/composer-common.js"",
     ""test"": ""node ./scripts/api-changelog.js && nyc mocha --recursive -t 10000"",
+    ""mocha"": ""mocha --recursive -t 10000 test/connection.js"",",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137761315,https://github.com/hyperledger/composer/pull/2026#discussion_r137761315,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,This is inconsistent with the other changes to add a `mocha` target?,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 10:41:10,137761344,"@@ -18,7 +18,8 @@
     ""lint"": ""eslint ."",
     ""postlint"": ""npm run browserify"",
     ""browserify"": ""browserify ./index.js -t [ babelify --presets [ latest ] ] > ./out/composer-runtime.js"",
-    ""test"": ""nyc mocha --recursive -t 10000""
+    ""test"": ""nyc mocha --recursive -t 10000"",
+    ""mocha"": ""mocha --recursive -t 10000 test/networkmanager.js""",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137761344,https://github.com/hyperledger/composer/pull/2026#discussion_r137761344,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,This is inconsistent with the other changes to add a `mocha` target?,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 10:41:24,137761373,"@@ -18,7 +18,8 @@
     ""doc"": ""jsdoc --pedantic --recurse -c jsdoc.json"",
     ""postdoc"": ""npm run lint"",
     ""lint"": ""eslint ."",
-    ""test"": ""nyc mocha --recursive -t 10000""
+    ""test"": ""nyc mocha --recursive -t 10000"",
+    ""mocha"": ""mocha --recursive -t 10000 --bail""",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137761373,https://github.com/hyperledger/composer/pull/2026#discussion_r137761373,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,ðŸ˜­ need some asserts here!,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 10:42:02,137761457,"@@ -340,44 +340,44 @@ describe('System REST API unit tests', () => {
 
     });
 
-    describe('GET /transactions', () => {
+    describe('GET /historian', () => {
 
         it('should return all of the transactions', () => {
             return chai.request(app)
-                .get('/api/system/transactions')
+                .get('/api/system/historian')
                 .then((res) => {
-                    res.should.be.json;
-                    res.body.filter((tx) => {
-                        return tx.$class === 'org.acme.bond.PublishBond';
-                    }).sort((a, b) => {
-                        return a.ISINCode.localeCompare(b.ISINCode);
-                    }).map((tx) => {
-                        delete tx.transactionId;
-                        delete tx.timestamp;
-                        return tx;
-                    }).should.deep.equal(transactionData);
+                    // res.should.be.json;",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137761457,https://github.com/hyperledger/composer/pull/2026#discussion_r137761457,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,Needs asserts and removing of the empty catch block!,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 10:42:31,137761524,"@@ -340,44 +340,44 @@ describe('System REST API unit tests', () => {
 
     });
 
-    describe('GET /transactions', () => {
+    describe('GET /historian', () => {
 
         it('should return all of the transactions', () => {
             return chai.request(app)
-                .get('/api/system/transactions')
+                .get('/api/system/historian')
                 .then((res) => {
-                    res.should.be.json;
-                    res.body.filter((tx) => {
-                        return tx.$class === 'org.acme.bond.PublishBond';
-                    }).sort((a, b) => {
-                        return a.ISINCode.localeCompare(b.ISINCode);
-                    }).map((tx) => {
-                        delete tx.transactionId;
-                        delete tx.timestamp;
-                        return tx;
-                    }).should.deep.equal(transactionData);
+                    // res.should.be.json;
+                    // res.body.filter((tx) => {
+                    //     return tx.$class === 'org.acme.bond.PublishBond';
+                    // }).sort((a, b) => {
+                    //     return a.ISINCode.localeCompare(b.ISINCode);
+                    // }).map((tx) => {
+                    //     delete tx.transactionId;
+                    //     delete tx.timestamp;
+                    //     return tx;
+                    // }).should.deep.equal(transactionData);
                 });
         });
 
     });
 
-    describe('GET /transactions/:id', () => {
+    describe('GET /historian/:id', () => {
 
         it('should return the specified transaction', () => {
             return chai.request(app)
-                .get('/api/system/transactions/' + transactionIds[0])
+                .get('/api/system/historian/' + transactionIds[0])
                 .then((res) => {
-                    res.should.be.json;
-                    const tx = res.body;
-                    delete tx.transactionId;
-                    delete tx.timestamp;
-                    tx.should.deep.equal(transactionData[0]);
-                });
+                    // res.should.be.json;
+                    // const tx = res.body;
+                    // delete tx.transactionId;
+                    // delete tx.timestamp;
+                    // tx.should.deep.equal(transactionData[0]);
+                }).catch((err)=>{});",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137761524,https://github.com/hyperledger/composer/pull/2026#discussion_r137761524,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,commentz,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 10:42:45,137761567,"@@ -14,9 +14,8 @@
 
 'use strict';
 
-const BusinessNetworkDefinition = require('composer-common').BusinessNetworkDefinition;
-const Context = require('./context');
-const createHash = require('sha.js');
+// const BusinessNetworkDefinition = require('composer-common').BusinessNetworkDefinition;
+// const createHash = require('sha.js');",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137761567,https://github.com/hyperledger/composer/pull/2026#discussion_r137761567,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,commentz,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 10:42:53,137761589,"@@ -105,103 +104,105 @@ class EngineBusinessNetworks {
     }
 
 
-    /**
-     * Update the business network archive.
-     * @param {Context} context The request context.
-     * @param {string[]} args The arguments to pass to the chaincode function.
-     * @return {Promise} A promise that will be resolved when complete, or rejected
-     * with an error.
-     */
-    updateBusinessNetwork(context, args) {
-        const method = 'updateBusinessNetwork';
-        LOG.entry(method, context, args);
-        if (args.length !== 1) {
-            LOG.error(method, 'Invalid arguments', args);
-            throw new Error(util.format('Invalid arguments ""%j"" to function ""%s"", expecting ""%j""', args, 'updateBusinessNetwork', ['businessNetworkArchive']));
-        }
-        let dataService = context.getDataService();
-        let businessNetworkBase64, businessNetworkHash, businessNetworkDefinition;
-        let compiledScriptBundle, compiledQueryBundle, compiledAclBundle;
-        let sysdata, resource;
-        return dataService.getCollection('$sysdata')
-            .then((result) => {
-                sysdata = result;
-                return sysdata.get('metanetwork');
-            })
-            .then((result) => {
-                resource = context.getSerializer().fromJSON(result);
-                return context.getAccessController().check(resource, 'UPDATE');
-            })
-            // return Promise.resolve()
-            .then(() => {
+    // /**
+    //  * Update the business network archive.
+    //  * @param {Context} context The request context.
+    //  * @param {string[]} args The arguments to pass to the chaincode function.
+    //  * @return {Promise} A promise that will be resolved when complete, or rejected
+    //  * with an error.
+    //  */
+    // updateBusinessNetwork(context, cache,transaction) {",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137761589,https://github.com/hyperledger/composer/pull/2026#discussion_r137761589,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,commentz,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 10:43:31,137761685,"@@ -32,9 +33,9 @@ const TYPE_MAP = {
 
 // This is a list of non-abstract system types that we do not want registries created for.
 const VIRTUAL_TYPES = [
-    'AssetRegistry',
+    /*'AssetRegistry',",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137761685,https://github.com/hyperledger/composer/pull/2026#discussion_r137761685,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,Probably not needed anymore ðŸ˜‰ ,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 10:43:54,137761743,"@@ -31,6 +30,7 @@ class TransactionHandler {
      */
     constructor() {
         this.handlers = {};
+        this.id=Math.random();",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137761743,https://github.com/hyperledger/composer/pull/2026#discussion_r137761743,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,commentz,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 10:44:02,137761762,"@@ -308,7 +314,7 @@ describe('Context', () => {
             mockIdentityManager.getParticipant.withArgs(mockIdentity).resolves(mockParticipant);
             context.function = 'submitTransaction';
             context.arguments = [
-                '45ea5b75-cc00-40bb-afad-4952ad97d469',
+                // '45ea5b75-cc00-40bb-afad-4952ad97d469',",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137761762,https://github.com/hyperledger/composer/pull/2026#discussion_r137761762,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,commentz,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 10:44:07,137761778,"@@ -14,21 +14,21 @@
 
 'use strict';
 
-const AclCompiler = require('../lib/aclcompiler');
-const BusinessNetworkDefinition = require('composer-common').BusinessNetworkDefinition;
-const CompiledAclBundle = require('../lib/compiledaclbundle');
-const CompiledQueryBundle = require('../lib/compiledquerybundle');
-const CompiledScriptBundle = require('../lib/compiledscriptbundle');
+// const AclCompiler = require('../lib/aclcompiler');",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137761778,https://github.com/hyperledger/composer/pull/2026#discussion_r137761778,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,commentz,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 10:44:13,137761791,"@@ -126,66 +126,66 @@ describe('EngineBusinessNetworks', () => {
         });
     });
 
-    describe('#updateBusinessNetwork', () => {
-
-        it('should throw for invalid arguments', () => {
-            let result = engine.invoke(mockContext, 'updateBusinessNetwork', ['no', 'args', 'supported']);
-            return result.should.be.rejectedWith(/Invalid arguments ""\[""no"",""args"",""supported""\]"" to function ""updateBusinessNetwork"", expecting ""\[\""businessNetworkArchive\""\]""/);
-        });
-
-        it('should update the business network archive and create default registries', () => {
-            let sysdata = sinon.createStubInstance(DataCollection);
-            sysdata.update.withArgs('businessnetwork', { data: 'aGVsbG8gd29ybGQ=' }).resolves();
-            mockDataService.getCollection.withArgs('$sysdata').resolves(sysdata);
-            let mockBusinessNetworkDefinition = sinon.createStubInstance(BusinessNetworkDefinition);
-            let mockScriptManager = sinon.createStubInstance(ScriptManager);
-            mockBusinessNetworkDefinition.getScriptManager.returns(mockScriptManager);
-            sandbox.stub(BusinessNetworkDefinition, 'fromArchive').resolves(mockBusinessNetworkDefinition);
-            let mockScriptCompiler = sinon.createStubInstance(ScriptCompiler);
-            let mockCompiledScriptBundle = sinon.createStubInstance(CompiledScriptBundle);
-            mockScriptCompiler.compile.returns(mockCompiledScriptBundle);
-            mockContext.getScriptCompiler.returns(mockScriptCompiler);
-            let mockQueryCompiler = sinon.createStubInstance(QueryCompiler);
-            let mockCompiledQueryBundle = sinon.createStubInstance(CompiledQueryBundle);
-            mockQueryCompiler.compile.returns(mockCompiledQueryBundle);
-            mockContext.getQueryCompiler.returns(mockQueryCompiler);
-            let mockAclCompiler = sinon.createStubInstance(AclCompiler);
-            let mockCompiledAclBundle = sinon.createStubInstance(CompiledAclBundle);
-            mockAclCompiler.compile.returns(mockCompiledAclBundle);
-            mockContext.getAclCompiler.returns(mockAclCompiler);
-            sandbox.stub(Context, 'cacheBusinessNetwork');
-            sandbox.stub(Context, 'cacheCompiledScriptBundle');
-            sandbox.stub(Context, 'cacheCompiledQueryBundle');
-            sandbox.stub(Context, 'cacheCompiledAclBundle');
-            mockRegistryManager.createDefaults.resolves();
-            return engine.invoke(mockContext, 'updateBusinessNetwork', ['aGVsbG8gd29ybGQ='])
-                .then((result) => {
-                    sinon.assert.calledOnce(sysdata.update);
-                    sinon.assert.calledWith(sysdata.update, 'businessnetwork', { data: 'aGVsbG8gd29ybGQ=', hash: 'dc9c1c09907c36f5379d615ae61c02b46ba254d92edb77cb63bdcc5247ccd01c' });
-                    sinon.assert.calledOnce(Context.cacheBusinessNetwork);
-                    sinon.assert.calledWith(Context.cacheBusinessNetwork, 'dc9c1c09907c36f5379d615ae61c02b46ba254d92edb77cb63bdcc5247ccd01c', mockBusinessNetworkDefinition);
-                    sinon.assert.calledOnce(Context.cacheCompiledScriptBundle);
-                    sinon.assert.calledWith(Context.cacheCompiledScriptBundle, 'dc9c1c09907c36f5379d615ae61c02b46ba254d92edb77cb63bdcc5247ccd01c', mockCompiledScriptBundle);
-                    sinon.assert.calledOnce(Context.cacheCompiledQueryBundle);
-                    sinon.assert.calledWith(Context.cacheCompiledQueryBundle, 'dc9c1c09907c36f5379d615ae61c02b46ba254d92edb77cb63bdcc5247ccd01c', mockCompiledQueryBundle);
-                    sinon.assert.calledOnce(Context.cacheCompiledAclBundle);
-                    sinon.assert.calledWith(Context.cacheCompiledAclBundle, 'dc9c1c09907c36f5379d615ae61c02b46ba254d92edb77cb63bdcc5247ccd01c', mockCompiledAclBundle);
-                    sinon.assert.calledTwice(mockContext.initialize);
-                    // Initialize.
-                    sinon.assert.calledWith(mockContext.initialize);
-                    // Reinitialize.
-                    sinon.assert.calledWith(mockContext.initialize, {
-                        businessNetworkDefinition: mockBusinessNetworkDefinition,
-                        compiledScriptBundle: mockCompiledScriptBundle,
-                        compiledQueryBundle: mockCompiledQueryBundle,
-                        compiledAclBundle: mockCompiledAclBundle,
-                        reinitialize: true
-                    });
-                    sinon.assert.calledOnce(mockRegistryManager.createDefaults);
-                });
-        });
-
-    });
+    // describe('#updateBusinessNetwork', () => {",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137761791,https://github.com/hyperledger/composer/pull/2026#discussion_r137761791,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,commentz,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 16:06:25,137828927,"@@ -0,0 +1,174 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+const AclCompiler = require('../lib/aclcompiler');
+const BusinessNetworkDefinition = require('composer-common').BusinessNetworkDefinition;
+const CompiledAclBundle = require('../lib/compiledaclbundle');
+const CompiledQueryBundle = require('../lib/compiledquerybundle');
+const CompiledScriptBundle = require('../lib/compiledscriptbundle');
+// const Container = require('../lib/container');
+const Context = require('../lib/context');
+const DataCollection = require('../lib/datacollection');
+const DataService = require('../lib/dataservice');
+// const Engine = require('../lib/engine');
+// const LoggingService = require('../lib/loggingservice');",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137828927,https://github.com/hyperledger/composer/pull/2026#discussion_r137828927,sstone1
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,"Learn something new all the time :-)
",afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 19:49:26,137875561,"@@ -402,6 +445,33 @@ class BusinessNetworkConnection extends EventEmitter {
     }
 
     /**
+     * Given a fully qualified name, works out and looks up the regsitry that this resource will be found in.
+     * This only gives back the system default registry - it does not look in any application defined registry
+     *
+     * @param {String} fullyQualifiedName The fully qualififed name of the resources
+     * @return {Promise} resolved with the registry that this fqn could be found in by default
+     */
+    getRegistry(fullyQualifiedName) {
+        Util.securityCheck(this.securityContext);
+
+        let type = this.getModelManager().getType(fullyQualifiedName);
+        return Registry.getRegistry(this.securityContext, type, fullyQualifiedName)
+        .then((registry) => {
+            switch (type) {
+            case 'Transaction':
+                return new TransactionRegistry(registry.id, registry.name, this.securityContext, this.getModelManager(), this.getFactory(), this.getSerializer());
+            case 'Asset':
+                return new AssetRegistry(registry.id, registry.name, this.securityContext, this.getModelManager(), this.getFactory(), this.getSerializer());
+            case 'Participant':
+                return new ParticipantRegistry(registry.id, registry.name, this.securityContext, this.getModelManager(), this.getFactory(), this.getSerializer());
+            default:
+                return Promise.reject('Unkown what type of registry this could be in');",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137875561,https://github.com/hyperledger/composer/pull/2026#discussion_r137875561,mbwhite
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,"idea was to capture all the errors, and then put them into the error... to help debug the 'connector-hlfv1 not found' errors. done. ",afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 20:07:52,137879058,"@@ -95,6 +95,7 @@ class ConnectionProfileManager {
     getConnectionManager(connectionProfile) {
         const METHOD = 'getConnectionManager';
         LOG.info(METHOD,'Looking up a connection manager for profile', connectionProfile);
+        let errorList = [];",4,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137879058,https://github.com/hyperledger/composer/pull/2026#discussion_r137879058,mbwhite
https://github.com/hyperledger/composer/pull/2026,https://github.com/hyperledger/composer/pull/2026,accepted with pride...,afa5437718a2fb8fbe04ed7bacf8317252761874,2017-09-08 20:19:09,137881158,"@@ -84,6 +88,14 @@ class Util {
             }
         });
         return securityContext.getConnection().invokeChainCode(securityContext, functionName, args);
+        // .then ( (result) => {",,2017-09-15 15:11:40,https://api.github.com/repos/hyperledger/composer/pulls/comments/137881158,https://github.com/hyperledger/composer/pull/2026#discussion_r137881158,mbwhite
https://github.com/hyperledger/composer/pull/1990,https://github.com/hyperledger/composer/pull/1990,"We probably shouldn't keep the secret either once they have enrolled as its not needed, should set it to empty string",f1269919b51695c5e0bd3a69875a3183f4e17505,2017-08-24 08:55:45,134961462,"@@ -277,24 +292,40 @@ export class IdentityCardService {
         return wantedCards;
     }
 
-    activateCurrentIdentityCard(): Promise<string | void> {
-        let data: any = this.identityCardStorageService.get(this.dataRef(this.currentCard));
+    private activateIdentityCard(cardRef): Promise<string | void> {
+        let data: any = this.identityCardStorageService.get(this.dataRef(cardRef));
 
         if (data && data.unused) {
             delete data['unused'];
-            this.identityCardStorageService.set(this.dataRef(this.currentCard), data);
+            this.identityCardStorageService.set(this.dataRef(cardRef), data);
 
-            let card = this.idCards.get(this.currentCard);
+            let hasCredentials = false;
+            let card = this.idCards.get(cardRef);
             let connectionProfile = card.getConnectionProfile();
-            let connectionProfileName = this.getQualifiedProfileName(connectionProfile);
-
-            // Hmmm, suspicious... is the enrollement ID really the identity?!
+            let connectionProfileRef = this.getQualifiedProfileName(connectionProfile);
             let enrollmentCredentials = card.getEnrollmentCredentials();
+            let credentials = card.getCredentials();
 
-            // Is this enough activation? What about the identity import thing?
-            return this.connectionProfileService.createProfile(connectionProfileName, connectionProfile).then(() => {
-                return this.currentCard;
-            });
+            if (credentials && credentials.certificate && credentials.privateKey) {
+                hasCredentials = true;
+
+                // don't want to keep credentials around after the card has been activated
+                card.setCredentials({});",189,2017-08-24 09:44:29,https://api.github.com/repos/hyperledger/composer/pulls/comments/134961462,https://github.com/hyperledger/composer/pull/1990#discussion_r134961462,cazfletch
https://github.com/hyperledger/composer/pull/1990,https://github.com/hyperledger/composer/pull/1990,"You potentially need the secret if the card hasn't been used anywhere so I'm not quite sure where this should happen- possibly in the admin service after connecting?
Removing the secret would be nice but in a real system it should only be good for a single use, and there's no harm it remaining in the cards after use.",f1269919b51695c5e0bd3a69875a3183f4e17505,2017-08-24 09:57:53,134974635,"@@ -277,24 +292,40 @@ export class IdentityCardService {
         return wantedCards;
     }
 
-    activateCurrentIdentityCard(): Promise<string | void> {
-        let data: any = this.identityCardStorageService.get(this.dataRef(this.currentCard));
+    private activateIdentityCard(cardRef): Promise<string | void> {
+        let data: any = this.identityCardStorageService.get(this.dataRef(cardRef));
 
         if (data && data.unused) {
             delete data['unused'];
-            this.identityCardStorageService.set(this.dataRef(this.currentCard), data);
+            this.identityCardStorageService.set(this.dataRef(cardRef), data);
 
-            let card = this.idCards.get(this.currentCard);
+            let hasCredentials = false;
+            let card = this.idCards.get(cardRef);
             let connectionProfile = card.getConnectionProfile();
-            let connectionProfileName = this.getQualifiedProfileName(connectionProfile);
-
-            // Hmmm, suspicious... is the enrollement ID really the identity?!
+            let connectionProfileRef = this.getQualifiedProfileName(connectionProfile);
             let enrollmentCredentials = card.getEnrollmentCredentials();
+            let credentials = card.getCredentials();
 
-            // Is this enough activation? What about the identity import thing?
-            return this.connectionProfileService.createProfile(connectionProfileName, connectionProfile).then(() => {
-                return this.currentCard;
-            });
+            if (credentials && credentials.certificate && credentials.privateKey) {
+                hasCredentials = true;
+
+                // don't want to keep credentials around after the card has been activated
+                card.setCredentials({});",189,2017-08-24 09:57:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/134974635,https://github.com/hyperledger/composer/pull/1990#discussion_r134974635,jt-nti
https://github.com/hyperledger/composer/pull/1971,https://github.com/hyperledger/composer/pull/1971,I think you also need to say the meta data needs to have the correct roles specified i.e. PeerAdmin and ChannelAdmin,03009196708cd0c24c4e4a93e111c20ca1ad1b2a,2017-08-23 08:39:51,134690266,"@@ -32,7 +32,10 @@ Due to many breaking API changes between {{site.data.conrefs.hlf_full}} alpha 1
 
 ### Deploying business networks using Playground locally
 
-When deploying a business network to {{site.data.conrefs.hlf_full}} v1.0 using the Playground locally, you must follow the process above to connect using the peer admin identity. However, in order to create identities and interact with your business network in the Playground, you must use the certificate authority admin identity.
+When deploying a business network to {{site.data.conrefs.hlf_full}} v1.0 using the Playground locally, you must follow the process above to connect using the peer admin identity.
+
+Identities in playground are associated with ID cards, comprising a connection profile, identity metadata, and certificates. When deploying a business network using Playground locally, you must have an ID card containing the correct admin certificates.",,2017-08-23 12:53:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/134690266,https://github.com/hyperledger/composer/pull/1971#discussion_r134690266,cazfletch
https://github.com/hyperledger/composer/pull/1971,https://github.com/hyperledger/composer/pull/1971,"This isn't quite true, the certificates won't be added until you choose to export the card (James is currently changing this)",03009196708cd0c24c4e4a93e111c20ca1ad1b2a,2017-08-23 08:44:01,134691148,"@@ -0,0 +1,117 @@
+---
+layout: default
+title: Creating, Exporting, and Importing ID Cards
+category: tasks
+section: managing
+sidebar: sidebars/accordion-toc0.md
+excerpt: ID cards combine a connection profile, identity, and certificates to allow a connection to a business network in Hyperledger Composer Playground. ID cards can be [created, exported and imported](./id-cards-playground.html) from the **My Wallet** page in Hyperledger Composer Playground.
+index-order: 703
+---
+
+
+# Creating, Exporting, and Importing ID Cards
+
+ID cards are represented by `.card` files containing a `metadata.JSON` file, a connection profile, and optional certificates.
+
+ID cards can be used in the {{site.data.conrefs.composer_full}} Playground to manage identities for different business networks and connection profiles.
+
+---
+
+## Creating ID Cards
+
+ID cards can be created in the wallet screen, created from the component files, or created within a business network.
+
+_Please note_: If cards are created from the wallet screen, or created from the component files, there must be a corresponding identity already created in the business network.
+
+
+### Creating an ID card within a business network
+
+1. From the **My Wallet** screen, select an identity to use to connect to your business network. Click **Connect Now**. _Please note:_ You must use an identity with the permission to create new identities.
+
+2. _Optional_: To create a participant to assign to the identity, click the **Test** tab, and click **Create New Participant**.
+
+3. Click the name of your identity in the upper right, and click **ID Registry**.
+
+4. Click **Issue New ID**.
+
+5. Choose an **ID Name**, and select a **Participant** to associate the new identity with.
+
+6. Click **Create New**.
+
+7. Click **Add to My Wallet**. Adding the ID card to your wallet allows you to use it to connect to the business network, or export it for someone else to use.
+
+The **My Wallet** screen should now show the new ID card.
+
+### Creating an ID card using from the Wallet
+
+An ID card can be created from the **My Wallet** page, however, a corresponding identity must already have been created in the business network. Creating an ID card from the **My Wallet** page requires that you use the same _User ID_, _User Secret_ and the correct _Business network name_ credentials as when the identity was created within the business network.
+
+To create an ID card from the **My Wallet** page:
+
+1. After receiving a valid _User ID_ and _User Secret_, click the **Create ID Card** button in the upper right of the **My Wallet** page.
+
+2. Select a connection profile and click **Next**.
+
+3. Enter the _User ID_ and _User Secret_ that were generated when the identity was created.
+
+4. Enter the correct _Business Network Name_ and click **Create**.
+
+The ID card should now be displayed in the **My Wallet** page.
+
+
+### Creating an ID card from component files
+
+ID cards are composite files containing up to three elements:
+
+- A connection profile. (`.json`)
+- A metadata file containing the data for the identity to use to connect to the business network. (`metadata.json`)
+- An optional credentials directory containing a public and private key.
+
+_Please note_: If there is no credentials directory, the metadata file must contain the _User Secret_ property with the property name _enrollmentSecret_. If an _enrollmentSecret_ is specified, the first time the ID card is used to connect to a business network, a credentials directory will be created and populated with the correct certificates.",,2017-08-23 12:53:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/134691148,https://github.com/hyperledger/composer/pull/1971#discussion_r134691148,cazfletch
https://github.com/hyperledger/composer/pull/1971,https://github.com/hyperledger/composer/pull/1971,The image property currently isn't used and you also need to add in the businessNetworkName property and say its optional,03009196708cd0c24c4e4a93e111c20ca1ad1b2a,2017-08-23 08:45:10,134691394,"@@ -0,0 +1,117 @@
+---
+layout: default
+title: Creating, Exporting, and Importing ID Cards
+category: tasks
+section: managing
+sidebar: sidebars/accordion-toc0.md
+excerpt: ID cards combine a connection profile, identity, and certificates to allow a connection to a business network in Hyperledger Composer Playground. ID cards can be [created, exported and imported](./id-cards-playground.html) from the **My Wallet** page in Hyperledger Composer Playground.
+index-order: 703
+---
+
+
+# Creating, Exporting, and Importing ID Cards
+
+ID cards are represented by `.card` files containing a `metadata.JSON` file, a connection profile, and optional certificates.
+
+ID cards can be used in the {{site.data.conrefs.composer_full}} Playground to manage identities for different business networks and connection profiles.
+
+---
+
+## Creating ID Cards
+
+ID cards can be created in the wallet screen, created from the component files, or created within a business network.
+
+_Please note_: If cards are created from the wallet screen, or created from the component files, there must be a corresponding identity already created in the business network.
+
+
+### Creating an ID card within a business network
+
+1. From the **My Wallet** screen, select an identity to use to connect to your business network. Click **Connect Now**. _Please note:_ You must use an identity with the permission to create new identities.
+
+2. _Optional_: To create a participant to assign to the identity, click the **Test** tab, and click **Create New Participant**.
+
+3. Click the name of your identity in the upper right, and click **ID Registry**.
+
+4. Click **Issue New ID**.
+
+5. Choose an **ID Name**, and select a **Participant** to associate the new identity with.
+
+6. Click **Create New**.
+
+7. Click **Add to My Wallet**. Adding the ID card to your wallet allows you to use it to connect to the business network, or export it for someone else to use.
+
+The **My Wallet** screen should now show the new ID card.
+
+### Creating an ID card using from the Wallet
+
+An ID card can be created from the **My Wallet** page, however, a corresponding identity must already have been created in the business network. Creating an ID card from the **My Wallet** page requires that you use the same _User ID_, _User Secret_ and the correct _Business network name_ credentials as when the identity was created within the business network.
+
+To create an ID card from the **My Wallet** page:
+
+1. After receiving a valid _User ID_ and _User Secret_, click the **Create ID Card** button in the upper right of the **My Wallet** page.
+
+2. Select a connection profile and click **Next**.
+
+3. Enter the _User ID_ and _User Secret_ that were generated when the identity was created.
+
+4. Enter the correct _Business Network Name_ and click **Create**.
+
+The ID card should now be displayed in the **My Wallet** page.
+
+
+### Creating an ID card from component files
+
+ID cards are composite files containing up to three elements:
+
+- A connection profile. (`.json`)
+- A metadata file containing the data for the identity to use to connect to the business network. (`metadata.json`)
+- An optional credentials directory containing a public and private key.
+
+_Please note_: If there is no credentials directory, the metadata file must contain the _User Secret_ property with the property name _enrollmentSecret_. If an _enrollmentSecret_ is specified, the first time the ID card is used to connect to a business network, a credentials directory will be created and populated with the correct certificates.
+
+The metadata file should take the following format:
+
+```
+{
+    ""name"": ""PeerAdmin"",
+    ""description"": ""A valid ID card"",
+    ""enrollmentId"": ""UserID"",
+    ""enrollmentSecret"": ""UserSecret"",
+    ""image"": ""images/conga.png"",",,2017-08-23 12:53:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/134691394,https://github.com/hyperledger/composer/pull/1971#discussion_r134691394,cazfletch
https://github.com/hyperledger/composer/pull/1971,https://github.com/hyperledger/composer/pull/1971,You don't compress the directory you compress the files in the directory,03009196708cd0c24c4e4a93e111c20ca1ad1b2a,2017-08-23 08:45:49,134691543,"@@ -0,0 +1,117 @@
+---
+layout: default
+title: Creating, Exporting, and Importing ID Cards
+category: tasks
+section: managing
+sidebar: sidebars/accordion-toc0.md
+excerpt: ID cards combine a connection profile, identity, and certificates to allow a connection to a business network in Hyperledger Composer Playground. ID cards can be [created, exported and imported](./id-cards-playground.html) from the **My Wallet** page in Hyperledger Composer Playground.
+index-order: 703
+---
+
+
+# Creating, Exporting, and Importing ID Cards
+
+ID cards are represented by `.card` files containing a `metadata.JSON` file, a connection profile, and optional certificates.
+
+ID cards can be used in the {{site.data.conrefs.composer_full}} Playground to manage identities for different business networks and connection profiles.
+
+---
+
+## Creating ID Cards
+
+ID cards can be created in the wallet screen, created from the component files, or created within a business network.
+
+_Please note_: If cards are created from the wallet screen, or created from the component files, there must be a corresponding identity already created in the business network.
+
+
+### Creating an ID card within a business network
+
+1. From the **My Wallet** screen, select an identity to use to connect to your business network. Click **Connect Now**. _Please note:_ You must use an identity with the permission to create new identities.
+
+2. _Optional_: To create a participant to assign to the identity, click the **Test** tab, and click **Create New Participant**.
+
+3. Click the name of your identity in the upper right, and click **ID Registry**.
+
+4. Click **Issue New ID**.
+
+5. Choose an **ID Name**, and select a **Participant** to associate the new identity with.
+
+6. Click **Create New**.
+
+7. Click **Add to My Wallet**. Adding the ID card to your wallet allows you to use it to connect to the business network, or export it for someone else to use.
+
+The **My Wallet** screen should now show the new ID card.
+
+### Creating an ID card using from the Wallet
+
+An ID card can be created from the **My Wallet** page, however, a corresponding identity must already have been created in the business network. Creating an ID card from the **My Wallet** page requires that you use the same _User ID_, _User Secret_ and the correct _Business network name_ credentials as when the identity was created within the business network.
+
+To create an ID card from the **My Wallet** page:
+
+1. After receiving a valid _User ID_ and _User Secret_, click the **Create ID Card** button in the upper right of the **My Wallet** page.
+
+2. Select a connection profile and click **Next**.
+
+3. Enter the _User ID_ and _User Secret_ that were generated when the identity was created.
+
+4. Enter the correct _Business Network Name_ and click **Create**.
+
+The ID card should now be displayed in the **My Wallet** page.
+
+
+### Creating an ID card from component files
+
+ID cards are composite files containing up to three elements:
+
+- A connection profile. (`.json`)
+- A metadata file containing the data for the identity to use to connect to the business network. (`metadata.json`)
+- An optional credentials directory containing a public and private key.
+
+_Please note_: If there is no credentials directory, the metadata file must contain the _User Secret_ property with the property name _enrollmentSecret_. If an _enrollmentSecret_ is specified, the first time the ID card is used to connect to a business network, a credentials directory will be created and populated with the correct certificates.
+
+The metadata file should take the following format:
+
+```
+{
+    ""name"": ""PeerAdmin"",
+    ""description"": ""A valid ID card"",
+    ""enrollmentId"": ""UserID"",
+    ""enrollmentSecret"": ""UserSecret"",
+    ""image"": ""images/conga.png"",
+    ""roles"": [
+
+    ]
+}
+```
+
+The _enrollmentSecret_ and _roles_ properties are optional.
+
+To create the ID card file, compress a directory containing the connection profile, metadata file, and optionally a credentials file, then modify the file type to `.card`.",,2017-08-23 12:53:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/134691543,https://github.com/hyperledger/composer/pull/1971#discussion_r134691543,cazfletch
https://github.com/hyperledger/composer/pull/1971,https://github.com/hyperledger/composer/pull/1971,Maybe say the roles can be include PeerAdmin and ChannelAdmin (we might add more roles later but these are currently the only 2 used,03009196708cd0c24c4e4a93e111c20ca1ad1b2a,2017-08-23 08:46:42,134691720,"@@ -0,0 +1,117 @@
+---
+layout: default
+title: Creating, Exporting, and Importing ID Cards
+category: tasks
+section: managing
+sidebar: sidebars/accordion-toc0.md
+excerpt: ID cards combine a connection profile, identity, and certificates to allow a connection to a business network in Hyperledger Composer Playground. ID cards can be [created, exported and imported](./id-cards-playground.html) from the **My Wallet** page in Hyperledger Composer Playground.
+index-order: 703
+---
+
+
+# Creating, Exporting, and Importing ID Cards
+
+ID cards are represented by `.card` files containing a `metadata.JSON` file, a connection profile, and optional certificates.
+
+ID cards can be used in the {{site.data.conrefs.composer_full}} Playground to manage identities for different business networks and connection profiles.
+
+---
+
+## Creating ID Cards
+
+ID cards can be created in the wallet screen, created from the component files, or created within a business network.
+
+_Please note_: If cards are created from the wallet screen, or created from the component files, there must be a corresponding identity already created in the business network.
+
+
+### Creating an ID card within a business network
+
+1. From the **My Wallet** screen, select an identity to use to connect to your business network. Click **Connect Now**. _Please note:_ You must use an identity with the permission to create new identities.
+
+2. _Optional_: To create a participant to assign to the identity, click the **Test** tab, and click **Create New Participant**.
+
+3. Click the name of your identity in the upper right, and click **ID Registry**.
+
+4. Click **Issue New ID**.
+
+5. Choose an **ID Name**, and select a **Participant** to associate the new identity with.
+
+6. Click **Create New**.
+
+7. Click **Add to My Wallet**. Adding the ID card to your wallet allows you to use it to connect to the business network, or export it for someone else to use.
+
+The **My Wallet** screen should now show the new ID card.
+
+### Creating an ID card using from the Wallet
+
+An ID card can be created from the **My Wallet** page, however, a corresponding identity must already have been created in the business network. Creating an ID card from the **My Wallet** page requires that you use the same _User ID_, _User Secret_ and the correct _Business network name_ credentials as when the identity was created within the business network.
+
+To create an ID card from the **My Wallet** page:
+
+1. After receiving a valid _User ID_ and _User Secret_, click the **Create ID Card** button in the upper right of the **My Wallet** page.
+
+2. Select a connection profile and click **Next**.
+
+3. Enter the _User ID_ and _User Secret_ that were generated when the identity was created.
+
+4. Enter the correct _Business Network Name_ and click **Create**.
+
+The ID card should now be displayed in the **My Wallet** page.
+
+
+### Creating an ID card from component files
+
+ID cards are composite files containing up to three elements:
+
+- A connection profile. (`.json`)
+- A metadata file containing the data for the identity to use to connect to the business network. (`metadata.json`)
+- An optional credentials directory containing a public and private key.
+
+_Please note_: If there is no credentials directory, the metadata file must contain the _User Secret_ property with the property name _enrollmentSecret_. If an _enrollmentSecret_ is specified, the first time the ID card is used to connect to a business network, a credentials directory will be created and populated with the correct certificates.
+
+The metadata file should take the following format:
+
+```
+{
+    ""name"": ""PeerAdmin"",
+    ""description"": ""A valid ID card"",
+    ""enrollmentId"": ""UserID"",
+    ""enrollmentSecret"": ""UserSecret"",
+    ""image"": ""images/conga.png"",
+    ""roles"": [",,2017-08-23 12:53:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/134691720,https://github.com/hyperledger/composer/pull/1971#discussion_r134691720,cazfletch
https://github.com/hyperledger/composer/pull/1971,https://github.com/hyperledger/composer/pull/1971,"This isn't true, as the id cards will contain the certificates when exported and won't rely on the secret therefore it doesn't matter if it has been used",03009196708cd0c24c4e4a93e111c20ca1ad1b2a,2017-08-23 08:48:01,134692009,"@@ -0,0 +1,117 @@
+---
+layout: default
+title: Creating, Exporting, and Importing ID Cards
+category: tasks
+section: managing
+sidebar: sidebars/accordion-toc0.md
+excerpt: ID cards combine a connection profile, identity, and certificates to allow a connection to a business network in Hyperledger Composer Playground. ID cards can be [created, exported and imported](./id-cards-playground.html) from the **My Wallet** page in Hyperledger Composer Playground.
+index-order: 703
+---
+
+
+# Creating, Exporting, and Importing ID Cards
+
+ID cards are represented by `.card` files containing a `metadata.JSON` file, a connection profile, and optional certificates.
+
+ID cards can be used in the {{site.data.conrefs.composer_full}} Playground to manage identities for different business networks and connection profiles.
+
+---
+
+## Creating ID Cards
+
+ID cards can be created in the wallet screen, created from the component files, or created within a business network.
+
+_Please note_: If cards are created from the wallet screen, or created from the component files, there must be a corresponding identity already created in the business network.
+
+
+### Creating an ID card within a business network
+
+1. From the **My Wallet** screen, select an identity to use to connect to your business network. Click **Connect Now**. _Please note:_ You must use an identity with the permission to create new identities.
+
+2. _Optional_: To create a participant to assign to the identity, click the **Test** tab, and click **Create New Participant**.
+
+3. Click the name of your identity in the upper right, and click **ID Registry**.
+
+4. Click **Issue New ID**.
+
+5. Choose an **ID Name**, and select a **Participant** to associate the new identity with.
+
+6. Click **Create New**.
+
+7. Click **Add to My Wallet**. Adding the ID card to your wallet allows you to use it to connect to the business network, or export it for someone else to use.
+
+The **My Wallet** screen should now show the new ID card.
+
+### Creating an ID card using from the Wallet
+
+An ID card can be created from the **My Wallet** page, however, a corresponding identity must already have been created in the business network. Creating an ID card from the **My Wallet** page requires that you use the same _User ID_, _User Secret_ and the correct _Business network name_ credentials as when the identity was created within the business network.
+
+To create an ID card from the **My Wallet** page:
+
+1. After receiving a valid _User ID_ and _User Secret_, click the **Create ID Card** button in the upper right of the **My Wallet** page.
+
+2. Select a connection profile and click **Next**.
+
+3. Enter the _User ID_ and _User Secret_ that were generated when the identity was created.
+
+4. Enter the correct _Business Network Name_ and click **Create**.
+
+The ID card should now be displayed in the **My Wallet** page.
+
+
+### Creating an ID card from component files
+
+ID cards are composite files containing up to three elements:
+
+- A connection profile. (`.json`)
+- A metadata file containing the data for the identity to use to connect to the business network. (`metadata.json`)
+- An optional credentials directory containing a public and private key.
+
+_Please note_: If there is no credentials directory, the metadata file must contain the _User Secret_ property with the property name _enrollmentSecret_. If an _enrollmentSecret_ is specified, the first time the ID card is used to connect to a business network, a credentials directory will be created and populated with the correct certificates.
+
+The metadata file should take the following format:
+
+```
+{
+    ""name"": ""PeerAdmin"",
+    ""description"": ""A valid ID card"",
+    ""enrollmentId"": ""UserID"",
+    ""enrollmentSecret"": ""UserSecret"",
+    ""image"": ""images/conga.png"",
+    ""roles"": [
+
+    ]
+}
+```
+
+The _enrollmentSecret_ and _roles_ properties are optional.
+
+To create the ID card file, compress a directory containing the connection profile, metadata file, and optionally a credentials file, then modify the file type to `.card`.
+
+This ID card can now be imported using the {{site.data.conrefs.composer_full}} Playground.
+
+---
+
+## Importing and Exporting ID cards
+
+Importing and exporting ID cards is the simplest way to grant access to other users of the business network in Playground. Valid ID cards must be created using one of the methods above, but can then be exported and sent to other users.
+
+_Please note_: An ID card must not be used to connect to a business network before it is exported, or it will be unusable after it is imported.",,2017-08-23 12:53:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/134692009,https://github.com/hyperledger/composer/pull/1971#discussion_r134692009,cazfletch
https://github.com/hyperledger/composer/pull/1971,https://github.com/hyperledger/composer/pull/1971,again this isn't true,03009196708cd0c24c4e4a93e111c20ca1ad1b2a,2017-08-23 08:48:26,134692087,"@@ -0,0 +1,117 @@
+---
+layout: default
+title: Creating, Exporting, and Importing ID Cards
+category: tasks
+section: managing
+sidebar: sidebars/accordion-toc0.md
+excerpt: ID cards combine a connection profile, identity, and certificates to allow a connection to a business network in Hyperledger Composer Playground. ID cards can be [created, exported and imported](./id-cards-playground.html) from the **My Wallet** page in Hyperledger Composer Playground.
+index-order: 703
+---
+
+
+# Creating, Exporting, and Importing ID Cards
+
+ID cards are represented by `.card` files containing a `metadata.JSON` file, a connection profile, and optional certificates.
+
+ID cards can be used in the {{site.data.conrefs.composer_full}} Playground to manage identities for different business networks and connection profiles.
+
+---
+
+## Creating ID Cards
+
+ID cards can be created in the wallet screen, created from the component files, or created within a business network.
+
+_Please note_: If cards are created from the wallet screen, or created from the component files, there must be a corresponding identity already created in the business network.
+
+
+### Creating an ID card within a business network
+
+1. From the **My Wallet** screen, select an identity to use to connect to your business network. Click **Connect Now**. _Please note:_ You must use an identity with the permission to create new identities.
+
+2. _Optional_: To create a participant to assign to the identity, click the **Test** tab, and click **Create New Participant**.
+
+3. Click the name of your identity in the upper right, and click **ID Registry**.
+
+4. Click **Issue New ID**.
+
+5. Choose an **ID Name**, and select a **Participant** to associate the new identity with.
+
+6. Click **Create New**.
+
+7. Click **Add to My Wallet**. Adding the ID card to your wallet allows you to use it to connect to the business network, or export it for someone else to use.
+
+The **My Wallet** screen should now show the new ID card.
+
+### Creating an ID card using from the Wallet
+
+An ID card can be created from the **My Wallet** page, however, a corresponding identity must already have been created in the business network. Creating an ID card from the **My Wallet** page requires that you use the same _User ID_, _User Secret_ and the correct _Business network name_ credentials as when the identity was created within the business network.
+
+To create an ID card from the **My Wallet** page:
+
+1. After receiving a valid _User ID_ and _User Secret_, click the **Create ID Card** button in the upper right of the **My Wallet** page.
+
+2. Select a connection profile and click **Next**.
+
+3. Enter the _User ID_ and _User Secret_ that were generated when the identity was created.
+
+4. Enter the correct _Business Network Name_ and click **Create**.
+
+The ID card should now be displayed in the **My Wallet** page.
+
+
+### Creating an ID card from component files
+
+ID cards are composite files containing up to three elements:
+
+- A connection profile. (`.json`)
+- A metadata file containing the data for the identity to use to connect to the business network. (`metadata.json`)
+- An optional credentials directory containing a public and private key.
+
+_Please note_: If there is no credentials directory, the metadata file must contain the _User Secret_ property with the property name _enrollmentSecret_. If an _enrollmentSecret_ is specified, the first time the ID card is used to connect to a business network, a credentials directory will be created and populated with the correct certificates.
+
+The metadata file should take the following format:
+
+```
+{
+    ""name"": ""PeerAdmin"",
+    ""description"": ""A valid ID card"",
+    ""enrollmentId"": ""UserID"",
+    ""enrollmentSecret"": ""UserSecret"",
+    ""image"": ""images/conga.png"",
+    ""roles"": [
+
+    ]
+}
+```
+
+The _enrollmentSecret_ and _roles_ properties are optional.
+
+To create the ID card file, compress a directory containing the connection profile, metadata file, and optionally a credentials file, then modify the file type to `.card`.
+
+This ID card can now be imported using the {{site.data.conrefs.composer_full}} Playground.
+
+---
+
+## Importing and Exporting ID cards
+
+Importing and exporting ID cards is the simplest way to grant access to other users of the business network in Playground. Valid ID cards must be created using one of the methods above, but can then be exported and sent to other users.
+
+_Please note_: An ID card must not be used to connect to a business network before it is exported, or it will be unusable after it is imported.
+
+### Exporting ID Cards
+
+1. To export an ID card create an identity by [using a business network](#creating-an-id-card-within-a-business-network) and add the ID card to your wallet.
+
+2. On the **My Wallet** page, click the **Export** icon on the ID card you wish to export. The ID card should download as a `.card` file.
+
+_Please note_: An ID card must not be used to connect to a business network before it is exported, or it will be unusable after it is imported.",,2017-08-23 12:53:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/134692087,https://github.com/hyperledger/composer/pull/1971#discussion_r134692087,cazfletch
https://github.com/hyperledger/composer/pull/1971,https://github.com/hyperledger/composer/pull/1971,Thats not true,03009196708cd0c24c4e4a93e111c20ca1ad1b2a,2017-08-23 08:51:48,134692892,"@@ -12,99 +12,55 @@ index-order: 701
 
 ## Concepts
 
-A `Participant` is an actor in a business network. A participant might be an individual
-an organization. A participant can create assets, and also exchange assets with
-other participants. A participant works with assets by submitting transactions.
+A `Participant` is an actor in a business network. A participant might be an individual an organization. A participant can create assets, and also exchange assets with other participants. A participant works with assets by submitting transactions.
 
-A participant has a set of `Identity` documents that can be validated to prove the
-identity of that participant. For example, an individual may have one or more of
-the following identity documents that prove who they are:
+A participant has a set of `Identity` documents that can be validated to prove the identity of that participant. For example, an individual may have one or more of the following identity documents that prove who they are:
 
 * Passport
 * Driving license
 * Fingerprints
 * Retina scan
 * SSL certificate
 
-In {{site.data.conrefs.composer_full}}, participants are separated from the set of
-identity documents that they can use to interact with a business network.
-
-In order for a new participant to join a business network, a new instance of that
-participant must be created in the business network. The participant instance
-stores all of the required information about that participant, but it does not give
-that participant access to interact with the business network.
-
-In order to grant the participant access to interact with the business network, an
-identity document must then be `Issued` to that participant. The new participant
-can then use that identity document to interact with the business network.
-
-A participant may have an existing identity document that they use to interact with
-other business networks or other external systems. These identity documents can
-be reused and `Bound` to that participant. The new participant can then use their
-existing identity document to interact with the business network.
-
-Identity documents usually expire after a set period of time. Identity documents may
-also be lost or stolen. If the identity document expires, or if it needs to be
-replaced, then it must be `Revoked` so it can no longer be used to interact with
-the business network.
-
-However, revoking an identity document does not remove the information about that
-participant and any assets that they own. Revoking the identity document simply
-removes the participants ability to interact with the business network using that
-identity document. Access to the business network can be restored by issuing the
-participant with a new identity document.
-
-These participant and identity management actions are performed by an existing
-participant in the business network, for example a regulatory body, or a participant
-in the same organization who has been trusted to manage participants/identities in
+In {{site.data.conrefs.composer_full}}, participants are separated from the set of identity documents that they can use to interact with a business network.
+
+In order for a new participant to join a business network, a new instance of that participant must be created in the business network. The participant instance stores all of the required information about that participant, but it does not give that participant access to interact with the business network.
+
+In order to grant the participant access to interact with the business network, an identity document must then be `Issued` to that participant. The new participant can then use that identity document to interact with the business network.
+
+A participant may have an existing identity document that they use to interact with other business networks or other external systems. These identity documents can be reused and `Bound` to that participant. The new participant can then use their existing identity document to interact with the business network.
+
+Identity documents usually expire after a set period of time. Identity documents may also be lost or stolen. If the identity document expires, or if it needs to be replaced, then it must be `Revoked` so it can no longer be used to interact with the business network.
+
+However, revoking an identity document does not remove the information about that participant and any assets that they own. Revoking the identity document simply removes the participants ability to interact with the business network using that identity document. Access to the business network can be restored by issuing the participant with a new identity document.
+
+These participant and identity management actions are performed by an existing participant in the business network, for example a regulatory body, or a participant in the same organization who has been trusted to manage participants/identities in
 that organization.
 
 ## Participants and identities in {{site.data.conrefs.composer_full}}
 
-In {{site.data.conrefs.composer_full}}, the structure of a participant is modelled in a
-model file. This structure may include various information about the participant,
-for example the participants name, address, e-mail address, date of birth, etc.
-New instances of that modelled participant can then be created and added to a
-participant registry.
-
-{{site.data.conrefs.composer_full}} requires the use Blockchain identities as the
-form of identity documents. For example, when deploying a business network to Hyperledger
-Fabric, enrolment certificates are used as the form of identity document. These enrolment
-certificates are used to cryptographically sign the transactions that are submitted to
-the deployed business network.
-
-A deployed business network maintains a set of mappings of identities to participants
-in the `Identity Registry`. When an identity is `Issued` or `Bound` to a participant, a new
-mapping is added to the identity registry. When that participant uses that identity to
-submit transactions to the deployed business network, the Composer runtime looks for a
-valid mapping for that identity in the identity registry. This lookup is done using
-the public key signature or fingerprint, essentially a hash of the certificate contents
-that is unique to that certificate and identity.
-
-Once a mapping is found in the identity registry, the participant for that identity is
-retrieved from that mapping. That participant becomes the `Current Participant`, the
-participant who submitted the transaction. All access control in {{site.data.conrefs.composer_full}}
-is based around the current participant. Access control rules that define which participants
-can perform which operations on which resources all operate on the current participant.
-
-When a participant uses an identity to submit a transaction to the deployed business
-network for the first time, that identity is `Activated`. This means that the entry in
-the identity registry is updated to record the fact that the identity was used for the
-first time. Additional information about the identity, such as the certificate, may also
-be recorded in the identity registry during activation if it was not available when the
-identity was issued or bound to the participant.
-
-If and when an identity is revoked, the entry in the identity registry for that identity
-is updated to change the status to `Revoked`. After an identity is revoked, if a participant
-tries to use that identity to submit a transaction to the deployed business network, that
-transaction will be rejected.
+In {{site.data.conrefs.composer_full}}, the structure of a participant is modeled in a model file. This structure may include various information about the participant, for example the participants name, address, e-mail address, date of birth, etc. New instances of that modeled participant can then be created and added to a participant registry.
+
+{{site.data.conrefs.composer_full}} requires the use Blockchain identities as the form of identity documents. For example, when deploying a business network to {{site.data.conrefs.hlf_full}}, enrollment certificates are used as the form of identity document. These enrollment certificates are used to cryptographically sign the transactions that are submitted to the deployed business network.
+
+A deployed business network maintains a set of mappings of identities to participants in the `Identity Registry`. When an identity is `Issued` or `Bound` to a participant, a new mapping is added to the identity registry. When that participant uses that identity to submit transactions to the deployed business network, the Composer runtime looks for a valid mapping for that identity in the identity registry. This lookup is done using the public key signature or fingerprint, essentially a hash of the certificate contents that is unique to that certificate and identity.
+
+Once a mapping is found in the identity registry, the participant for that identity is retrieved from that mapping. That participant becomes the `Current Participant`, the participant who submitted the transaction. All access control in {{site.data.conrefs.composer_full}} is based around the current participant. Access control rules that define which participants can perform which operations on which resources all operate on the current participant.
+
+When a participant uses an identity to submit a transaction to the deployed business network for the first time, that identity is `Activated`. This means that the entry in the identity registry is updated to record the fact that the identity was used for the first time. Additional information about the identity, such as the certificate, may also be recorded in the identity registry during activation if it was not available when the identity was issued or bound to the participant.
+
+If and when an identity is revoked, the entry in the identity registry for that identity is updated to change the status to `Revoked`. After an identity is revoked, if a participant tries to use that identity to submit a transaction to the deployed business network, that transaction will be rejected.
+
+## Identities and ID cards in the {{site.data.conrefs.composer_full}} Playground
+
+In the {{site.data.conrefs.composer_full}} Playground, there is a wallet containing locally stored ID cards. An ID card is an access card to a business network, comprising identity data, a connection profile, and the correct certificates for business network access.
+
+ID cards can be exported to allow the assignment of identities to others. Once the certificates associated with an identity have been used to register the ID card, they cannot be reused, for this reason it is important connect using an ID card before exporting, if that id card is being assigned to another user.",,2017-08-23 12:53:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/134692892,https://github.com/hyperledger/composer/pull/1971#discussion_r134692892,cazfletch
https://github.com/hyperledger/composer/pull/1971,https://github.com/hyperledger/composer/pull/1971,"Shouldn't this be ""This will allow us to make changes to the....""",03009196708cd0c24c4e4a93e111c20ca1ad1b2a,2017-08-23 08:53:03,134693207,"@@ -21,7 +21,11 @@ Open <a href=""http://composer-playground.mybluemix.net"" target=""blank"">{{site.da
 
 If you have previously used Playground, be sure to clear your browser local storage by running `localStorage.clear()` in your browser Console.
 
-## Step 2: Define your Domain Model
+## Step 2: Choose an Identity
+
+At the **My Wallet** page, click **Connect now** on the **Admin** ID card. This will allow us to make any changes to the business network definition.",,2017-08-23 12:53:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/134693207,https://github.com/hyperledger/composer/pull/1971#discussion_r134693207,cazfletch
https://github.com/hyperledger/composer/pull/1971,https://github.com/hyperledger/composer/pull/1971,Will add. :),03009196708cd0c24c4e4a93e111c20ca1ad1b2a,2017-08-23 10:36:18,134715588,"@@ -32,7 +32,10 @@ Due to many breaking API changes between {{site.data.conrefs.hlf_full}} alpha 1
 
 ### Deploying business networks using Playground locally
 
-When deploying a business network to {{site.data.conrefs.hlf_full}} v1.0 using the Playground locally, you must follow the process above to connect using the peer admin identity. However, in order to create identities and interact with your business network in the Playground, you must use the certificate authority admin identity.
+When deploying a business network to {{site.data.conrefs.hlf_full}} v1.0 using the Playground locally, you must follow the process above to connect using the peer admin identity.
+
+Identities in playground are associated with ID cards, comprising a connection profile, identity metadata, and certificates. When deploying a business network using Playground locally, you must have an ID card containing the correct admin certificates.",,2017-08-23 12:53:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/134715588,https://github.com/hyperledger/composer/pull/1971#discussion_r134715588,EdProsser
https://github.com/hyperledger/composer/pull/1971,https://github.com/hyperledger/composer/pull/1971,Will add. :),03009196708cd0c24c4e4a93e111c20ca1ad1b2a,2017-08-23 10:36:51,134715672,"@@ -0,0 +1,117 @@
+---
+layout: default
+title: Creating, Exporting, and Importing ID Cards
+category: tasks
+section: managing
+sidebar: sidebars/accordion-toc0.md
+excerpt: ID cards combine a connection profile, identity, and certificates to allow a connection to a business network in Hyperledger Composer Playground. ID cards can be [created, exported and imported](./id-cards-playground.html) from the **My Wallet** page in Hyperledger Composer Playground.
+index-order: 703
+---
+
+
+# Creating, Exporting, and Importing ID Cards
+
+ID cards are represented by `.card` files containing a `metadata.JSON` file, a connection profile, and optional certificates.
+
+ID cards can be used in the {{site.data.conrefs.composer_full}} Playground to manage identities for different business networks and connection profiles.
+
+---
+
+## Creating ID Cards
+
+ID cards can be created in the wallet screen, created from the component files, or created within a business network.
+
+_Please note_: If cards are created from the wallet screen, or created from the component files, there must be a corresponding identity already created in the business network.
+
+
+### Creating an ID card within a business network
+
+1. From the **My Wallet** screen, select an identity to use to connect to your business network. Click **Connect Now**. _Please note:_ You must use an identity with the permission to create new identities.
+
+2. _Optional_: To create a participant to assign to the identity, click the **Test** tab, and click **Create New Participant**.
+
+3. Click the name of your identity in the upper right, and click **ID Registry**.
+
+4. Click **Issue New ID**.
+
+5. Choose an **ID Name**, and select a **Participant** to associate the new identity with.
+
+6. Click **Create New**.
+
+7. Click **Add to My Wallet**. Adding the ID card to your wallet allows you to use it to connect to the business network, or export it for someone else to use.
+
+The **My Wallet** screen should now show the new ID card.
+
+### Creating an ID card using from the Wallet
+
+An ID card can be created from the **My Wallet** page, however, a corresponding identity must already have been created in the business network. Creating an ID card from the **My Wallet** page requires that you use the same _User ID_, _User Secret_ and the correct _Business network name_ credentials as when the identity was created within the business network.
+
+To create an ID card from the **My Wallet** page:
+
+1. After receiving a valid _User ID_ and _User Secret_, click the **Create ID Card** button in the upper right of the **My Wallet** page.
+
+2. Select a connection profile and click **Next**.
+
+3. Enter the _User ID_ and _User Secret_ that were generated when the identity was created.
+
+4. Enter the correct _Business Network Name_ and click **Create**.
+
+The ID card should now be displayed in the **My Wallet** page.
+
+
+### Creating an ID card from component files
+
+ID cards are composite files containing up to three elements:
+
+- A connection profile. (`.json`)
+- A metadata file containing the data for the identity to use to connect to the business network. (`metadata.json`)
+- An optional credentials directory containing a public and private key.
+
+_Please note_: If there is no credentials directory, the metadata file must contain the _User Secret_ property with the property name _enrollmentSecret_. If an _enrollmentSecret_ is specified, the first time the ID card is used to connect to a business network, a credentials directory will be created and populated with the correct certificates.",,2017-08-23 12:53:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/134715672,https://github.com/hyperledger/composer/pull/1971#discussion_r134715672,EdProsser
https://github.com/hyperledger/composer/pull/1971,https://github.com/hyperledger/composer/pull/1971,Yup,03009196708cd0c24c4e4a93e111c20ca1ad1b2a,2017-08-23 10:36:59,134715701,"@@ -0,0 +1,117 @@
+---
+layout: default
+title: Creating, Exporting, and Importing ID Cards
+category: tasks
+section: managing
+sidebar: sidebars/accordion-toc0.md
+excerpt: ID cards combine a connection profile, identity, and certificates to allow a connection to a business network in Hyperledger Composer Playground. ID cards can be [created, exported and imported](./id-cards-playground.html) from the **My Wallet** page in Hyperledger Composer Playground.
+index-order: 703
+---
+
+
+# Creating, Exporting, and Importing ID Cards
+
+ID cards are represented by `.card` files containing a `metadata.JSON` file, a connection profile, and optional certificates.
+
+ID cards can be used in the {{site.data.conrefs.composer_full}} Playground to manage identities for different business networks and connection profiles.
+
+---
+
+## Creating ID Cards
+
+ID cards can be created in the wallet screen, created from the component files, or created within a business network.
+
+_Please note_: If cards are created from the wallet screen, or created from the component files, there must be a corresponding identity already created in the business network.
+
+
+### Creating an ID card within a business network
+
+1. From the **My Wallet** screen, select an identity to use to connect to your business network. Click **Connect Now**. _Please note:_ You must use an identity with the permission to create new identities.
+
+2. _Optional_: To create a participant to assign to the identity, click the **Test** tab, and click **Create New Participant**.
+
+3. Click the name of your identity in the upper right, and click **ID Registry**.
+
+4. Click **Issue New ID**.
+
+5. Choose an **ID Name**, and select a **Participant** to associate the new identity with.
+
+6. Click **Create New**.
+
+7. Click **Add to My Wallet**. Adding the ID card to your wallet allows you to use it to connect to the business network, or export it for someone else to use.
+
+The **My Wallet** screen should now show the new ID card.
+
+### Creating an ID card using from the Wallet
+
+An ID card can be created from the **My Wallet** page, however, a corresponding identity must already have been created in the business network. Creating an ID card from the **My Wallet** page requires that you use the same _User ID_, _User Secret_ and the correct _Business network name_ credentials as when the identity was created within the business network.
+
+To create an ID card from the **My Wallet** page:
+
+1. After receiving a valid _User ID_ and _User Secret_, click the **Create ID Card** button in the upper right of the **My Wallet** page.
+
+2. Select a connection profile and click **Next**.
+
+3. Enter the _User ID_ and _User Secret_ that were generated when the identity was created.
+
+4. Enter the correct _Business Network Name_ and click **Create**.
+
+The ID card should now be displayed in the **My Wallet** page.
+
+
+### Creating an ID card from component files
+
+ID cards are composite files containing up to three elements:
+
+- A connection profile. (`.json`)
+- A metadata file containing the data for the identity to use to connect to the business network. (`metadata.json`)
+- An optional credentials directory containing a public and private key.
+
+_Please note_: If there is no credentials directory, the metadata file must contain the _User Secret_ property with the property name _enrollmentSecret_. If an _enrollmentSecret_ is specified, the first time the ID card is used to connect to a business network, a credentials directory will be created and populated with the correct certificates.
+
+The metadata file should take the following format:
+
+```
+{
+    ""name"": ""PeerAdmin"",
+    ""description"": ""A valid ID card"",
+    ""enrollmentId"": ""UserID"",
+    ""enrollmentSecret"": ""UserSecret"",
+    ""image"": ""images/conga.png"",
+    ""roles"": [",,2017-08-23 12:53:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/134715701,https://github.com/hyperledger/composer/pull/1971#discussion_r134715701,EdProsser
https://github.com/hyperledger/composer/pull/1971,https://github.com/hyperledger/composer/pull/1971,Will add. :),03009196708cd0c24c4e4a93e111c20ca1ad1b2a,2017-08-23 10:37:16,134715752,"@@ -0,0 +1,117 @@
+---
+layout: default
+title: Creating, Exporting, and Importing ID Cards
+category: tasks
+section: managing
+sidebar: sidebars/accordion-toc0.md
+excerpt: ID cards combine a connection profile, identity, and certificates to allow a connection to a business network in Hyperledger Composer Playground. ID cards can be [created, exported and imported](./id-cards-playground.html) from the **My Wallet** page in Hyperledger Composer Playground.
+index-order: 703
+---
+
+
+# Creating, Exporting, and Importing ID Cards
+
+ID cards are represented by `.card` files containing a `metadata.JSON` file, a connection profile, and optional certificates.
+
+ID cards can be used in the {{site.data.conrefs.composer_full}} Playground to manage identities for different business networks and connection profiles.
+
+---
+
+## Creating ID Cards
+
+ID cards can be created in the wallet screen, created from the component files, or created within a business network.
+
+_Please note_: If cards are created from the wallet screen, or created from the component files, there must be a corresponding identity already created in the business network.
+
+
+### Creating an ID card within a business network
+
+1. From the **My Wallet** screen, select an identity to use to connect to your business network. Click **Connect Now**. _Please note:_ You must use an identity with the permission to create new identities.
+
+2. _Optional_: To create a participant to assign to the identity, click the **Test** tab, and click **Create New Participant**.
+
+3. Click the name of your identity in the upper right, and click **ID Registry**.
+
+4. Click **Issue New ID**.
+
+5. Choose an **ID Name**, and select a **Participant** to associate the new identity with.
+
+6. Click **Create New**.
+
+7. Click **Add to My Wallet**. Adding the ID card to your wallet allows you to use it to connect to the business network, or export it for someone else to use.
+
+The **My Wallet** screen should now show the new ID card.
+
+### Creating an ID card using from the Wallet
+
+An ID card can be created from the **My Wallet** page, however, a corresponding identity must already have been created in the business network. Creating an ID card from the **My Wallet** page requires that you use the same _User ID_, _User Secret_ and the correct _Business network name_ credentials as when the identity was created within the business network.
+
+To create an ID card from the **My Wallet** page:
+
+1. After receiving a valid _User ID_ and _User Secret_, click the **Create ID Card** button in the upper right of the **My Wallet** page.
+
+2. Select a connection profile and click **Next**.
+
+3. Enter the _User ID_ and _User Secret_ that were generated when the identity was created.
+
+4. Enter the correct _Business Network Name_ and click **Create**.
+
+The ID card should now be displayed in the **My Wallet** page.
+
+
+### Creating an ID card from component files
+
+ID cards are composite files containing up to three elements:
+
+- A connection profile. (`.json`)
+- A metadata file containing the data for the identity to use to connect to the business network. (`metadata.json`)
+- An optional credentials directory containing a public and private key.
+
+_Please note_: If there is no credentials directory, the metadata file must contain the _User Secret_ property with the property name _enrollmentSecret_. If an _enrollmentSecret_ is specified, the first time the ID card is used to connect to a business network, a credentials directory will be created and populated with the correct certificates.
+
+The metadata file should take the following format:
+
+```
+{
+    ""name"": ""PeerAdmin"",
+    ""description"": ""A valid ID card"",
+    ""enrollmentId"": ""UserID"",
+    ""enrollmentSecret"": ""UserSecret"",
+    ""image"": ""images/conga.png"",
+    ""roles"": [
+
+    ]
+}
+```
+
+The _enrollmentSecret_ and _roles_ properties are optional.
+
+To create the ID card file, compress a directory containing the connection profile, metadata file, and optionally a credentials file, then modify the file type to `.card`.",,2017-08-23 12:53:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/134715752,https://github.com/hyperledger/composer/pull/1971#discussion_r134715752,EdProsser
https://github.com/hyperledger/composer/pull/1971,https://github.com/hyperledger/composer/pull/1971,Remove/reword this.,03009196708cd0c24c4e4a93e111c20ca1ad1b2a,2017-08-23 10:40:12,134716247,"@@ -0,0 +1,117 @@
+---
+layout: default
+title: Creating, Exporting, and Importing ID Cards
+category: tasks
+section: managing
+sidebar: sidebars/accordion-toc0.md
+excerpt: ID cards combine a connection profile, identity, and certificates to allow a connection to a business network in Hyperledger Composer Playground. ID cards can be [created, exported and imported](./id-cards-playground.html) from the **My Wallet** page in Hyperledger Composer Playground.
+index-order: 703
+---
+
+
+# Creating, Exporting, and Importing ID Cards
+
+ID cards are represented by `.card` files containing a `metadata.JSON` file, a connection profile, and optional certificates.
+
+ID cards can be used in the {{site.data.conrefs.composer_full}} Playground to manage identities for different business networks and connection profiles.
+
+---
+
+## Creating ID Cards
+
+ID cards can be created in the wallet screen, created from the component files, or created within a business network.
+
+_Please note_: If cards are created from the wallet screen, or created from the component files, there must be a corresponding identity already created in the business network.
+
+
+### Creating an ID card within a business network
+
+1. From the **My Wallet** screen, select an identity to use to connect to your business network. Click **Connect Now**. _Please note:_ You must use an identity with the permission to create new identities.
+
+2. _Optional_: To create a participant to assign to the identity, click the **Test** tab, and click **Create New Participant**.
+
+3. Click the name of your identity in the upper right, and click **ID Registry**.
+
+4. Click **Issue New ID**.
+
+5. Choose an **ID Name**, and select a **Participant** to associate the new identity with.
+
+6. Click **Create New**.
+
+7. Click **Add to My Wallet**. Adding the ID card to your wallet allows you to use it to connect to the business network, or export it for someone else to use.
+
+The **My Wallet** screen should now show the new ID card.
+
+### Creating an ID card using from the Wallet
+
+An ID card can be created from the **My Wallet** page, however, a corresponding identity must already have been created in the business network. Creating an ID card from the **My Wallet** page requires that you use the same _User ID_, _User Secret_ and the correct _Business network name_ credentials as when the identity was created within the business network.
+
+To create an ID card from the **My Wallet** page:
+
+1. After receiving a valid _User ID_ and _User Secret_, click the **Create ID Card** button in the upper right of the **My Wallet** page.
+
+2. Select a connection profile and click **Next**.
+
+3. Enter the _User ID_ and _User Secret_ that were generated when the identity was created.
+
+4. Enter the correct _Business Network Name_ and click **Create**.
+
+The ID card should now be displayed in the **My Wallet** page.
+
+
+### Creating an ID card from component files
+
+ID cards are composite files containing up to three elements:
+
+- A connection profile. (`.json`)
+- A metadata file containing the data for the identity to use to connect to the business network. (`metadata.json`)
+- An optional credentials directory containing a public and private key.
+
+_Please note_: If there is no credentials directory, the metadata file must contain the _User Secret_ property with the property name _enrollmentSecret_. If an _enrollmentSecret_ is specified, the first time the ID card is used to connect to a business network, a credentials directory will be created and populated with the correct certificates.
+
+The metadata file should take the following format:
+
+```
+{
+    ""name"": ""PeerAdmin"",
+    ""description"": ""A valid ID card"",
+    ""enrollmentId"": ""UserID"",
+    ""enrollmentSecret"": ""UserSecret"",
+    ""image"": ""images/conga.png"",
+    ""roles"": [
+
+    ]
+}
+```
+
+The _enrollmentSecret_ and _roles_ properties are optional.
+
+To create the ID card file, compress a directory containing the connection profile, metadata file, and optionally a credentials file, then modify the file type to `.card`.
+
+This ID card can now be imported using the {{site.data.conrefs.composer_full}} Playground.
+
+---
+
+## Importing and Exporting ID cards
+
+Importing and exporting ID cards is the simplest way to grant access to other users of the business network in Playground. Valid ID cards must be created using one of the methods above, but can then be exported and sent to other users.
+
+_Please note_: An ID card must not be used to connect to a business network before it is exported, or it will be unusable after it is imported.
+
+### Exporting ID Cards
+
+1. To export an ID card create an identity by [using a business network](#creating-an-id-card-within-a-business-network) and add the ID card to your wallet.
+
+2. On the **My Wallet** page, click the **Export** icon on the ID card you wish to export. The ID card should download as a `.card` file.
+
+_Please note_: An ID card must not be used to connect to a business network before it is exported, or it will be unusable after it is imported.",,2017-08-23 12:53:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/134716247,https://github.com/hyperledger/composer/pull/1971#discussion_r134716247,EdProsser
https://github.com/hyperledger/composer/pull/1971,https://github.com/hyperledger/composer/pull/1971,See above.,03009196708cd0c24c4e4a93e111c20ca1ad1b2a,2017-08-23 10:40:31,134716286,"@@ -12,99 +12,55 @@ index-order: 701
 
 ## Concepts
 
-A `Participant` is an actor in a business network. A participant might be an individual
-an organization. A participant can create assets, and also exchange assets with
-other participants. A participant works with assets by submitting transactions.
+A `Participant` is an actor in a business network. A participant might be an individual an organization. A participant can create assets, and also exchange assets with other participants. A participant works with assets by submitting transactions.
 
-A participant has a set of `Identity` documents that can be validated to prove the
-identity of that participant. For example, an individual may have one or more of
-the following identity documents that prove who they are:
+A participant has a set of `Identity` documents that can be validated to prove the identity of that participant. For example, an individual may have one or more of the following identity documents that prove who they are:
 
 * Passport
 * Driving license
 * Fingerprints
 * Retina scan
 * SSL certificate
 
-In {{site.data.conrefs.composer_full}}, participants are separated from the set of
-identity documents that they can use to interact with a business network.
-
-In order for a new participant to join a business network, a new instance of that
-participant must be created in the business network. The participant instance
-stores all of the required information about that participant, but it does not give
-that participant access to interact with the business network.
-
-In order to grant the participant access to interact with the business network, an
-identity document must then be `Issued` to that participant. The new participant
-can then use that identity document to interact with the business network.
-
-A participant may have an existing identity document that they use to interact with
-other business networks or other external systems. These identity documents can
-be reused and `Bound` to that participant. The new participant can then use their
-existing identity document to interact with the business network.
-
-Identity documents usually expire after a set period of time. Identity documents may
-also be lost or stolen. If the identity document expires, or if it needs to be
-replaced, then it must be `Revoked` so it can no longer be used to interact with
-the business network.
-
-However, revoking an identity document does not remove the information about that
-participant and any assets that they own. Revoking the identity document simply
-removes the participants ability to interact with the business network using that
-identity document. Access to the business network can be restored by issuing the
-participant with a new identity document.
-
-These participant and identity management actions are performed by an existing
-participant in the business network, for example a regulatory body, or a participant
-in the same organization who has been trusted to manage participants/identities in
+In {{site.data.conrefs.composer_full}}, participants are separated from the set of identity documents that they can use to interact with a business network.
+
+In order for a new participant to join a business network, a new instance of that participant must be created in the business network. The participant instance stores all of the required information about that participant, but it does not give that participant access to interact with the business network.
+
+In order to grant the participant access to interact with the business network, an identity document must then be `Issued` to that participant. The new participant can then use that identity document to interact with the business network.
+
+A participant may have an existing identity document that they use to interact with other business networks or other external systems. These identity documents can be reused and `Bound` to that participant. The new participant can then use their existing identity document to interact with the business network.
+
+Identity documents usually expire after a set period of time. Identity documents may also be lost or stolen. If the identity document expires, or if it needs to be replaced, then it must be `Revoked` so it can no longer be used to interact with the business network.
+
+However, revoking an identity document does not remove the information about that participant and any assets that they own. Revoking the identity document simply removes the participants ability to interact with the business network using that identity document. Access to the business network can be restored by issuing the participant with a new identity document.
+
+These participant and identity management actions are performed by an existing participant in the business network, for example a regulatory body, or a participant in the same organization who has been trusted to manage participants/identities in
 that organization.
 
 ## Participants and identities in {{site.data.conrefs.composer_full}}
 
-In {{site.data.conrefs.composer_full}}, the structure of a participant is modelled in a
-model file. This structure may include various information about the participant,
-for example the participants name, address, e-mail address, date of birth, etc.
-New instances of that modelled participant can then be created and added to a
-participant registry.
-
-{{site.data.conrefs.composer_full}} requires the use Blockchain identities as the
-form of identity documents. For example, when deploying a business network to Hyperledger
-Fabric, enrolment certificates are used as the form of identity document. These enrolment
-certificates are used to cryptographically sign the transactions that are submitted to
-the deployed business network.
-
-A deployed business network maintains a set of mappings of identities to participants
-in the `Identity Registry`. When an identity is `Issued` or `Bound` to a participant, a new
-mapping is added to the identity registry. When that participant uses that identity to
-submit transactions to the deployed business network, the Composer runtime looks for a
-valid mapping for that identity in the identity registry. This lookup is done using
-the public key signature or fingerprint, essentially a hash of the certificate contents
-that is unique to that certificate and identity.
-
-Once a mapping is found in the identity registry, the participant for that identity is
-retrieved from that mapping. That participant becomes the `Current Participant`, the
-participant who submitted the transaction. All access control in {{site.data.conrefs.composer_full}}
-is based around the current participant. Access control rules that define which participants
-can perform which operations on which resources all operate on the current participant.
-
-When a participant uses an identity to submit a transaction to the deployed business
-network for the first time, that identity is `Activated`. This means that the entry in
-the identity registry is updated to record the fact that the identity was used for the
-first time. Additional information about the identity, such as the certificate, may also
-be recorded in the identity registry during activation if it was not available when the
-identity was issued or bound to the participant.
-
-If and when an identity is revoked, the entry in the identity registry for that identity
-is updated to change the status to `Revoked`. After an identity is revoked, if a participant
-tries to use that identity to submit a transaction to the deployed business network, that
-transaction will be rejected.
+In {{site.data.conrefs.composer_full}}, the structure of a participant is modeled in a model file. This structure may include various information about the participant, for example the participants name, address, e-mail address, date of birth, etc. New instances of that modeled participant can then be created and added to a participant registry.
+
+{{site.data.conrefs.composer_full}} requires the use Blockchain identities as the form of identity documents. For example, when deploying a business network to {{site.data.conrefs.hlf_full}}, enrollment certificates are used as the form of identity document. These enrollment certificates are used to cryptographically sign the transactions that are submitted to the deployed business network.
+
+A deployed business network maintains a set of mappings of identities to participants in the `Identity Registry`. When an identity is `Issued` or `Bound` to a participant, a new mapping is added to the identity registry. When that participant uses that identity to submit transactions to the deployed business network, the Composer runtime looks for a valid mapping for that identity in the identity registry. This lookup is done using the public key signature or fingerprint, essentially a hash of the certificate contents that is unique to that certificate and identity.
+
+Once a mapping is found in the identity registry, the participant for that identity is retrieved from that mapping. That participant becomes the `Current Participant`, the participant who submitted the transaction. All access control in {{site.data.conrefs.composer_full}} is based around the current participant. Access control rules that define which participants can perform which operations on which resources all operate on the current participant.
+
+When a participant uses an identity to submit a transaction to the deployed business network for the first time, that identity is `Activated`. This means that the entry in the identity registry is updated to record the fact that the identity was used for the first time. Additional information about the identity, such as the certificate, may also be recorded in the identity registry during activation if it was not available when the identity was issued or bound to the participant.
+
+If and when an identity is revoked, the entry in the identity registry for that identity is updated to change the status to `Revoked`. After an identity is revoked, if a participant tries to use that identity to submit a transaction to the deployed business network, that transaction will be rejected.
+
+## Identities and ID cards in the {{site.data.conrefs.composer_full}} Playground
+
+In the {{site.data.conrefs.composer_full}} Playground, there is a wallet containing locally stored ID cards. An ID card is an access card to a business network, comprising identity data, a connection profile, and the correct certificates for business network access.
+
+ID cards can be exported to allow the assignment of identities to others. Once the certificates associated with an identity have been used to register the ID card, they cannot be reused, for this reason it is important connect using an ID card before exporting, if that id card is being assigned to another user.",,2017-08-23 12:53:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/134716286,https://github.com/hyperledger/composer/pull/1971#discussion_r134716286,EdProsser
https://github.com/hyperledger/composer/pull/1971,https://github.com/hyperledger/composer/pull/1971,Have a look. ^^,03009196708cd0c24c4e4a93e111c20ca1ad1b2a,2017-08-23 10:41:16,134716411,"@@ -21,7 +21,11 @@ Open <a href=""http://composer-playground.mybluemix.net"" target=""blank"">{{site.da
 
 If you have previously used Playground, be sure to clear your browser local storage by running `localStorage.clear()` in your browser Console.
 
-## Step 2: Define your Domain Model
+## Step 2: Choose an Identity
+
+At the **My Wallet** page, click **Connect now** on the **Admin** ID card. This will allow us to make any changes to the business network definition.",,2017-08-23 12:53:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/134716411,https://github.com/hyperledger/composer/pull/1971#discussion_r134716411,EdProsser
https://github.com/hyperledger/composer/pull/1971,https://github.com/hyperledger/composer/pull/1971,The PeerAdmin and ChannelAdmin roles can be on different cards,03009196708cd0c24c4e4a93e111c20ca1ad1b2a,2017-08-23 11:21:04,134723511,"@@ -32,7 +32,10 @@ Due to many breaking API changes between {{site.data.conrefs.hlf_full}} alpha 1
 
 ### Deploying business networks using Playground locally
 
-When deploying a business network to {{site.data.conrefs.hlf_full}} v1.0 using the Playground locally, you must follow the process above to connect using the peer admin identity. However, in order to create identities and interact with your business network in the Playground, you must use the certificate authority admin identity.
+When deploying a business network to {{site.data.conrefs.hlf_full}} v1.0 using the Playground locally, you must follow the process above to connect using the peer admin identity.
+
+Identities in playground are associated with ID cards, comprising a connection profile, identity metadata, and certificates. When deploying a business network using Playground locally, you must have an ID card containing the correct admin certificates. The identity metadata in the ID card must also specify the `PeerAdmin` and `ChannelAdmin` roles.",,2017-08-23 12:53:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/134723511,https://github.com/hyperledger/composer/pull/1971#discussion_r134723511,cazfletch
https://github.com/hyperledger/composer/pull/1971,https://github.com/hyperledger/composer/pull/1971,sorry this should be businessNetwork,03009196708cd0c24c4e4a93e111c20ca1ad1b2a,2017-08-23 11:22:54,134723858,"@@ -0,0 +1,115 @@
+---
+layout: default
+title: Creating, Exporting, and Importing ID Cards
+category: tasks
+section: managing
+sidebar: sidebars/accordion-toc0.md
+excerpt: ID cards combine a connection profile, identity, and certificates to allow a connection to a business network in Hyperledger Composer Playground. ID cards can be [created, exported and imported](./id-cards-playground.html) from the **My Wallet** page in Hyperledger Composer Playground.
+index-order: 703
+---
+
+
+# Creating, Exporting, and Importing ID Cards
+
+ID cards are represented by `.card` files containing a `metadata.JSON` file, a connection profile, and optional certificates.
+
+ID cards can be used in the {{site.data.conrefs.composer_full}} Playground to manage identities for different business networks and connection profiles.
+
+---
+
+## Creating ID Cards
+
+ID cards can be created in the wallet screen, created from the component files, or created within a business network.
+
+_Please note_: If cards are created from the wallet screen, or created from the component files, there must be a corresponding identity already created in the business network.
+
+
+### Creating an ID card within a business network
+
+1. From the **My Wallet** screen, select an identity to use to connect to your business network. Click **Connect Now**. _Please note:_ You must use an identity with the permission to create new identities.
+
+2. _Optional_: To create a participant to assign to the identity, click the **Test** tab, and click **Create New Participant**.
+
+3. Click the name of your identity in the upper right, and click **ID Registry**.
+
+4. Click **Issue New ID**.
+
+5. Choose an **ID Name**, and select a **Participant** to associate the new identity with.
+
+6. Click **Create New**.
+
+7. Click **Add to My Wallet**. Adding the ID card to your wallet allows you to use it to connect to the business network, or export it for someone else to use.
+
+The **My Wallet** screen should now show the new ID card.
+
+### Creating an ID card using from the Wallet
+
+An ID card can be created from the **My Wallet** page, however, a corresponding identity must already have been created in the business network. Creating an ID card from the **My Wallet** page requires that you use the same _User ID_, _User Secret_ and the correct _Business network name_ credentials as when the identity was created within the business network.
+
+To create an ID card from the **My Wallet** page:
+
+1. After receiving a valid _User ID_ and _User Secret_, click the **Create ID Card** button in the upper right of the **My Wallet** page.
+
+2. Select a connection profile and click **Next**.
+
+3. Enter the _User ID_ and _User Secret_ that were generated when the identity was created.
+
+4. Enter the correct _Business Network Name_ and click **Create**.
+
+The ID card should now be displayed in the **My Wallet** page.
+
+
+### Creating an ID card from component files
+
+ID cards are composite files containing up to three elements:
+
+- A connection profile. (`.json`)
+- A metadata file containing the data for the identity to use to connect to the business network. (`metadata.json`)
+- An optional credentials directory containing a public and private key.
+
+_Please note_: If there is no credentials directory, the metadata file must contain the _User Secret_ property with the property name _enrollmentSecret_. If an _enrollmentSecret_ is specified, a credentials directory with certificates will be created and populated if the ID card is exported.
+
+The metadata file should take the following format:
+
+```
+{
+    ""name"": ""PeerAdmin"",
+    ""description"": ""A valid ID card"",
+    ""businessNetworkName"": ""basic-sample-network""",,2017-08-23 12:53:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/134723858,https://github.com/hyperledger/composer/pull/1971#discussion_r134723858,cazfletch
https://github.com/hyperledger/composer/pull/1966,https://github.com/hyperledger/composer/pull/1966,"We can probably just remove this function and have a version constant at the top:

`const version = require('./package.json').version;`",28b734256cfa983e2edfbb5c28b36bec5f321df2,2017-08-23 10:07:18,134709944,"@@ -71,20 +65,17 @@ if (typeof(results.thePromise) !== 'undefined'){
     process.exit(0);
 }
 
+
 /**
  * [getInfo description]
- * @param  {[type]} moduleName [description]
  * @return {[type]}            [description]
  */
-function getInfo(moduleName){
-
+function getVersion(){",,2017-08-23 18:21:20,https://api.github.com/repos/hyperledger/composer/pulls/comments/134709944,https://github.com/hyperledger/composer/pull/1966#discussion_r134709944,sstone1
https://github.com/hyperledger/composer/pull/1966,https://github.com/hyperledger/composer/pull/1966,"We can probably just remove this function and have a version constant at the top:

const version = require('./package.json').version;",28b734256cfa983e2edfbb5c28b36bec5f321df2,2017-08-23 10:07:33,134709990,"@@ -163,18 +158,14 @@ module.exports = promise.then((composer) => {
 
 /**
  * [getInfo description]
- * @param  {[type]} moduleName [description]
  * @return {[type]}            [description]
  */
-function getInfo(moduleName) {
-
+function getVersion(){",,2017-08-23 18:21:20,https://api.github.com/repos/hyperledger/composer/pulls/comments/134709990,https://github.com/hyperledger/composer/pull/1966#discussion_r134709990,sstone1
https://github.com/hyperledger/composer/pull/1924,https://github.com/hyperledger/composer/pull/1924,should this be changed after a version bump has been done ?,92234500ca140598e892c8972b55bfa8f584d061,2017-08-21 08:23:43,134170866,"@@ -12,6 +12,9 @@
 # Note that the latest public API is documented using JSDocs and is available in api.txt.
 #
 
+Version 0.11.4 {24d2234e4b8ccafd57c303c90792ec31} 2017-08-18",,2017-08-21 21:12:47,https://api.github.com/repos/hyperledger/composer/pulls/comments/134170866,https://github.com/hyperledger/composer/pull/1924#discussion_r134170866,davidkel
https://github.com/hyperledger/composer/pull/1924,https://github.com/hyperledger/composer/pull/1924,Should we have an issue to change these examples ?,92234500ca140598e892c8972b55bfa8f584d061,2017-08-21 08:24:39,134171026,"@@ -182,7 +182,7 @@ class BusinessNetworkConnection extends EventEmitter {
 
     /**
      * Get a list of all existing participant registries.
-     * @exampleserializedResources
+     * @example
      * // Get all participant registries
      * var businessNetwork = new BusinessNetworkConnection();
      * return businessNetwork.connect('testprofile', 'businessNetworkIdentifier', 'WebAppAdmin', 'DJY27pEnl16d')",26,2017-08-21 21:12:47,https://api.github.com/repos/hyperledger/composer/pulls/comments/134171026,https://github.com/hyperledger/composer/pull/1924#discussion_r134171026,davidkel
https://github.com/hyperledger/composer/pull/1924,https://github.com/hyperledger/composer/pull/1924,should HistorianRecord extend asset in the same way Identity does ?,92234500ca140598e892c8972b55bfa8f584d061,2017-08-21 08:41:04,134174466,"@@ -108,23 +102,15 @@ asset HistorianRecord identified by transactionId {
   --> Identity    identityUsed         optional",43,2017-08-21 21:12:47,https://api.github.com/repos/hyperledger/composer/pulls/comments/134174466,https://github.com/hyperledger/composer/pull/1924#discussion_r134174466,davidkel
https://github.com/hyperledger/composer/pull/1924,https://github.com/hyperledger/composer/pull/1924,"The other way round - I fixed the problem which meant you had to explicitly extend Asset, so I'll remove the `extend Asset` from the other types.",92234500ca140598e892c8972b55bfa8f584d061,2017-08-21 09:26:54,134184429,"@@ -108,23 +102,15 @@ asset HistorianRecord identified by transactionId {
   --> Identity    identityUsed         optional",43,2017-08-21 21:12:47,https://api.github.com/repos/hyperledger/composer/pulls/comments/134184429,https://github.com/hyperledger/composer/pull/1924#discussion_r134184429,sstone1
https://github.com/hyperledger/composer/pull/1924,https://github.com/hyperledger/composer/pull/1924,"Yep, have raised #1932.",92234500ca140598e892c8972b55bfa8f584d061,2017-08-21 09:29:22,134184978,"@@ -182,7 +182,7 @@ class BusinessNetworkConnection extends EventEmitter {
 
     /**
      * Get a list of all existing participant registries.
-     * @exampleserializedResources
+     * @example
      * // Get all participant registries
      * var businessNetwork = new BusinessNetworkConnection();
      * return businessNetwork.connect('testprofile', 'businessNetworkIdentifier', 'WebAppAdmin', 'DJY27pEnl16d')",26,2017-08-21 21:12:47,https://api.github.com/repos/hyperledger/composer/pulls/comments/134184978,https://github.com/hyperledger/composer/pull/1924#discussion_r134184978,sstone1
https://github.com/hyperledger/composer/pull/1924,https://github.com/hyperledger/composer/pull/1924,"Yeah, I'll take the hit for the version bump.",92234500ca140598e892c8972b55bfa8f584d061,2017-08-21 09:29:38,134185037,"@@ -12,6 +12,9 @@
 # Note that the latest public API is documented using JSDocs and is available in api.txt.
 #
 
+Version 0.11.4 {24d2234e4b8ccafd57c303c90792ec31} 2017-08-18",,2017-08-21 21:12:47,https://api.github.com/repos/hyperledger/composer/pulls/comments/134185037,https://github.com/hyperledger/composer/pull/1924#discussion_r134185037,sstone1
https://github.com/hyperledger/composer/pull/1916,https://github.com/hyperledger/composer/pull/1916,oops,7253e15e76af51541ba3340ea547ec9e0fca587a,2017-08-18 13:56:16,133964759,"@@ -3,13 +3,23 @@ import { ExpectedConditions } from 'protractor';
 import { dragDropFile } from '../utils/fileUtils';
 import { OperationsHelper } from '../utils/operations-helper';
 
+let scrollMe = (target) => {
+    target.scrollIntoView(true);
+};
+
 export class Import {
 
   // Select BND from BNA file drop
   static selectBusinessNetworkDefinitionFromFile(filePath: string) {
-    // Import modal should be present
-    return browser.wait(ExpectedConditions.visibilityOf(element(by.css('.import'))), 10000)
+    // Import slide out should be present
+    return browser.wait(ExpectedConditions.visibilityOf(element(by.css('.drawer'))), 10000)
+    .then(() => {
+        // must have file drag drop visible
+        OperationsHelper.retriveMatchingElementsByCSS('.sample-network-list-container', '.sample-network-list-item', 3);
+        return browser.wait(ExpectedConditions.visibilityOf(element(by.id('file-importer_input'))), 10000);
+    })
     .then(() => {
+        console.log('drag drop go');",,2017-08-18 13:59:57,https://api.github.com/repos/hyperledger/composer/pulls/comments/133964759,https://github.com/hyperledger/composer/pull/1916#discussion_r133964759,cazfletch
https://github.com/hyperledger/composer/pull/1905,https://github.com/hyperledger/composer/pull/1905,"I think this `else if` can be removed now that you've added `exportIdentity` support for the embedded, web, and proxy runtimes? You need to manually merge the `api.txt` changes so worth a try to see if it works ðŸ˜‰ ",3559778fd8020e71f75f8d3f5712b7fada73e93e,2017-08-19 19:16:57,134098830,"@@ -273,4 +273,45 @@ describe('Identity system tests', () => {
             .should.be.rejectedWith(/The current identity is bound to a participant that does not exist/);
     });
 
+    it('should export credentials for previously imported identity', function () {
+        let profileName;
+        let certificate;
+        let privateKey;
+        if (TestUtil.isHyperledgerFabricV1()) {
+            profileName = 'composer-systests-org1';
+            const certificateFile = path.resolve(__dirname, '../hlfv1/crypto-config/peerOrganizations/org1.example.com/users/User1@org1.example.com/msp/signcerts/User1@org1.example.com-cert.pem');
+            certificate = fs.readFileSync(certificateFile, 'utf8').replace(/\r/g, '');
+            const privateKeyFile = path.resolve(__dirname, '../hlfv1/crypto-config/peerOrganizations/org1.example.com/users/User1@org1.example.com/msp/keystore/key.pem');
+            privateKey = fs.readFileSync(privateKeyFile, 'utf8').replace(/\r/g, '');
+        } else if (TestUtil.isWeb()) {",,2017-08-22 13:27:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/134098830,https://github.com/hyperledger/composer/pull/1905#discussion_r134098830,sstone1
https://github.com/hyperledger/composer/pull/1883,https://github.com/hyperledger/composer/pull/1883,Wrong logger name of `IdCard` here!,a38e69f68a238735bd38c5dfd666ffcd51e264a0,2017-08-16 10:33:47,133413904,"@@ -14,8 +14,11 @@
 
 'use strict';
 
-const JavaScriptParser = require('../codegen/javascriptparser');
 const FunctionDeclaration = require('../introspect/functiondeclaration');
+const JavaScriptParser = require('../codegen/javascriptparser');
+
+const Logger = require('../log/logger');
+const LOG = Logger.getLog('IdCard');",,2017-08-16 10:38:04,https://api.github.com/repos/hyperledger/composer/pulls/comments/133413904,https://github.com/hyperledger/composer/pull/1883#discussion_r133413904,sstone1
https://github.com/hyperledger/composer/pull/1880,https://github.com/hyperledger/composer/pull/1880,User names aren't centred. Think this should be `margin-top: $space-medium`,07ebc1a223869f0550787c0e331246ffae339e7a,2017-08-16 15:17:46,133480913,"@@ -63,9 +63,13 @@
 
         .user-details {
             padding-top: $space-large;
+            text-align: center;
+            font-size: 0.9em;
+            margin-bottom: $space-smedium;
 
-            p {
+            .user-name {
                 font-weight: 600;
+                margin: $space-medium 0 0 $space-smedium;",,2017-08-16 15:51:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/133480913,https://github.com/hyperledger/composer/pull/1880#discussion_r133480913,jt-nti
https://github.com/hyperledger/composer/pull/1879,https://github.com/hyperledger/composer/pull/1879,"A couple of nit-picks:
- To run the Playground UI locally you need to run `npm start` in both the _composer-playground-api_ and _composer-playground_ packages in turn; just _composer-playground_ on its own won't give you enough for a fully functional UI running locally.
- Please could you tidy up the punctuation: no spaces before comma (,) and full-stop (.); _""For example, if...""_ rather than _""For eg. If...""_.",e967711945209e806e776c32dc3f1ac1869cd21c,2017-08-15 15:10:17,133215231,"@@ -79,6 +79,16 @@ You must bootstrap the repository so that all of the dependencies are installed
 You can then work with the packages under [packages/](packages/) on a per-package
 basis as any normal node.js package.
 
+For eg. If you are working on composer-playground package , you can run:",,2017-08-15 17:39:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/133215231,https://github.com/hyperledger/composer/pull/1879#discussion_r133215231,bestbeforetoday
https://github.com/hyperledger/composer/pull/1879,https://github.com/hyperledger/composer/pull/1879,"Sure , i have updated the PR .",e967711945209e806e776c32dc3f1ac1869cd21c,2017-08-15 17:37:26,133252626,"@@ -79,6 +79,16 @@ You must bootstrap the repository so that all of the dependencies are installed
 You can then work with the packages under [packages/](packages/) on a per-package
 basis as any normal node.js package.
 
+For eg. If you are working on composer-playground package , you can run:",,2017-08-15 17:39:54,https://api.github.com/repos/hyperledger/composer/pulls/comments/133252626,https://github.com/hyperledger/composer/pull/1879#discussion_r133252626,neeravarora
https://github.com/hyperledger/composer/pull/1872,https://github.com/hyperledger/composer/pull/1872,you don't need the fakeAsync here,529cbd2021f02793bdfe70ad3eab49594ee7d8b9,2017-08-15 10:03:54,133156133,"@@ -0,0 +1,242 @@
+/* tslint:disable:no-unused-variable */
+/* tslint:disable:no-unused-expression */
+/* tslint:disable:no-var-requires */
+/* tslint:disable:max-classes-per-file */
+import { ComponentFixture, TestBed, fakeAsync, tick } from '@angular/core/testing';
+import { Component, Directive, EventEmitter, Output, Input } from '@angular/core';
+import { FormsModule } from '@angular/forms';
+import { By } from '@angular/platform-browser';
+
+import { ImportIdentityComponent } from './import-identity.component';
+
+import { ActiveDrawer, DrawerService } from '../../common/drawer';
+import { AlertService } from '../../basic-modals/alert.service';
+import { Logger, IdCard } from 'composer-common';
+
+import * as sinon from 'sinon';
+import * as chai from 'chai';
+
+let should = chai.should();
+
+@Directive({
+    selector: '[fileDragDrop]'
+})
+class MockDragDropDirective {
+    @Output()
+    public fileDragDropFileAccepted: EventEmitter<File> = new EventEmitter<File>();
+    @Output()
+    public fileDragDropFileRejected: EventEmitter<string> = new EventEmitter<string>();
+    @Output()
+    public fileDragDropDragOver: EventEmitter<string> = new EventEmitter<string>();
+    @Output()
+    public fileDragDropDragLeave: EventEmitter<string> = new EventEmitter<string>();
+
+    @Input()
+    public supportedFileTypes: string[] = [];
+    @Input()
+    maxFileSize: number = 0;
+}
+
+@Directive({
+    selector: 'file-importer'
+})
+class MockFileImporterDirective {
+    @Output()
+    public fileAccepted: EventEmitter<File> = new EventEmitter<File>();
+
+    @Output()
+    public fileRejected: EventEmitter<File> = new EventEmitter<File>();
+
+    @Input()
+    public expandInput: boolean = false;
+
+    @Input()
+    public svgName: string = '#icon-BNA_Upload';
+
+    @Input()
+    public maxFileSize: number = 0;
+
+    @Input()
+    public supportedFileTypes: string[] = [];
+}
+
+@Component({
+    selector: 'identity-card',
+    template: ''
+})
+class MockIdentityCardComponent {
+    @Input() identity: any;
+    @Input() preview: boolean;
+}
+
+describe('ImportIdentityComponent', () => {
+    let component: ImportIdentityComponent;
+    let fixture: ComponentFixture<ImportIdentityComponent>;
+
+    let mockDragDropComponent;
+
+    let mockAlertService;
+    let mockActiveDrawer;
+    let mockDrawerService;
+
+    beforeEach(() => {
+        mockAlertService = sinon.createStubInstance(AlertService);
+        mockActiveDrawer = sinon.createStubInstance(ActiveDrawer);
+        mockDrawerService = sinon.createStubInstance(DrawerService);
+
+        mockAlertService.errorStatus$ = {
+            next: sinon.stub()
+        };
+
+        mockAlertService.busyStatus$ = {
+            next: sinon.stub()
+        };
+
+        TestBed.configureTestingModule({
+            imports: [FormsModule],
+            declarations: [
+                ImportIdentityComponent,
+                MockIdentityCardComponent,
+                MockDragDropDirective,
+                MockFileImporterDirective
+            ],
+            providers: [
+                {provide: ActiveDrawer, useValue: mockActiveDrawer},
+                {provide: DrawerService, useValue: mockDrawerService},
+                {provide: AlertService, useValue: mockAlertService}]
+        });
+
+        mockDrawerService.open.returns({componentInstance: {}});
+
+        fixture = TestBed.createComponent(ImportIdentityComponent);
+        component = fixture.componentInstance;
+
+        let mockDragDropElement = fixture.debugElement.query(By.directive(MockDragDropDirective));
+        mockDragDropComponent = mockDragDropElement.injector.get(MockDragDropDirective) as MockDragDropDirective;
+    });
+
+    it('should create', () => {
+        component.should.be.ok;
+    });
+
+    describe('fileDetected', () => {
+        it('should set expand input to true', () => {
+            component['expandInput'].should.equal(false);
+            mockDragDropComponent.fileDragDropDragOver.emit();
+
+            component['expandInput'].should.equal(true);
+        });
+    });
+
+    describe('fileLeft', () => {
+        it('should set expand input to false', () => {
+            component['expandInput'] = true;
+            mockDragDropComponent.fileDragDropDragLeave.emit();
+
+            component['expandInput'].should.equal(false);
+        });
+    });
+
+    describe('fileAccepted', () => {
+        let sandbox;
+        let mockFile;
+        let mockIdCard;
+        let mockFileReader;
+        let fileReaderStub;
+        let idCardFromArchiveStub;
+        let bufferFromStub;
+
+        beforeEach(() => {
+            // webpack can't handle dymanically creating a logger
+            Logger.setFunctionalLogger({
+                log: sinon.stub()
+            });
+
+            sandbox = sinon.sandbox.create();
+            mockFile = 'card file';
+            mockIdCard = sinon.createStubInstance(IdCard);
+            idCardFromArchiveStub = sandbox.stub(IdCard, 'fromArchive');
+            bufferFromStub = sandbox.stub(Buffer.prototype, 'from');
+            fileReaderStub = sandbox.stub(window, 'FileReader');
+
+            mockFileReader = {
+                onload: sinon.stub(),
+                readAsArrayBuffer: sinon.stub(),
+                result: 'idcard file'
+            };
+
+            bufferFromStub.returns('id card data');
+            fileReaderStub.returns(mockFileReader);
+        });
+
+        afterEach(() => {
+            sandbox.restore();
+        });
+
+        it('should read an identity card file', fakeAsync(() => {
+            idCardFromArchiveStub.returns(Promise.resolve(mockIdCard));
+            mockDragDropComponent.fileDragDropFileAccepted.emit(mockFile);
+
+            mockFileReader.readAsArrayBuffer.should.have.been.calledWith(mockFile);
+
+            mockFileReader.onload();
+
+            tick();
+
+            component['identityCard'].should.equal(mockIdCard);
+            component['expandInput'].should.equal(true);
+        }));
+
+        it('should handle error', fakeAsync(() => {
+            idCardFromArchiveStub.returns(Promise.reject('some error'));
+            mockDragDropComponent.fileDragDropFileAccepted.emit(mockFile);
+
+            mockFileReader.readAsArrayBuffer.should.have.been.calledWith(mockFile);
+
+            mockFileReader.onload();
+
+            tick();
+
+            mockActiveDrawer.dismiss.should.have.been.calledWith('Could not read ID card');
+            component['expandInput'].should.equal(false);
+        }));
+    });
+
+    describe('file rejected', () => {
+        it('should reject the file', () => {
+            mockDragDropComponent.fileDragDropFileRejected.emit('some error');
+
+            mockActiveDrawer.dismiss.should.have.been.calledWith('some error');
+            component['expandInput'].should.equal(false);
+            should.not.exist(component['identityCard']);
+        });
+    });
+
+    describe('remove file', () => {
+        it('should remove the file', () => {
+            component.removeFile();
+
+            component['expandInput'].should.equal(false);
+            should.not.exist(component['identityCard']);
+        });
+    });
+
+    describe('import', () => {
+        it('should close the drawer with imported identity card', fakeAsync(() => {",,2017-08-15 19:31:32,https://api.github.com/repos/hyperledger/composer/pulls/comments/133156133,https://github.com/hyperledger/composer/pull/1872#discussion_r133156133,cazfletch
https://github.com/hyperledger/composer/pull/1872,https://github.com/hyperledger/composer/pull/1872,no todo anymore???,529cbd2021f02793bdfe70ad3eab49594ee7d8b9,2017-08-15 10:06:50,133156549,"@@ -162,6 +162,23 @@ export class LoginComponent implements OnInit {
         this.showDeployNetwork = false;
     }
 
+    importIdentity() {
+        this.drawerService.open(ImportIdentityComponent).result.then((result) => {
+            return this.identityCardService.addIdentityCard(result);
+        }).then((cardRef) => {
+            // TODO import something!",,2017-08-15 19:31:32,https://api.github.com/repos/hyperledger/composer/pulls/comments/133156549,https://github.com/hyperledger/composer/pull/1872#discussion_r133156549,cazfletch
https://github.com/hyperledger/composer/pull/1871,https://github.com/hyperledger/composer/pull/1871,"I would say to run composer and hlf requires a minimum of 4Gb of memory, lets not refer specifically to VM environments as we should cover all bases (believe it or not people have been running components of fabric on a raspberry pi)",ac5c0ffa5762a3e4e7f9c481fbc9661fec8d3495,2017-08-15 10:39:14,133161131,"@@ -44,6 +44,9 @@ Next run the script - as this briefly uses sudo during its execution, you will b
 ```
 ./prereqs-ubuntu.sh
 ```
+
+To run {{site.data.conrefs.composer_full}} and {{site.data.conrefs.hlf_full}} in a virtual machine, we recommend you allocate the VM 4Gb of memory.",,2017-08-15 14:26:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/133161131,https://github.com/hyperledger/composer/pull/1871#discussion_r133161131,davidkel
https://github.com/hyperledger/composer/pull/1871,https://github.com/hyperledger/composer/pull/1871,Same applies here,ac5c0ffa5762a3e4e7f9c481fbc9661fec8d3495,2017-08-15 10:39:32,133161182,"@@ -27,6 +27,9 @@ In order to install {{site.data.conrefs.composer_full}} Playground, you need the
 docker ps -aq | xargs docker rm -f
 docker images -aq | xargs docker rmi -f
 ```
+
+To run {{site.data.conrefs.composer_full}} and {{site.data.conrefs.hlf_full}} in a virtual machine, we recommend you allocate the VM 4Gb of memory.",,2017-08-15 14:26:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/133161182,https://github.com/hyperledger/composer/pull/1871#discussion_r133161182,davidkel
https://github.com/hyperledger/composer/pull/1867,https://github.com/hyperledger/composer/pull/1867,dead code,10d87ecc9ae2ef0fe3e73a3e59452981eeeb4dfd,2017-08-15 09:44:04,133153075,"@@ -21,9 +19,9 @@ export class TestComponent implements OnInit, OnDestroy {
     hasTransactions = false;
     private registries = {
         assets: [],
-        participants : [],
+        participants: [],
         // transactions: null,",,2017-08-15 09:54:55,https://api.github.com/repos/hyperledger/composer/pulls/comments/133153075,https://github.com/hyperledger/composer/pull/1867#discussion_r133153075,nklincoln
https://github.com/hyperledger/composer/pull/1849,https://github.com/hyperledger/composer/pull/1849,Why is this `fromUri` and not `fromURI` as per the existing code?,3b811cb418225cda0616f38ec00fb08fa694461c,2017-08-12 04:50:41,132809763,"@@ -0,0 +1,84 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const ModelUtils = require('../modelutil');
+
+/**
+ * All the identifying properties of a resource.
+ * @private
+ * @class
+ * @memberof module:composer-common
+ * @property {String} protocol
+ * @property {String} namespace
+ * @property {String} type
+ * @property {String} id
+ */
+class Identifier {
+    /**
+     * <strong>Note: only for use by internal framework code.</strong>
+     * @param {String} protocol - Protocol.
+     * @param {String} namespace - Namespace containing the type.
+     * @param {String} type - Short type name.
+     * @param {String} id - Instance identifier.
+     * @private
+     */
+    constructor(protocol, namespace, type, id) {
+        this.protocol = protocol;
+        this.namespace = namespace;
+        this.type = type;
+        this.id = id;
+    }
+
+    /**
+     * Parse a URI into an identifier.
+     * @param {String} uri - Resource URI.
+     * @param {String} [defaultNamespace] - Namespace to use if the URI does not specify one.
+     * @param {String} [defaultType] - Type to use if the URI does not specify one.
+     * @return {Identifier} - An identifier.
+     */
+    static fromUri(uri, defaultNamespace, defaultType) {",,2017-08-14 09:46:24,https://api.github.com/repos/hyperledger/composer/pulls/comments/132809763,https://github.com/hyperledger/composer/pull/1849#discussion_r132809763,sstone1
https://github.com/hyperledger/composer/pull/1849,https://github.com/hyperledger/composer/pull/1849,Why is this `toUri` and not `toURI` as per the existing code?,3b811cb418225cda0616f38ec00fb08fa694461c,2017-08-12 04:50:51,132809764,"@@ -0,0 +1,84 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const ModelUtils = require('../modelutil');
+
+/**
+ * All the identifying properties of a resource.
+ * @private
+ * @class
+ * @memberof module:composer-common
+ * @property {String} protocol
+ * @property {String} namespace
+ * @property {String} type
+ * @property {String} id
+ */
+class Identifier {
+    /**
+     * <strong>Note: only for use by internal framework code.</strong>
+     * @param {String} protocol - Protocol.
+     * @param {String} namespace - Namespace containing the type.
+     * @param {String} type - Short type name.
+     * @param {String} id - Instance identifier.
+     * @private
+     */
+    constructor(protocol, namespace, type, id) {
+        this.protocol = protocol;
+        this.namespace = namespace;
+        this.type = type;
+        this.id = id;
+    }
+
+    /**
+     * Parse a URI into an identifier.
+     * @param {String} uri - Resource URI.
+     * @param {String} [defaultNamespace] - Namespace to use if the URI does not specify one.
+     * @param {String} [defaultType] - Type to use if the URI does not specify one.
+     * @return {Identifier} - An identifier.
+     */
+    static fromUri(uri, defaultNamespace, defaultType) {
+        // Format: ""protocol:qualifiedType#identifier"", where ""protocol:"" and ""qualifiedType#"" are optional.
+        // This pattern should never fail to match.
+        const pattern = /^(?:([^:#]+):)?(?:([^#]+)#)?(.*)$/;
+        const match = uri.match(pattern);
+
+        const protocol = match[1] || '';
+        const qualifiedType = match[2] || '';
+        const id = decodeURI(match[3] || '');
+
+        let namespace = defaultNamespace;
+        let type = defaultType;
+        if (qualifiedType) {
+            namespace = ModelUtils.getNamespace(qualifiedType);
+            type = ModelUtils.getShortName(qualifiedType);
+        }
+
+        return new Identifier(protocol, namespace, type, id);
+    }
+
+    /**
+     * URI representation of this identifier.
+     * @return {String} - A URI.
+     */
+    toUri() {",,2017-08-14 09:46:24,https://api.github.com/repos/hyperledger/composer/pulls/comments/132809764,https://github.com/hyperledger/composer/pull/1849#discussion_r132809764,sstone1
https://github.com/hyperledger/composer/pull/1849,https://github.com/hyperledger/composer/pull/1849,This is a more widely accepted naming standard as it avoids ambiguity and lack of clarity that can arise from using capitals -- try stringing several acronyms together and see how it reads in all-caps. I personally agree that it looks less intuitive for a single acronym. I'm OK to change it to maintain consistency with the established practice in our codebase though.,3b811cb418225cda0616f38ec00fb08fa694461c,2017-08-12 09:06:08,132814215,"@@ -0,0 +1,84 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const ModelUtils = require('../modelutil');
+
+/**
+ * All the identifying properties of a resource.
+ * @private
+ * @class
+ * @memberof module:composer-common
+ * @property {String} protocol
+ * @property {String} namespace
+ * @property {String} type
+ * @property {String} id
+ */
+class Identifier {
+    /**
+     * <strong>Note: only for use by internal framework code.</strong>
+     * @param {String} protocol - Protocol.
+     * @param {String} namespace - Namespace containing the type.
+     * @param {String} type - Short type name.
+     * @param {String} id - Instance identifier.
+     * @private
+     */
+    constructor(protocol, namespace, type, id) {
+        this.protocol = protocol;
+        this.namespace = namespace;
+        this.type = type;
+        this.id = id;
+    }
+
+    /**
+     * Parse a URI into an identifier.
+     * @param {String} uri - Resource URI.
+     * @param {String} [defaultNamespace] - Namespace to use if the URI does not specify one.
+     * @param {String} [defaultType] - Type to use if the URI does not specify one.
+     * @return {Identifier} - An identifier.
+     */
+    static fromUri(uri, defaultNamespace, defaultType) {",,2017-08-14 09:46:24,https://api.github.com/repos/hyperledger/composer/pulls/comments/132814215,https://github.com/hyperledger/composer/pull/1849#discussion_r132814215,bestbeforetoday
https://github.com/hyperledger/composer/pull/1848,https://github.com/hyperledger/composer/pull/1848,you could just have the idCardAdded here and emit false if it hasn't to indicate cancel rather than have 2 outputs,28606da9abfeb2aa3ffd7d48da13cd79d1a1d9a3,2017-08-11 15:12:08,132710449,"@@ -0,0 +1,70 @@
+import { Component, Input, Output, EventEmitter } from '@angular/core';
+import { AlertService } from '../../basic-modals/alert.service';
+import { IdentityCardService } from '../../services/identity-card.service';
+
+@Component({
+    selector: 'add-identity-card',
+    templateUrl: './add-identity-card.component.html',
+    styleUrls: ['./add-identity-card.component.scss'.toString()]
+})
+
+export class AddIdentityCardComponent {
+
+    @Input() connectionProfile: any;
+    @Output() idCardAdded = new EventEmitter<any>();
+    @Output() cancelAdd = new EventEmitter<any>();",,2017-08-18 08:49:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/132710449,https://github.com/hyperledger/composer/pull/1848#discussion_r132710449,cazfletch
https://github.com/hyperledger/composer/pull/1848,https://github.com/hyperledger/composer/pull/1848,don't think you need this here,28606da9abfeb2aa3ffd7d48da13cd79d1a1d9a3,2017-08-11 15:14:27,132710990,"@@ -2,6 +2,7 @@ import { NgModule }            from '@angular/core';
 import { RouterModule }        from '@angular/router';
 
 import { LoginComponent }    from './login.component';
+import { CreateIdentityCardComponent }    from './create-identity-card.component';",,2017-08-18 08:49:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/132710990,https://github.com/hyperledger/composer/pull/1848#discussion_r132710990,cazfletch
https://github.com/hyperledger/composer/pull/1848,https://github.com/hyperledger/composer/pull/1848,You don't really need 2 outputs here you can combine them into one,28606da9abfeb2aa3ffd7d48da13cd79d1a1d9a3,2017-08-11 15:18:06,132711888,"@@ -0,0 +1,70 @@
+import { Component, Input, Output, EventEmitter } from '@angular/core';
+import { AlertService } from '../../basic-modals/alert.service';
+import { IdentityCardService } from '../../services/identity-card.service';
+
+@Component({
+    selector: 'add-identity-card',
+    templateUrl: './add-identity-card.component.html',
+    styleUrls: ['./add-identity-card.component.scss'.toString()]
+})
+
+export class AddIdentityCardComponent {
+
+    @Input() connectionProfile: any;
+    @Output() idCardAdded = new EventEmitter<any>();
+    @Output() cancelAdd = new EventEmitter<any>();",,2017-08-18 08:49:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/132711888,https://github.com/hyperledger/composer/pull/1848#discussion_r132711888,cazfletch
https://github.com/hyperledger/composer/pull/1848,https://github.com/hyperledger/composer/pull/1848,why did you take this out?,28606da9abfeb2aa3ffd7d48da13cd79d1a1d9a3,2017-08-11 15:27:43,132714206,"@@ -323,92 +305,39 @@ describe(`LoginComponent`, () => {
         }));
     });
 
-    describe('editConnectionProfile', () => {",,2017-08-18 08:49:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/132714206,https://github.com/hyperledger/composer/pull/1848#discussion_r132714206,cazfletch
https://github.com/hyperledger/composer/pull/1848,https://github.com/hyperledger/composer/pull/1848,these function can stay we just need to not show the button,28606da9abfeb2aa3ffd7d48da13cd79d1a1d9a3,2017-08-11 15:29:00,132714558,"@@ -103,49 +100,19 @@ export class LoginComponent implements OnInit {
             });
     }
 
-    editConnectionProfile(connectionProfile): void {",,2017-08-18 08:49:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/132714558,https://github.com/hyperledger/composer/pull/1848#discussion_r132714558,cazfletch
https://github.com/hyperledger/composer/pull/1848,https://github.com/hyperledger/composer/pull/1848,It would be better to upper case this in the css since it's a visual thing,28606da9abfeb2aa3ffd7d48da13cd79d1a1d9a3,2017-08-15 10:54:57,133163421,"@@ -1,9 +1,9 @@
-<section class=""add-identity"">
+<section class=""add-identity-card"">
     <h1>Create ID Card</h1>
   <section class=""profiles"">
     <div class=""description""><b>PROVIDE SECURITY CREDENTIALS</b></div>",,2017-08-18 08:49:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/133163421,https://github.com/hyperledger/composer/pull/1848#discussion_r133163421,jt-nti
https://github.com/hyperledger/composer/pull/1848,https://github.com/hyperledger/composer/pull/1848,This seems to be a page/section for entering security credentials rather than adding an identity card. 'edit-security-credentials' might be better than 'add-identity-card'?,28606da9abfeb2aa3ffd7d48da13cd79d1a1d9a3,2017-08-15 10:57:54,133163840,"@@ -1,9 +1,9 @@
-<section class=""add-identity"">
+<section class=""add-identity-card"">",,2017-08-18 08:49:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/133163840,https://github.com/hyperledger/composer/pull/1848#discussion_r133163840,jt-nti
https://github.com/hyperledger/composer/pull/1848,https://github.com/hyperledger/composer/pull/1848,Uppercase via css,28606da9abfeb2aa3ffd7d48da13cd79d1a1d9a3,2017-08-15 12:17:11,133175537,"@@ -0,0 +1,54 @@
+<section class=""create-identity-card"">
+    <div *ngIf=""creatingWithProfile"">
+        <connection-profile (profileUpdated)=""finishedEditingConnectionProfile($event)""
+                            [connectionProfile]=""wrappedConnectionProfile""></connection-profile>
+    </div>
+    <div *ngIf=""editingIdCard"">
+        <add-identity-card (idCardAdded)=""completeCardAddition($event)""
+                      (cancelAdd) = ""cancelCreate()""
+                      [connectionProfile]=""wrappedConnectionProfile.profile""></add-identity-card>
+    </div>
+    <div *ngIf=""creatingIdCard"" class=""create-card"">
+        <h1>Create ID Card</h1>
+        <section class=""profiles"">
+            <div class=""description""><b>SELECT BLOCKCHAIN DEPLOYMENT</b></div>",,2017-08-18 08:49:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/133175537,https://github.com/hyperledger/composer/pull/1848#discussion_r133175537,jt-nti
https://github.com/hyperledger/composer/pull/1848,https://github.com/hyperledger/composer/pull/1848,Editing credentials?,28606da9abfeb2aa3ffd7d48da13cd79d1a1d9a3,2017-08-15 12:17:53,133175638,"@@ -0,0 +1,54 @@
+<section class=""create-identity-card"">
+    <div *ngIf=""creatingWithProfile"">
+        <connection-profile (profileUpdated)=""finishedEditingConnectionProfile($event)""
+                            [connectionProfile]=""wrappedConnectionProfile""></connection-profile>
+    </div>
+    <div *ngIf=""editingIdCard"">",,2017-08-18 08:49:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/133175638,https://github.com/hyperledger/composer/pull/1848#discussion_r133175638,jt-nti
https://github.com/hyperledger/composer/pull/1846,https://github.com/hyperledger/composer/pull/1846,can we have some hover help text for this pls?,8610d1dbc4554134593c120f70cc2f08903f541b,2017-08-11 15:26:23,132713892,"@@ -13,7 +13,7 @@ <h1 class=""left-align"">My Wallet</h1>
     <div class=""connection-profile"" *ngFor=""let connectionProfileRef of connectionProfileRefs;"">
         <h2>Identities for {{this.connectionProfileNames.get(connectionProfileRef) === '$default' ? 'Web Browser' : this.connectionProfileNames.get(connectionProfileRef) }}
             <div class=""connection-profile-buttons"">
-                <button id=""deployButton"" type=""button"" class=""action circular"">
+                <button id=""deployButton"" type=""button"" class=""action circular"" *ngIf=""canDeploy(connectionProfileRef)"" (click)=""deployNetwork(connectionProfileRef)"">",,2017-08-15 09:48:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/132713892,https://github.com/hyperledger/composer/pull/1846#discussion_r132713892,nklincoln
https://github.com/hyperledger/composer/pull/1846,https://github.com/hyperledger/composer/pull/1846,"it would be nice if we could do some basic validation of the name here, since we are restricted to lower case and no whitespace",8610d1dbc4554134593c120f70cc2f08903f541b,2017-08-11 15:33:24,132715655,"@@ -92,21 +88,19 @@ <h3 class=""sub-title"">Choose a Business Network Definition to {{deployNetwork ?
 </div>
 <div *ngIf=""!npmInProgress"" class=""chosen-network"">
     <div *ngIf=""!deployNetwork"" class=""replace-message"">
-        The files in the <b>{{clientService.getBusinessNetworkName()}}</b> will be replace with files from:",27,2017-08-15 09:48:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/132715655,https://github.com/hyperledger/composer/pull/1846#discussion_r132715655,nklincoln
https://github.com/hyperledger/composer/pull/1846,https://github.com/hyperledger/composer/pull/1846,done,8610d1dbc4554134593c120f70cc2f08903f541b,2017-08-15 09:48:58,133153883,"@@ -92,21 +88,19 @@ <h3 class=""sub-title"">Choose a Business Network Definition to {{deployNetwork ?
 </div>
 <div *ngIf=""!npmInProgress"" class=""chosen-network"">
     <div *ngIf=""!deployNetwork"" class=""replace-message"">
-        The files in the <b>{{clientService.getBusinessNetworkName()}}</b> will be replace with files from:",27,2017-08-15 09:48:58,https://api.github.com/repos/hyperledger/composer/pulls/comments/133153883,https://github.com/hyperledger/composer/pull/1846#discussion_r133153883,cazfletch
https://github.com/hyperledger/composer/pull/1828,https://github.com/hyperledger/composer/pull/1828,Can we remove the Wallet/My IDs section now?,1c1f5d69aaf37fd17cbdb64884345ec0f4fa48de,2017-08-10 11:35:18,132429760,"@@ -1,12 +1,7 @@
 <section class=""main-view"">
     <div class=""flex"">
         <div class=""flex-container"">
-            <h1 class=""flex"">My Wallet</h1>
-
-            <button type=""button"" class=""secondary"" (click)=""addId()"">
-                <span>+ Add to Wallet</span>
-            </button>
-
+            <h1 class=""flex"">My IDs for {{businessNetworkName}}</h1>",10,2017-08-10 12:48:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/132429760,https://github.com/hyperledger/composer/pull/1828#discussion_r132429760,jt-nti
https://github.com/hyperledger/composer/pull/1828,https://github.com/hyperledger/composer/pull/1828,Is this definitely going to get the right thing. Just something Ed reminded me about something Simon said about certificates and cnames that's making me wonder. Would this be necessary without the wallet section of the ID Registry page?,1c1f5d69aaf37fd17cbdb64884345ec0f4fa48de,2017-08-10 12:39:52,132441335,"@@ -232,23 +245,42 @@ export class IdentityCardService {
         } else {
             return prefix + '-' + connectionProfile.name;
         }
-    };
+    }
 
-    private dataRef(cardRef: string): string {
-        return cardRef + '-pd';
+    getCardRefFromIdentity(identityName: string, businessNetworkName: string, qualifiedConnectionProfile: string): string {",58,2017-08-10 12:48:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/132441335,https://github.com/hyperledger/composer/pull/1828#discussion_r132441335,jt-nti
https://github.com/hyperledger/composer/pull/1815,https://github.com/hyperledger/composer/pull/1815,Think this should say delete identities in your wallet rather than local identities,f012f153f4201f42c3ad81d8c947fb43e242c3a2,2017-08-09 14:23:38,132198353,"@@ -51,6 +51,15 @@ Due to many breaking API changes between {{site.data.conrefs.hlf_full}} v1.0 alp
 
 When deploying a business network to {{site.data.conrefs.hlf_full}} v1.0 using the Playground locally, you must follow the process above to connect using the peer admin identity. However, in order to create identities and interact with your business network in the Playground, you must use the certificate authority admin identity.
 
+### Errors deploying a business network to a local fabric using the {{site.data.conrefs.composer_full}} Playground
+
+When deploying a business network to an instance of {{site.data.conrefs.hlf_full}} by using a locally installed {{site.data.conrefs.composer_full}} Playground, you may encounter the following error:
+
+```
+Error: error trying to list instantiated chaincodes. Error: chaincode error (status 500, message: Authorization for GETCHAINCODES on channel getchaincodes has been denied with error Failed verifying that proposal's creator satisfies local MSP principal during channelless check policy with policy [Admins]:[This identity is not an admin])
+```
+
+Once this error has occurred, you must delete your local browser storage to restore normal function. *Please note*: Deleting local browser storage will delete your connection profile and local identities.",,2017-08-09 20:06:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/132198353,https://github.com/hyperledger/composer/pull/1815#discussion_r132198353,cazfletch
https://github.com/hyperledger/composer/pull/1815,https://github.com/hyperledger/composer/pull/1815,It's 'org-acme-biznet,f012f153f4201f42c3ad81d8c947fb43e242c3a2,2017-08-09 14:24:38,132198621,"@@ -0,0 +1,33 @@
+---
+layout: default
+title: Error using the local Playground
+category: tasks
+sidebar: sidebars/accordion-toc0.md
+excerpt:
+section: diagnostics
+index-order: 801
+---
+
+# Errors deploying a business network to a local fabric using the {{site.data.conrefs.composer_full}} Playground
+
+When deploying a business network to an instance of {{site.data.conrefs.hlf_full}} by using a locally installed {{site.data.conrefs.composer_full}} Playground, you may encounter the following error:
+
+```
+Error: error trying to list instantiated chaincodes. Error: chaincode error (status 500, message: Authorization for GETCHAINCODES on channel getchaincodes has been denied with error Failed verifying that proposal's creator satisfies local MSP principal during channelless check policy with policy [Admins]:[This identity is not an admin])
+```
+
+Once this error has occurred, you must delete your local browser storage to restore normal function. *Please note*: Deleting local browser storage will delete your connection profile and local identities.
+
+## What causes the error
+
+The error occurs if both the identity you are using to deploy the business network does not have network-level access control, and the connection profile is not associated with a business network with the name `org.acme.biznet`.",,2017-08-09 20:06:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/132198621,https://github.com/hyperledger/composer/pull/1815#discussion_r132198621,cazfletch
https://github.com/hyperledger/composer/pull/1815,https://github.com/hyperledger/composer/pull/1815,Is network level access the right term,f012f153f4201f42c3ad81d8c947fb43e242c3a2,2017-08-09 14:25:13,132198832,"@@ -0,0 +1,33 @@
+---
+layout: default
+title: Error using the local Playground
+category: tasks
+sidebar: sidebars/accordion-toc0.md
+excerpt:
+section: diagnostics
+index-order: 801
+---
+
+# Errors deploying a business network to a local fabric using the {{site.data.conrefs.composer_full}} Playground
+
+When deploying a business network to an instance of {{site.data.conrefs.hlf_full}} by using a locally installed {{site.data.conrefs.composer_full}} Playground, you may encounter the following error:
+
+```
+Error: error trying to list instantiated chaincodes. Error: chaincode error (status 500, message: Authorization for GETCHAINCODES on channel getchaincodes has been denied with error Failed verifying that proposal's creator satisfies local MSP principal during channelless check policy with policy [Admins]:[This identity is not an admin])
+```
+
+Once this error has occurred, you must delete your local browser storage to restore normal function. *Please note*: Deleting local browser storage will delete your connection profile and local identities.
+
+## What causes the error
+
+The error occurs if both the identity you are using to deploy the business network does not have network-level access control, and the connection profile is not associated with a business network with the name `org.acme.biznet`.",,2017-08-09 20:06:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/132198832,https://github.com/hyperledger/composer/pull/1815#discussion_r132198832,cazfletch
https://github.com/hyperledger/composer/pull/1815,https://github.com/hyperledger/composer/pull/1815,It's not that it doesn't have a business network associated with it it is that the fabric being used doesn't have a business network with that name,f012f153f4201f42c3ad81d8c947fb43e242c3a2,2017-08-09 14:26:27,132199220,"@@ -0,0 +1,33 @@
+---
+layout: default
+title: Error using the local Playground
+category: tasks
+sidebar: sidebars/accordion-toc0.md
+excerpt:
+section: diagnostics
+index-order: 801
+---
+
+# Errors deploying a business network to a local fabric using the {{site.data.conrefs.composer_full}} Playground
+
+When deploying a business network to an instance of {{site.data.conrefs.hlf_full}} by using a locally installed {{site.data.conrefs.composer_full}} Playground, you may encounter the following error:
+
+```
+Error: error trying to list instantiated chaincodes. Error: chaincode error (status 500, message: Authorization for GETCHAINCODES on channel getchaincodes has been denied with error Failed verifying that proposal's creator satisfies local MSP principal during channelless check policy with policy [Admins]:[This identity is not an admin])
+```
+
+Once this error has occurred, you must delete your local browser storage to restore normal function. *Please note*: Deleting local browser storage will delete your connection profile and local identities.
+
+## What causes the error
+
+The error occurs if both the identity you are using to deploy the business network does not have network-level access control, and the connection profile is not associated with a business network with the name `org.acme.biznet`.",,2017-08-09 20:06:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/132199220,https://github.com/hyperledger/composer/pull/1815#discussion_r132199220,cazfletch
https://github.com/hyperledger/composer/pull/1815,https://github.com/hyperledger/composer/pull/1815,A business network isn't associated with a connection profile. A business network is deployed to a fabric and the connection profile provides the connection details to be able to connect to it,f012f153f4201f42c3ad81d8c947fb43e242c3a2,2017-08-09 16:09:13,132230551,"@@ -0,0 +1,31 @@
+---
+layout: default
+title: Error using the local Playground
+category: tasks
+sidebar: sidebars/accordion-toc0.md
+excerpt:
+section: diagnostics
+index-order: 801
+---
+
+# Errors deploying a business network to a local fabric using the {{site.data.conrefs.composer_full}} Playground
+
+When deploying a business network to an instance of {{site.data.conrefs.hlf_full}} by using a locally installed {{site.data.conrefs.composer_full}} Playground, you may encounter the following error:
+
+```
+Error: error trying to list instantiated chaincodes. Error: chaincode error (status 500, message: Authorization for GETCHAINCODES on channel getchaincodes has been denied with error Failed verifying that proposal's creator satisfies local MSP principal during channelless check policy with policy [Admins]:[This identity is not an admin])
+```
+
+Once this error has occurred, you must delete your local browser storage to restore normal function. *Please note*: Deleting local browser storage will delete your connection profile and identities in your wallet.
+
+## What causes the error
+
+The error occurs if both the identity you are using to deploy the business network does not have network-level access control, and the connection profile is not associated with a business network with the name `org-acme-biznet`.",,2017-08-09 20:06:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/132230551,https://github.com/hyperledger/composer/pull/1815#discussion_r132230551,cazfletch
https://github.com/hyperledger/composer/pull/1815,https://github.com/hyperledger/composer/pull/1815,"You've written ""that wish to obtain these will must...""",f012f153f4201f42c3ad81d8c947fb43e242c3a2,2017-08-09 17:33:16,132252511,"@@ -38,47 +37,44 @@ asset HistorianRecord identified by transactionId {
  * `Event[] eventsEmitted` The events that where emitted by this transactionId
  * `DateTime transactionTimestamp` Use the transaction's timestamp
 
-Important points to note are tha the Transaction, Participant and Identity are relationships. Applications that wish to obtain these will then need to resolve this relationship themself. At this point ACLs might prevent you from accessing these. 
+It's important to note that the Transaction, Participant and Identity are relationships. Applications that wish to obtain these will must resolve this relationship.",,2017-08-09 20:06:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/132252511,https://github.com/hyperledger/composer/pull/1815#discussion_r132252511,cazfletch
https://github.com/hyperledger/composer/pull/1815,https://github.com/hyperledger/composer/pull/1815,"This edit is in progress, I pushed what I had as I left the office just in case. ^^",f012f153f4201f42c3ad81d8c947fb43e242c3a2,2017-08-09 19:35:14,132284065,"@@ -38,47 +37,44 @@ asset HistorianRecord identified by transactionId {
  * `Event[] eventsEmitted` The events that where emitted by this transactionId
  * `DateTime transactionTimestamp` Use the transaction's timestamp
 
-Important points to note are tha the Transaction, Participant and Identity are relationships. Applications that wish to obtain these will then need to resolve this relationship themself. At this point ACLs might prevent you from accessing these. 
+It's important to note that the Transaction, Participant and Identity are relationships. Applications that wish to obtain these will must resolve this relationship.",,2017-08-09 20:06:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/132284065,https://github.com/hyperledger/composer/pull/1815#discussion_r132284065,EdProsser
https://github.com/hyperledger/composer/pull/1815,https://github.com/hyperledger/composer/pull/1815,in progress????,f012f153f4201f42c3ad81d8c947fb43e242c3a2,2017-08-09 19:36:56,132284414,"@@ -38,47 +37,44 @@ asset HistorianRecord identified by transactionId {
  * `Event[] eventsEmitted` The events that where emitted by this transactionId
  * `DateTime transactionTimestamp` Use the transaction's timestamp
 
-Important points to note are tha the Transaction, Participant and Identity are relationships. Applications that wish to obtain these will then need to resolve this relationship themself. At this point ACLs might prevent you from accessing these. 
+It's important to note that the Transaction, Participant and Identity are relationships. Applications that wish to obtain these will must resolve this relationship.",,2017-08-09 20:06:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/132284414,https://github.com/hyperledger/composer/pull/1815#discussion_r132284414,cazfletch
https://github.com/hyperledger/composer/pull/1815,https://github.com/hyperledger/composer/pull/1815,"Yes, I'm doing it as we speak.",f012f153f4201f42c3ad81d8c947fb43e242c3a2,2017-08-09 19:52:03,132288286,"@@ -38,47 +37,44 @@ asset HistorianRecord identified by transactionId {
  * `Event[] eventsEmitted` The events that where emitted by this transactionId
  * `DateTime transactionTimestamp` Use the transaction's timestamp
 
-Important points to note are tha the Transaction, Participant and Identity are relationships. Applications that wish to obtain these will then need to resolve this relationship themself. At this point ACLs might prevent you from accessing these. 
+It's important to note that the Transaction, Participant and Identity are relationships. Applications that wish to obtain these will must resolve this relationship.",,2017-08-09 20:06:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/132288286,https://github.com/hyperledger/composer/pull/1815#discussion_r132288286,EdProsser
https://github.com/hyperledger/composer/pull/1807,https://github.com/hyperledger/composer/pull/1807,... if requestIdentity fails,cb132515caa76e782656218226579cd7cd72a423,2017-08-09 09:25:03,132132583,"@@ -0,0 +1,115 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const Client = require('composer-admin');
+
+const Request = require('../../lib/cmds/identity/requestCommand.js');
+const CmdUtil = require('../../lib/cmds/utils/cmdutils.js');
+const fs = require('fs');
+const os = require('os');
+const mkdirp = require('mkdirp');
+
+const sinon = require('sinon');
+const chai = require('chai');
+chai.should();
+chai.use(require('chai-as-promised'));
+
+const PROFILE_NAME = 'myprofile';
+const USER_ID = 'SuccessKid';
+const USER_SECRET = 'SomeSecret';
+
+describe('composer identity request CLI unit tests', () => {
+
+    let sandbox;
+    let mockAdminConnection;
+
+    beforeEach(() => {
+        sandbox = sinon.sandbox.create();
+        mockAdminConnection = sinon.createStubInstance(Client.AdminConnection);
+        sandbox.stub(CmdUtil, 'createAdminConnection').returns(mockAdminConnection);
+        sandbox.stub(process, 'exit');
+        sandbox.stub(mkdirp, 'sync').returns();
+    });
+
+    afterEach(() => {
+        sandbox.restore();
+    });
+
+    it('should request an identity using the specified profile and store in specified path', () => {
+        let argv = {
+            connectionProfileName: PROFILE_NAME,
+            enrollId: USER_ID,
+            enrollSecret: USER_SECRET,
+            path: '/'
+        };
+        let fsStub = sandbox.stub(fs, 'writeFileSync');
+        mockAdminConnection.requestIdentity.withArgs(PROFILE_NAME, USER_ID, USER_SECRET).resolves({
+            certificate: 'a',
+            key: 'b',
+            rootCertificate: 'c',
+            caName: 'caName'
+        });
+        return Request.handler(argv)
+            .then(() => {
+                argv.thePromise.should.be.a('promise');
+                sinon.assert.calledOnce(mockAdminConnection.requestIdentity);
+                sinon.assert.calledWith(mockAdminConnection.requestIdentity, PROFILE_NAME, USER_ID, USER_SECRET);
+                sinon.assert.calledThrice(fsStub);
+                sinon.assert.calledWith(fsStub, '/SuccessKid-pub.pem', 'a');
+                sinon.assert.calledWith(fsStub, '/SuccessKid-priv.pem', 'b');
+                sinon.assert.calledWith(fsStub, '/caName-root.pem', 'c');
+            });
+    });
+
+    it('should request an identity using the specified profile', () => {
+        let argv = {
+            connectionProfileName: PROFILE_NAME,
+            enrollId: USER_ID,
+            enrollSecret: USER_SECRET
+        };
+        let fsStub = sandbox.stub(fs, 'writeFileSync');
+        sandbox.stub(os, 'homedir').returns('/x');
+        mockAdminConnection.requestIdentity.withArgs(PROFILE_NAME, USER_ID, USER_SECRET).resolves({
+            certificate: 'a',
+            key: 'b',
+            rootCertificate: 'c',
+            caName: 'caName'
+        });
+        return Request.handler(argv)
+            .then(() => {
+                argv.thePromise.should.be.a('promise');
+                sinon.assert.calledOnce(mockAdminConnection.requestIdentity);
+                sinon.assert.calledWith(mockAdminConnection.requestIdentity, PROFILE_NAME, USER_ID, USER_SECRET);
+                sinon.assert.calledThrice(fsStub);
+                sinon.assert.calledWith(fsStub, '/x/.identityCredentials/SuccessKid-pub.pem', 'a');
+                sinon.assert.calledWith(fsStub, '/x/.identityCredentials/SuccessKid-priv.pem', 'b');
+                sinon.assert.calledWith(fsStub, '/x/.identityCredentials/caName-root.pem', 'c');
+            });
+    });
+
+
+    it('should fail gracefully if importIdentity fails', () => {",,2017-08-09 09:34:45,https://api.github.com/repos/hyperledger/composer/pulls/comments/132132583,https://github.com/hyperledger/composer/pull/1807#discussion_r132132583,nklincoln
https://github.com/hyperledger/composer/pull/1807,https://github.com/hyperledger/composer/pull/1807,is this needed?,cb132515caa76e782656218226579cd7cd72a423,2017-08-09 09:30:17,132133696,"@@ -1056,4 +1056,116 @@ describe('HLFConnectionManager', () => {
 
     });
 
+    describe('#requestIdentity', () => {
+        let profile, mockCAClient, mockCryptoSuite;
+        beforeEach(() => {
+            mockCryptoSuite = sinon.createStubInstance(CryptoSuite);
+            sandbox.stub(Client, 'newCryptoSuite').returns(mockCryptoSuite);
+            mockCAClient = sinon.createStubInstance(FabricCAClientImpl);
+            mockCAClient.enroll.resolves({
+                certificate: 'a',
+                key: {toBytes: function() {return 'c';}},
+                rootCertificate: 'b'
+            });
+            sandbox.stub(HLFConnectionManager, 'createCAClient').withArgs(sinon.match.string).returns(mockCAClient);
+
+            profile = {
+                orderers: [
+                    'grpc://localhost:7050'
+                ],
+                peers: [
+                    {
+                        requestURL: 'grpc://localhost:7051',
+                        eventURL: 'grpc://localhost:7053'
+                    }
+                ],
+                ca: 'http://localhost:7054',
+                keyValStore: '/tmp/hlfabric1',
+                channel: 'testchainid',
+                timeout: 123,
+                mspID: 'MSP1Org'
+            };
+        });
+
+        it('should successfully request an identity', () => {
+            return connectionManager.requestIdentity('connprof1', profile, 'id', 'secret')
+                .then((result) => {
+                    result.should.deep.equal({certificate: 'a', key: 'c', rootCertificate: 'b', caName: 'default'});
+                    sinon.assert.calledOnce(Client.newCryptoSuite);
+                    sinon.assert.calledOnce(mockCAClient.enroll);
+                    sinon.assert.calledWith(mockCAClient.enroll,{ enrollmentID: 'id', enrollmentSecret: 'secret' });
+                });
+        });
+
+        it('should successfully request an identity with a named ca server', () => {
+            profile.ca = {'url': 'http://localhost:7054', 'name': 'aName'};
+            return connectionManager.requestIdentity('connprof1', profile, 'id', 'secret')
+                .then((result) => {
+                    result.should.deep.equal({certificate: 'a', key: 'c', rootCertificate: 'b', caName: 'aName'});
+                    sinon.assert.calledOnce(Client.newCryptoSuite);
+                    sinon.assert.calledOnce(mockCAClient.enroll);
+                    sinon.assert.calledWith(mockCAClient.enroll,{ enrollmentID: 'id', enrollmentSecret: 'secret' });
+                });
+        });
+
+
+        it('should throw if connectionProfile not specified', () => {
+            (() => {
+                connectionManager.requestIdentity();
+            }).should.throw(/connectionProfile not specified or not a string/);
+        });
+
+        it('should throw if connectionProfile not a string', () => {
+            (() => {
+                connectionManager.requestIdentity([]);
+            }).should.throw(/connectionProfile not specified or not a string/);
+        });
+
+        it('should throw if connectionOptions not specified', () => {
+            (() => {
+                connectionManager.requestIdentity('connprof1');
+            }).should.throw(/connectionOptions not specified or not an object/);
+        });
+
+        it('should throw if connectionOptions not an object', () => {
+            (() => {
+                connectionManager.requestIdentity('connprof1', 'hlfabric1');
+            }).should.throw(/connectionOptions not specified or not an object/);
+        });
+
+        it('should throw if enrollmentid not specified', () => {
+            (() => {
+                connectionManager.requestIdentity('connprof1', profile);
+            }).should.throw(/enrollmentID not specified/);
+        });
+
+        it('should throw if enrollmentid not specified', () => {
+            (() => {
+                connectionManager.requestIdentity('connprof1', profile, 'id');
+            }).should.throw(/enrollmentSecret not specified/);
+        });
+
+        it('should throw if ca is not specified', () => {
+            delete profile.ca;
+            (() => {
+                connectionManager.requestIdentity('connprof1', profile, 'id', 'secret');
+            }).should.throw(/No ca defined/);
+        });
+
+        it('should handle an error on enroll', () => {
+            mockCAClient.enroll.rejects('Error','wow such fail');
+            return connectionManager.requestIdentity('connprof1', profile, 'id', 'secret')
+                .should.be.rejectedWith(/wow such fail/);
+        });
+
+        /*
+        it('should handle an error creating a new cryptosuite', () => {",,2017-08-09 09:34:45,https://api.github.com/repos/hyperledger/composer/pulls/comments/132133696,https://github.com/hyperledger/composer/pull/1807#discussion_r132133696,nklincoln
https://github.com/hyperledger/composer/pull/1753,https://github.com/hyperledger/composer/pull/1753,Would recommend putting sudo apt-add-repository ppa:git-core/ppa before the apt-get update above (line 35) so only need to call apt-get update once. Also add a -y to the apt-add-repository command because I have seen it prompt you to ask if you want to do this.,38361a79a4ad662e063acac741f635f894a0a436,2017-08-11 10:36:05,132658309,"@@ -35,8 +35,10 @@ echo ""# Updating package lists""
 sudo apt-get update
 
 # Install Git
-echo ""# Installing GitHub""
-sudo apt-get -y install git
+echo ""# Installing Git""",10,2017-08-12 12:12:23,https://api.github.com/repos/hyperledger/composer/pulls/comments/132658309,https://github.com/hyperledger/composer/pull/1753#discussion_r132658309,davidkel
https://github.com/hyperledger/composer/pull/1753,https://github.com/hyperledger/composer/pull/1753,Shifted sudo apt-add-repository ppa:git-core/ppa above sudo apt-get update and added -y for no prompt ,38361a79a4ad662e063acac741f635f894a0a436,2017-08-12 07:31:34,132811793,"@@ -32,12 +32,11 @@ fi
 
 # Update package lists
 echo ""# Updating package lists""
+sudo apt-add-repository -y ppa:git-core/ppa",4,2017-08-12 12:12:23,https://api.github.com/repos/hyperledger/composer/pulls/comments/132811793,https://github.com/hyperledger/composer/pull/1753#discussion_r132811793,aviralwal
https://github.com/hyperledger/composer/pull/1728,https://github.com/hyperledger/composer/pull/1728,Should it be Version 0.10.2 ?,18867fdbf49199ff5db222bb31d6f2a22edcfba4,2017-08-02 11:23:22,130849244,"@@ -12,6 +12,9 @@
 # Note that the latest public API is documented using JSDocs and is available in api.txt.
 #
 
+Version 0.9.4 {f73a45b584fadd644734a91fe4cbbadc} 2017-07-31",,2017-08-02 16:21:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/130849244,https://github.com/hyperledger/composer/pull/1728#discussion_r130849244,davidkel
https://github.com/hyperledger/composer/pull/1728,https://github.com/hyperledger/composer/pull/1728,To be removed ? Or something to come in the future ? If so a comment would help here.,18867fdbf49199ff5db222bb31d6f2a22edcfba4,2017-08-02 11:26:11,130849728,"@@ -173,10 +176,13 @@ class Registry {
         if (!resources) {
             throw new Error('resources not specified');
         }
-        let serializedResources = resources.map((resource) => {
-            return this.serializer.toJSON(resource);
-        });
-        return Util.invokeChainCode(this.securityContext, 'addAllResourcesToRegistry', [this.registryType, this.id, JSON.stringify(serializedResources)]);
+        let txName = 'Add'+this.registryType;
+        const transaction = this.factory.newTransaction('org.hyperledger.composer.system',txName);
+        // transaction.targetRegistry = this.factory.newRelationship(ModelUtil.getNamespace(this.id),this.registryType, this.id);",,2017-08-02 16:21:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/130849728,https://github.com/hyperledger/composer/pull/1728#discussion_r130849728,davidkel
https://github.com/hyperledger/composer/pull/1728,https://github.com/hyperledger/composer/pull/1728,Code to keep for later or to remove ?,18867fdbf49199ff5db222bb31d6f2a22edcfba4,2017-08-02 11:27:49,130850006,"@@ -207,10 +212,17 @@ class Registry {
         if (!resources) {
             throw new Error('resources not specified');
         }
-        let serializedResources = resources.map((resource) => {
-            return this.serializer.toJSON(resource);
-        });
-        return Util.invokeChainCode(this.securityContext, 'updateAllResourcesInRegistry', [this.registryType, this.id, JSON.stringify(serializedResources)]);
+        let txName = 'Update'+this.registryType;
+        const transaction = this.factory.newTransaction('org.hyperledger.composer.system',txName);
+        // transaction.targetRegistry = this.factory.newRelationship('org.hyperledger.composer.system',TYPE_MAP[this.registryType], this.id);
+        transaction.resources = resources;
+        transaction.registryType = this.registryType;
+        transaction.registryId = this.id;
+        return this.bnc.submitTransaction(transaction);
+        // let serializedResources = resources.map((resource) => {",,2017-08-02 16:21:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/130850006,https://github.com/hyperledger/composer/pull/1728#discussion_r130850006,davidkel
https://github.com/hyperledger/composer/pull/1728,https://github.com/hyperledger/composer/pull/1728,change this to ?,18867fdbf49199ff5db222bb31d6f2a22edcfba4,2017-08-02 11:28:20,130850100,"@@ -235,20 +246,29 @@ class Registry {
      * @param {(Resource[]|string[])} resources The resources, or the unique identifiers of the resources.
      * @return {Promise} A promise that will be resolved when the resource is
      * added to the registry.
+     * TODO: need to change this",,2017-08-02 16:21:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/130850100,https://github.com/hyperledger/composer/pull/1728#discussion_r130850100,davidkel
https://github.com/hyperledger/composer/pull/1728,https://github.com/hyperledger/composer/pull/1728,Reason to keep or remove ?,18867fdbf49199ff5db222bb31d6f2a22edcfba4,2017-08-02 11:28:42,130850174,"@@ -235,20 +246,29 @@ class Registry {
      * @param {(Resource[]|string[])} resources The resources, or the unique identifiers of the resources.
      * @return {Promise} A promise that will be resolved when the resource is
      * added to the registry.
+     * TODO: need to change this
      */
     removeAll(resources) {
         Util.securityCheck(this.securityContext);
         if (!resources) {
             throw new Error('resources not specified');
         }
-        let data = resources.map((resource) => {
+        let txName = 'Remove'+this.registryType;
+        const transaction = this.factory.newTransaction('org.hyperledger.composer.system',txName);
+        // transaction.targetRegistry = this.factory.newRelationship('org.hyperledger.composer.system',TYPE_MAP[this.registryType], this.id);",,2017-08-02 16:21:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/130850174,https://github.com/hyperledger/composer/pull/1728#discussion_r130850174,davidkel
https://github.com/hyperledger/composer/pull/1728,https://github.com/hyperledger/composer/pull/1728,remove ?,18867fdbf49199ff5db222bb31d6f2a22edcfba4,2017-08-02 11:28:57,130850213,"@@ -235,20 +246,29 @@ class Registry {
      * @param {(Resource[]|string[])} resources The resources, or the unique identifiers of the resources.
      * @return {Promise} A promise that will be resolved when the resource is
      * added to the registry.
+     * TODO: need to change this
      */
     removeAll(resources) {
         Util.securityCheck(this.securityContext);
         if (!resources) {
             throw new Error('resources not specified');
         }
-        let data = resources.map((resource) => {
+        let txName = 'Remove'+this.registryType;
+        const transaction = this.factory.newTransaction('org.hyperledger.composer.system',txName);
+        // transaction.targetRegistry = this.factory.newRelationship('org.hyperledger.composer.system',TYPE_MAP[this.registryType], this.id);
+        transaction.resources = [];
+        transaction.registryType = this.registryType;
+        transaction.registryId = this.id;
+
+        transaction.resourceIds = resources.map((resource) => {
             if (resource instanceof Resource) {
                 return resource.getIdentifier();
             } else {
                 return resource;
             }
         });
-        return Util.invokeChainCode(this.securityContext, 'removeAllResourcesFromRegistry', [this.registryType, this.id, JSON.stringify(data)]);
+        return this.bnc.submitTransaction(transaction);
+        // return Util.invokeChainCode(this.securityContext, 'removeAllResourcesFromRegistry', [this.registryType, this.id, JSON.stringify(data)]);",,2017-08-02 16:21:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/130850213,https://github.com/hyperledger/composer/pull/1728#discussion_r130850213,davidkel
https://github.com/hyperledger/composer/pull/1728,https://github.com/hyperledger/composer/pull/1728,spelling....,18867fdbf49199ff5db222bb31d6f2a22edcfba4,2017-08-02 11:30:04,130850403,"@@ -20,6 +20,8 @@ const Registry = require('../lib/registry');
 const Resource = require('composer-common').Resource;
 const SecurityContext = require('composer-common').SecurityContext;
 const Serializer = require('composer-common').Serializer;
+const TransactionDeclartion = require('composer-common').TransactionDeclaration;",,2017-08-02 16:21:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/130850403,https://github.com/hyperledger/composer/pull/1728#discussion_r130850403,davidkel
https://github.com/hyperledger/composer/pull/1728,https://github.com/hyperledger/composer/pull/1728,remove ?,18867fdbf49199ff5db222bb31d6f2a22edcfba4,2017-08-02 11:32:00,130850730,"@@ -77,7 +77,7 @@ class RelationshipDeclaration extends Property {
                 throw new IllegalModelException('Relationship ' + this.getName() + ' points to a missing type ' + this.getFullyQualifiedTypeName(), classDecl.getModelFile(), this.ast.location);
             }
 
-            if ((namespace === ModelUtil.getSystemNamespace()) && classDecl.isEvent()) {
+            if ( namespace === ModelUtil.getSystemNamespace() ) /*&& classDecl.isEvent())*/ {",,2017-08-02 16:21:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/130850730,https://github.com/hyperledger/composer/pull/1728#discussion_r130850730,davidkel
https://github.com/hyperledger/composer/pull/1728,https://github.com/hyperledger/composer/pull/1728,Do we really want this console.log ?,18867fdbf49199ff5db222bb31d6f2a22edcfba4,2017-08-02 11:34:33,130851143,"@@ -224,6 +224,9 @@ class WebConnection extends Connection {
         return businessNetwork.toArchive()
             .then((businessNetworkArchive) => {
                 const initArgs = {};
+
+                console.log('***********************************************************************');",,2017-08-02 16:21:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/130851143,https://github.com/hyperledger/composer/pull/1728#discussion_r130851143,davidkel
https://github.com/hyperledger/composer/pull/1728,https://github.com/hyperledger/composer/pull/1728,Shouldn't it be ResourceManager and The resource manager ?,18867fdbf49199ff5db222bb31d6f2a22edcfba4,2017-08-02 11:36:46,130851570,"@@ -758,6 +759,17 @@ class Context {
         return this.identityManager;
     }
 
+        /**
+     * Get the resource manager.
+     * @return {IdentityManager} The identity manager.",,2017-08-02 16:21:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/130851570,https://github.com/hyperledger/composer/pull/1728#discussion_r130851570,davidkel
https://github.com/hyperledger/composer/pull/1728,https://github.com/hyperledger/composer/pull/1728,I can see you!!!!,18867fdbf49199ff5db222bb31d6f2a22edcfba4,2017-08-02 11:42:53,130852602,"@@ -250,6 +254,7 @@ class Engine {
                     });
             })
             .then(() => {
+                LOG.error(method,'can you see me?');",,2017-08-02 16:21:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/130852602,https://github.com/hyperledger/composer/pull/1728#discussion_r130852602,davidkel
https://github.com/hyperledger/composer/pull/1728,https://github.com/hyperledger/composer/pull/1728,"newline, to be consistent with the other array entries ?",18867fdbf49199ff5db222bb31d6f2a22edcfba4,2017-08-02 11:49:06,130853752,"@@ -21,17 +21,20 @@ const ParticipantDeclaration = require('composer-common').ParticipantDeclaration
 const Registry = require('./registry');
 
 const LOG = Logger.getLog('RegistryManager');
+
+// TODO: Address the use of these two arrays - indicative of something not correct.
 const TYPE_MAP = {
     'Asset': 'AssetRegistry',
     'Participant': 'ParticipantRegistry',
     'Transaction': 'TransactionRegistry',
-    'Network': 'Network'
+    'Network': 'Network',
+    'Historian':'HistorianRegistry'
 };
 const VIRTUAL_TYPES = [
     'AssetRegistry',
     'ParticipantRegistry',
     'TransactionRegistry',
-    'Network'
+    'Network','HistorianRegistry'",,2017-08-02 16:21:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/130853752,https://github.com/hyperledger/composer/pull/1728#discussion_r130853752,davidkel
https://github.com/hyperledger/composer/pull/1728,https://github.com/hyperledger/composer/pull/1728,keep or remove ?,18867fdbf49199ff5db222bb31d6f2a22edcfba4,2017-08-02 11:53:05,130854461,"@@ -349,6 +349,7 @@ class Resolver {
             // Special case for this one!
             registryId = 'default';
         } else {
+            //LOG.debug(method, 'Unsupported class declaration type ' + classDeclaration.toString());",,2017-08-02 16:21:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/130854461,https://github.com/hyperledger/composer/pull/1728#discussion_r130854461,davidkel
https://github.com/hyperledger/composer/pull/1728,https://github.com/hyperledger/composer/pull/1728,removed,18867fdbf49199ff5db222bb31d6f2a22edcfba4,2017-08-02 15:15:20,130906584,"@@ -235,20 +246,29 @@ class Registry {
      * @param {(Resource[]|string[])} resources The resources, or the unique identifiers of the resources.
      * @return {Promise} A promise that will be resolved when the resource is
      * added to the registry.
+     * TODO: need to change this",,2017-08-02 16:21:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/130906584,https://github.com/hyperledger/composer/pull/1728#discussion_r130906584,mbwhite
https://github.com/hyperledger/composer/pull/1728,https://github.com/hyperledger/composer/pull/1728,removed,18867fdbf49199ff5db222bb31d6f2a22edcfba4,2017-08-02 15:15:29,130906624,"@@ -207,10 +212,17 @@ class Registry {
         if (!resources) {
             throw new Error('resources not specified');
         }
-        let serializedResources = resources.map((resource) => {
-            return this.serializer.toJSON(resource);
-        });
-        return Util.invokeChainCode(this.securityContext, 'updateAllResourcesInRegistry', [this.registryType, this.id, JSON.stringify(serializedResources)]);
+        let txName = 'Update'+this.registryType;
+        const transaction = this.factory.newTransaction('org.hyperledger.composer.system',txName);
+        // transaction.targetRegistry = this.factory.newRelationship('org.hyperledger.composer.system',TYPE_MAP[this.registryType], this.id);
+        transaction.resources = resources;
+        transaction.registryType = this.registryType;
+        transaction.registryId = this.id;
+        return this.bnc.submitTransaction(transaction);
+        // let serializedResources = resources.map((resource) => {",,2017-08-02 16:21:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/130906624,https://github.com/hyperledger/composer/pull/1728#discussion_r130906624,mbwhite
https://github.com/hyperledger/composer/pull/1728,https://github.com/hyperledger/composer/pull/1728,Comment added,18867fdbf49199ff5db222bb31d6f2a22edcfba4,2017-08-02 15:15:35,130906648,"@@ -173,10 +176,13 @@ class Registry {
         if (!resources) {
             throw new Error('resources not specified');
         }
-        let serializedResources = resources.map((resource) => {
-            return this.serializer.toJSON(resource);
-        });
-        return Util.invokeChainCode(this.securityContext, 'addAllResourcesToRegistry', [this.registryType, this.id, JSON.stringify(serializedResources)]);
+        let txName = 'Add'+this.registryType;
+        const transaction = this.factory.newTransaction('org.hyperledger.composer.system',txName);
+        // transaction.targetRegistry = this.factory.newRelationship(ModelUtil.getNamespace(this.id),this.registryType, this.id);",,2017-08-02 16:21:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/130906648,https://github.com/hyperledger/composer/pull/1728#discussion_r130906648,mbwhite
https://github.com/hyperledger/composer/pull/1728,https://github.com/hyperledger/composer/pull/1728,"removed
",18867fdbf49199ff5db222bb31d6f2a22edcfba4,2017-08-02 15:15:47,130906692,"@@ -235,20 +246,29 @@ class Registry {
      * @param {(Resource[]|string[])} resources The resources, or the unique identifiers of the resources.
      * @return {Promise} A promise that will be resolved when the resource is
      * added to the registry.
+     * TODO: need to change this
      */
     removeAll(resources) {
         Util.securityCheck(this.securityContext);
         if (!resources) {
             throw new Error('resources not specified');
         }
-        let data = resources.map((resource) => {
+        let txName = 'Remove'+this.registryType;
+        const transaction = this.factory.newTransaction('org.hyperledger.composer.system',txName);
+        // transaction.targetRegistry = this.factory.newRelationship('org.hyperledger.composer.system',TYPE_MAP[this.registryType], this.id);",,2017-08-02 16:21:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/130906692,https://github.com/hyperledger/composer/pull/1728#discussion_r130906692,mbwhite
https://github.com/hyperledger/composer/pull/1728,https://github.com/hyperledger/composer/pull/1728,"eeek!  removed
",18867fdbf49199ff5db222bb31d6f2a22edcfba4,2017-08-02 15:18:15,130907416,"@@ -224,6 +224,9 @@ class WebConnection extends Connection {
         return businessNetwork.toArchive()
             .then((businessNetworkArchive) => {
                 const initArgs = {};
+
+                console.log('***********************************************************************');",,2017-08-02 16:21:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/130907416,https://github.com/hyperledger/composer/pull/1728#discussion_r130907416,mbwhite
https://github.com/hyperledger/composer/pull/1728,https://github.com/hyperledger/composer/pull/1728,not anymore!,18867fdbf49199ff5db222bb31d6f2a22edcfba4,2017-08-02 15:20:17,130908004,"@@ -250,6 +254,7 @@ class Engine {
                     });
             })
             .then(() => {
+                LOG.error(method,'can you see me?');",,2017-08-02 16:21:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/130908004,https://github.com/hyperledger/composer/pull/1728#discussion_r130908004,mbwhite
https://github.com/hyperledger/composer/pull/1711,https://github.com/hyperledger/composer/pull/1711,Can the 32px be a variable please,4199e71ab6814cb7636a8e0842e5077d04767a04,2017-07-31 12:01:36,130334433,"@@ -2,9 +2,13 @@
 @import '../../assets/styles/base/_variables.scss';
 
 app-footer {
-    position: relative;
-    display: flex;
+    position: absolute;
+    display: block;
     width: 100%;
+    bottom: 0px;
+    left: 0px;
+    right: 0px;
+    padding: 0px 32px;",,2017-08-04 09:22:10,https://api.github.com/repos/hyperledger/composer/pulls/comments/130334433,https://github.com/hyperledger/composer/pull/1711#discussion_r130334433,cazfletch
https://github.com/hyperledger/composer/pull/1711,https://github.com/hyperledger/composer/pull/1711,Can these be variables too please,4199e71ab6814cb7636a8e0842e5077d04767a04,2017-07-31 12:02:37,130334601,"@@ -40,6 +41,12 @@
   .main-view {
     background-color: $fourth-highlight;
     width: 100%;
-    padding: $space-large $space-large 0 $space-large;
+    position: relative;
+    padding: 0 0 $space-xlarge 0;
+    .main-view-content {
+      height: 100%;
+      padding: 32px 32px 0px 32px;",,2017-08-04 09:22:10,https://api.github.com/repos/hyperledger/composer/pulls/comments/130334601,https://github.com/hyperledger/composer/pull/1711#discussion_r130334601,cazfletch
https://github.com/hyperledger/composer/pull/1709,https://github.com/hyperledger/composer/pull/1709,"We should really be checking against the actual radio label name too, just in case the ordering gets changed at a future date",0c66b8109c6475d0c09d243cbedba544a068cc12,2017-07-31 10:22:21,130318343,"@@ -591,6 +689,26 @@ describe('Editor Define', (() => {
         });
     }));
 
+    it('should prevent the addition of a query file and/or acl file if one exists already', (() => {
+        AddFile.clickCancelAdd();
+        OperationsHelper.importBusinessNetworkArchive('./e2e/data/bna/importBNA.bna');
+
+        Editor.clickAddFile();
+        AddFile.waitToAppear();
+
+        AddFile.retrieveAddFileRadioButtons()
+        .then((radioList: any) => {
+            expect(radioList).to.be.an('array').lengthOf(4);
+            expect(radioList[0]).to.deep.equal({enabled: true});",,2017-07-31 14:23:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/130318343,https://github.com/hyperledger/composer/pull/1709#discussion_r130318343,nklincoln
https://github.com/hyperledger/composer/pull/1709,https://github.com/hyperledger/composer/pull/1709,It would appear that we are now using this replace modal in different places for different things - we should probably start making these inputs to modal to make it easier to use and more flexible,0c66b8109c6475d0c09d243cbedba544a068cc12,2017-07-31 10:23:42,130318554,"@@ -3,7 +3,7 @@
     <svg class=""ibm-icon"" aria-hidden=""true"">
       <use xlink:href=""#icon-warn_32""></use>
     </svg>
-    <h1>Current definition will be replaced</h1>",4,2017-07-31 14:23:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/130318554,https://github.com/hyperledger/composer/pull/1709#discussion_r130318554,nklincoln
https://github.com/hyperledger/composer/pull/1709,https://github.com/hyperledger/composer/pull/1709,same as above -maybe this should be an input to the modal?,0c66b8109c6475d0c09d243cbedba544a068cc12,2017-07-31 10:24:04,130318630,"@@ -18,6 +18,6 @@
   </section>
   <footer>
     <button id=""replace_cancel"" type=""button"" class=""secondary"" (click)=""activeModal.dismiss()"">Cancel</button>
-    <button id=""replace_confirm"" type=""button"" class=""primary"" (click)=""activeModal.close(true)"">Replace & Import</button>",13,2017-07-31 14:23:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/130318630,https://github.com/hyperledger/composer/pull/1709#discussion_r130318630,nklincoln
https://github.com/hyperledger/composer/pull/1709,https://github.com/hyperledger/composer/pull/1709,"""query stuff"" should probably receive some wordification-magic",0c66b8109c6475d0c09d243cbedba544a068cc12,2017-07-31 14:15:05,130364270,"@@ -58,6 +58,22 @@
           Define the logic of transaction executions using JavaScript.
         </div>
       </div>
+      <div class=""file-types-list-item"" [ngClass]=""{'selection-disabled': queryExists()}"">
+        <input [disabled]=""queryExists()"" type=""radio"" id=""file-type-qry"" name=""file-type-qry"" [(ngModel)]=""fileType"" value=""qry""
+               (change)=""changeCurrentFileType()"">
+        <label class=""radio-label"" for=""file-type-qry"">Query File (.qry)</label>
+        <div class=""description"">
+          Define the Query stuff in here (Note: you can only have 1 of these per .bna).",,2017-07-31 14:23:31,https://api.github.com/repos/hyperledger/composer/pulls/comments/130364270,https://github.com/hyperledger/composer/pull/1709#discussion_r130364270,nklincoln
https://github.com/hyperledger/composer/pull/1689,https://github.com/hyperledger/composer/pull/1689,Can this be a variable please,db1153bd5bc020694c133623c9d17e09259e3713,2017-07-28 07:50:33,130031784,"@@ -1,41 +1,84 @@
 @import '../../../assets/styles/base/colors';
 @import '../../../assets/styles/base/variables';
 
-.import {
-  width: 660px;
-  height: 450px;
-
+.add-connection {
   display: flex;
   flex-direction: column;
+  min-width: 35rem;
+  background-color: $white;
+  margin-bottom: $space-large;
+  margin-top: $space-large;
+  border:1px solid $keyline-highlight;
+  border-radius:4px;
+
+  h1 {
+      margin-top: $space-medium;
+      margin-bottom: $space-large;
+      margin-left: $space-medium;
+      font-size: 20px;
+      color: $primary-text;
+      letter-spacing:0;
+      text-align:left;
+  }
 
-  .file-types-list {
-    max-height: 200px;
-    margin-top: 16px;
-
-    .file-types-list-item {
-      background-color: $third-highlight;
-      padding: $space-medium;
-      &:nth-child(even) {
-        background-color: $white;
-      }
+  .profiles {
+      display: flex;
+      flex-direction: row;
+      margin-left: $space-medium;
 
       .description {
-        font-style: italic;
-        padding-left: 2em;
+        margin-right: $space-xlarge;
+        margin-top: 4px;",,2017-07-28 14:55:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/130031784,https://github.com/hyperledger/composer/pull/1689#discussion_r130031784,cazfletch
https://github.com/hyperledger/composer/pull/1689,https://github.com/hyperledger/composer/pull/1689,This doesn't look right (max-width),db1153bd5bc020694c133623c9d17e09259e3713,2017-07-28 07:52:01,130032003,"@@ -1,41 +1,84 @@
 @import '../../../assets/styles/base/colors';
 @import '../../../assets/styles/base/variables';
 
-.import {
-  width: 660px;
-  height: 450px;
-
+.add-connection {
   display: flex;
   flex-direction: column;
+  min-width: 35rem;
+  background-color: $white;
+  margin-bottom: $space-large;
+  margin-top: $space-large;
+  border:1px solid $keyline-highlight;
+  border-radius:4px;
+
+  h1 {
+      margin-top: $space-medium;
+      margin-bottom: $space-large;
+      margin-left: $space-medium;
+      font-size: 20px;
+      color: $primary-text;
+      letter-spacing:0;
+      text-align:left;
+  }
 
-  .file-types-list {
-    max-height: 200px;
-    margin-top: 16px;
-
-    .file-types-list-item {
-      background-color: $third-highlight;
-      padding: $space-medium;
-      &:nth-child(even) {
-        background-color: $white;
-      }
+  .profiles {
+      display: flex;
+      flex-direction: row;
+      margin-left: $space-medium;
 
       .description {
-        font-style: italic;
-        padding-left: 2em;
+        margin-right: $space-xlarge;
+        margin-top: 4px;
+        font-size:11px;
+        color:$tertiary-text;
+        line-height:15px;
       }
 
-      label.radio-label {
-        font-weight: bold;
-
-        &::before {
-          top: 8px;
-        }
+      .create-route {
+          display: flex;
+          flex-direction: column;
+          margin-bottom: $space-large;
+          max-width: 52rem;",,2017-07-28 14:55:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/130032003,https://github.com/hyperledger/composer/pull/1689#discussion_r130032003,cazfletch
https://github.com/hyperledger/composer/pull/1689,https://github.com/hyperledger/composer/pull/1689,You could probably use h3 here rather than setting the font size,db1153bd5bc020694c133623c9d17e09259e3713,2017-07-28 07:55:25,130032518,"@@ -1,41 +1,84 @@
 @import '../../../assets/styles/base/colors';
 @import '../../../assets/styles/base/variables';
 
-.import {
-  width: 660px;
-  height: 450px;
-
+.add-connection {
   display: flex;
   flex-direction: column;
+  min-width: 35rem;
+  background-color: $white;
+  margin-bottom: $space-large;
+  margin-top: $space-large;
+  border:1px solid $keyline-highlight;
+  border-radius:4px;
+
+  h1 {
+      margin-top: $space-medium;
+      margin-bottom: $space-large;
+      margin-left: $space-medium;
+      font-size: 20px;
+      color: $primary-text;
+      letter-spacing:0;
+      text-align:left;
+  }
 
-  .file-types-list {
-    max-height: 200px;
-    margin-top: 16px;
-
-    .file-types-list-item {
-      background-color: $third-highlight;
-      padding: $space-medium;
-      &:nth-child(even) {
-        background-color: $white;
-      }
+  .profiles {
+      display: flex;
+      flex-direction: row;
+      margin-left: $space-medium;
 
       .description {
-        font-style: italic;
-        padding-left: 2em;
+        margin-right: $space-xlarge;
+        margin-top: 4px;
+        font-size:11px;
+        color:$tertiary-text;
+        line-height:15px;
       }
 
-      label.radio-label {
-        font-weight: bold;
-
-        &::before {
-          top: 8px;
-        }
+      .create-route {
+          display: flex;
+          flex-direction: column;
+          margin-bottom: $space-large;
+          max-width: 52rem;
+
+          p {
+              color:$primary-text;
+              line-height:19px;
+              margin-top: 0;
+              margin-bottom: 0;
+              font-family: ""Open Sans"", ""Helvetica Neue for IBM"", ""Helvetica Neue"", Helvetica, Arial, sans-serif;
+              font-weight: 300;
+          }
 
-        &::after {
-          top: 13px;
+          .file-types-list {
+              display: flex;
+              flex-direction: row;
+              margin-top: $space-large;
+              margin-bottom: $space-mlarge;
+              flex-wrap: wrap;
+
+              .file-types-list-item {
+                    background-color:  $white;
+                    padding: $space-medium;
+                    max-width: 25rem;
+                    min-width: 22rem;
+
+                .description {
+                    font-size:14px;",,2017-07-28 14:55:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/130032518,https://github.com/hyperledger/composer/pull/1689#discussion_r130032518,cazfletch
https://github.com/hyperledger/composer/pull/1689,https://github.com/hyperledger/composer/pull/1689,This could be a variable too,db1153bd5bc020694c133623c9d17e09259e3713,2017-07-28 07:55:46,130032579,"@@ -1,41 +1,84 @@
 @import '../../../assets/styles/base/colors';
 @import '../../../assets/styles/base/variables';
 
-.import {
-  width: 660px;
-  height: 450px;
-
+.add-connection {
   display: flex;
   flex-direction: column;
+  min-width: 35rem;
+  background-color: $white;
+  margin-bottom: $space-large;
+  margin-top: $space-large;
+  border:1px solid $keyline-highlight;
+  border-radius:4px;
+
+  h1 {
+      margin-top: $space-medium;
+      margin-bottom: $space-large;
+      margin-left: $space-medium;
+      font-size: 20px;
+      color: $primary-text;
+      letter-spacing:0;
+      text-align:left;
+  }
 
-  .file-types-list {
-    max-height: 200px;
-    margin-top: 16px;
-
-    .file-types-list-item {
-      background-color: $third-highlight;
-      padding: $space-medium;
-      &:nth-child(even) {
-        background-color: $white;
-      }
+  .profiles {
+      display: flex;
+      flex-direction: row;
+      margin-left: $space-medium;
 
       .description {
-        font-style: italic;
-        padding-left: 2em;
+        margin-right: $space-xlarge;
+        margin-top: 4px;
+        font-size:11px;
+        color:$tertiary-text;
+        line-height:15px;
       }
 
-      label.radio-label {
-        font-weight: bold;
-
-        &::before {
-          top: 8px;
-        }
+      .create-route {
+          display: flex;
+          flex-direction: column;
+          margin-bottom: $space-large;
+          max-width: 52rem;
+
+          p {
+              color:$primary-text;
+              line-height:19px;
+              margin-top: 0;
+              margin-bottom: 0;
+              font-family: ""Open Sans"", ""Helvetica Neue for IBM"", ""Helvetica Neue"", Helvetica, Arial, sans-serif;
+              font-weight: 300;
+          }
 
-        &::after {
-          top: 13px;
+          .file-types-list {
+              display: flex;
+              flex-direction: row;
+              margin-top: $space-large;
+              margin-bottom: $space-mlarge;
+              flex-wrap: wrap;
+
+              .file-types-list-item {
+                    background-color:  $white;
+                    padding: $space-medium;
+                    max-width: 25rem;
+                    min-width: 22rem;
+
+                .description {
+                    font-size:14px;
+                    color:$primary-text;
+                    line-height: 21px;
+                    margin-left: 2rem;",,2017-07-28 14:55:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/130032579,https://github.com/hyperledger/composer/pull/1689#discussion_r130032579,cazfletch
https://github.com/hyperledger/composer/pull/1689,https://github.com/hyperledger/composer/pull/1689,Is this really needed too?,db1153bd5bc020694c133623c9d17e09259e3713,2017-07-28 07:56:14,130032667,"@@ -1,41 +1,84 @@
 @import '../../../assets/styles/base/colors';
 @import '../../../assets/styles/base/variables';
 
-.import {
-  width: 660px;
-  height: 450px;
-
+.add-connection {
   display: flex;
   flex-direction: column;
+  min-width: 35rem;
+  background-color: $white;
+  margin-bottom: $space-large;
+  margin-top: $space-large;
+  border:1px solid $keyline-highlight;
+  border-radius:4px;
+
+  h1 {
+      margin-top: $space-medium;
+      margin-bottom: $space-large;
+      margin-left: $space-medium;
+      font-size: 20px;
+      color: $primary-text;
+      letter-spacing:0;
+      text-align:left;
+  }
 
-  .file-types-list {
-    max-height: 200px;
-    margin-top: 16px;
-
-    .file-types-list-item {
-      background-color: $third-highlight;
-      padding: $space-medium;
-      &:nth-child(even) {
-        background-color: $white;
-      }
+  .profiles {
+      display: flex;
+      flex-direction: row;
+      margin-left: $space-medium;
 
       .description {
-        font-style: italic;
-        padding-left: 2em;
+        margin-right: $space-xlarge;
+        margin-top: 4px;
+        font-size:11px;
+        color:$tertiary-text;
+        line-height:15px;
       }
 
-      label.radio-label {
-        font-weight: bold;
-
-        &::before {
-          top: 8px;
-        }
+      .create-route {
+          display: flex;
+          flex-direction: column;
+          margin-bottom: $space-large;
+          max-width: 52rem;
+
+          p {
+              color:$primary-text;
+              line-height:19px;
+              margin-top: 0;
+              margin-bottom: 0;
+              font-family: ""Open Sans"", ""Helvetica Neue for IBM"", ""Helvetica Neue"", Helvetica, Arial, sans-serif;
+              font-weight: 300;
+          }
 
-        &::after {
-          top: 13px;
+          .file-types-list {
+              display: flex;
+              flex-direction: row;
+              margin-top: $space-large;
+              margin-bottom: $space-mlarge;
+              flex-wrap: wrap;
+
+              .file-types-list-item {
+                    background-color:  $white;
+                    padding: $space-medium;
+                    max-width: 25rem;
+                    min-width: 22rem;",,2017-07-28 14:55:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/130032667,https://github.com/hyperledger/composer/pull/1689#discussion_r130032667,cazfletch
https://github.com/hyperledger/composer/pull/1689,https://github.com/hyperledger/composer/pull/1689,why is this all commented out?,db1153bd5bc020694c133623c9d17e09259e3713,2017-07-28 07:58:18,130032989,"@@ -13,678 +13,650 @@ import { BusinessNetworkDefinition, AdminConnection } from 'composer-admin';
 import { AlertService } from '../../basic-modals/alert.service';
 import { AdminService } from '../../services/admin.service';
 import { ConnectionProfileService } from '../../services/connectionprofile.service';
+import { IdentityService } from '../../services/identity.service';
 import { BehaviorSubject, Subject } from 'rxjs/Rx';
 
 import * as sinon from 'sinon';
 import { expect } from 'chai';
 
-class MockAdminService {
-    getAdminConnection(): AdminConnection {
-        return new AdminConnection();
-    }
-
-    ensureConnection(): Promise<any> {
-        return new Promise((resolve, reject) => {
-            resolve(true);
-        });
-    }
-
-    deploy(): Promise<any> {
-        return new Promise((resolve, reject) => {
-            resolve(new BusinessNetworkDefinition('org-acme-biznet@0.0.1', 'Acme Business Network'));
-        });
-    }
-
-    update(): Promise<any> {
-        return new Promise((resolve, reject) => {
-            resolve(new BusinessNetworkDefinition('org-acme-biznet@0.0.1', 'Acme Business Network'));
-        });
-    }
-
-    generateDefaultBusinessNetwork(): BusinessNetworkDefinition {
-        return new BusinessNetworkDefinition('org-acme-biznet@0.0.1', 'Acme Business Network');
-    }
-
-    isInitialDeploy(): boolean {
-        return true;
-    }
-}
-
-class MockAlertService {
-    public errorStatus$: Subject<string> = new BehaviorSubject<string>(null);
-    public busyStatus$: Subject<string> = new BehaviorSubject<string>(null);
-}
-
-class MockConnectionProfileService {
-    getAllProfiles(): Promise<any> {
-        return new Promise((resolve, reject) => {
-            resolve({profile0: 'a', profile2: 'c', profile1: 'b'});
-        });
-    }
-}
-
-@Directive({
-    selector: '[fileDragDrop]'
-})
-class MockDragDropDirective {
-    @Output()
-    public fileDragDropFileAccepted: EventEmitter<File> = new EventEmitter<File>();
-    @Output()
-    public fileDragDropFileRejected: EventEmitter<string> = new EventEmitter<string>();
-    @Output()
-    public fileDragDropDragOver: EventEmitter<string> = new EventEmitter<string>();
-    @Output()
-    public fileDragDropDragLeave: EventEmitter<string> = new EventEmitter<string>();
-
-    @Input()
-    public supportedFileTypes: string[] = [];
-    @Input()
-    maxFileSize: number = 0;
-}
-
-@Directive({
-    selector: 'file-importer'
-})
-class MockFileImporterDirective {
-    @Output()
-    public fileAccepted: EventEmitter<File> = new EventEmitter<File>();
-
-    @Output()
-    public fileRejected: EventEmitter<File> = new EventEmitter<File>();
-
-    @Input()
-    public expandInput: boolean = false;
-
-    @Input()
-    public svgName: string = '#icon-BNA_Upload';
-
-    @Input()
-    public maxFileSize: number = 0;
-
-    @Input()
-    public supportedFileTypes: string[] = [];
-}
-
 describe('AddConnectionProfileComponent', () => {
-    let sandbox;
+
     let component: AddConnectionProfileComponent;
     let fixture: ComponentFixture<AddConnectionProfileComponent>;
 
-    const NAME = 'New Profile';
-    const DESC = 'Test Description';
-    const MS_URL = 'msurl';
-    const PEER_URL = 'peerurl';
-    const EH_URL = 'ehurl';
-    const KEY_VAL_STORE = 'kvs';
-    const DEPLOY_TIME = 100;
-    const WAIT_TIME = 999;
-    const TIMEOUT = 134;
-    const CERT = 'cert';
-    const CERT_PATH = 'certpath';
-    const PEERS = ['peers'];
-    const ORDERERS = ['orderers'];
-    const CA = 'ca';
-    const CHANNEL = 'channel';
-    const MSPID = 'mspID';
+    let mockConnectionProfileService;
+    let mockIdentityService;
+    let mockAlertService;
 
     beforeEach(() => {
+
+        mockConnectionProfileService = sinon.createStubInstance(ConnectionProfileService);
+        mockIdentityService = sinon.createStubInstance(IdentityService);
+        mockAlertService = sinon.createStubInstance(AlertService);
+        mockAlertService.successStatus$ = {next: sinon.stub()};
+        mockAlertService.busyStatus$ = {next: sinon.stub()};
+        mockAlertService.errorStatus$ = {next: sinon.stub()};
+
         TestBed.configureTestingModule({
             declarations: [
-                AddConnectionProfileComponent, MockDragDropDirective, MockFileImporterDirective
+                AddConnectionProfileComponent
             ],
             imports: [
                 FormsModule
             ],
             providers: [
-                {provide: AlertService, useClass: MockAlertService},
-                NgbActiveModal,
-                {provide: AdminService, useClass: MockAdminService},
-                {provide: ConnectionProfileService, useClass: MockConnectionProfileService}
+                {provide: AlertService, useValue: mockAlertService},
+                {provide: ConnectionProfileService, useValue: mockConnectionProfileService},
+                {provide: IdentityService, useValue: mockIdentityService}
             ]
         });
 
-        sandbox = sinon.sandbox.create();
         fixture = TestBed.createComponent(AddConnectionProfileComponent);
         component = fixture.componentInstance;
     });
 
-    afterEach(() => {
-        sandbox.restore();
-    });
-
-    describe('#removeFile', () => {
-        it('should reset current settings when removeFile is called', () => {
-            component.removeFile();
-            expect(component.expandInput).to.be.false;
-            expect(component.currentFile).to.be.null;
-            expect(component.currentFileName).to.be.null;
-            expect(component.version).to.equal('');
-        });
-    });
+    describe('#ngOnInit', () => {
+        it('should call updateConnectionProfiles', () => {
+            let updateConnectionProfilesStub = sinon.stub(component, 'updateConnectionProfiles');
 
-    describe('#fileDetected', () => {
-        it('should change this.expandInput to true', () => {
-            component.fileDetected();
-            expect(component.expandInput).to.be.true;
-        });
-    });
+            component['ngOnInit']();
 
-    describe('#fileLeft', () => {
-        it('should change this.expectedInput to false', () => {
-            component.fileLeft();
-            expect(component.expandInput).to.be.false;
+            updateConnectionProfilesStub.should.have.been.called;
         });
     });
 
-    describe('#fileAccepted', () => {
-
-        it('should call this.createProfile', fakeAsync(() => {
-            let b = new Blob(['/**Connection Profile*/'], {type: 'json'});
-            let file = new File([b], 'New Profile.json');
-
-            let createMock = sandbox.stub(component, 'createProfile');
-            let dataBufferMock = sandbox.stub(component, 'getDataBuffer')
-            .returns(Promise.resolve('some data'));
-
-            component.fileAccepted(file);
-            tick();
-            createMock.called;
-        }));
-
-        it('should call this.fileRejected when there is an error reading the file', fakeAsync(() => {
-            let b = new Blob(['/**CTO File*/'], {type: 'text/plain'});
-            let file = new File([b], 'newfile.cto');
-
-            let createMock = sandbox.stub(component, 'fileRejected');
-            let dataBufferMock = sandbox.stub(component, 'getDataBuffer')
-            .returns(Promise.reject('some data'));
-
-            component.fileAccepted(file);
-            tick();
-            createMock.called;
-        }));
-
-        it('should throw when given incorrect file type', fakeAsync(() => {
+    describe('updateConnectionProfiles', () => {
+        it('should update all connection profiles', fakeAsync(() => {
+            mockConnectionProfileService.getAllProfiles.returns(Promise.resolve({myProfile: {name: 'myProfile'}}));
 
-            let b = new Blob(['/**PNG File*/'], {type: 'text/plain'});
-            let file = new File([b], 'newfile.png');
+            mockIdentityService.getIdentities.returns(Promise.resolve(['bob']));
 
-            let createMock = sandbox.stub(component, 'fileRejected');
-            let dataBufferMock = sandbox.stub(component, 'getDataBuffer')
-            .returns(Promise.resolve('some data'));
+            component.updateConnectionProfiles();
 
-            component.fileAccepted(file);
             tick();
-            createMock.called;
-        }));
-    });
-
-    describe('#fileRejected', () => {
-        it('should return an error status', async(() => {
-            component.fileRejected('long reason to reject file');
-
-            component['alertService'].errorStatus$.subscribe(
-                (message) => {
-                    expect(message).to.be.equal('long reason to reject file');
-                }
-            );
+            mockConnectionProfileService.getAllProfiles.should.have.been.called;
+            mockIdentityService.getIdentities.should.have.been.calledWith('myProfile');
+            component['connectionProfiles'].should.deep.equal([{
+                name: 'myProfile',
+                profile: {name: 'myProfile'},
+                default: false,
+                description: 'Default connection profile',
+                identities: [{
+                    userId: 'bob',
+                    businessNetwork: 'org-acme-biznet'
+                }]
+            }]);
         }));
     });
 
-    describe('#getDataBuffer', () => {
-        let file;
-        let mockFileReadObj;
-        let mockBuffer;
-        let mockFileRead;
-        let content;
-
-        beforeEach(() => {
-            content = 'hello world';
-            let data = new Blob([content], {type: 'text/plain'});
-            file = new File([data], 'mock.bna');
-
-            mockFileReadObj = {
-                readAsArrayBuffer: sandbox.stub(),
-                result: content,
-                onload: sinon.stub(),
-                onerror: sinon.stub()
-            };
-
-            mockFileRead = sinon.stub(window, 'FileReader');
-            mockFileRead.returns(mockFileReadObj);
-        });
-
-        afterEach(() => {
-            mockFileRead.restore();
+    describe('#generateProfileName', () => {
+        it('should generate a base name', () => {
+            component['generateProfileName']().should.equal('New Connection Profile');
         });
 
-        it('should return data from a file', () => {
-            let promise = component.getDataBuffer(file);
-            mockFileReadObj.onload();
-            return promise
-            .then((data) => {
-                data.toString().should.equal(content);
-            });
+        it('should generate an incremented base name if one exists already', () => {
+            component['connectionProfiles'] = ['New Connection Profile', 'New Connection Profile1'];
+            component['generateProfileName']().should.equal('New Connection Profile2');
         });
 
-        it('should give error in promise chain', () => {
-            let promise = component.getDataBuffer(file);
-            mockFileReadObj.onerror('error');
-            return promise
-            .then((data) => {
-                data.should.be.null;
-            })
-            .catch((err) => {
-                err.should.equal('error');
-            });
+        it('should generate an incremented base name accounting for skipped indicies', () => {
+            component['connectionProfiles'] = ['New Connection Profile', 'New Connection Profile1', 'New Connection Profile2', 'New Connection Profile4'];
+            component['generateProfileName']().should.equal('New Connection Profile3');
         });
     });
 
-    describe('#createProfile', () => {
-        let V06_INPUT = {
-            description: DESC,
-            type: 'hlf',
-            membershipServicesURL: MS_URL,
-            peerURL: PEER_URL,
-            eventHubURL: EH_URL,
-            keyValStore: KEY_VAL_STORE,
-            deployWaitTime: DEPLOY_TIME,
-            invokeWaitTime: WAIT_TIME,
-            certificate: CERT,
-            certificatePath: CERT_PATH
-        };
-
-        let V1_INPUT = {
-            description: DESC,
-            type: 'hlfv1',
-            orderers: ORDERERS,
-            ca: CA,
-            peers: PEERS,
-            keyValStore: KEY_VAL_STORE,
-            timeout: TIMEOUT,
-            channel: CHANNEL,
-            mspID: MSPID,
-        };
-
-        let BAD_INPUT = 'This is not valid input';
-
-        let INVALID_VERSION = {
-            description: 'test',
-            type: 'hlfv100',
-        };
-
-        it('should process json data for v0.6 hlf', fakeAsync(() => {
-            let createMock = sandbox.stub(component, 'setV06Defaults').returns(Promise.resolve('some data'));
-            let addMock = sandbox.stub(component, 'addConnectionProfile');
-            let data = JSON.stringify(V06_INPUT);
-            component.createProfile(data);
-            tick();
-            createMock.should.have.been.called;
-            component['addConnectionProfileDescription'].should.equal(DESC);
-            component['addConnectionProfileType'].should.equal('hlf');
-            component['addConnectionProfileMembershipServicesURL'].should.equal(MS_URL);
-            component['addConnectionProfilePeerURL'].should.equal(PEER_URL);
-            component['addConnectionProfileEventHubURL'].should.equal(EH_URL);
-            component['addConnectionProfileKeyValStore'].should.equal(KEY_VAL_STORE);
-            component['addConnectionProfileDeployWaitTime'].should.equal(DEPLOY_TIME);
-            component['addConnectionProfileInvokeWaitTime'].should.equal(WAIT_TIME);
-            component['addConnectionProfileCertificate'].should.equal(CERT);
-            component['addConnectionProfileCertificatePath'].should.equal(CERT_PATH);
-            addMock.should.have.been.called;
-        }));
-
-        it('should process json data for v1 hlf', fakeAsync(() => {
-            let createMock = sandbox.stub(component, 'setV1Defaults').returns(Promise.resolve('some data'));
-            let addMock = sandbox.stub(component, 'addConnectionProfile');
-            let data = JSON.stringify(V1_INPUT);
-            component.createProfile(data);
-            tick();
-            createMock.should.have.been.called;
-            component['addConnectionProfileDescription'].should.equal(DESC);
-            component['addConnectionProfileType'].should.equal('hlfv1');
-            component['addConnectionProfileOrderers'].should.deep.equal(ORDERERS);
-            component['addConnectionProfileCertificateAuthority'].should.equal(CA);
-            component['addConnectionProfilePeers'].should.deep.equal(PEERS);
-            component['addConnectionProfileKeyValStore'].should.equal(KEY_VAL_STORE);
-            component['addConnectionProfileChannel'].should.equal(CHANNEL);
-            component['addConnectionProfileMspId'].should.equal(MSPID);
-            component['addConnectionProfileTimeout'].should.equal(TIMEOUT);
-            addMock.should.have.been.called;
-        }));
+    describe('#retrieveConnectionProfileByName', () => {
+        it('should retrieve a profile by name if it exists', fakeAsync(() => {
+            let myProfile = {myProfile: {profile: 'myProfile'}};
+            mockConnectionProfileService.getAllProfiles.returns(Promise.resolve(myProfile));
 
-        it('should throw an error for bad input', fakeAsync(() => {
-            try {
-                component.createProfile(BAD_INPUT);
-            } catch (e) {
-                e.message.should.contain('Parse error');
-            }
+            component['retrieveConnectionProfileByName']('myProfile')
+            .then((result) => {
+                result.should.deep.equal({profile: 'myProfile'});
+            })
+            .catch((error) => {
+                fail('should not error');
+            });
         }));
 
-        it('should throw an error for an invalid type', fakeAsync(() => {
-            let data = JSON.stringify(INVALID_VERSION);
-            try {
-                component.createProfile(data);
-            } catch (e) {
-                e.message.should.contain('Invalid type in profile');
-            }
+        it('should return an error if a profile by name does not exist', fakeAsync(() => {
+            let myProfile = [{myProfile: {name: 'myProfile'}}];
+            mockConnectionProfileService.getAllProfiles.returns(Promise.resolve(myProfile));
+            component['retrieveConnectionProfileByName']('notThisProfile')
+            .then((result) => {
+                fail('should throw error');
+            })
+            .catch((error) => {
+                error.toString().should.equal('Error: Unknown connection profile name: notThisProfile');
+            });
         }));
 
     });
 
-    describe('#changeCurrentFileType', () => {
-        let TEST_DESC = 'Test Description';
-        beforeEach(() => {
-            component['addConnectionProfileDescription'] = TEST_DESC;
-        });
+    describe('#setConnectionProfile', () => {
+        it('should be able to set default v1 profile', fakeAsync(() => {
+            let updateConnectionProfilesStub = sinon.stub(component, 'updateConnectionProfiles');
+            updateConnectionProfilesStub.returns(Promise.resolve({}));
 
-        it('should deal with the version being 0.6', fakeAsync(() => {
-            let setMock = sandbox.stub(component, 'setV06Defaults').returns(Promise.resolve());
-            component['version'] = 'v06';
-            component.changeCurrentFileType();
-            tick();
-            setMock.should.have.been.called;
-            expect(component.currentFile).to.be.null;
-            component['newConnectionProfile'].type.should.equal('hlf');
-            component['newConnectionProfile'].description.should.equal(TEST_DESC);
-        }));
+            component.setConnectionProfile('_$v1');
 
-        it('should deal with the addConnectionProfileType being hlf ', fakeAsync(() => {
-            let setMock = sandbox.stub(component, 'setV06Defaults').returns(Promise.resolve());
-            component['addConnectionProfileType'] = 'hlf';
-            component.changeCurrentFileType();
             tick();
-            setMock.should.have.been.called;
-            expect(component.currentFile).to.be.null;
-            component['newConnectionProfile'].type.should.equal('hlf');
-            component['newConnectionProfile'].description.should.equal(TEST_DESC);
-        }));
-
-        it('should deal with the version being v1', fakeAsync(() => {
-            let setMock = sandbox.stub(component, 'setV1Defaults').returns(Promise.resolve());
-            component['version'] = 'v1';
-            component.changeCurrentFileType();
-            tick();
-            setMock.should.have.been.called;
-            expect(component.currentFile).to.be.null;
-            component['newConnectionProfile'].type.should.equal('hlfv1');
-            component['newConnectionProfile'].description.should.equal(TEST_DESC);
-        }));
 
-        it('should throw an error when no version or connection type', fakeAsync(() => {
-            component['version'] = 'BAD';
-            try {
-                component.changeCurrentFileType();
-            } catch (e) {
-                e.message.should.contain('Unsupported version');
-            }
+            let profile = { description: 'A description for a V1 Profile',
+                            type: 'hlfv1',
+                            orderers: [{
+                                        url: 'grpc://localhost:7050',
+                                        cert: ''
+                                        }],
+                            ca: {
+                                    url: 'http://localhost:7054',
+                                    name: ''
+                                },
+                            peers: [{
+                                        requestURL: 'grpc://localhost:7051',
+                                        eventURL: 'grpc://localhost:7053',
+                                        cert: ''
+                                    }],
+                            keyValStore: '/tmp/keyValStore',
+                            channel: 'composerchannel',
+                            mspID: 'Org1MSP',
+                            timeout: 300
+                        };
+
+            let expectedConstruct = {name: 'New Connection Profile',
+                                     profile: profile,
+                                     default: false };
+
+            component['connectionProfile'].should.deep.equal(expectedConstruct);
         }));
-    });
 
-    describe('#setV06Defaults', () => {
-        it('should create a new profile and set defaults for a v0.6 fabric', fakeAsync(() => {
-            let mockUpdate = sandbox.stub(component, 'updateConnectionProfiles').returns(Promise.resolve());
-            component['connectionProfiles'] = [];
-            component.setV06Defaults().then(() => {
-                component['addConnectionProfileName'].should.equal('New Connection Profile');
-                verifyUnchangeableDefaults();
-            });
-        }));
+        it('should be able to set default v0.6 profile', fakeAsync(() => {
+            let updateConnectionProfilesStub = sinon.stub(component, 'updateConnectionProfiles');
+            updateConnectionProfilesStub.returns(Promise.resolve({}));
 
-        it('should create a new profile with a new name and set defaults for a v0.6 fabric', fakeAsync(() => {
-            let mockUpdate = sandbox.stub(component, 'updateConnectionProfiles').returns(Promise.resolve());
-            component['connectionProfiles'] = [{name: 'New Connection Profile'}];
-            component.setV06Defaults().then(() => {
-                component['addConnectionProfileName'].should.equal('New Connection Profile 2');
-                verifyUnchangeableDefaults();
-            });
-        }));
+            component.setConnectionProfile('_$v06');
 
-        function verifyUnchangeableDefaults() {
-            component['addConnectionProfileDescription'].should.equal('A description for a V0.6 Profile');
-            component['addConnectionProfileType'].should.equal('hlf');
-            component['addConnectionProfilePeerURL'].should.equal('grpc://localhost:7051');
-            component['addConnectionProfileMembershipServicesURL'].should.equal('grpc://localhost:7054');
-            component['addConnectionProfileEventHubURL'].should.equal('grpc://localhost:7053');
-            component['addConnectionProfileKeyValStore'].should.equal('/tmp/keyValStore');
-            component['addConnectionProfileDeployWaitTime'].should.equal(300);
-            component['addConnectionProfileInvokeWaitTime'].should.equal(30);
-            expect(component['addConnectionProfileCertificate']).to.be.null;
-            expect(component['addConnectionProfileCertificatePath']).to.be.null;
-        }
-    });
-
-    describe('#setV1Defaults', () => {
-
-        it('should create a new profile and set defaults for a v1 fabric 1', fakeAsync(() => {
-            let mockUpdate = sandbox.stub(component, 'updateConnectionProfiles').returns(Promise.resolve());
-            component['connectionProfiles'] = [];
-            component.setV1Defaults();
             tick();
 
-            component['addConnectionProfileName'].should.equal('New Connection Profile');
-            verifyUnchangeableDefaults();
+            let profile = {
+                            description: 'A description for a V0.6 Profile',
+                            type: 'hlf',
+                            membershipServicesURL: 'grpc://localhost:7054',
+                            peerURL: 'grpc://localhost:7051',
+                            eventHubURL: 'grpc://localhost:7053',
+                            keyValStore: '/tmp/keyValStore',
+                            deployWaitTime: 5 * 60,
+                            invokeWaitTime: 30,
+                            certificate: null,
+                            certificatePath: null
+                        };
+
+            let expectedConstruct = {name: 'New Connection Profile',
+                                     profile: profile,
+                                     default: false };
+
+            component['connectionProfile'].should.deep.equal(expectedConstruct);
         }));
 
-        it('should create a new profile and set defaults for a v1 fabric 2', fakeAsync(() => {
-            let mockUpdate = sandbox.stub(component, 'updateConnectionProfiles').returns(Promise.resolve());
-            component['connectionProfiles'] = [{name: 'New Connection Profile'}];
-            component.setV1Defaults();
-            tick();
-            component['addConnectionProfileName'].should.equal('New Connection Profile 2');
-            verifyUnchangeableDefaults();
-        }));
+        it('should be able to set named profile', fakeAsync(() => {
+            let updateConnectionProfilesStub = sinon.stub(component, 'updateConnectionProfiles');
+            updateConnectionProfilesStub.returns(Promise.resolve({}));
 
-        function verifyUnchangeableDefaults() {
-            component['addConnectionProfileDescription'].should.equal('A description for a V1 Profile');
-            component['addConnectionProfileType'].should.equal('hlfv1');
-            component['addConnectionProfileOrderers'].should.deep.equal([{
-                url: 'grpc://localhost:7050',
-                cert: ''
-            }]);
+            let targetProfile = { name: 'Pingu', type: 'Penguin'};
 
-            component['addConnectionProfileCertificateAuthority'].url.should.equal('http://localhost:7054');
-            component['addConnectionProfileCertificateAuthority'].name.should.equal('');
-            component['addConnectionProfilePeers'].should.deep.equal([{
-                requestURL: 'grpc://localhost:7051',
-                eventURL: 'grpc://localhost:7053',
-                cert: ''
-            }]);
-            component['addConnectionProfileKeyValStore'].should.equal('/tmp/keyValStore');
-            component['addConnectionProfileChannel'].should.equal('composerchannel');
-            component['addConnectionProfileMspId'].should.equal('Org1MSP');
-            component['addConnectionProfileTimeout'].should.equal(300);
-        }
+            let retrieveConnectionProfileByNameStub = sinon.stub(component, 'retrieveConnectionProfileByName');
+            retrieveConnectionProfileByNameStub.returns(targetProfile);
 
-    });
+            component.setConnectionProfile('selectMe');
 
-    describe('#updateConnectionProfiles', () => {
+            tick();
 
-        it('should update/refresh the list of connection profiles', fakeAsync(() => {
-            component.updateConnectionProfiles().then(() => {
-                component['connectionProfiles'].should.deep.equal([
-                    {name: 'profile0', profile: 'a', default: false},
-                    {name: 'profile1', profile: 'b', default: false},
-                    {name: 'profile2', profile: 'c', default: false}
-                ]);
-            });
-        }));
-    });
+            let expectedConstruct = {name: 'selectMe',
+                                     profile: targetProfile,
+                                     default: true };
 
-    describe('#addConnectionProfile', () => {
-        let mockModalSpy;
-
-        beforeEach(inject([NgbActiveModal], (activeModal: NgbActiveModal) => {
-            mockModalSpy = sinon.spy(activeModal, 'close');
-
-            component['addConnectionProfileName'] = NAME;
-            component['addConnectionProfileDescription'] = DESC;
-            component['addConnectionProfileMembershipServicesURL'] = MS_URL;
-            component['addConnectionProfilePeerURL'] = PEER_URL;
-            component['addConnectionProfileEventHubURL'] = EH_URL;
-            component['addConnectionProfileKeyValStore'] = KEY_VAL_STORE;
-            component['addConnectionProfileDeployWaitTime'] = DEPLOY_TIME;
-            component['addConnectionProfileInvokeWaitTime'] = WAIT_TIME;
-            component['addConnectionProfileCertificate'] = CERT;
-            component['addConnectionProfileCertificatePath'] = CERT_PATH;
-            component['addConnectionProfileOrderers'] = ORDERERS;
-            component['addConnectionProfileCertificateAuthority'] = CA;
-            component['addConnectionProfilePeers'] = PEERS;
-            component['addConnectionProfileChannel'] = CHANNEL;
-            component['addConnectionProfileMspId'] = MSPID;
-            component['addConnectionProfileTimeout'] = TIMEOUT;
+            component['connectionProfile'].should.deep.equal(expectedConstruct);
         }));
+    });
 
-        it('should deal with the version being 0.6 and a certificate', () => {
-            let EXP = {
-                default: false,
-                name: 'New Profile',
-                profile: {
-                    certificate: CERT + '\n',
-                    certificatePath: CERT_PATH,
-                    deployWaitTime: DEPLOY_TIME,
-                    description: DESC,
-                    eventHubURL: EH_URL,
-                    invokeWaitTime: WAIT_TIME,
-                    keyValStore: KEY_VAL_STORE,
-                    membershipServicesURL: MS_URL,
-                    peerURL: PEER_URL,
-                    type: 'hlf'
-                }
-            };
-
-            component['version'] = 'v06';
-            component.addConnectionProfile();
-            mockModalSpy.should.have.been.calledWith(EXP);
-        });
-
-        it('should deal with the version being 0.6 and without a certificate', () => {
-            component['addConnectionProfileCertificate'] = null;
+    describe('#dismiss', () => {
+        it('should trigger cancelAdd.emit ', () => {
+            let spy = sinon.spy(component.cancelAdd, 'emit');
 
-            let EXP = {
-                default: false,
-                name: 'New Profile',
-                profile: {
-                    certificate: null,
-                    certificatePath: CERT_PATH,
-                    deployWaitTime: DEPLOY_TIME,
-                    description: DESC,
-                    eventHubURL: EH_URL,
-                    invokeWaitTime: WAIT_TIME,
-                    keyValStore: KEY_VAL_STORE,
-                    membershipServicesURL: MS_URL,
-                    peerURL: PEER_URL,
-                    type: 'hlf'
-                }
-            };
-
-            component['version'] = 'v06';
-            component.addConnectionProfile();
-            mockModalSpy.should.have.been.calledWith(EXP);
-        });
+            component.dismiss();
 
-        it('should deal with the version being 1', () => {
-            let EXP = {
-                default: false,
-                name: 'New Profile',
-                profile: {
-                    ca: CA,
-                    channel: CHANNEL,
-                    timeout: TIMEOUT,
-                    description: DESC,
-                    keyValStore: KEY_VAL_STORE,
-                    mspID: MSPID,
-                    orderers: [{url: 'orderers', cert: ''}],
-                    peers: PEERS,
-                    type: 'hlfv1'
-                }
-            };
-
-            component['version'] = 'v1';
-            component.addConnectionProfile();
-            mockModalSpy.should.have.been.calledWith(EXP);
+            spy.should.have.been.calledWith(true);
         });
+    });
 
-        it('should deal with the version being 0.6 and with a certificate just whitespace', () => {
-            component['addConnectionProfileCertificate'] = ' ';
-
-            let EXP = {
-                default: false,
-                name: 'New Profile',
-                profile: {
-                    certificate: ' ',
-                    certificatePath: CERT_PATH,
-                    deployWaitTime: DEPLOY_TIME,
-                    description: DESC,
-                    eventHubURL: EH_URL,
-                    invokeWaitTime: WAIT_TIME,
-                    keyValStore: KEY_VAL_STORE,
-                    membershipServicesURL: MS_URL,
-                    peerURL: PEER_URL,
-                    type: 'hlf'
-                }
-            };
-
-            component['version'] = 'v06';
-            component.addConnectionProfile();
-            mockModalSpy.should.have.been.calledWith(EXP);
-        });
+    describe('#initiateAddToProfile', () => {
+        it('should trigger profileToUse.emit with the connection profile name', () => {
+            component['connectionProfile'] = {name: 'bob'};
+            let spy = sinon.spy(component.profileToUse, 'emit');
 
-        it('should deal with the version being 0.6 and with a certificate with new line char', () => {
-            component['addConnectionProfileCertificate'] = 'bob \n';
+            component.initiateAddToProfile();
 
-            let EXP = {
-                default: false,
-                name: 'New Profile',
-                profile: {
-                    certificate: 'bob \n',
-                    certificatePath: CERT_PATH,
-                    deployWaitTime: DEPLOY_TIME,
-                    description: DESC,
-                    eventHubURL: EH_URL,
-                    invokeWaitTime: WAIT_TIME,
-                    keyValStore: KEY_VAL_STORE,
-                    membershipServicesURL: MS_URL,
-                    peerURL: PEER_URL,
-                    type: 'hlf'
-                }
-            };
-
-            component['version'] = 'v06';
-            component.addConnectionProfile();
-            mockModalSpy.should.have.been.calledWith(EXP);
+            spy.should.have.been.calledWith('bob');
         });
+    });
 
-        it('should deal with the version being 1 with object orderers', () => {
-            component['addConnectionProfileOrderers'] = [{url: 'http://localhost', cert: 'bob'}];
+    describe('#initiateAddWithProfile', () => {
+        it('should trigger profileToEdit.emit with the connection profile', () => {
+            let myProfile = {name: 'bob', penguins : ['pingu', 'poppy']};
+            component['connectionProfile'] = myProfile;
+            let spy = sinon.spy(component.profileToEdit, 'emit');
 
-            let EXP = {
-                default: false,
-                name: 'New Profile',
-                profile: {
-                    ca: CA,
-                    channel: CHANNEL,
-                    timeout: TIMEOUT,
-                    description: DESC,
-                    keyValStore: KEY_VAL_STORE,
-                    mspID: MSPID,
-                    orderers: [{url: 'http://localhost', cert: 'bob'}],
-                    peers: PEERS,
-                    type: 'hlfv1'
-                }
-            };
-
-            component['version'] = 'v1';
-            component.addConnectionProfile();
-            mockModalSpy.should.have.been.calledWith(EXP);
-        });
+            component.initiateAddWithProfile();
 
-        it('should deal with an invalid version', () => {
-            try {
-                component['version'] = 'badversion';
-                component.addConnectionProfile();
-            } catch (e) {
-                e.message.should.contain('Unknown connection profile version selected');
-            }
+            spy.should.have.been.calledWith(myProfile);
         });
     });
+
+    // describe('#createProfile', () => {",,2017-07-28 14:55:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/130032989,https://github.com/hyperledger/composer/pull/1689#discussion_r130032989,cazfletch
https://github.com/hyperledger/composer/pull/1689,https://github.com/hyperledger/composer/pull/1689,Can this be a variable,db1153bd5bc020694c133623c9d17e09259e3713,2017-07-28 08:04:47,130034133,"@@ -1,10 +1,56 @@
 @import '../../../assets/styles/base/colors';
 @import '../../../assets/styles/base/variables';
+@import '../../connection-profile/add-connection-profile/add-connection-profile.component';
 
-add-identity-modal {
-  .add-identity {
-    p {
-      color: $secondary-text;
+.add-identity {
+
+  // Take main styling from add-connection-profile
+  @extend .add-connection;
+
+    .profiles {
+         .create-route {
+            margin-right: 4rem;",,2017-07-28 14:55:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/130034133,https://github.com/hyperledger/composer/pull/1689#discussion_r130034133,cazfletch
https://github.com/hyperledger/composer/pull/1688,https://github.com/hyperledger/composer/pull/1688,"""If your CA requires a name **you must be the object notation** and specify that name."" <--- not sure I get this",f2b05297b0e12210e2034c2e9d028bef0375c85d,2017-07-28 12:27:56,130077742,"@@ -107,6 +107,8 @@ A Connection Profile is used by {{site.data.conrefs.composer_full}} to connect t
         }
 
   - `type` defines the version of {{site.data.conrefs.hlf_full}} that you will connect to. To connect to {{site.data.conrefs.hlf_full}} v1.0 is must be `hlfv1`.
+  - `ca` defines the url for of a {{site.data.conrefs.hlf_full}} Certificate Authority that you will connect to. If your Certificate Authority requires a name you must be the object notation and specify that name.",,2017-07-28 14:56:04,https://api.github.com/repos/hyperledger/composer/pulls/comments/130077742,https://github.com/hyperledger/composer/pull/1688#discussion_r130077742,EdProsser
https://github.com/hyperledger/composer/pull/1688,https://github.com/hyperledger/composer/pull/1688,This bit is fine. :),f2b05297b0e12210e2034c2e9d028bef0375c85d,2017-07-28 12:28:54,130077884,"@@ -107,6 +107,8 @@ A Connection Profile is used by {{site.data.conrefs.composer_full}} to connect t
         }
 
   - `type` defines the version of {{site.data.conrefs.hlf_full}} that you will connect to. To connect to {{site.data.conrefs.hlf_full}} v1.0 is must be `hlfv1`.
+  - `ca` defines the url for of a {{site.data.conrefs.hlf_full}} Certificate Authority that you will connect to. If your Certificate Authority requires a name you must be the object notation and specify that name.
+  - `trustedRoots` and `verify` options for the Certificate Authority are described here https://fabric-sdk-node.github.io/global.html#TLSOptions",,2017-07-28 14:56:04,https://api.github.com/repos/hyperledger/composer/pulls/comments/130077884,https://github.com/hyperledger/composer/pull/1688#discussion_r130077884,EdProsser
https://github.com/hyperledger/composer/pull/1686,https://github.com/hyperledger/composer/pull/1686,"There are a bunch of small changes to make here, but I'll make a note and come back to it later. :)",34ed408542206ba261010f3244aa1202c2257d4e,2017-07-28 12:19:23,130076394,"@@ -0,0 +1,112 @@
+---
+layout: default
+title: Binding an existing identity to a participant
+category: tasks
+section: managing
+sidebar: sidebars/accordion-toc0.md
+excerpt: ""[**An existing identity can be bound to a participant using either the API or the command line**](../managing/identity-issue.html). Once an existing identity has been bound, the identity can then be used by the participant to interact with the business network in the context of that participant.""
+index-order: 704
+---
+
+# Binding an existing identity to a participant
+",12,2017-07-28 14:27:20,https://api.github.com/repos/hyperledger/composer/pulls/comments/130076394,https://github.com/hyperledger/composer/pull/1686#discussion_r130076394,EdProsser
https://github.com/hyperledger/composer/pull/1673,https://github.com/hyperledger/composer/pull/1673,"Is this needed? If not, delete please!",ee30ff5b50c667b9d17de4742781f156511b7697,2017-07-26 18:49:04,129663437,"@@ -112,7 +112,7 @@ class JSONWriter extends Writer {
      * @param {string} value - the value
      */
     writeKeyStringValue(key,value) {
-        this.writeComma();
+        // this.writeComma();",,2017-07-26 19:12:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/129663437,https://github.com/hyperledger/composer/pull/1673#discussion_r129663437,sstone1
https://github.com/hyperledger/composer/pull/1663,https://github.com/hyperledger/composer/pull/1663,Looks like empty string.,6fd0d1799783e23ba9af41b42d315a9956e7be26,2017-07-26 12:25:36,129556393,"@@ -62,52 +69,55 @@ class IdCard {
 
     /**
      * Free text description of the card.
-     * @return {String} description, or {@link undefined} if none exists.
+     * @return {String} card description.
      */
     getDescription() {
-        return this.metadata.description;
-    }
-
-    /**
-     * Business network to which the ID card applies. Generally this will be present but may be omitted for system
-     * cards.
-     * @return {String} description, or {@link undefined} if none exists.",68,2017-07-26 13:17:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/129556393,https://github.com/hyperledger/composer/pull/1663#discussion_r129556393,dselman
https://github.com/hyperledger/composer/pull/1663,https://github.com/hyperledger/composer/pull/1663,Could you take private off please? Need to create these in the playground (currently do the same with business network definitions),6fd0d1799783e23ba9af41b42d315a9956e7be26,2017-07-26 12:48:08,129560914,"@@ -15,37 +15,44 @@
 'use strict';
 
 const JSZip = require('jszip');
-const path = require('path');
 
 const Logger = require('./log/logger');
 const LOG = Logger.getLog('IdCard');
 
 /**
- * An ID card.
+ * An ID card. Encapsulates credentials and other information required to connect to a specific business network
+ * as a specific user.
+ * <p>
+ * Instances of this class should be created using {@link IdCard.fromArchive}.
  * @class
  * @memberof module:composer-common
  */
 class IdCard {
 
     /**
-     * Create the BusinessNetworkDefinition.
+     * Create the IdCard.
      * <p>
      * <strong>Note: Only to be called by framework code. Applications should
      * retrieve instances from {@link IdCard.fromArchive}</strong>
      * @param {Object} metadata - metadata associated with the card.
-     * @param {Object} connection - connection properties associated with the card.
-     * @param {Map} credentials - map of credential filename String keys to credential data Buffer objects.
-     * @param {Map} tlscerts - map of TLS certificate filename String keys to TLS certificate data Buffer objects.
+     * @param {Object} connectionProfile - connection profile associated with the card.
+     * @param {Object} credentials - credentials used to connect to business network.
      * @private",32,2017-07-26 13:17:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/129560914,https://github.com/hyperledger/composer/pull/1663#discussion_r129560914,jt-nti
https://github.com/hyperledger/composer/pull/1659,https://github.com/hyperledger/composer/pull/1659,This bit shouldn't be commented out,2ca9faa3890cc068586894b0d06a31320e14f3c2,2017-07-26 07:19:56,129497003,"@@ -128,9 +128,9 @@ module.exports = (app) => {
 
                 // Remove any prelease versions.
                 // TODO: For prelease/unstable Composer versions, we might want to include these.
-                .filter((version) => {
+                /*.filter((version) => {
                     return semver.prerelease(version) === null;",,2017-07-31 15:29:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/129497003,https://github.com/hyperledger/composer/pull/1659#discussion_r129497003,cazfletch
https://github.com/hyperledger/composer/pull/1659,https://github.com/hyperledger/composer/pull/1659,Why is this commented out?,2ca9faa3890cc068586894b0d06a31320e14f3c2,2017-07-26 07:21:11,129497204,"@@ -3,28 +3,27 @@
         <div class=""flex-container"">
             <h1 class=""flex"">My Wallet</h1>
 
-            <button type=""button"" class=""secondary"" (click)=""addId()"">
+            <!--<button type=""button"" class=""secondary"" (click)=""addId()"">
                 <span>+ Add to Wallet</span>",,2017-07-31 15:29:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/129497204,https://github.com/hyperledger/composer/pull/1659#discussion_r129497204,cazfletch
https://github.com/hyperledger/composer/pull/1659,https://github.com/hyperledger/composer/pull/1659,Can you remove this console.log please,2ca9faa3890cc068586894b0d06a31320e14f3c2,2017-07-31 08:30:48,130296818,"@@ -33,14 +36,28 @@ export class IdentityComponent implements OnInit {
     }
 
     ngOnInit(): Promise<any> {
-        return this.loadIdentities();
+        this.deployedPackageName = this.clientService.getMetaData().getName();
+        return this.loadAllIdentities();
     }
 
-    loadIdentities() {
+    loadAllIdentities() {
+        return this.loadMyIdentities()
+            .then(() => {
+                return this.clientService.ensureConnected();
+            }).then(() => {
+                return this.clientService.getBusinessNetworkConnection().getIdentityRegistry();
+            }).then((registry) => {
+                return registry.getAll();
+            }).then((ids) => {
+                console.log(ids);",,2017-07-31 15:29:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/130296818,https://github.com/hyperledger/composer/pull/1659#discussion_r130296818,cazfletch
https://github.com/hyperledger/composer/pull/1659,https://github.com/hyperledger/composer/pull/1659,Can you test the else on this please?,2ca9faa3890cc068586894b0d06a31320e14f3c2,2017-07-31 08:39:41,130298465,"@@ -17,14 +17,16 @@ export class DeleteComponent implements OnInit {
     }
 
     ngOnInit() {
-        this.fileName = this.deleteFile.displayID;
+        if (!this.fileName) {",5,2017-07-31 15:29:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/130298465,https://github.com/hyperledger/composer/pull/1659#discussion_r130298465,cazfletch
https://github.com/hyperledger/composer/pull/1643,https://github.com/hyperledger/composer/pull/1643,The `sinon-as-promised` require needs to be removed due to the sinon related PR earlier.,54f525fa74965b56a14f4af0c14a66589f7e5589,2017-07-23 15:44:50,128922796,"@@ -0,0 +1,74 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const Admin = require('composer-admin');
+const InstallCmd = require('../../lib/cmds/network/upgradeCommand.js');
+const CmdUtil = require('../../lib/cmds/utils/cmdutils.js');
+
+require('chai').should();
+
+const chai = require('chai');
+const sinon = require('sinon');
+require('sinon-as-promised');",,2017-07-24 10:09:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/128922796,https://github.com/hyperledger/composer/pull/1643#discussion_r128922796,sstone1
https://github.com/hyperledger/composer/pull/1643,https://github.com/hyperledger/composer/pull/1643,"First argument to the logging calls should be `method` - whilst you're here, can you remove the duplicate `LOG.entry` at the top please?",54f525fa74965b56a14f4af0c14a66589f7e5589,2017-07-23 15:46:26,128922829,"@@ -90,6 +90,19 @@ class Engine {
         const method = 'init';
         LOG.entry(method);
         LOG.entry(method, context, fcn, args);
+
+        // chaincode was upgraded, no change to business network and obviously
+        // nothing the runtime can do to stop it.
+        if (fcn === 'upgrade') {
+            LOG.info('runtime has been upgraded');",,2017-07-24 10:09:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/128922829,https://github.com/hyperledger/composer/pull/1643#discussion_r128922829,sstone1
https://github.com/hyperledger/composer/pull/1643,https://github.com/hyperledger/composer/pull/1643,"@sstone1 Thanks Simon, missed that one. Figured I would need to do the sinon as well after seeing yours :-)",54f525fa74965b56a14f4af0c14a66589f7e5589,2017-07-23 18:16:38,128925902,"@@ -90,6 +90,19 @@ class Engine {
         const method = 'init';
         LOG.entry(method);
         LOG.entry(method, context, fcn, args);
+
+        // chaincode was upgraded, no change to business network and obviously
+        // nothing the runtime can do to stop it.
+        if (fcn === 'upgrade') {
+            LOG.info('runtime has been upgraded');",,2017-07-24 10:09:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/128925902,https://github.com/hyperledger/composer/pull/1643#discussion_r128925902,davidkel
https://github.com/hyperledger/composer/pull/1641,https://github.com/hyperledger/composer/pull/1641,This isn't a business network definition,c43d64408c8a1c46cd68fd766be76311c4ee1e78,2017-07-24 09:34:45,128990919,"@@ -0,0 +1,207 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const JSZip = require('jszip');
+const path = require('path');
+
+const Logger = require('./log/logger');
+const LOG = Logger.getLog('IdCard');
+
+/**
+ * An ID card.
+ * @class
+ * @memberof module:composer-common
+ */
+class IdCard {
+
+    /**
+     * Create the BusinessNetworkDefinition.",31,2017-07-24 09:41:55,https://api.github.com/repos/hyperledger/composer/pulls/comments/128990919,https://github.com/hyperledger/composer/pull/1641#discussion_r128990919,jt-nti
https://github.com/hyperledger/composer/pull/1637,https://github.com/hyperledger/composer/pull/1637,why do you need the ngif on both of thses?,8db3ec8bd07b5077745b9e091c786d05c79c9ea3,2017-07-24 16:32:00,129086732,"@@ -1,17 +1,22 @@
-<section *ngIf=""!editingConectionProfile"" class=""header"">
-    My Wallet
-</section>
 <section *ngIf=""!editingConectionProfile"" class=""main-view"">
+    <header *ngIf=""!editingConectionProfile"" class=""flex-container"">",,2017-07-24 16:46:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/129086732,https://github.com/hyperledger/composer/pull/1637#discussion_r129086732,cazfletch
https://github.com/hyperledger/composer/pull/1637,https://github.com/hyperledger/composer/pull/1637,shouldn't this go in the common styles?,8db3ec8bd07b5077745b9e091c786d05c79c9ea3,2017-07-24 16:37:42,129088180,"@@ -24,13 +20,26 @@ app-login {
             .connection-profile-buttons {
                 display: inline-block;
                 margin-left: $space-medium;
+
+                button {
+                    &.action.circular:hover,",17,2017-07-24 16:46:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/129088180,https://github.com/hyperledger/composer/pull/1637#discussion_r129088180,cazfletch
https://github.com/hyperledger/composer/pull/1637,https://github.com/hyperledger/composer/pull/1637,Ooops,8db3ec8bd07b5077745b9e091c786d05c79c9ea3,2017-07-24 16:39:40,129088647,"@@ -1,17 +1,22 @@
-<section *ngIf=""!editingConectionProfile"" class=""header"">
-    My Wallet
-</section>
 <section *ngIf=""!editingConectionProfile"" class=""main-view"">
+    <header *ngIf=""!editingConectionProfile"" class=""flex-container"">",,2017-07-24 16:46:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/129088647,https://github.com/hyperledger/composer/pull/1637#discussion_r129088647,jt-nti
https://github.com/hyperledger/composer/pull/1637,https://github.com/hyperledger/composer/pull/1637,The common style works for a light background and I couldn't think of a nice way to handle this with a common style,8db3ec8bd07b5077745b9e091c786d05c79c9ea3,2017-07-24 16:47:30,129090639,"@@ -24,13 +20,26 @@ app-login {
             .connection-profile-buttons {
                 display: inline-block;
                 margin-left: $space-medium;
+
+                button {
+                    &.action.circular:hover,",17,2017-07-24 16:47:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/129090639,https://github.com/hyperledger/composer/pull/1637#discussion_r129090639,jt-nti
https://github.com/hyperledger/composer/pull/1631,https://github.com/hyperledger/composer/pull/1631,Why is this change needed? The `.then` and the `.catch` are redundant and can be removed anyway.,126549636942822aa7041e0373b0fff32647ef0f,2017-07-22 08:01:13,128892163,"@@ -26,12 +26,12 @@ module.exports.builder = {
 };
 
 module.exports.handler = (argv) => {
-    argv.thePromise =  Import.handler(argv)
+    argv.thePromise = Import.handler(argv)
     .then(() => {
         return;
     })
     .catch((error) => {
-        throw error;
+        throw new Error(error);",,2017-07-23 09:23:04,https://api.github.com/repos/hyperledger/composer/pulls/comments/128892163,https://github.com/hyperledger/composer/pull/1631#discussion_r128892163,sstone1
https://github.com/hyperledger/composer/pull/1631,https://github.com/hyperledger/composer/pull/1631,"Again, why do we need these `new Error(error)` changes?",126549636942822aa7041e0373b0fff32647ef0f,2017-07-22 08:02:07,128892173,"@@ -70,7 +70,7 @@ class HFCWalletProxy {
             })
             .catch((error) => {
                 LOG.debug(method, error);
-                return cb(error);
+                return cb(new Error(error));",,2017-07-23 09:23:04,https://api.github.com/repos/hyperledger/composer/pulls/comments/128892173,https://github.com/hyperledger/composer/pull/1631#discussion_r128892173,sstone1
https://github.com/hyperledger/composer/pull/1631,https://github.com/hyperledger/composer/pull/1631,"Again, why do we need these `new Error(error)` changes?",126549636942822aa7041e0373b0fff32647ef0f,2017-07-22 08:02:11,128892175,"@@ -100,7 +100,7 @@ class HFCWalletProxy {
             })
             .catch((error) => {
                 LOG.error(method, error);
-                return cb(error);
+                return cb(new Error(error));",,2017-07-23 09:23:04,https://api.github.com/repos/hyperledger/composer/pulls/comments/128892175,https://github.com/hyperledger/composer/pull/1631#discussion_r128892175,sstone1
https://github.com/hyperledger/composer/pull/1631,https://github.com/hyperledger/composer/pull/1631,These tests don't require sinon at all.,126549636942822aa7041e0373b0fff32647ef0f,2017-07-22 08:04:07,128892192,"@@ -18,17 +18,19 @@ const DataService = require('composer-runtime').DataService;
 const WebDataService = require('..').WebDataService;
 
 require('chai').should();
+const sinon = require('sinon');
 
 describe('WebDataService', () => {
 
+    let sandbox;
     let dataService;
 
     beforeEach(() => {
-        dataService = new WebDataService('3a4b69c9-239c-4e3d-9c33-9c24d2bdbb1c');
+        sandbox = sinon.sandbox.create();",,2017-07-23 09:23:04,https://api.github.com/repos/hyperledger/composer/pulls/comments/128892192,https://github.com/hyperledger/composer/pull/1631#discussion_r128892192,sstone1
https://github.com/hyperledger/composer/pull/1631,https://github.com/hyperledger/composer/pull/1631,"Again, why do we need these `new Error(error)` changes?",126549636942822aa7041e0373b0fff32647ef0f,2017-07-22 08:04:30,128892195,"@@ -393,7 +393,7 @@ class HLFConnectionManager extends ConnectionManager {
             })
             .catch((error) => {
                 LOG.error(method, error);
-                throw error;
+                throw new Error(error);",,2017-07-23 09:23:04,https://api.github.com/repos/hyperledger/composer/pulls/comments/128892195,https://github.com/hyperledger/composer/pull/1631#discussion_r128892195,sstone1
https://github.com/hyperledger/composer/pull/1631,https://github.com/hyperledger/composer/pull/1631,"Again, why do we need these `new Error(error)` changes?",126549636942822aa7041e0373b0fff32647ef0f,2017-07-22 08:04:34,128892197,"@@ -74,7 +74,7 @@ class HLFWalletProxy extends KeyValueStore {
             })
             .catch((error) => {
                 LOG.error(method, error);
-                throw error;
+                throw new Error(error);",,2017-07-23 09:23:04,https://api.github.com/repos/hyperledger/composer/pulls/comments/128892197,https://github.com/hyperledger/composer/pull/1631#discussion_r128892197,sstone1
https://github.com/hyperledger/composer/pull/1631,https://github.com/hyperledger/composer/pull/1631,"Again, why do we need these `new Error(error)` changes?",126549636942822aa7041e0373b0fff32647ef0f,2017-07-22 08:04:37,128892199,"@@ -101,7 +101,7 @@ class HLFWalletProxy extends KeyValueStore {
             })
             .catch((error) => {
                 LOG.error(method, error);
-                throw error;
+                throw new Error(error);",,2017-07-23 09:23:04,https://api.github.com/repos/hyperledger/composer/pulls/comments/128892199,https://github.com/hyperledger/composer/pull/1631#discussion_r128892199,sstone1
https://github.com/hyperledger/composer/pull/1631,https://github.com/hyperledger/composer/pull/1631,fixed in updated commits,126549636942822aa7041e0373b0fff32647ef0f,2017-07-23 10:19:27,128915419,"@@ -18,17 +18,19 @@ const DataService = require('composer-runtime').DataService;
 const WebDataService = require('..').WebDataService;
 
 require('chai').should();
+const sinon = require('sinon');
 
 describe('WebDataService', () => {
 
+    let sandbox;
     let dataService;
 
     beforeEach(() => {
-        dataService = new WebDataService('3a4b69c9-239c-4e3d-9c33-9c24d2bdbb1c');
+        sandbox = sinon.sandbox.create();",,2017-07-23 10:19:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/128915419,https://github.com/hyperledger/composer/pull/1631#discussion_r128915419,aietcn
https://github.com/hyperledger/composer/pull/1609,https://github.com/hyperledger/composer/pull/1609,"Just checking, should it say ""David"" here ?",9c7b51d66d34f796c7e6fb4209565d1cdc24832c,2017-07-19 16:36:16,128300050,"@@ -34,7 +34,7 @@ The config module does write out a warning, if there are no configuration files
 - advice: set loglevel to debug on deploy because if deploy breaks you want the logs.
 
 
-## {{site.data.conrefs.hlf_full}} RC1 - David",4,2017-07-19 16:54:09,https://api.github.com/repos/hyperledger/composer/pulls/comments/128300050,https://github.com/hyperledger/composer/pull/1609#discussion_r128300050,davidkel
https://github.com/hyperledger/composer/pull/1609,https://github.com/hyperledger/composer/pull/1609,Yeah that's commented out. :),9c7b51d66d34f796c7e6fb4209565d1cdc24832c,2017-07-19 16:36:42,128300152,"@@ -34,7 +34,7 @@ The config module does write out a warning, if there are no configuration files
 - advice: set loglevel to debug on deploy because if deploy breaks you want the logs.
 
 
-## {{site.data.conrefs.hlf_full}} RC1 - David",4,2017-07-19 16:54:09,https://api.github.com/repos/hyperledger/composer/pulls/comments/128300152,https://github.com/hyperledger/composer/pull/1609#discussion_r128300152,EdProsser
https://github.com/hyperledger/composer/pull/1609,https://github.com/hyperledger/composer/pull/1609,"probably just say ""peer"" rather than ""blockchain peer"" ",9c7b51d66d34f796c7e6fb4209565d1cdc24832c,2017-07-19 16:37:40,128300406,"@@ -56,6 +56,14 @@ Test the connection to a deployed a Business Network: [composer network ping](./
 
 Update a deployed Business Network: [composer network update](./composer.network.update.md)
 
+`composer network start`
+
+Deploy a business network archive to a peer that already has the {{site.data.conrefs.composer_full}} runtime installed: [composer network start](./composer.network.start.md)
+
+`composer runtime install`
+
+Install the {{site.data.conrefs.composer_full}} runtime to a blockchain peer: [composer runtime install](./composer.runtime.install.md)",,2017-07-19 16:54:09,https://api.github.com/repos/hyperledger/composer/pulls/comments/128300406,https://github.com/hyperledger/composer/pull/1609#discussion_r128300406,davidkel
https://github.com/hyperledger/composer/pull/1609,https://github.com/hyperledger/composer/pull/1609,"I think we should say ""composer network start will start the provided business network from the archive provided""

I've seen multiple definitions of a peer
- peer
- blockchain peer
- blockchain network peers
I think we should be consistent. If you use the term peer, that is a hyperledger fabric specific term so maybe we should qualify that for all uses of the word peer",9c7b51d66d34f796c7e6fb4209565d1cdc24832c,2017-07-19 16:39:46,128300869,"@@ -0,0 +1,67 @@
+---
+layout: default
+title: Hyperledger Composer Network Start CLI
+section: reference-command
+sidebar: sidebars/accordion-toc0.md
+excerpt: Composer Network Start
+---
+
+# {{site.data.conrefs.composer_full}} Network Start
+
+---
+
+The `composer network start` utility is used to deploy a business network archive from local disk to blockchain network peers.",,2017-07-19 16:54:09,https://api.github.com/repos/hyperledger/composer/pulls/comments/128300869,https://github.com/hyperledger/composer/pull/1609#discussion_r128300869,davidkel
https://github.com/hyperledger/composer/pull/1609,https://github.com/hyperledger/composer/pull/1609,What would be a better general term?,9c7b51d66d34f796c7e6fb4209565d1cdc24832c,2017-07-19 16:43:07,128301603,"@@ -0,0 +1,67 @@
+---
+layout: default
+title: Hyperledger Composer Network Start CLI
+section: reference-command
+sidebar: sidebars/accordion-toc0.md
+excerpt: Composer Network Start
+---
+
+# {{site.data.conrefs.composer_full}} Network Start
+
+---
+
+The `composer network start` utility is used to deploy a business network archive from local disk to blockchain network peers.",,2017-07-19 16:54:09,https://api.github.com/repos/hyperledger/composer/pulls/comments/128301603,https://github.com/hyperledger/composer/pull/1609#discussion_r128301603,EdProsser
https://github.com/hyperledger/composer/pull/1609,https://github.com/hyperledger/composer/pull/1609,"so here we have the term endorsing peer, again this is a hyperledger fabric specific term ""endorsing"". 
You would only be interested in installing the runtime on ""endorsing peers"" which would then be started with a business network.",9c7b51d66d34f796c7e6fb4209565d1cdc24832c,2017-07-19 16:45:24,128302129,"@@ -0,0 +1,34 @@
+---
+layout: default
+title: Hyperledger Composer Runtime Start CLI
+section: reference-command
+sidebar: sidebars/accordion-toc0.md
+excerpt: Composer Runtime Install
+---
+
+# {{site.data.conrefs.composer_full}} Runtime Install
+
+---
+
+The `composer runtime install` command is used to install the {{site.data.conrefs.composer_full}} runtime on the endorsing peers of the blockchain network you are connecting to. This command must be run before the `composer network start` command.",,2017-07-19 16:54:09,https://api.github.com/repos/hyperledger/composer/pulls/comments/128302129,https://github.com/hyperledger/composer/pull/1609#discussion_r128302129,davidkel
https://github.com/hyperledger/composer/pull/1606,https://github.com/hyperledger/composer/pull/1606,Fabric v1 is now GA,577efc446ca5aff497014f93053abfe90193a202,2017-07-19 12:27:17,128230741,"@@ -22,7 +22,7 @@ For example:
 
 To update the definition of an already deployed business network use the `composer network update` CLI command.
 
-## Deploying business networks to {{site.data.conrefs.hlf_full}} v1.0 RC 1
+## Deploying business networks to {{site.data.conrefs.hlf_full}} RC 1",5,2017-07-19 12:27:17,https://api.github.com/repos/hyperledger/composer/pulls/comments/128230741,https://github.com/hyperledger/composer/pull/1606#discussion_r128230741,mbwhite
https://github.com/hyperledger/composer/pull/1606,https://github.com/hyperledger/composer/pull/1606,I'll change that in another PR incoming today. ^^,577efc446ca5aff497014f93053abfe90193a202,2017-07-19 12:33:11,128231970,"@@ -22,7 +22,7 @@ For example:
 
 To update the definition of an already deployed business network use the `composer network update` CLI command.
 
-## Deploying business networks to {{site.data.conrefs.hlf_full}} v1.0 RC 1
+## Deploying business networks to {{site.data.conrefs.hlf_full}} RC 1",5,2017-07-19 12:33:11,https://api.github.com/repos/hyperledger/composer/pulls/comments/128231970,https://github.com/hyperledger/composer/pull/1606#discussion_r128231970,EdProsser
https://github.com/hyperledger/composer/pull/1583,https://github.com/hyperledger/composer/pull/1583,Needs changing for 0.10.0.,bd70c56d93a2b27753742b77af064620a1bdd82f,2017-07-18 05:21:27,127884535,"@@ -11,6 +11,9 @@
 #
 # Note that the latest public API is documented using JSDocs and is available in api.txt.
 #
+Version 0.9.3 {3af411e8da53bb013ab9718ed5980c20} 2017-07-17",,2017-07-18 21:36:17,https://api.github.com/repos/hyperledger/composer/pulls/comments/127884535,https://github.com/hyperledger/composer/pull/1583#discussion_r127884535,sstone1
https://github.com/hyperledger/composer/pull/1583,https://github.com/hyperledger/composer/pull/1583,Case needs to be fixed - `Hyperledger Composer`.,bd70c56d93a2b27753742b77af064620a1bdd82f,2017-07-18 05:21:55,127884579,"@@ -88,6 +88,32 @@ class Connection extends EventEmitter {
     }
 
     /**
+     * Install the hyperledger composer runtime.",,2017-07-18 21:36:17,https://api.github.com/repos/hyperledger/composer/pulls/comments/127884579,https://github.com/hyperledger/composer/pull/1583#discussion_r127884579,sstone1
https://github.com/hyperledger/composer/pull/1583,https://github.com/hyperledger/composer/pull/1583,Think I need to version bump first before I can change this.,bd70c56d93a2b27753742b77af064620a1bdd82f,2017-07-18 06:30:44,127891507,"@@ -11,6 +11,9 @@
 #
 # Note that the latest public API is documented using JSDocs and is available in api.txt.
 #
+Version 0.9.3 {3af411e8da53bb013ab9718ed5980c20} 2017-07-17",,2017-07-18 21:36:17,https://api.github.com/repos/hyperledger/composer/pulls/comments/127891507,https://github.com/hyperledger/composer/pull/1583#discussion_r127891507,davidkel
https://github.com/hyperledger/composer/pull/1583,https://github.com/hyperledger/composer/pull/1583,"Good point, Thanks",bd70c56d93a2b27753742b77af064620a1bdd82f,2017-07-18 06:30:55,127891530,"@@ -88,6 +88,32 @@ class Connection extends EventEmitter {
     }
 
     /**
+     * Install the hyperledger composer runtime.",,2017-07-18 21:36:17,https://api.github.com/repos/hyperledger/composer/pulls/comments/127891530,https://github.com/hyperledger/composer/pull/1583#discussion_r127891530,davidkel
https://github.com/hyperledger/composer/pull/1581,https://github.com/hyperledger/composer/pull/1581,Wheeeeeeey conflicts!,fc6af41167f4990e358af647cdd43902831e3cef,2017-07-17 15:23:13,127738748,"@@ -47,21 +47,30 @@ The `--option, -o` option and the `--optionsFile, -O` option allow connection sp
 
 - Using the `-o` option, the endorsement policy can be sent as a single-line JSON string as follows:
 
+<<<<<<< HEAD
+        composer network deploy -o endorsementPolicy='{""endorsementPolicy"": {""identities"": [.... }'
+=======
         composer network deploy -o endorsementPolicy='{""identities"": [.... }'
+>>>>>>> hyperledger/master
 
 - Using the `-o` option, the endorsement policy can be sent as a file path as follows:
 
         composer network deploy -o endorsementPolicyFile=/path/to/file/endorsementPolicy.json
 
+<<<<<<< HEAD
+=======
 	In this case, the endorsement policy file should follow this format:
 
 		{""identities"":[...],
 			""policy"": {...}}
 
+>>>>>>> hyperledger/master
 - Using the `-O` option, the endorsement policy can be sent as a file path as follows:
 
         composer network deploy -O /path/to/file/options.json
 
+<<<<<<< HEAD
+=======
 	In this case, the options file should follow this format:
 ",38,2017-07-17 15:24:37,https://api.github.com/repos/hyperledger/composer/pulls/comments/127738748,https://github.com/hyperledger/composer/pull/1581#discussion_r127738748,EdProsser
https://github.com/hyperledger/composer/pull/1580,https://github.com/hyperledger/composer/pull/1580,Remove useless commented code!,a305c0809761308f98c3646ada0f06af924fc5a0,2017-07-17 08:58:24,127658913,"@@ -141,10 +169,10 @@ class EngineBusinessNetworks {
 
                 // Get the sysdata collection where the business network definition is stored.
                 LOG.debug(method, 'Loaded business network definition, storing in $sysdata collection');
-                return dataService.getCollection('$sysdata');
+                //     return dataService.getCollection('$sysdata');
 
-            })
-            .then((sysdata) => {
+                // })
+                // .then((sysdata) => {",,2017-07-17 15:27:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/127658913,https://github.com/hyperledger/composer/pull/1580#discussion_r127658913,sstone1
https://github.com/hyperledger/composer/pull/1580,https://github.com/hyperledger/composer/pull/1580,Remove useless commented code!,a305c0809761308f98c3646ada0f06af924fc5a0,2017-07-17 08:58:33,127658935,"@@ -89,22 +98,42 @@ class RegistryManager extends EventEmitter {
             .then(() => {
                 return assetDeclarations.reduce((result, assetDeclaration) => {
                     let fqn = assetDeclaration.getFullyQualifiedName();
-                    if (force) {
-                        return this.add('Asset', fqn, `Asset registry for ${fqn}`, true);
-                    } else {
-                        return this.ensure('Asset', fqn, `Asset registry for ${fqn}`);
+                    if (!assetDeclaration.isSystemType()) {
+                        if (force) {
+                            return this.add('Asset', fqn, `Asset registry for ${fqn}`, true);
+                        } else {
+                            return this.ensure('Asset', fqn, `Asset registry for ${fqn}`);
+                        }
                     }
                 }, Promise.resolve());
             })
             .then(() => {
                 return participantDeclarations.reduce((result, participantDeclaration) => {
                     let fqn = participantDeclaration.getFullyQualifiedName();
-                    if (force) {
-                        return this.add('Participant', fqn, `Participant registry for ${fqn}`, true);
-                    } else {
-                        return this.ensure('Participant', fqn, `Participant registry for ${fqn}`);
+                    if (!participantDeclaration.isSystemType()) {
+                        if (force) {
+                            return this.add('Participant', fqn, `Participant registry for ${fqn}`, true);
+                        } else {
+                            return this.ensure('Participant', fqn, `Participant registry for ${fqn}`);
+                        }
                     }
                 }, Promise.resolve());
+            }).then(() => {
+                // FUTURE:
+                // let file = ['namespace org.composer.runtime', 'import org.hyperledger.composer.system.AssetRegistry'];
+
+                // let runtimeModel = assetDeclarations.reduce((result, assetDeclaration) => {
+                //     let fqn = assetDeclaration.getName();
+                //     if (!assetDeclaration.isSystemType()) {
+                //         result.push('asset ' + fqn + 'Registry extends AssetRegistry {}');
+                //     }
+
+                //     return result;
+                // }, file);
+                // LOG.debug('createDefaults', runtimeModel.join('\n'));
+                // // console.log(runtimeModel.join('\n'));
+                // this.introspector.getModelManager().addModelFile(runtimeModel.join('\n'));
+                return;",,2017-07-17 15:27:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/127658935,https://github.com/hyperledger/composer/pull/1580#discussion_r127658935,sstone1
https://github.com/hyperledger/composer/pull/1580,https://github.com/hyperledger/composer/pull/1580,Remove useless commented code!,a305c0809761308f98c3646ada0f06af924fc5a0,2017-07-17 08:58:39,127658958,"@@ -142,13 +180,46 @@ class RegistryManager extends EventEmitter {
      */
     get(type, id) {
         let collectionID = type + ':' + id;
+        let resource;
+        let simpledata;
+        LOG.entry('get', collectionID);
+
+        // go to the sysregistries datacollection and get the 'resource' for the registry we are interested in
         return this.sysregistries.get(collectionID)
-            .then((registry) => {
-                return this.dataService.getCollection(collectionID)
-                    .then((dataCollection) => {
-                        return this.createRegistry(dataCollection, this.serializer, this.accessController, registry.type, registry.id, registry.name);
-                    });
+            .then((result) => {
+                simpledata = result;
+                // do we have permission to be looking at this??
+                resource = this.serializer.fromJSON(result);
+                return this.accessController.check(resource, 'READ');
+            })
+            .then(() => {
+                // if we got here then, we the accessController.check was OK, get the dataCollection with the actual information
+                // for the require registry
+                return this.dataService.getCollection(collectionID);
+            }).then((dataCollection) => {
+                // and form up the actual registry object
+                // TODO: Does this really need to take the the 3 parametrs type,registryID and name??
+                // TODO: this really doens't seem right
+                return this.createRegistry(dataCollection, this.serializer, this.accessController, simpledata.type, simpledata.registryID, simpledata.name);
             });
+
+        // let regType = TYPE_MAP[type];
+        // let r = {
+        //     '$class': regType,
+        //     'registryID': id,
+        //     'type': type
+        // };
+        // // go to the sysregistries datacollection and get the 'resource' for the registry we are interested in
+        // let resource = this.serializer.fromJSON(r);
+        // return this.accessController.check(resource, 'READ').then(() => {
+        //     return this.sysregistries.get(collectionID);
+        // })
+        //     .then((registry) => {
+        //         return this.dataService.getCollection(collectionID)
+        //             .then((dataCollection) => {
+        //                 return this.createRegistry(dataCollection, this.serializer, this.accessController, registry.type, registry.registryID, registry.name);
+        //             });
+        //     });",,2017-07-17 15:27:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/127658958,https://github.com/hyperledger/composer/pull/1580#discussion_r127658958,sstone1
https://github.com/hyperledger/composer/pull/1580,https://github.com/hyperledger/composer/pull/1580,Is this file meant to have been added? I can't see it referenced anywhere.,a305c0809761308f98c3646ada0f06af924fc5a0,2017-07-17 08:59:31,127659119,"@@ -0,0 +1,23 @@
+#!/bin/bash
+
+# Exit on first error, print all commands.
+set -ev
+
+# Grab the Composer directory.
+DIR=""$( cd ""$( dirname ""${BASH_SOURCE[0]}"" )/.."" && pwd )""
+
+# Check for the system tests.
+case ${TEST_SUITE} in
+system*)
+    echo Not executing as running system tests.
+    exit 0
+    ;;
+esac
+
+echo $(date) Generating documentation.js
+echo $DIR
+#documentation build -f md --output ~/github/composer/packages/composer-website/out/common-api.md ~/github/composer/packages/composer-common/lib/**
+documentation build --format md --output ""$DIR/out/composer-client.md"" ""$DIR/node_modules/composer-client/lib/**""
+#documentation build --format md --output ""$DIR/out/common-admin.md"" ""$DIR/node_modules/composer-admin/lib/**""
+#documentation build --format md --output ""$DIR/out/common-runtime.md"" ""$DIR/node_modules/composer-runtime/lib/**""
+",,2017-07-17 15:27:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/127659119,https://github.com/hyperledger/composer/pull/1580#discussion_r127659119,sstone1
https://github.com/hyperledger/composer/pull/1580,https://github.com/hyperledger/composer/pull/1580,"We have a mix of `Id` and `ID` in this file - can we go with `Id` everywhere since that is what we use already.
The Transaction base type is also missing an `identified by`.
Registry should be abstract.
And I would be in favour of removing the Identity related stuff until I get the identity registry changes in on top.",a305c0809761308f98c3646ada0f06af924fc5a0,2017-07-17 09:05:50,127660194,"@@ -41,3 +41,7 @@ asset Identity identified by userID {
   o Boolean activated
   o Boolean revoked
 }
+
+asset Network identified by networkID {",,2017-07-17 15:27:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/127660194,https://github.com/hyperledger/composer/pull/1580#discussion_r127660194,sstone1
https://github.com/hyperledger/composer/pull/1580,https://github.com/hyperledger/composer/pull/1580,Remove identity related stuff.,a305c0809761308f98c3646ada0f06af924fc5a0,2017-07-17 09:07:00,127660390,"@@ -21,13 +21,22 @@ const ParticipantDeclaration = require('composer-common').ParticipantDeclaration
 const Registry = require('./registry');
 
 const LOG = Logger.getLog('RegistryManager');
+const TYPE_MAP = {
+    'Asset': 'org.hyperledger.composer.system.AssetRegistry',
+    'Participant': 'org.hyperledger.composer.system.ParticipantRegistry',
+    'Transaction': 'org.hyperledger.composer.system.TransactionRegistry',
+    'Identity': 'org.hyperledger.composer.system.IdentityRegistry'",,2017-07-17 15:27:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/127660390,https://github.com/hyperledger/composer/pull/1580#discussion_r127660390,sstone1
https://github.com/hyperledger/composer/pull/1580,https://github.com/hyperledger/composer/pull/1580,Would be better to use the Factory and newResource here.,a305c0809761308f98c3646ada0f06af924fc5a0,2017-07-17 09:07:49,127660511,"@@ -160,10 +231,34 @@ class RegistryManager extends EventEmitter {
      */
     exists(type, id) {
         let collectionID = type + ':' + id;
-        return this.sysregistries.exists(collectionID)
-            .then((exists) => {
-                return exists;
+        let resource;
+
+        // firstly form up a 'fake' object to test IF one did exist, would you in theory
+        // be able to see it?
+        let regType = TYPE_MAP[type];
+        let r = {
+            '$class': regType,
+            'registryID': id,
+            'type': type
+        };
+
+        let litmusResource = this.serializer.fromJSON(r);",,2017-07-17 15:27:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/127660511,https://github.com/hyperledger/composer/pull/1580#discussion_r127660511,sstone1
https://github.com/hyperledger/composer/pull/1580,https://github.com/hyperledger/composer/pull/1580,Would be better to use the Factory and newResource here.,a305c0809761308f98c3646ada0f06af924fc5a0,2017-07-17 09:08:13,127660582,"@@ -188,12 +283,37 @@ class RegistryManager extends EventEmitter {
      */
     add(type, id, name, force) {
         let collectionID = type + ':' + id;
-        return this.sysregistries.add(collectionID, { type: type, id: id, name: name }, force)
+
+        // This map should be sufficient I hope!
+        let regType = TYPE_MAP[type];
+        let r = {
+            '$class': regType,
+            'registryID': id,
+            'type': type,
+            'name': name
+        };
+
+        LOG.debug('add', 'Creating new registry ', r.type, r.name, r.id);
+
+        // form this up into a resource and check if we are able to create this.
+        let resource = this.serializer.fromJSON(r);",,2017-07-17 15:27:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/127660582,https://github.com/hyperledger/composer/pull/1580#discussion_r127660582,sstone1
https://github.com/hyperledger/composer/pull/1580,https://github.com/hyperledger/composer/pull/1580,done,a305c0809761308f98c3646ada0f06af924fc5a0,2017-07-17 09:22:09,127663044,"@@ -141,10 +169,10 @@ class EngineBusinessNetworks {
 
                 // Get the sysdata collection where the business network definition is stored.
                 LOG.debug(method, 'Loaded business network definition, storing in $sysdata collection');
-                return dataService.getCollection('$sysdata');
+                //     return dataService.getCollection('$sysdata');
 
-            })
-            .then((sysdata) => {
+                // })
+                // .then((sysdata) => {",,2017-07-17 15:27:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/127663044,https://github.com/hyperledger/composer/pull/1580#discussion_r127663044,mbwhite
https://github.com/hyperledger/composer/pull/1580,https://github.com/hyperledger/composer/pull/1580,bleed-over from another branch.. gone.,a305c0809761308f98c3646ada0f06af924fc5a0,2017-07-17 09:25:39,127663726,"@@ -0,0 +1,23 @@
+#!/bin/bash
+
+# Exit on first error, print all commands.
+set -ev
+
+# Grab the Composer directory.
+DIR=""$( cd ""$( dirname ""${BASH_SOURCE[0]}"" )/.."" && pwd )""
+
+# Check for the system tests.
+case ${TEST_SUITE} in
+system*)
+    echo Not executing as running system tests.
+    exit 0
+    ;;
+esac
+
+echo $(date) Generating documentation.js
+echo $DIR
+#documentation build -f md --output ~/github/composer/packages/composer-website/out/common-api.md ~/github/composer/packages/composer-common/lib/**
+documentation build --format md --output ""$DIR/out/composer-client.md"" ""$DIR/node_modules/composer-client/lib/**""
+#documentation build --format md --output ""$DIR/out/common-admin.md"" ""$DIR/node_modules/composer-admin/lib/**""
+#documentation build --format md --output ""$DIR/out/common-runtime.md"" ""$DIR/node_modules/composer-runtime/lib/**""
+",,2017-07-17 15:27:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/127663726,https://github.com/hyperledger/composer/pull/1580#discussion_r127663726,mbwhite
https://github.com/hyperledger/composer/pull/1580,https://github.com/hyperledger/composer/pull/1580,I'll remove this in my PR ðŸ˜‰ ,a305c0809761308f98c3646ada0f06af924fc5a0,2017-07-17 16:41:39,127759039,"@@ -203,6 +203,7 @@ const bfs_fs = BrowserFS.BFSRequire('fs');
                 return businessNetworkConnection.connect('defaultProfile', 'bond-network', 'admin', 'Xurw3yU9zI0l');
             })
             .then(() => {
+                console.log('getting bondasset');",4,2017-07-17 16:41:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/127759039,https://github.com/hyperledger/composer/pull/1580#discussion_r127759039,sstone1
https://github.com/hyperledger/composer/pull/1580,https://github.com/hyperledger/composer/pull/1580,Argh more commented code! I'll remove this in my PR ðŸ˜‰ ,a305c0809761308f98c3646ada0f06af924fc5a0,2017-07-17 16:43:22,127759486,"@@ -188,16 +254,42 @@ class RegistryManager extends EventEmitter {
      */
     add(type, id, name, force) {
         let collectionID = type + ':' + id;
-        return this.sysregistries.add(collectionID, { type: type, id: id, name: name }, force)
+
+        // This map should be sufficient I hope!",197,2017-07-17 16:43:22,https://api.github.com/repos/hyperledger/composer/pulls/comments/127759486,https://github.com/hyperledger/composer/pull/1580#discussion_r127759486,sstone1
https://github.com/hyperledger/composer/pull/1580,https://github.com/hyperledger/composer/pull/1580,Argh more commented code! I'll remove this in my PR ðŸ˜‰ ,a305c0809761308f98c3646ada0f06af924fc5a0,2017-07-17 16:43:36,127759550,"@@ -160,10 +201,35 @@ class RegistryManager extends EventEmitter {
      */
     exists(type, id) {
         let collectionID = type + ':' + id;
-        return this.sysregistries.exists(collectionID)
-            .then((exists) => {
-                return exists;
+        let resource;
+
+        // firstly form up a 'fake' object to test IF one did exist, would you in theory",152,2017-07-17 16:43:36,https://api.github.com/repos/hyperledger/composer/pulls/comments/127759550,https://github.com/hyperledger/composer/pull/1580#discussion_r127759550,sstone1
https://github.com/hyperledger/composer/pull/1573,https://github.com/hyperledger/composer/pull/1573,Please remove dead code,fa5f69a0ee6f350da74203f68d164bc91c463fed,2017-07-20 13:00:25,128507430,"@@ -55,7 +55,7 @@ describe('ClassDeclaration', () => {
             const modelFile = new ModelFile(modelManager, modelDefinitions);
             modelFiles.push(modelFile);
         }
-        modelManager.addModelFiles(modelFiles, modelFileNames);
+        //modelManager.addModelFiles(modelFiles, modelFileNames);",5,2017-07-21 07:09:48,https://api.github.com/repos/hyperledger/composer/pulls/comments/128507430,https://github.com/hyperledger/composer/pull/1573#discussion_r128507430,dselman
https://github.com/hyperledger/composer/pull/1553,https://github.com/hyperledger/composer/pull/1553,This is a bit weird - we could just use `Registry.getRegistry` instead of getting all of them and filtering!,5b087587a0e22f42152e70b07341d860da5bef4c,2017-07-13 18:16:39,127291899,"@@ -0,0 +1,148 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const Registry = require('./registry');
+const Util = require('composer-common').Util;
+
+const REGISTRY_TYPE = 'Asset';
+
+/**
+ * The IdentityRegistry is used to store a set of identities on the blockchain.
+ * <p><a href=""./diagrams/identityregistry.svg""><img src=""./diagrams/identityregistry.svg"" style=""height:100%;""/></a></p>
+ * @extends Registry
+ * @see See [Registry]{@link module:composer-client.Registry}
+ * @class
+ * @memberof module:composer-client
+ */
+class IdentityRegistry extends Registry {
+
+    /**
+     * Get an existing identity registry.
+     *
+     * @param {SecurityContext} securityContext The user's security context.
+     * @param {ModelManager} modelManager The ModelManager to use for this identity registry.
+     * @param {Factory} factory The factory to use for this identity registry.
+     * @param {Serializer} serializer The Serializer to use for this identity registry.
+     * @return {Promise} A promise that will be resolved with a {@link IdentityRegistry}
+     * instance representing the identity registry.
+     */
+    static getIdentityRegistry(securityContext, modelManager, factory, serializer) {
+        Util.securityCheck(securityContext);
+        if (!modelManager) {
+            throw new Error('modelManager not specified');
+        } else if (!factory) {
+            throw new Error('factory not specified');
+        } else if (!serializer) {
+            throw new Error('serializer not specified');
+        }
+        return Registry.getAllRegistries(securityContext, REGISTRY_TYPE)",51,2017-07-13 18:16:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/127291899,https://github.com/hyperledger/composer/pull/1553#discussion_r127291899,sstone1
https://github.com/hyperledger/composer/pull/1553,https://github.com/hyperledger/composer/pull/1553,Looks like this describe has been duplicated?,5b087587a0e22f42152e70b07341d860da5bef4c,2017-07-13 18:17:30,127292102,"@@ -1009,6 +1018,59 @@ describe('BusinessNetworkConnection', () => {
                 });
         });
 
+        it('should throw if participant does not exist', () => {
+            sandbox.stub(Util, 'invokeChainCode').resolves();
+            mockParticipantRegistry.exists.resolves(false);
+
+            return businessNetworkConnection.issueIdentity('org.doge.Doge#DOGE_1', 'dogeid1')
+                .catch((error) => {
+                    error.should.match(/does not exist /);
+                });
+        });
+    });
+
+    describe('#bindIdentity', () => {",52,2017-07-13 18:17:30,https://api.github.com/repos/hyperledger/composer/pulls/comments/127292102,https://github.com/hyperledger/composer/pull/1553#discussion_r127292102,sstone1
https://github.com/hyperledger/composer/pull/1544,https://github.com/hyperledger/composer/pull/1544,This should be `this.getSystemType()` as webpack will mangle the constructor names.,cd7d07ecd0ce284f16800fa309baf5063f8424cb,2017-07-12 14:55:06,126977780,"@@ -167,6 +167,17 @@ class ClassDeclaration {
             if(classDecl===null) {
                 throw new IllegalModelException('Could not find super type ' + this.superType, this.modelFile, this.ast.location);
             }
+
+            // Prevent extending declaration with different type of declaration
+            const supertypeDeclaration = this.getModelFile().getType(this.superType);
+            if (supertypeDeclaration) {
+                if (this.constructor.name !== supertypeDeclaration.constructor.name) {
+                    let typeName = this.constructor.name.replace('Declaration', '');",,2017-07-12 15:01:56,https://api.github.com/repos/hyperledger/composer/pulls/comments/126977780,https://github.com/hyperledger/composer/pull/1544#discussion_r126977780,sstone1
https://github.com/hyperledger/composer/pull/1544,https://github.com/hyperledger/composer/pull/1544,Should this be 10000?,cd7d07ecd0ce284f16800fa309baf5063f8424cb,2017-07-12 14:59:04,126979146,"@@ -31,46 +31,45 @@ export class AddFileModalHelper {
   // Confirm Add
   static confirmAdd() {
     // AddFile modal should be present
-    return browser.wait(ExpectedConditions.visibilityOf(element(by.css('.import'))), 5000)
+    return browser.wait(ExpectedConditions.visibilityOf(element(by.css('.import'))), 10000)
     .then(() => {
         let addElement = element(by.id('add-file_confirm'));
-        browser.wait(ExpectedConditions.elementToBeClickable(addElement), 5000);
+        browser.wait(ExpectedConditions.elementToBeClickable(addElement), 10000);
         return addElement.click();
     });
   }
 
   // Select Script file via Radio Button
   static selectScriptRadioOption() {
     // AddFile modal should be present
-    return browser.wait(ExpectedConditions.visibilityOf(element(by.css('.import'))), 5000)
+    return browser.wait(ExpectedConditions.visibilityOf(element(by.css('.import'))), 10000)
     .then(() => {
         let selectElement = element(by.css('[for=""file-type-js""]'));
-        browser.wait(ExpectedConditions.elementToBeClickable(selectElement), 5000);
+        browser.wait(ExpectedConditions.elementToBeClickable(selectElement), 10000);
         return selectElement.click();
     });
   }
 
   // Select Model file via Radio Button
   static selectModelRadioOption() {
     // AddFile modal should be present
-    return browser.wait(ExpectedConditions.visibilityOf(element(by.css('.import'))), 5000)
+    return browser.wait(ExpectedConditions.visibilityOf(element(by.css('.import'))), 1000)",,2017-07-12 15:01:56,https://api.github.com/repos/hyperledger/composer/pulls/comments/126979146,https://github.com/hyperledger/composer/pull/1544#discussion_r126979146,sstone1
https://github.com/hyperledger/composer/pull/1544,https://github.com/hyperledger/composer/pull/1544,Should this be 10000?,cd7d07ecd0ce284f16800fa309baf5063f8424cb,2017-07-12 14:59:10,126979192,"@@ -31,46 +31,45 @@ export class AddFileModalHelper {
   // Confirm Add
   static confirmAdd() {
     // AddFile modal should be present
-    return browser.wait(ExpectedConditions.visibilityOf(element(by.css('.import'))), 5000)
+    return browser.wait(ExpectedConditions.visibilityOf(element(by.css('.import'))), 10000)
     .then(() => {
         let addElement = element(by.id('add-file_confirm'));
-        browser.wait(ExpectedConditions.elementToBeClickable(addElement), 5000);
+        browser.wait(ExpectedConditions.elementToBeClickable(addElement), 10000);
         return addElement.click();
     });
   }
 
   // Select Script file via Radio Button
   static selectScriptRadioOption() {
     // AddFile modal should be present
-    return browser.wait(ExpectedConditions.visibilityOf(element(by.css('.import'))), 5000)
+    return browser.wait(ExpectedConditions.visibilityOf(element(by.css('.import'))), 10000)
     .then(() => {
         let selectElement = element(by.css('[for=""file-type-js""]'));
-        browser.wait(ExpectedConditions.elementToBeClickable(selectElement), 5000);
+        browser.wait(ExpectedConditions.elementToBeClickable(selectElement), 10000);
         return selectElement.click();
     });
   }
 
   // Select Model file via Radio Button
   static selectModelRadioOption() {
     // AddFile modal should be present
-    return browser.wait(ExpectedConditions.visibilityOf(element(by.css('.import'))), 5000)
+    return browser.wait(ExpectedConditions.visibilityOf(element(by.css('.import'))), 1000)
     .then(() => {
         let selectElement = element(by.css('[for=""file-type-cto""]'));
-        browser.wait(ExpectedConditions.elementToBeClickable(selectElement), 5000);
+        browser.wait(ExpectedConditions.elementToBeClickable(selectElement), 1000);
         return selectElement.click();
     });
   }
 
   // Select BND from BNA file drop
   static selectFromFile(filePath: string) {
     // Import modal should be present
-    return browser.wait(ExpectedConditions.visibilityOf(element(by.css('.import'))), 5000)
+    return browser.wait(ExpectedConditions.visibilityOf(element(by.css('.import'))), 1000)",,2017-07-12 15:01:56,https://api.github.com/repos/hyperledger/composer/pulls/comments/126979192,https://github.com/hyperledger/composer/pull/1544#discussion_r126979192,sstone1
https://github.com/hyperledger/composer/pull/1542,https://github.com/hyperledger/composer/pull/1542,I don't think you meant to have this in your commit,689b4f4b714e406db4ea866f83be3615a80fbe5c,2017-07-24 20:42:50,129148137,"@@ -58,13 +58,29 @@
           Define the logic of transaction executions using JavaScript.
         </div>
       </div>
+      <div class=""file-types-list-item"">",,2017-07-25 08:25:23,https://api.github.com/repos/hyperledger/composer/pulls/comments/129148137,https://github.com/hyperledger/composer/pull/1542#discussion_r129148137,cazfletch
https://github.com/hyperledger/composer/pull/1532,https://github.com/hyperledger/composer/pull/1532,global color?,cd38d6835ecd85072210205640aac7b403358b23,2017-07-11 13:14:28,126683995,"@@ -97,9 +97,30 @@ app-editor {
     .readme {
       background-color: $white;
       padding: $space-large;
-      min-height: 63vh;
-      max-height: 63vh;
+      min-height: 72vh;
+      max-height: 72vh;
       overflow-y: auto;
+
+      pre {
+        font-size: 0.8rem;
+        color: $white;
+        background-color: #272B36;",13,2017-07-11 14:34:42,https://api.github.com/repos/hyperledger/composer/pulls/comments/126683995,https://github.com/hyperledger/composer/pull/1532#discussion_r126683995,nklincoln
https://github.com/hyperledger/composer/pull/1532,https://github.com/hyperledger/composer/pull/1532,global color,cd38d6835ecd85072210205640aac7b403358b23,2017-07-11 13:14:53,126684097,"@@ -74,4 +74,8 @@
       flex:1;
       color: #8C9696;",,2017-07-11 14:34:42,https://api.github.com/repos/hyperledger/composer/pulls/comments/126684097,https://github.com/hyperledger/composer/pull/1532#discussion_r126684097,nklincoln
https://github.com/hyperledger/composer/pull/1532,https://github.com/hyperledger/composer/pull/1532,This isn't a global colour - pulled from the documentation code blocks!,cd38d6835ecd85072210205640aac7b403358b23,2017-07-11 13:17:02,126684617,"@@ -97,9 +97,30 @@ app-editor {
     .readme {
       background-color: $white;
       padding: $space-large;
-      min-height: 63vh;
-      max-height: 63vh;
+      min-height: 72vh;
+      max-height: 72vh;
       overflow-y: auto;
+
+      pre {
+        font-size: 0.8rem;
+        color: $white;
+        background-color: #272B36;",13,2017-07-11 14:34:42,https://api.github.com/repos/hyperledger/composer/pulls/comments/126684617,https://github.com/hyperledger/composer/pull/1532#discussion_r126684617,Tobias-Hunter
https://github.com/hyperledger/composer/pull/1532,https://github.com/hyperledger/composer/pull/1532,Wasn't my change but I'll be good ðŸ˜‰ ,cd38d6835ecd85072210205640aac7b403358b23,2017-07-11 13:17:59,126684852,"@@ -74,4 +74,8 @@
       flex:1;
       color: #8C9696;",,2017-07-11 14:34:42,https://api.github.com/repos/hyperledger/composer/pulls/comments/126684852,https://github.com/hyperledger/composer/pull/1532#discussion_r126684852,Tobias-Hunter
https://github.com/hyperledger/composer/pull/1516,https://github.com/hyperledger/composer/pull/1516,console log left from debug,5ed1cbfe3a2bbc1dae8d2570e797699bc5ad9e3e,2017-07-18 16:13:13,128022883,"@@ -76,8 +87,14 @@ export class TestComponent implements OnInit, OnDestroy {
                 }
             })
             .catch((error) => {
+                console.log('Caught error');",,2017-07-19 07:49:10,https://api.github.com/repos/hyperledger/composer/pulls/comments/128022883,https://github.com/hyperledger/composer/pull/1516#discussion_r128022883,nklincoln
https://github.com/hyperledger/composer/pull/1516,https://github.com/hyperledger/composer/pull/1516,console log left over,5ed1cbfe3a2bbc1dae8d2570e797699bc5ad9e3e,2017-07-18 16:13:25,128022938,"@@ -76,8 +87,14 @@ export class TestComponent implements OnInit, OnDestroy {
                 }
             })
             .catch((error) => {
+                console.log('Caught error');
                 this.alertService.errorStatus$.next(error);
             });
+        })
+        .catch((error) => {
+            console.log('Caught error');",,2017-07-19 07:49:10,https://api.github.com/repos/hyperledger/composer/pulls/comments/128022938,https://github.com/hyperledger/composer/pull/1516#discussion_r128022938,nklincoln
https://github.com/hyperledger/composer/pull/1516,https://github.com/hyperledger/composer/pull/1516,"really pedantic, but could we have this as private like those beneath? ",5ed1cbfe3a2bbc1dae8d2570e797699bc5ad9e3e,2017-07-18 16:16:10,128023684,"@@ -17,6 +18,7 @@ import { TransactionService } from '../services/transaction.service';
 
 export class TestComponent implements OnInit, OnDestroy {
 
+    hasTransactions = false;",12,2017-07-19 07:49:10,https://api.github.com/repos/hyperledger/composer/pulls/comments/128023684,https://github.com/hyperledger/composer/pull/1516#discussion_r128023684,nklincoln
https://github.com/hyperledger/composer/pull/1516,https://github.com/hyperledger/composer/pull/1516,:+1:,5ed1cbfe3a2bbc1dae8d2570e797699bc5ad9e3e,2017-07-19 07:51:00,128175734,"@@ -76,8 +87,14 @@ export class TestComponent implements OnInit, OnDestroy {
                 }
             })
             .catch((error) => {
+                console.log('Caught error');",,2017-07-19 07:51:00,https://api.github.com/repos/hyperledger/composer/pulls/comments/128175734,https://github.com/hyperledger/composer/pull/1516#discussion_r128175734,samjsmith
https://github.com/hyperledger/composer/pull/1516,https://github.com/hyperledger/composer/pull/1516,:+1:,5ed1cbfe3a2bbc1dae8d2570e797699bc5ad9e3e,2017-07-19 07:51:09,128175778,"@@ -76,8 +87,14 @@ export class TestComponent implements OnInit, OnDestroy {
                 }
             })
             .catch((error) => {
+                console.log('Caught error');
                 this.alertService.errorStatus$.next(error);
             });
+        })
+        .catch((error) => {
+            console.log('Caught error');",,2017-07-19 07:51:09,https://api.github.com/repos/hyperledger/composer/pulls/comments/128175778,https://github.com/hyperledger/composer/pull/1516#discussion_r128175778,samjsmith
https://github.com/hyperledger/composer/pull/1516,https://github.com/hyperledger/composer/pull/1516,"@nklincoln Hey Nick, yeah I don't really like this either but I had to make it visible so that it could be examined for correctness in the unit test.  Hope that's ok with you.",5ed1cbfe3a2bbc1dae8d2570e797699bc5ad9e3e,2017-07-19 07:55:25,128176709,"@@ -17,6 +18,7 @@ import { TransactionService } from '../services/transaction.service';
 
 export class TestComponent implements OnInit, OnDestroy {
 
+    hasTransactions = false;",12,2017-07-19 07:55:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/128176709,https://github.com/hyperledger/composer/pull/1516#discussion_r128176709,samjsmith
https://github.com/hyperledger/composer/pull/1507,https://github.com/hyperledger/composer/pull/1507,this line isn't really doing alot anymore ;-),6ef045579bf35472e16460f124a2ef18c8e61213,2017-07-06 16:09:05,125944899,"@@ -76,12 +76,9 @@ class RelationshipDeclaration extends Property {
             if(classDeclaration === null) {
                 throw new IllegalModelException('Relationship ' + this.getName() + ' points to a missing type ' + this.getFullyQualifiedTypeName(), classDecl.getModelFile(), this.ast.location);
             }
-
-
+            // console.log(c)",,2017-07-07 08:22:41,https://api.github.com/repos/hyperledger/composer/pulls/comments/125944899,https://github.com/hyperledger/composer/pull/1507#discussion_r125944899,nklincoln
https://github.com/hyperledger/composer/pull/1507,https://github.com/hyperledger/composer/pull/1507,Removed,6ef045579bf35472e16460f124a2ef18c8e61213,2017-07-07 08:03:19,126090098,"@@ -76,12 +76,9 @@ class RelationshipDeclaration extends Property {
             if(classDeclaration === null) {
                 throw new IllegalModelException('Relationship ' + this.getName() + ' points to a missing type ' + this.getFullyQualifiedTypeName(), classDecl.getModelFile(), this.ast.location);
             }
-
-
+            // console.log(c)",,2017-07-07 08:22:41,https://api.github.com/repos/hyperledger/composer/pulls/comments/126090098,https://github.com/hyperledger/composer/pull/1507#discussion_r126090098,liam-grace
https://github.com/hyperledger/composer/pull/1483,https://github.com/hyperledger/composer/pull/1483,"in the -o case the endorsement policy example would be
endorsementPolicy='{""identities"":[...}'
",63f07106719697903622adb0e24f7c7194bda488,2017-07-06 07:28:45,125828417,"@@ -37,3 +40,21 @@ Business network definition:
 Deploying business network definition. This may take a minute...
 Command completed successfully.
 ```
+
+## {{site.data.conrefs.hlf_full}} Endorsement Policies
+
+The `--option, -o` option and the `--optionsFile, -O` option allow connection specific information to be sent. {{site.data.conrefs.hlf_full}} RC endorsement policies can be sent using the `-o` and `-O` options in several ways.
+
+- Using the `-o` option, the endorsement policy can be sent as a single-line JSON string as follows:
+
+        composer network deploy -o endorsementPolicy='{""endorsementPolicy"": {""identities"": [.... }'
+",,2017-07-06 09:21:07,https://api.github.com/repos/hyperledger/composer/pulls/comments/125828417,https://github.com/hyperledger/composer/pull/1483#discussion_r125828417,davidkel
https://github.com/hyperledger/composer/pull/1483,https://github.com/hyperledger/composer/pull/1483,"the -O example should be described in more detail as it is actually a way to provide multiple options from a file. The way it is described here makes it sound as though it is identical to using -o endorsementPolicyFile which it isn't. In the case of endorsementPolicyFile it would look like
```
{""identities"":[...],
 ""policy"": {...}}
```
whereas the options file would look like
```
{""endorsementPolicy"": {""Identities"": [...].
    ""policy: {...}""
  },
  ""someOtherOption"": ""A Value""
}
```",63f07106719697903622adb0e24f7c7194bda488,2017-07-06 07:36:05,125829513,"@@ -37,3 +40,21 @@ Business network definition:
 Deploying business network definition. This may take a minute...
 Command completed successfully.
 ```
+
+## {{site.data.conrefs.hlf_full}} Endorsement Policies
+
+The `--option, -o` option and the `--optionsFile, -O` option allow connection specific information to be sent. {{site.data.conrefs.hlf_full}} RC endorsement policies can be sent using the `-o` and `-O` options in several ways.
+
+- Using the `-o` option, the endorsement policy can be sent as a single-line JSON string as follows:
+
+        composer network deploy -o endorsementPolicy='{""endorsementPolicy"": {""identities"": [.... }'
+
+- Using the `-o` option, the endorsement policy can be sent as a file path as follows:
+
+        composer network deploy -o endorsementPolicyFile=/path/to/file/endorsementPolicy.json
+
+- Using the `-O` option, the endorsement policy can be sent as a file path as follows:
+
+        composer network deploy -O /path/to/file/options.json",,2017-07-06 09:21:07,https://api.github.com/repos/hyperledger/composer/pulls/comments/125829513,https://github.com/hyperledger/composer/pull/1483#discussion_r125829513,davidkel
https://github.com/hyperledger/composer/pull/1483,https://github.com/hyperledger/composer/pull/1483,Should be RC1,63f07106719697903622adb0e24f7c7194bda488,2017-07-06 09:46:26,125856188,"@@ -15,7 +16,7 @@ Queries are used to return data about the blockchain world-state; for example, y
 
 Queries are an optional component of a business network definition, written in a single query file (`queries.qry`).
 
-Note: Queries are supported by the {{site.data.conrefs.hlf_full}} v1.0, embedded and web runtimes. The query support for the embedded and web runtimes currently has limitations and is unstable. When using the {{site.data.conrefs.hlf_full}} v1.0-beta runtime {{site.data.conrefs.hlf_full}} must be configured to use CouchDB persistence. Queries are **not** supported with the {{site.data.conrefs.hlf_full}} v0.6 runtime.
+Note: Queries are supported by the {{site.data.conrefs.hlf_full}} v1.0, embedded and web runtimes. The query support for the embedded and web runtimes currently has limitations and is unstable. When using the {{site.data.conrefs.hlf_full}} v1.0-RC runtime {{site.data.conrefs.hlf_full}} must be configured to use CouchDB persistence. Queries are **not** supported with the {{site.data.conrefs.hlf_full}} v0.6 runtime.",13,2017-07-06 09:46:27,https://api.github.com/repos/hyperledger/composer/pulls/comments/125856188,https://github.com/hyperledger/composer/pull/1483#discussion_r125856188,davidkel
https://github.com/hyperledger/composer/pull/1483,https://github.com/hyperledger/composer/pull/1483,Should be RC1,63f07106719697903622adb0e24f7c7194bda488,2017-07-06 09:47:38,125856466,"@@ -12,7 +12,7 @@ index-order: 3
 
 Follow the instructions below to get the required {{site.data.conrefs.composer_full}} development tools and stand up a {{site.data.conrefs.hlf_full}}.
 
-There are two version of {{site.data.conrefs.hlf_full}}: v0.6 and v1.0-beta. The default is for v1.0-beta and we suggest this is the one you use.
+There are two version of {{site.data.conrefs.hlf_full}}: v0.6 and v1.0-RC. The default is for v1.0-RC and we suggest this is the one you use.",5,2017-07-06 09:47:38,https://api.github.com/repos/hyperledger/composer/pulls/comments/125856466,https://github.com/hyperledger/composer/pull/1483#discussion_r125856466,davidkel
https://github.com/hyperledger/composer/pull/1483,https://github.com/hyperledger/composer/pull/1483,Should be RC1,63f07106719697903622adb0e24f7c7194bda488,2017-07-06 09:47:53,125856508,"@@ -107,7 +107,7 @@ docker rmi $(docker images dev-* -q)
 
         export FABRIC_VERSION=hlfv0.6
 
-    {{site.data.conrefs.hlf_full}} v1.0-beta is the default, but to 'unset' the v0.6, or to be explicit in using v1 use this command
+    {{site.data.conrefs.hlf_full}} v1.0-RC is the default, but to 'unset' the v0.6, or to be explicit in using v1 use this command",14,2017-07-06 09:47:53,https://api.github.com/repos/hyperledger/composer/pulls/comments/125856508,https://github.com/hyperledger/composer/pull/1483#discussion_r125856508,davidkel
https://github.com/hyperledger/composer/pull/1483,https://github.com/hyperledger/composer/pull/1483,Should be RC1,63f07106719697903622adb0e24f7c7194bda488,2017-07-06 09:48:08,125856557,"@@ -39,17 +39,17 @@ docker images -aq | xargs docker rmi -f
 2. Access your local {{site.data.conrefs.composer_full}} Playground by clicking this link: <a href=""http://localhost:8080"" target=""blank"">http://<span></span>localhost:8080</a>.
 
 
-## Deploying business networks to {{site.data.conrefs.hlf_full}} Beta
+## Deploying business networks to {{site.data.conrefs.hlf_full}} RC",14,2017-07-06 09:48:08,https://api.github.com/repos/hyperledger/composer/pulls/comments/125856557,https://github.com/hyperledger/composer/pull/1483#discussion_r125856557,davidkel
https://github.com/hyperledger/composer/pull/1467,https://github.com/hyperledger/composer/pull/1467,ðŸ¢ ,5203fd9c7b335269e310a353cfc846e0a776a6cc,2017-07-04 21:38:50,125531623,"@@ -2,12 +2,12 @@
 
 We provide script assistance and tutorials for users to follow. It is essential that these tuorials may be followed by a user such that their intial experience with Hyperledger Composer is positive one.
 
-## Pre-Reqs and And Documented Turtorials
+## Turtorials",,2017-07-05 07:09:29,https://api.github.com/repos/hyperledger/composer/pulls/comments/125531623,https://github.com/hyperledger/composer/pull/1467#discussion_r125531623,sstone1
https://github.com/hyperledger/composer/pull/1464,https://github.com/hyperledger/composer/pull/1464,Commented code,3231da7e7ff0a458d6224e0f7bc9d9fa7c8d5435,2017-07-05 08:18:45,125580686,"@@ -0,0 +1,33 @@
+/*
+ * Licensed under the Apache License, Version 2.0 (the ""License"");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an ""AS IS"" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+'use strict';
+
+const fs = require('fs');
+const path = require('path');
+const nunjucks=require('nunjucks');
+
+const targetFile = path.resolve(__dirname, '..', 'lib','systemModel.js');
+const templatePath = path.resolve(__dirname, '..', 'lib','_template');
+const modelFile = path.resolve(__dirname, '..', 'lib','system.cto');
+
+let env = nunjucks.configure(templatePath,{autoescape:false});
+
+// get the template file
+let model = fs.readFileSync(modelFile,  { encoding: 'utf8' });
+// let template = fs.readFileSync(templateFile,  { encoding: 'utf8' });",,2017-07-05 09:00:44,https://api.github.com/repos/hyperledger/composer/pulls/comments/125580686,https://github.com/hyperledger/composer/pull/1464#discussion_r125580686,jt-nti
https://github.com/hyperledger/composer/pull/1453,https://github.com/hyperledger/composer/pull/1453,This line is executed before the file save dialog box appears so will not achieve the desired effect. There is no success message any more so the bug is invalid now. Also any fixes should have tests created for them.,d2feae506b9616ff39e6014b71d5f8d385b8f4cb,2017-07-04 08:04:29,125411517,"@@ -362,10 +362,12 @@ export class EditorComponent implements OnInit, OnDestroy {
 
     exportBNA() {
         return this.clientService.getBusinessNetwork().toArchive().then((exportedData) => {
+	if (exportedData.length > 0) {",4,2017-07-04 08:05:19,https://api.github.com/repos/hyperledger/composer/pulls/comments/125411517,https://github.com/hyperledger/composer/pull/1453#discussion_r125411517,cazfletch
https://github.com/hyperledger/composer/pull/1443,https://github.com/hyperledger/composer/pull/1443,Commented code,5e51d962973842fa7439963dc65b254dadd4f886,2017-07-03 12:29:51,125277657,"@@ -25,7 +25,12 @@ sudo apt-get install docker-ce
 echo ""Docker version: ""
 docker --version
 
-sudo apt-get install linkchecker
+#sudo apt-get install linkchecker",,2017-07-03 12:46:52,https://api.github.com/repos/hyperledger/composer/pulls/comments/125277657,https://github.com/hyperledger/composer/pull/1443#discussion_r125277657,jt-nti
https://github.com/hyperledger/composer/pull/1434,https://github.com/hyperledger/composer/pull/1434,What happens if there is no concrete subclass here?,b4d8a4f14f8193003926233228f9f2de41742778,2017-07-01 14:08:34,125162848,"@@ -102,33 +98,34 @@ class InstanceGenerator {
      */
     getFieldValue(field, parameters) {
         let type = field.getFullyQualifiedTypeName();
-        let valueGenerator = parameters.valueGenerator || ValueGeneratorFactory.sample();
+
         if (ModelUtil.isPrimitiveType(type)) {
             switch(type) {
             case 'DateTime':
-                return valueGenerator.getDateTime();
+                return parameters.valueGenerator.getDateTime();
             case 'Integer':
-                return valueGenerator.getInteger();
+                return parameters.valueGenerator.getInteger();
             case 'Long':
-                return valueGenerator.getLong();
+                return parameters.valueGenerator.getLong();
             case 'Double':
-                return valueGenerator.getDouble();
+                return parameters.valueGenerator.getDouble();
             case 'Boolean':
-                return valueGenerator.getBoolean();
+                return parameters.valueGenerator.getBoolean();
             default:
-                return valueGenerator.getString();
+                return parameters.valueGenerator.getString();
             }
         }
+
         let classDeclaration = parameters.modelManager.getType(type);
+
         if (classDeclaration instanceof EnumDeclaration) {
             let enumValues = classDeclaration.getOwnProperties();
-            return valueGenerator.getEnum(enumValues).getName();
+            return parameters.valueGenerator.getEnum(enumValues).getName();
         }
 
         if (classDeclaration.isAbstract()) {
-            const newClassDecl = this.findConcreteSubclass(classDeclaration);
-            classDeclaration = newClassDecl;
-            type = newClassDecl.getName();
+            classDeclaration = this.findConcreteSubclass(classDeclaration);",,2017-07-07 12:48:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/125162848,https://github.com/hyperledger/composer/pull/1434#discussion_r125162848,dselman
https://github.com/hyperledger/composer/pull/1434,https://github.com/hyperledger/composer/pull/1434,It would be worth adding a check here to ensure that classDeclaration is not abstract. We should not have a relationship to an instance of an abstract type!,b4d8a4f14f8193003926233228f9f2de41742778,2017-07-01 14:11:56,125162885,"@@ -181,25 +178,19 @@ class InstanceGenerator {
      * @private
      */
     visitRelationshipDeclaration(relationshipDeclaration, parameters) {
-        let classDeclaration = parameters.modelManager.getType(relationshipDeclaration.getFullyQualifiedTypeName());
-        let identifierFieldName = classDeclaration.getIdentifierFieldName();
-        let factory = parameters.factory;
-        if (relationshipDeclaration.isArray()) {
-            let result = [];
-            for (let i = 0; i < 3; i++) {
-                let idx = Math.round(Math.random() * 9999).toString();
-                idx = leftPad(idx, 4, '0');
-                let id = `${identifierFieldName}:${idx}`;
-                let relationship = factory.newRelationship(classDeclaration.getModelFile().getNamespace(), classDeclaration.getName(), id);
-                result.push(relationship);
-            }
-            return result;
-        } else {
+        const classDeclaration = parameters.modelManager.getType(relationshipDeclaration.getFullyQualifiedTypeName());",,2017-07-07 12:48:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/125162885,https://github.com/hyperledger/composer/pull/1434#discussion_r125162885,dselman
https://github.com/hyperledger/composer/pull/1434,https://github.com/hyperledger/composer/pull/1434,I think it makes more sense to use classDeclaration.getName() + '_' + idx as the id.,b4d8a4f14f8193003926233228f9f2de41742778,2017-07-01 14:14:13,125162916,"@@ -181,25 +178,19 @@ class InstanceGenerator {
      * @private
      */
     visitRelationshipDeclaration(relationshipDeclaration, parameters) {
-        let classDeclaration = parameters.modelManager.getType(relationshipDeclaration.getFullyQualifiedTypeName());
-        let identifierFieldName = classDeclaration.getIdentifierFieldName();
-        let factory = parameters.factory;
-        if (relationshipDeclaration.isArray()) {
-            let result = [];
-            for (let i = 0; i < 3; i++) {
-                let idx = Math.round(Math.random() * 9999).toString();
-                idx = leftPad(idx, 4, '0');
-                let id = `${identifierFieldName}:${idx}`;
-                let relationship = factory.newRelationship(classDeclaration.getModelFile().getNamespace(), classDeclaration.getName(), id);
-                result.push(relationship);
-            }
-            return result;
-        } else {
+        const classDeclaration = parameters.modelManager.getType(relationshipDeclaration.getFullyQualifiedTypeName());
+        const identifierFieldName = classDeclaration.getIdentifierFieldName();
+        const factory = parameters.factory;
+        const valueSupplier = () => {
             let idx = Math.round(Math.random() * 9999).toString();
             idx = leftPad(idx, 4, '0');
-            let id = `${identifierFieldName}:${idx}`;
-            let relationship = factory.newRelationship(classDeclaration.getModelFile().getNamespace(), classDeclaration.getName(), id);
-            return relationship;
+            const id = `${identifierFieldName}:${idx}`;",,2017-07-07 12:48:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/125162916,https://github.com/hyperledger/composer/pull/1434#discussion_r125162916,dselman
https://github.com/hyperledger/composer/pull/1434,https://github.com/hyperledger/composer/pull/1434,From findConcreteSubclass(): ```@throws {Error} if no concrete subclasses exist.```,b4d8a4f14f8193003926233228f9f2de41742778,2017-07-04 10:25:33,125440991,"@@ -102,33 +98,34 @@ class InstanceGenerator {
      */
     getFieldValue(field, parameters) {
         let type = field.getFullyQualifiedTypeName();
-        let valueGenerator = parameters.valueGenerator || ValueGeneratorFactory.sample();
+
         if (ModelUtil.isPrimitiveType(type)) {
             switch(type) {
             case 'DateTime':
-                return valueGenerator.getDateTime();
+                return parameters.valueGenerator.getDateTime();
             case 'Integer':
-                return valueGenerator.getInteger();
+                return parameters.valueGenerator.getInteger();
             case 'Long':
-                return valueGenerator.getLong();
+                return parameters.valueGenerator.getLong();
             case 'Double':
-                return valueGenerator.getDouble();
+                return parameters.valueGenerator.getDouble();
             case 'Boolean':
-                return valueGenerator.getBoolean();
+                return parameters.valueGenerator.getBoolean();
             default:
-                return valueGenerator.getString();
+                return parameters.valueGenerator.getString();
             }
         }
+
         let classDeclaration = parameters.modelManager.getType(type);
+
         if (classDeclaration instanceof EnumDeclaration) {
             let enumValues = classDeclaration.getOwnProperties();
-            return valueGenerator.getEnum(enumValues).getName();
+            return parameters.valueGenerator.getEnum(enumValues).getName();
         }
 
         if (classDeclaration.isAbstract()) {
-            const newClassDecl = this.findConcreteSubclass(classDeclaration);
-            classDeclaration = newClassDecl;
-            type = newClassDecl.getName();
+            classDeclaration = this.findConcreteSubclass(classDeclaration);",,2017-07-07 12:48:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/125440991,https://github.com/hyperledger/composer/pull/1434#discussion_r125440991,bestbeforetoday
https://github.com/hyperledger/composer/pull/1434,https://github.com/hyperledger/composer/pull/1434,"Changed the logic so it behaves similar to members: use nearest concrete subclass when the model specifies a reference to an abstract type, and throw an error if no concrete subclass exists.",b4d8a4f14f8193003926233228f9f2de41742778,2017-07-04 14:35:39,125486922,"@@ -181,25 +178,19 @@ class InstanceGenerator {
      * @private
      */
     visitRelationshipDeclaration(relationshipDeclaration, parameters) {
-        let classDeclaration = parameters.modelManager.getType(relationshipDeclaration.getFullyQualifiedTypeName());
-        let identifierFieldName = classDeclaration.getIdentifierFieldName();
-        let factory = parameters.factory;
-        if (relationshipDeclaration.isArray()) {
-            let result = [];
-            for (let i = 0; i < 3; i++) {
-                let idx = Math.round(Math.random() * 9999).toString();
-                idx = leftPad(idx, 4, '0');
-                let id = `${identifierFieldName}:${idx}`;
-                let relationship = factory.newRelationship(classDeclaration.getModelFile().getNamespace(), classDeclaration.getName(), id);
-                result.push(relationship);
-            }
-            return result;
-        } else {
+        const classDeclaration = parameters.modelManager.getType(relationshipDeclaration.getFullyQualifiedTypeName());",,2017-07-07 12:48:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/125486922,https://github.com/hyperledger/composer/pull/1434#discussion_r125486922,bestbeforetoday
https://github.com/hyperledger/composer/pull/1434,https://github.com/hyperledger/composer/pull/1434,"I'm not sure about this. It will mean generated JSON looks like this:

`resource:org.acme.vehicle.auction.Member#Member_3429`

Perhaps we can tackle the generated identifier format under #1408 rather than here?",b4d8a4f14f8193003926233228f9f2de41742778,2017-07-04 14:47:51,125489398,"@@ -181,25 +178,19 @@ class InstanceGenerator {
      * @private
      */
     visitRelationshipDeclaration(relationshipDeclaration, parameters) {
-        let classDeclaration = parameters.modelManager.getType(relationshipDeclaration.getFullyQualifiedTypeName());
-        let identifierFieldName = classDeclaration.getIdentifierFieldName();
-        let factory = parameters.factory;
-        if (relationshipDeclaration.isArray()) {
-            let result = [];
-            for (let i = 0; i < 3; i++) {
-                let idx = Math.round(Math.random() * 9999).toString();
-                idx = leftPad(idx, 4, '0');
-                let id = `${identifierFieldName}:${idx}`;
-                let relationship = factory.newRelationship(classDeclaration.getModelFile().getNamespace(), classDeclaration.getName(), id);
-                result.push(relationship);
-            }
-            return result;
-        } else {
+        const classDeclaration = parameters.modelManager.getType(relationshipDeclaration.getFullyQualifiedTypeName());
+        const identifierFieldName = classDeclaration.getIdentifierFieldName();
+        const factory = parameters.factory;
+        const valueSupplier = () => {
             let idx = Math.round(Math.random() * 9999).toString();
             idx = leftPad(idx, 4, '0');
-            let id = `${identifierFieldName}:${idx}`;
-            let relationship = factory.newRelationship(classDeclaration.getModelFile().getNamespace(), classDeclaration.getName(), id);
-            return relationship;
+            const id = `${identifierFieldName}:${idx}`;",,2017-07-07 12:48:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/125489398,https://github.com/hyperledger/composer/pull/1434#discussion_r125489398,bestbeforetoday
https://github.com/hyperledger/composer/pull/1434,https://github.com/hyperledger/composer/pull/1434,This should be added as a Version 0.9.1 change,b4d8a4f14f8193003926233228f9f2de41742778,2017-07-06 10:07:50,125860533,"@@ -11,11 +11,11 @@
 #
 # Note that the latest public API is documented using JSDocs and is available in api.txt.
 #
-
-Version 0.9.0 {d0b9ae5179276e20604874624fe9529d} 2017-06-23
+Version 0.9.0 {60327250ee4f059647020f8aee5ed67b} 2017-06-23
 - Removed useless toJSON methods everywhere
 - Removed deprecated Factory.newInstance method
 - Removed deprecated ModelFile.getFileName method
+- Added includeOptionalFields option to Factory.newXXX functions",,2017-07-07 12:48:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/125860533,https://github.com/hyperledger/composer/pull/1434#discussion_r125860533,liam-grace
https://github.com/hyperledger/composer/pull/1434,https://github.com/hyperledger/composer/pull/1434,I've just noticed that the identifier format is littered around Playground code as well as in the runtime. This really needs to be tackled: both code refactor and improved generated ID format. Just not in this issue. :),b4d8a4f14f8193003926233228f9f2de41742778,2017-07-06 14:55:52,125924486,"@@ -181,25 +178,19 @@ class InstanceGenerator {
      * @private
      */
     visitRelationshipDeclaration(relationshipDeclaration, parameters) {
-        let classDeclaration = parameters.modelManager.getType(relationshipDeclaration.getFullyQualifiedTypeName());
-        let identifierFieldName = classDeclaration.getIdentifierFieldName();
-        let factory = parameters.factory;
-        if (relationshipDeclaration.isArray()) {
-            let result = [];
-            for (let i = 0; i < 3; i++) {
-                let idx = Math.round(Math.random() * 9999).toString();
-                idx = leftPad(idx, 4, '0');
-                let id = `${identifierFieldName}:${idx}`;
-                let relationship = factory.newRelationship(classDeclaration.getModelFile().getNamespace(), classDeclaration.getName(), id);
-                result.push(relationship);
-            }
-            return result;
-        } else {
+        const classDeclaration = parameters.modelManager.getType(relationshipDeclaration.getFullyQualifiedTypeName());
+        const identifierFieldName = classDeclaration.getIdentifierFieldName();
+        const factory = parameters.factory;
+        const valueSupplier = () => {
             let idx = Math.round(Math.random() * 9999).toString();
             idx = leftPad(idx, 4, '0');
-            let id = `${identifierFieldName}:${idx}`;
-            let relationship = factory.newRelationship(classDeclaration.getModelFile().getNamespace(), classDeclaration.getName(), id);
-            return relationship;
+            const id = `${identifierFieldName}:${idx}`;",,2017-07-07 12:48:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/125924486,https://github.com/hyperledger/composer/pull/1434#discussion_r125924486,bestbeforetoday
https://github.com/hyperledger/composer/pull/1434,https://github.com/hyperledger/composer/pull/1434,Why are you defining the functions this way instead of as proper methods with JSDoc comments?,b4d8a4f14f8193003926233228f9f2de41742778,2017-07-06 14:56:08,125924561,"@@ -55,6 +54,36 @@ class Factory {
      */
     constructor(modelManager) {
         this.modelManager = modelManager;
+
+        this.initializeNewObject = (newObject, classDeclaration, clientOptions) => {",,2017-07-07 12:48:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/125924561,https://github.com/hyperledger/composer/pull/1434#discussion_r125924561,sstone1
https://github.com/hyperledger/composer/pull/1434,https://github.com/hyperledger/composer/pull/1434,"It's a private implementation method, not something I want visible outside of this class. Happy to do it differently if appropriate.",b4d8a4f14f8193003926233228f9f2de41742778,2017-07-06 14:59:29,125925572,"@@ -55,6 +54,36 @@ class Factory {
      */
     constructor(modelManager) {
         this.modelManager = modelManager;
+
+        this.initializeNewObject = (newObject, classDeclaration, clientOptions) => {",,2017-07-07 12:48:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/125925572,https://github.com/hyperledger/composer/pull/1434#discussion_r125925572,bestbeforetoday
https://github.com/hyperledger/composer/pull/1434,https://github.com/hyperledger/composer/pull/1434,"Yeah, let's not do something different to the rest of the code base.
Mark the APIs with `@private` in the JSDoc comments so they don't appear in the public JSDoc documentation. Dave has been prefixing private method names with `_` which nobody else is doing at present, but I'm not against it.",b4d8a4f14f8193003926233228f9f2de41742778,2017-07-06 15:02:29,125926416,"@@ -55,6 +54,36 @@ class Factory {
      */
     constructor(modelManager) {
         this.modelManager = modelManager;
+
+        this.initializeNewObject = (newObject, classDeclaration, clientOptions) => {",,2017-07-07 12:48:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/125926416,https://github.com/hyperledger/composer/pull/1434#discussion_r125926416,sstone1
https://github.com/hyperledger/composer/pull/1434,https://github.com/hyperledger/composer/pull/1434,"I don't think this stops the functions being called outside of the class either?
I can still do `const factory = new Factory(); factory.initializeNewObject()`.",b4d8a4f14f8193003926233228f9f2de41742778,2017-07-06 19:29:54,125994409,"@@ -55,6 +54,36 @@ class Factory {
      */
     constructor(modelManager) {
         this.modelManager = modelManager;
+
+        this.initializeNewObject = (newObject, classDeclaration, clientOptions) => {",,2017-07-07 12:48:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/125994409,https://github.com/hyperledger/composer/pull/1434#discussion_r125994409,sstone1
https://github.com/hyperledger/composer/pull/1434,https://github.com/hyperledger/composer/pull/1434,"Your'e right! I was getting confused between private and privileged functions. I've learnt something at least. :)

So for functions that we don't want any code (even our own internal code) outside the containing class to call, how should we best indicate that? JSDoc comments? Underscore prefix? Something else?",b4d8a4f14f8193003926233228f9f2de41742778,2017-07-07 10:00:41,126112279,"@@ -55,6 +54,36 @@ class Factory {
      */
     constructor(modelManager) {
         this.modelManager = modelManager;
+
+        this.initializeNewObject = (newObject, classDeclaration, clientOptions) => {",,2017-07-07 12:48:18,https://api.github.com/repos/hyperledger/composer/pulls/comments/126112279,https://github.com/hyperledger/composer/pull/1434#discussion_r126112279,bestbeforetoday
https://github.com/hyperledger/composer/pull/1420,https://github.com/hyperledger/composer/pull/1420,Misleading message,9f6a8f1fb09b6c67a203cbafa60aa7379edec364,2017-06-30 09:53:22,125004127,"@@ -91,8 +91,8 @@ then
 
     # Check of the task current executing
     if [ ""${FC_TASK}"" != ""docs"" ]; then
-        echo ""ABORT_BUILD=true"" > ${DIR}/build.cfg
-        echo ""ABORT_CODE=0"" >> ${DIR}/build.cfg
+#        echo ""ABORT_BUILD=true"" > ${DIR}/build.cfg
+#        echo ""ABORT_CODE=0"" >> ${DIR}/build.cfg
         echo 'Docs only build - no pointing bothering with anything more'",8,2017-06-30 09:53:22,https://api.github.com/repos/hyperledger/composer/pulls/comments/125004127,https://github.com/hyperledger/composer/pull/1420#discussion_r125004127,jt-nti
https://github.com/hyperledger/composer/pull/1420,https://github.com/hyperledger/composer/pull/1420,"Yes - don't want it to stay like for long... this afternoons job once the release gone
",9f6a8f1fb09b6c67a203cbafa60aa7379edec364,2017-06-30 09:55:20,125004533,"@@ -91,8 +91,8 @@ then
 
     # Check of the task current executing
     if [ ""${FC_TASK}"" != ""docs"" ]; then
-        echo ""ABORT_BUILD=true"" > ${DIR}/build.cfg
-        echo ""ABORT_CODE=0"" >> ${DIR}/build.cfg
+#        echo ""ABORT_BUILD=true"" > ${DIR}/build.cfg
+#        echo ""ABORT_CODE=0"" >> ${DIR}/build.cfg
         echo 'Docs only build - no pointing bothering with anything more'",8,2017-06-30 09:55:20,https://api.github.com/repos/hyperledger/composer/pulls/comments/125004533,https://github.com/hyperledger/composer/pull/1420#discussion_r125004533,mbwhite
https://github.com/hyperledger/composer/pull/1405,https://github.com/hyperledger/composer/pull/1405,Please make these consistent with the rest of the runtime APIs and use camelCaseNames.,d7f41ff2cd81b86c1964b5927420316a032ed230,2017-06-29 10:07:49,124760677,"@@ -295,6 +296,49 @@ class AdminConnection {
     }
 
     /**
+     * set logging level of a business network
+     * @example
+     * // Set the logging level of a business network.
+     * var adminConnection = new AdminConnection();
+     * return adminConnection.setLogLevel('DEBUG')
+     * .then(() => {
+     *     console.log('log level set to DEBUG');
+     * })
+     * .catch(function(error){
+     *     // Add optional error handling here.
+     * });
+     *
+     * @param {any} newLogLevel new logging level
+     * @returns {Promise} A promise that resolves if successful.
+     * @memberof AdminConnection
+     */
+    setLogLevel(newLogLevel) {
+        Util.securityCheck(this.securityContext);
+        return this.connection.invokeChainCode(this.securityContext, 'setloglevel' , [newLogLevel]);",38,2017-06-29 10:20:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/124760677,https://github.com/hyperledger/composer/pull/1405#discussion_r124760677,sstone1
https://github.com/hyperledger/composer/pull/1405,https://github.com/hyperledger/composer/pull/1405,Comment should be improved - these are user facing docs! Proper English sentences with capital letters and full stops please ðŸ˜‰ ,d7f41ff2cd81b86c1964b5927420316a032ed230,2017-06-29 10:09:30,124760978,"@@ -295,6 +296,49 @@ class AdminConnection {
     }
 
     /**
+     * set logging level of a business network",20,2017-06-29 10:20:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/124760978,https://github.com/hyperledger/composer/pull/1405#discussion_r124760978,sstone1
https://github.com/hyperledger/composer/pull/1405,https://github.com/hyperledger/composer/pull/1405,Comment needs improvement.,d7f41ff2cd81b86c1964b5927420316a032ed230,2017-06-29 10:09:51,124761033,"@@ -295,6 +296,49 @@ class AdminConnection {
     }
 
     /**
+     * set logging level of a business network
+     * @example
+     * // Set the logging level of a business network.
+     * var adminConnection = new AdminConnection();
+     * return adminConnection.setLogLevel('DEBUG')
+     * .then(() => {
+     *     console.log('log level set to DEBUG');
+     * })
+     * .catch(function(error){
+     *     // Add optional error handling here.
+     * });
+     *
+     * @param {any} newLogLevel new logging level
+     * @returns {Promise} A promise that resolves if successful.
+     * @memberof AdminConnection
+     */
+    setLogLevel(newLogLevel) {
+        Util.securityCheck(this.securityContext);
+        return this.connection.invokeChainCode(this.securityContext, 'setloglevel' , [newLogLevel]);
+    }
+
+    /**
+     * get the current logging level of a business network",42,2017-06-29 10:20:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/124761033,https://github.com/hyperledger/composer/pull/1405#discussion_r124761033,sstone1
https://github.com/hyperledger/composer/pull/1405,https://github.com/hyperledger/composer/pull/1405,Comment needs improvement.,d7f41ff2cd81b86c1964b5927420316a032ed230,2017-06-29 10:09:56,124761054,"@@ -320,6 +364,17 @@ class AdminConnection {
 
     /**
      * import an identity into a profiles' wallet",69,2017-06-29 10:20:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/124761054,https://github.com/hyperledger/composer/pull/1405#discussion_r124761054,sstone1
https://github.com/hyperledger/composer/pull/1405,https://github.com/hyperledger/composer/pull/1405,:+1: for using `resolves`,d7f41ff2cd81b86c1964b5927420316a032ed230,2017-06-29 10:10:51,124761203,"@@ -68,8 +68,8 @@ describe('composer network download CLI unit tests', function () {
         sandbox.stub(fs,'writeFileSync' );
         sandbox.stub(CmdUtil, 'createBusinessNetworkConnection').returns(mockBusinessNetworkConnection);
         sandbox.stub(process, 'exit');
-
-        sandbox.stub(ListCmd,'getMatchingRegistries').returns(Promise.resolve([{id:'reg1','name':'reg1','registryType':'Asset','assets':{}},{id:'reg2','name':'reg2','registryType':'Asset','assets':{}}]));
+        sandbox.stub(ListCmd, 'getMatchingAssets').resolves({});
+        sandbox.stub(ListCmd,'getMatchingRegistries').resolves([{id:'reg1','name':'reg1','registryType':'Asset','assets':{}},{id:'reg2','name':'reg2','registryType':'Asset','assets':{}}]);",7,2017-06-29 10:20:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/124761203,https://github.com/hyperledger/composer/pull/1405#discussion_r124761203,sstone1
https://github.com/hyperledger/composer/pull/1405,https://github.com/hyperledger/composer/pull/1405,"Why can't we just JSON.stringify the `deployOptions` and always send them across?
It would make the code cleaner and also make it easier to extend in the future with additional options.
We don't really need CLI style flags here.",d7f41ff2cd81b86c1964b5927420316a032ed230,2017-06-29 10:12:22,124761527,"@@ -416,13 +418,20 @@ class HLFConnection extends Connection {
                 // prepare and send the instantiate proposal
                 finalTxId = this.client.newTransactionID();
 
+                let initArgs;
+                if (deployOptions && deployOptions.logLevel) {
+                    initArgs = ['-d', deployOptions.logLevel, businessNetworkArchive.toString('base64')];",37,2017-06-29 10:20:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/124761527,https://github.com/hyperledger/composer/pull/1405#discussion_r124761527,sstone1
https://github.com/hyperledger/composer/pull/1405,https://github.com/hyperledger/composer/pull/1405,Why is this being handled here and not in the JavaScript code in `composer-runtime`?,d7f41ff2cd81b86c1964b5927420316a032ed230,2017-06-29 10:13:16,124761720,"@@ -49,6 +51,9 @@ func (chaincode *Chaincode) Invoke(stub shim.ChaincodeStubInterface, function st
 	logger.Debug(""Entering Chaincode.Invoke"", &stub, function, arguments)
 	defer func() { logger.Debug(""Exiting Chaincode.Invoke"", string(result), err) }()
 
+	if strings.ToLower(function) == ""setloglevel"" {",13,2017-06-29 10:20:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/124761720,https://github.com/hyperledger/composer/pull/1405#discussion_r124761720,sstone1
https://github.com/hyperledger/composer/pull/1405,https://github.com/hyperledger/composer/pull/1405,"Any proper security model will use the JavaScript access control code, which reinforces my above question:
Why is this being handled here and not in the JavaScript code in `composer-runtime`?",d7f41ff2cd81b86c1964b5927420316a032ed230,2017-06-29 10:14:03,124761860,"@@ -117,9 +121,21 @@ func (chaincode *Chaincode) Invoke(stub shim.ChaincodeStubInterface) (response p
 
 	// Execute the invoke function.
 	function, arguments := stub.GetFunctionAndParameters()
-	if strings.ToLower(function) == ""logging"" {
-		SetLogging(stub, arguments[0])
-		return shim.Success(nil)
+	if strings.ToLower(function) == ""setloglevel"" {
+		// TODO: Will be upgraded to a proper security model soon",32,2017-06-29 10:20:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/124761860,https://github.com/hyperledger/composer/pull/1405#discussion_r124761860,sstone1
https://github.com/hyperledger/composer/pull/1405,https://github.com/hyperledger/composer/pull/1405,All of this code should be in `LoggingService` and then handled by the Blockchain platform specific implementations - e.g. `loggingservice.go` for Fabric.,d7f41ff2cd81b86c1964b5927420316a032ed230,2017-06-29 10:15:36,124762111,"@@ -117,9 +121,21 @@ func (chaincode *Chaincode) Invoke(stub shim.ChaincodeStubInterface) (response p
 
 	// Execute the invoke function.
 	function, arguments := stub.GetFunctionAndParameters()
-	if strings.ToLower(function) == ""logging"" {
-		SetLogging(stub, arguments[0])
-		return shim.Success(nil)
+	if strings.ToLower(function) == ""setloglevel"" {
+		// TODO: Will be upgraded to a proper security model soon",32,2017-06-29 10:20:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/124762111,https://github.com/hyperledger/composer/pull/1405#discussion_r124762111,sstone1
https://github.com/hyperledger/composer/pull/1405,https://github.com/hyperledger/composer/pull/1405,"I did ask you about this and told you that it was implemented in the chaincode and you said that was fine, given that the chaincode and javascript runtime form a complete runtime, but I guess the confusion was the fact that I was handling it all the chaincode and maybe I hadn't explained that clearly",d7f41ff2cd81b86c1964b5927420316a032ed230,2017-06-29 10:46:02,124767448,"@@ -49,6 +51,9 @@ func (chaincode *Chaincode) Invoke(stub shim.ChaincodeStubInterface, function st
 	logger.Debug(""Entering Chaincode.Invoke"", &stub, function, arguments)
 	defer func() { logger.Debug(""Exiting Chaincode.Invoke"", string(result), err) }()
 
+	if strings.ToLower(function) == ""setloglevel"" {",13,2017-06-29 10:57:22,https://api.github.com/repos/hyperledger/composer/pulls/comments/124767448,https://github.com/hyperledger/composer/pull/1405#discussion_r124767448,davidkel
https://github.com/hyperledger/composer/pull/1405,https://github.com/hyperledger/composer/pull/1405,Apologies - I must have misunderstood what you were saying.,d7f41ff2cd81b86c1964b5927420316a032ed230,2017-06-29 10:52:04,124768514,"@@ -49,6 +51,9 @@ func (chaincode *Chaincode) Invoke(stub shim.ChaincodeStubInterface, function st
 	logger.Debug(""Entering Chaincode.Invoke"", &stub, function, arguments)
 	defer func() { logger.Debug(""Exiting Chaincode.Invoke"", string(result), err) }()
 
+	if strings.ToLower(function) == ""setloglevel"" {",13,2017-06-29 10:52:04,https://api.github.com/repos/hyperledger/composer/pulls/comments/124768514,https://github.com/hyperledger/composer/pull/1405#discussion_r124768514,sstone1
https://github.com/hyperledger/composer/pull/1402,https://github.com/hyperledger/composer/pull/1402,This should be `file.isSystemModelFile()` shouldn't it?,28a70db8bdc5c61611489253770d175a0536038d,2017-06-29 08:14:53,124737278,"@@ -300,6 +300,10 @@ class BusinessNetworkDefinition {
         zip.file('models/', null, Object.assign({}, options, { dir: true }));
         modelFiles.forEach(function(file) {
             let fileName;
+            // ignore the system namespace when creating an archive
+            if (file.namespace === COMPOSER_SYSTEM_NAMESPACE){",,2017-06-29 09:00:24,https://api.github.com/repos/hyperledger/composer/pulls/comments/124737278,https://github.com/hyperledger/composer/pull/1402#discussion_r124737278,sstone1
https://github.com/hyperledger/composer/pull/1402,https://github.com/hyperledger/composer/pull/1402,"And here, should be `m.isSystemModelFile()` and also you're missing some `()` around `getNamespace` anyway.",28a70db8bdc5c61611489253770d175a0536038d,2017-06-29 08:15:38,124737424,"@@ -172,6 +172,9 @@ class ModelManager {
         LOG.info(NAME,'updateModelFile',modelFile,fileName);
         if (typeof modelFile === 'string') {
             let m = new ModelFile(this, modelFile, fileName);
+            if (m.getNamespace === ModelUtil.getSystemNamespace()){",,2017-06-29 09:00:24,https://api.github.com/repos/hyperledger/composer/pulls/comments/124737424,https://github.com/hyperledger/composer/pull/1402#discussion_r124737424,sstone1
https://github.com/hyperledger/composer/pull/1402,https://github.com/hyperledger/composer/pull/1402,"Ah  - useful method - forgetting I'm not in Eclipse anymore...
Yep change it.",28a70db8bdc5c61611489253770d175a0536038d,2017-06-29 08:30:11,124740445,"@@ -300,6 +300,10 @@ class BusinessNetworkDefinition {
         zip.file('models/', null, Object.assign({}, options, { dir: true }));
         modelFiles.forEach(function(file) {
             let fileName;
+            // ignore the system namespace when creating an archive
+            if (file.namespace === COMPOSER_SYSTEM_NAMESPACE){",,2017-06-29 09:00:24,https://api.github.com/repos/hyperledger/composer/pulls/comments/124740445,https://github.com/hyperledger/composer/pull/1402#discussion_r124740445,mbwhite
https://github.com/hyperledger/composer/pull/1402,https://github.com/hyperledger/composer/pull/1402,changed,28a70db8bdc5c61611489253770d175a0536038d,2017-06-29 08:30:12,124740453,"@@ -172,6 +172,9 @@ class ModelManager {
         LOG.info(NAME,'updateModelFile',modelFile,fileName);
         if (typeof modelFile === 'string') {
             let m = new ModelFile(this, modelFile, fileName);
+            if (m.getNamespace === ModelUtil.getSystemNamespace()){",,2017-06-29 09:00:24,https://api.github.com/repos/hyperledger/composer/pulls/comments/124740453,https://github.com/hyperledger/composer/pull/1402#discussion_r124740453,mbwhite
https://github.com/hyperledger/composer/pull/1394,https://github.com/hyperledger/composer/pull/1394,"Is there not a colour variable for this?, if not you should create one. Also do you really need the important?",5f2cbf695987645c1070d5ce739deee86afc4c73,2017-06-28 08:19:49,124479124,"@@ -42,6 +42,13 @@ success {
                 height: 24px;
                 margin-right: $space-medium;
             }
+        
+            .transaction-link {
+                color:#3f55af!important;",,2017-07-05 12:45:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/124479124,https://github.com/hyperledger/composer/pull/1394#discussion_r124479124,cazfletch
https://github.com/hyperledger/composer/pull/1394,https://github.com/hyperledger/composer/pull/1394,Can we make this more generalised incase we have different links in the future,5f2cbf695987645c1070d5ce739deee86afc4c73,2017-06-28 08:24:05,124479935,"@@ -13,6 +13,7 @@
         <div>
             <div class=""notification-title"">{{message.title}}</div>
             <p class=""notification-text"" [innerHTML]=""message.text""></p>
+            <p *ngIf=""events.length > 0""><a (click)=""onEvent()"" href=""#"" class=""transaction-link"">{{events.length}} event emitted</a></p>",,2017-07-05 12:45:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/124479935,https://github.com/hyperledger/composer/pull/1394#discussion_r124479935,cazfletch
https://github.com/hyperledger/composer/pull/1394,https://github.com/hyperledger/composer/pull/1394,"There are alot of !important in here, are they really all needed?",5f2cbf695987645c1070d5ce739deee86afc4c73,2017-06-28 08:30:20,124481310,"@@ -0,0 +1,121 @@
+@import '../../assets/styles/base/_colors.scss';
+@import '../../assets/styles/base/_variables.scss';
+@import '../../assets/styles/base/_typography.scss';
+
+.composer {
+  .transactionnav {
+    background-color: $third-highlight !important;",,2017-07-05 12:45:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/124481310,https://github.com/hyperledger/composer/pull/1394#discussion_r124481310,cazfletch
https://github.com/hyperledger/composer/pull/1394,https://github.com/hyperledger/composer/pull/1394,this should be using variables,5f2cbf695987645c1070d5ce739deee86afc4c73,2017-07-05 10:05:40,125603658,"@@ -0,0 +1,94 @@
+@import '../../../assets/styles/base/_colors.scss';
+@import '../../../assets/styles/base/_variables.scss';
+@import '../../../assets/styles/base/_typography.scss';
+transaction-modal {
+    .modal-sub-header {
+        display: flex;
+        align-items: center;
+        background-color: $third-highlight;
+        padding: 0;
+        nav.transactionnav {
+            background-color: $third-highlight;
+            box-shadow: 0 1px 4px 0 $white;
+            .navcontent {
+                .links {
+                    li {
+                        &.withseparator::after {
+                            content: '';
+                            border-right-color: $sixth-highlight;
+                            margin-top: 0;
+                            margin-bottom: 0;
+                        }
+                    }
+                    a {
+                        color: $primary-text;
+                    }
+                    .action {
+                        margin-left: 1rem;",,2017-07-05 12:45:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/125603658,https://github.com/hyperledger/composer/pull/1394#discussion_r125603658,cazfletch
https://github.com/hyperledger/composer/pull/1394,https://github.com/hyperledger/composer/pull/1394,don't use vh here other wise this causes problems when you change the size of your screen it should be in px,5f2cbf695987645c1070d5ce739deee86afc4c73,2017-07-05 10:06:33,125603816,"@@ -0,0 +1,94 @@
+@import '../../../assets/styles/base/_colors.scss';
+@import '../../../assets/styles/base/_variables.scss';
+@import '../../../assets/styles/base/_typography.scss';
+transaction-modal {
+    .modal-sub-header {
+        display: flex;
+        align-items: center;
+        background-color: $third-highlight;
+        padding: 0;
+        nav.transactionnav {
+            background-color: $third-highlight;
+            box-shadow: 0 1px 4px 0 $white;
+            .navcontent {
+                .links {
+                    li {
+                        &.withseparator::after {
+                            content: '';
+                            border-right-color: $sixth-highlight;
+                            margin-top: 0;
+                            margin-bottom: 0;
+                        }
+                    }
+                    a {
+                        color: $primary-text;
+                    }
+                    .action {
+                        margin-left: 1rem;
+                        margin-right: 1rem;
+                        line-height: 63px;
+                        color: $primary-text;
+                        transition: none;
+                        border-bottom: 3px solid transparent;
+                        &:hover {
+                            border-bottom-color: $first-highlight;
+                        }
+                        &.active {
+                            border-bottom-color: $first-highlight;
+                        }
+                    }
+                }
+            }
+        }
+    }
+  .resource-list {
+    margin: $space-small 0;
+    .resource-dropdown {
+      margin: $space-small 0;
+      border-radius: 3px;
+      border:1px solid #e3ecec;
+      .resource-open {
+        position: relative;
+        width: 100%;
+        background-color: $third-highlight;
+        padding: $space-small $space-medium;
+        .resource-title {
+          .title {
+            width: 85%;
+            text-overflow: ellipsis;
+            overflow: hidden;
+            float: left;
+          }
+        }
+        &::after {
+          content: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c3ZnIHdpZHRoPSIxN3B4IiBoZWlnaHQ9IjE0cHgiIHZpZXdCb3g9IjAgMCAxNyAxNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4gICAgICAgIDx0aXRsZT5Db2xsYXBzZS1FeHBhbmQ8L3RpdGxlPiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4gICAgPGRlZnM+PC9kZWZzPiAgICA8ZyBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4gICAgICAgIDxnIGlkPSJGYWJyaWMtQ29tcG9zZXItUGxheWdyb3VuZC1EZWZpbmUtMi1Db3B5LTEyMSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEwNzYuMDAwMDAwLCAtNDg2LjAwMDAwMCkiPiAgICAgICAgICAgIDxnIGlkPSJHcm91cC0zLUNvcHkiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDMwMC4wMDAwMDAsIDQ2NC4wMDAwMDApIj4gICAgICAgICAgICAgICAgPGcgaWQ9Ikdyb3VwLUNvcHktMiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNzg0LjUwMDAwMCwgMjkuMDAwMDAwKSByb3RhdGUoOTAuMDAwMDAwKSB0cmFuc2xhdGUoLTc4NC41MDAwMDAsIC0yOS4wMDAwMDApIHRyYW5zbGF0ZSg3NzcuNTAwMDAwLCAyMS41MDAwMDApIj4gICAgICAgICAgICAgICAgICAgIDxnIGlkPSJDb2xsYXBzZS1FeHBhbmQiPiAgICAgICAgICAgICAgICAgICAgICAgIDxwb2x5Z29uIGlkPSJGaWxsLTMiIGZpbGw9IiMxOTI3M0MiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDMuNDYxNTM4LCA3LjUzODQ2Mikgc2NhbGUoLTEsIDEpIHRyYW5zbGF0ZSgtMy40NjE1MzgsIC03LjUzODQ2MikgIiBwb2ludHM9IjUuNTM4NDYxNTQgMiAwIDcuNTM4NDYxNTQgNS41Mzg0NjE1NCAxMy4wNzY5MjMxIDYuOTIzMDc2OTIgMTEuNjkyMzA3NyAyLjc2OTIzMDc3IDcuNTM4NDYxNTQgNi45MjMwNzY5MiAzLjM4NDYxNTM4Ij48L3BvbHlnb24+ICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTEzLDAgTDEzLDE1IiBpZD0iTGluZSIgc3Ryb2tlPSIjMTkyNzNDIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJzcXVhcmUiPjwvcGF0aD4gICAgICAgICAgICAgICAgICAgIDwvZz4gICAgICAgICAgICAgICAgPC9nPiAgICAgICAgICAgIDwvZz4gICAgICAgIDwvZz4gICAgPC9nPjwvc3ZnPg==);
+          cursor: pointer;
+          position: fixed;
+          right: 8%;
+          width: 0;
+          height: 0;
+        }
+      }
+      .resource-content {
+        position: relative;
+        width: 100%;
+        background-color: $third-highlight;
+        padding: $space-small $space-medium;
+        text-align: left;
+        border-top:1px solid #e3ecec;
+        .CodeMirror {
+          height: 13vh;",,2017-07-05 12:45:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/125603816,https://github.com/hyperledger/composer/pull/1394#discussion_r125603816,cazfletch
https://github.com/hyperledger/composer/pull/1394,https://github.com/hyperledger/composer/pull/1394,1rem should be $space-medium,5f2cbf695987645c1070d5ce739deee86afc4c73,2017-07-05 12:15:39,125626255,"@@ -24,8 +24,8 @@ transaction-modal {
                         color: $primary-text;
                     }
                     .action {
-                        margin-left: 1rem;
-                        margin-right: 1rem;
+                        margin-left: $space-smedium;",,2017-07-05 12:45:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/125626255,https://github.com/hyperledger/composer/pull/1394#discussion_r125626255,cazfletch
https://github.com/hyperledger/composer/pull/1386,https://github.com/hyperledger/composer/pull/1386,"We will have to be careful when we report errors in this ""query file"" to not use the file name...",bf232e67d62c94cf6c88e77c17ffa8087c61c9c0,2017-06-26 21:55:25,124132157,"@@ -355,6 +357,7 @@ class BusinessNetworkConnection extends EventEmitter {
             })
             .then((businessNetwork) => {
                 this.businessNetwork = businessNetwork;
+                this.dynamicQueryFile = this.businessNetwork.getQueryManager().createQueryFile('$dynamic_queries.qry', '');",20,2017-06-26 22:00:45,https://api.github.com/repos/hyperledger/composer/pulls/comments/124132157,https://github.com/hyperledger/composer/pull/1386#discussion_r124132157,dselman
https://github.com/hyperledger/composer/pull/1384,https://github.com/hyperledger/composer/pull/1384,"What is this line with the hardcoded version number doing in here?
Suggest that we turn this into a loop as follows:

```
while ! npm view composer-playground@${VERSION} > /dev/null 2>&1; do
  sleep 10
done
```

npm will return 1 for packages that do not exist, and 0 for packages that do exist.",128b1d565ae4cd35f216637746e9ce161a95aa6d,2017-06-26 18:33:43,124085672,"@@ -78,6 +78,10 @@ if [ -z ""${TRAVIS_TAG}"" ]; then
     echo ""Pushing with tag unstable""
     lerna exec --ignore '@(composer-systests|composer-website)' -- npm publish --tag=unstable 2>&1 | tee
 
+	# quick check to see if the latest npm module has been published
+	npm view composer-playground@0.9.0-20170626131511 | grep dist-tags",,2017-06-27 15:54:59,https://api.github.com/repos/hyperledger/composer/pulls/comments/124085672,https://github.com/hyperledger/composer/pull/1384#discussion_r124085672,sstone1
https://github.com/hyperledger/composer/pull/1384,https://github.com/hyperledger/composer/pull/1384,"sadly that variant of npm view with the version always returns 0.

```
while ! npm view composer-playground@${VERSION} | grep dist-tags > /dev/null 2>&1; do
  sleep 10
done
```

Add in a grep command does the trick.",128b1d565ae4cd35f216637746e9ce161a95aa6d,2017-06-27 08:55:30,124216632,"@@ -78,6 +78,10 @@ if [ -z ""${TRAVIS_TAG}"" ]; then
     echo ""Pushing with tag unstable""
     lerna exec --ignore '@(composer-systests|composer-website)' -- npm publish --tag=unstable 2>&1 | tee
 
+	# quick check to see if the latest npm module has been published
+	npm view composer-playground@0.9.0-20170626131511 | grep dist-tags",,2017-06-27 15:54:59,https://api.github.com/repos/hyperledger/composer/pulls/comments/124216632,https://github.com/hyperledger/composer/pull/1384#discussion_r124216632,mbwhite
https://github.com/hyperledger/composer/pull/1374,https://github.com/hyperledger/composer/pull/1374,I think we should explain what is going on here: adding imports to the system types and modifying the AST so that resources extend the correct system type. It took me a couple of minutes to figure this out.,592f8b01fb0d7bdac8901870aa047fa04c6fc699,2017-06-23 09:15:18,123705215,"@@ -79,19 +79,37 @@ class ModelFile {
             this.imports = this.ast.imports;
         }
 
+        let decorate = false;",4,2017-06-26 09:42:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/123705215,https://github.com/hyperledger/composer/pull/1374#discussion_r123705215,dselman
https://github.com/hyperledger/composer/pull/1374,https://github.com/hyperledger/composer/pull/1374,Do we still need this?,592f8b01fb0d7bdac8901870aa047fa04c6fc699,2017-06-23 09:21:34,123706470,"@@ -194,6 +224,8 @@ class ModelManager {
             // let's go and retrofit the model to make sure all is good
             // make sure that models are all correctly/
             // temp workaround until system models in place",,2017-06-26 09:42:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/123706470,https://github.com/hyperledger/composer/pull/1374#discussion_r123706470,dselman
https://github.com/hyperledger/composer/pull/1374,https://github.com/hyperledger/composer/pull/1374,Why is this an array? Why not use backticks?,592f8b01fb0d7bdac8901870aa047fa04c6fc699,2017-06-23 09:22:31,123706761,"@@ -20,6 +20,24 @@ const ModelUtil = require('./modelutil');
 const ModelFile = require('./introspect/modelfile');
 const TypeNotFoundException = require('./typenotfoundexception');
 
+// const ENCODING = 'utf8';
+
+const LOG = require('./log/logger').getLog('ModelManager');
+const SYSTEM_MODEL_CONTENTS = [",,2017-06-26 09:42:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/123706761,https://github.com/hyperledger/composer/pull/1374#discussion_r123706761,dselman
https://github.com/hyperledger/composer/pull/1374,https://github.com/hyperledger/composer/pull/1374,Odd...,592f8b01fb0d7bdac8901870aa047fa04c6fc699,2017-06-23 09:22:58,123706896,"@@ -268,6 +302,8 @@ class ModelManager {
      */
     clearModelFiles() {
         this.modelFiles = {};
+        let systemModelContents = SYSTEM_MODEL_CONTENTS.join('\n');",,2017-06-26 09:42:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/123706896,https://github.com/hyperledger/composer/pull/1374#discussion_r123706896,dselman
https://github.com/hyperledger/composer/pull/1374,https://github.com/hyperledger/composer/pull/1374,Odd.,592f8b01fb0d7bdac8901870aa047fa04c6fc699,2017-06-23 09:23:26,123707081,"@@ -48,7 +66,12 @@ class ModelManager {
      * </p>
      */
     constructor() {
+        LOG.entry('constructor');
         this.modelFiles = {};
+        let systemModelContents = SYSTEM_MODEL_CONTENTS.join('\n');",,2017-06-26 09:42:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/123707081,https://github.com/hyperledger/composer/pull/1374#discussion_r123707081,dselman
https://github.com/hyperledger/composer/pull/1374,https://github.com/hyperledger/composer/pull/1374,global const?,592f8b01fb0d7bdac8901870aa047fa04c6fc699,2017-06-23 09:28:42,123708434,"@@ -75,6 +75,17 @@ class ModelUtil {
     }
 
     /**
+     * Returns the system namespace
+     * @return {string} - namespace of system types
+     * @private
+     */
+    static getSystemNamespace() {
+        let result = 'org.hyperledger.composer.system';",9,2017-06-26 09:42:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/123708434,https://github.com/hyperledger/composer/pull/1374#discussion_r123708434,dselman
https://github.com/hyperledger/composer/pull/1374,https://github.com/hyperledger/composer/pull/1374,:-(,592f8b01fb0d7bdac8901870aa047fa04c6fc699,2017-06-23 09:29:00,123708507,"@@ -116,7 +116,7 @@
     ""check-coverage"": true,
     ""statements"": 96,
     ""branches"": 91,
-    ""functions"": 97,
+    ""functions"": 96,",,2017-06-26 09:42:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/123708507,https://github.com/hyperledger/composer/pull/1374#discussion_r123708507,dselman
https://github.com/hyperledger/composer/pull/1374,https://github.com/hyperledger/composer/pull/1374,Yep good idea.,592f8b01fb0d7bdac8901870aa047fa04c6fc699,2017-06-23 10:51:24,123722051,"@@ -79,19 +79,37 @@ class ModelFile {
             this.imports = this.ast.imports;
         }
 
+        let decorate = false;",4,2017-06-26 09:42:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/123722051,https://github.com/hyperledger/composer/pull/1374#discussion_r123722051,mbwhite
https://github.com/hyperledger/composer/pull/1374,https://github.com/hyperledger/composer/pull/1374,..because I didn't know back ticks existed until now :-),592f8b01fb0d7bdac8901870aa047fa04c6fc699,2017-06-23 10:51:53,123722108,"@@ -20,6 +20,24 @@ const ModelUtil = require('./modelutil');
 const ModelFile = require('./introspect/modelfile');
 const TypeNotFoundException = require('./typenotfoundexception');
 
+// const ENCODING = 'utf8';
+
+const LOG = require('./log/logger').getLog('ModelManager');
+const SYSTEM_MODEL_CONTENTS = [",,2017-06-26 09:42:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/123722108,https://github.com/hyperledger/composer/pull/1374#discussion_r123722108,mbwhite
https://github.com/hyperledger/composer/pull/1374,https://github.com/hyperledger/composer/pull/1374,.. see above...,592f8b01fb0d7bdac8901870aa047fa04c6fc699,2017-06-23 10:51:54,123722111,"@@ -48,7 +66,12 @@ class ModelManager {
      * </p>
      */
     constructor() {
+        LOG.entry('constructor');
         this.modelFiles = {};
+        let systemModelContents = SYSTEM_MODEL_CONTENTS.join('\n');",,2017-06-26 09:42:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/123722111,https://github.com/hyperledger/composer/pull/1374#discussion_r123722111,mbwhite
https://github.com/hyperledger/composer/pull/1374,https://github.com/hyperledger/composer/pull/1374,possibly not... will check as a separate issue,592f8b01fb0d7bdac8901870aa047fa04c6fc699,2017-06-23 10:52:32,123722184,"@@ -194,6 +224,8 @@ class ModelManager {
             // let's go and retrofit the model to make sure all is good
             // make sure that models are all correctly/
             // temp workaround until system models in place",,2017-06-26 09:42:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/123722184,https://github.com/hyperledger/composer/pull/1374#discussion_r123722184,mbwhite
https://github.com/hyperledger/composer/pull/1374,https://github.com/hyperledger/composer/pull/1374,see above,592f8b01fb0d7bdac8901870aa047fa04c6fc699,2017-06-23 10:52:37,123722198,"@@ -268,6 +302,8 @@ class ModelManager {
      */
     clearModelFiles() {
         this.modelFiles = {};
+        let systemModelContents = SYSTEM_MODEL_CONTENTS.join('\n');",,2017-06-26 09:42:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/123722198,https://github.com/hyperledger/composer/pull/1374#discussion_r123722198,mbwhite
https://github.com/hyperledger/composer/pull/1374,https://github.com/hyperledger/composer/pull/1374,could be yes.,592f8b01fb0d7bdac8901870aa047fa04c6fc699,2017-06-23 10:52:55,123722236,"@@ -75,6 +75,17 @@ class ModelUtil {
     }
 
     /**
+     * Returns the system namespace
+     * @return {string} - namespace of system types
+     * @private
+     */
+    static getSystemNamespace() {
+        let result = 'org.hyperledger.composer.system';",9,2017-06-26 09:42:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/123722236,https://github.com/hyperledger/composer/pull/1374#discussion_r123722236,mbwhite
https://github.com/hyperledger/composer/pull/1374,https://github.com/hyperledger/composer/pull/1374,Need to raise an issue to update back to 97 when the query unit tests have gone in.. there wasn't any practical way I could get to it.. I was on 96.99%,592f8b01fb0d7bdac8901870aa047fa04c6fc699,2017-06-23 10:53:39,123722338,"@@ -116,7 +116,7 @@
     ""check-coverage"": true,
     ""statements"": 96,
     ""branches"": 91,
-    ""functions"": 97,
+    ""functions"": 96,",,2017-06-26 09:42:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/123722338,https://github.com/hyperledger/composer/pull/1374#discussion_r123722338,mbwhite
https://github.com/hyperledger/composer/pull/1374,https://github.com/hyperledger/composer/pull/1374,Looks like these are not merged?,592f8b01fb0d7bdac8901870aa047fa04c6fc699,2017-06-26 08:13:25,123950041,"@@ -116,7 +116,7 @@
     ""check-coverage"": true,
     ""statements"": 96,
     ""branches"": 91,
-    ""functions"": 97,
+    ""functions"": 96,",,2017-06-26 09:42:39,https://api.github.com/repos/hyperledger/composer/pulls/comments/123950041,https://github.com/hyperledger/composer/pull/1374#discussion_r123950041,dselman
https://github.com/hyperledger/composer/pull/1374,https://github.com/hyperledger/composer/pull/1374,Commented code left in,592f8b01fb0d7bdac8901870aa047fa04c6fc699,2017-06-26 12:17:59,123994206,"@@ -15,7 +15,7 @@
 'use strict';
 
 const ClassDeclaration = require('./classdeclaration');
-const Field = require('./field');
+// const Field = require('./field');",5,2017-06-26 12:17:59,https://api.github.com/repos/hyperledger/composer/pulls/comments/123994206,https://github.com/hyperledger/composer/pull/1374#discussion_r123994206,jt-nti
https://github.com/hyperledger/composer/pull/1374,https://github.com/hyperledger/composer/pull/1374,"I'm not entirely sure about the names of these system types. I guess if we were saying all names with a dollar prefix were reserved, that might be a useful thing, however I don't think that is the case (yet?) and as prefixes go, a dollar seems more likely to cause future headaches than other options.

Also, for a possible future enhancement, it would be nice if this model could be in a separate file and added in here during the build.",592f8b01fb0d7bdac8901870aa047fa04c6fc699,2017-06-26 12:23:33,123995140,"@@ -20,6 +20,23 @@ const ModelUtil = require('./modelutil');
 const ModelFile = require('./introspect/modelfile');
 const TypeNotFoundException = require('./typenotfoundexception');
 
+// const ENCODING = 'utf8';
+
+const LOG = require('./log/logger').getLog('ModelManager');
+const SYSTEM_MODEL_CONTENTS = `",7,2017-06-26 12:23:33,https://api.github.com/repos/hyperledger/composer/pulls/comments/123995140,https://github.com/hyperledger/composer/pull/1374#discussion_r123995140,jt-nti
https://github.com/hyperledger/composer/pull/1374,https://github.com/hyperledger/composer/pull/1374,"The names shouldn't have a $ prefix?   There where quite a few merge conflicts - so I will go back and determine if they haven't been lost. 

A separate file of some type is better idea true. Loading files in chaincode was an issue- but preprocessing could be used. ",592f8b01fb0d7bdac8901870aa047fa04c6fc699,2017-06-26 12:44:12,123998930,"@@ -20,6 +20,23 @@ const ModelUtil = require('./modelutil');
 const ModelFile = require('./introspect/modelfile');
 const TypeNotFoundException = require('./typenotfoundexception');
 
+// const ENCODING = 'utf8';
+
+const LOG = require('./log/logger').getLog('ModelManager');
+const SYSTEM_MODEL_CONTENTS = `",7,2017-06-26 12:44:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/123998930,https://github.com/hyperledger/composer/pull/1374#discussion_r123998930,mbwhite
https://github.com/hyperledger/composer/pull/1374,https://github.com/hyperledger/composer/pull/1374,Moved to a nitpick issue since the PR has been merged now. See #1385,592f8b01fb0d7bdac8901870aa047fa04c6fc699,2017-06-26 16:51:25,124061741,"@@ -20,6 +20,23 @@ const ModelUtil = require('./modelutil');
 const ModelFile = require('./introspect/modelfile');
 const TypeNotFoundException = require('./typenotfoundexception');
 
+// const ENCODING = 'utf8';
+
+const LOG = require('./log/logger').getLog('ModelManager');
+const SYSTEM_MODEL_CONTENTS = `",7,2017-06-26 16:51:25,https://api.github.com/repos/hyperledger/composer/pulls/comments/124061741,https://github.com/hyperledger/composer/pull/1374#discussion_r124061741,jt-nti
https://github.com/hyperledger/composer/pull/1356,https://github.com/hyperledger/composer/pull/1356,Left a console.log in there,5b8c6fdcade3ef15e10f939ddea6141f888a6168,2017-06-23 09:10:07,123704270,"@@ -0,0 +1,32 @@
+import {
+    EventEmitter,
+    ElementRef,
+    OnInit,
+    Directive,
+    Input,
+    Output
+} from '@angular/core';
+import { Observable } from 'rxjs';
+import { NgModel } from '@angular/forms';
+
+@Directive({
+    selector: '[debounce]'
+})
+export class DebounceDirective implements OnInit {
+    @Input() delay: number = 500;
+    @Output() debounceFunc: EventEmitter<any> = new EventEmitter();
+
+    constructor(private elementRef: ElementRef, private model: NgModel) {
+    }
+
+    ngOnInit(): void {
+        const eventStream = Observable.fromEvent(this.elementRef.nativeElement, 'keyup')
+            .map(() => {
+                console.log('@14gracel');",,2017-06-23 09:31:41,https://api.github.com/repos/hyperledger/composer/pulls/comments/123704270,https://github.com/hyperledger/composer/pull/1356#discussion_r123704270,jt-nti
https://github.com/hyperledger/composer/pull/1351,https://github.com/hyperledger/composer/pull/1351,Still need to create changedfiles.log somewhere otherwise there will be trouble ahead,be79842023e1c15e0b0242ca6d97cb2d7e28a2dc,2017-06-21 10:43:34,123212831,"@@ -74,12 +74,12 @@ cd $TRAVIS_BUILD_DIR
 git diff --name-only $(echo $TRAVIS_COMMIT_RANGE | sed 's/\.//')
 
 if [ ""$TRAVIS_PULL_REQUEST"" = ""false"" ]; then
-    git show --pretty=format: --name-only ""$TRAVIS_COMMIT_RANGE""|sort|uniq  > changedfiles.log
+    git show --pretty=format: --name-only ""$TRAVIS_COMMIT_RANGE""|sort|uniq  > changedfiles.log  || echo Fail",,2017-06-21 12:04:16,https://api.github.com/repos/hyperledger/composer/pulls/comments/123212831,https://github.com/hyperledger/composer/pull/1351#discussion_r123212831,jt-nti
https://github.com/hyperledger/composer/pull/1351,https://github.com/hyperledger/composer/pull/1351,Ditto,be79842023e1c15e0b0242ca6d97cb2d7e28a2dc,2017-06-21 10:43:47,123212867,"@@ -74,12 +74,12 @@ cd $TRAVIS_BUILD_DIR
 git diff --name-only $(echo $TRAVIS_COMMIT_RANGE | sed 's/\.//')
 
 if [ ""$TRAVIS_PULL_REQUEST"" = ""false"" ]; then
-    git show --pretty=format: --name-only ""$TRAVIS_COMMIT_RANGE""|sort|uniq  > changedfiles.log
+    git show --pretty=format: --name-only ""$TRAVIS_COMMIT_RANGE""|sort|uniq  > changedfiles.log  || echo Fail
 elif [ -n ""$TRAVIS_PULL_REQUEST"" ]; then
-    git diff --name-only ""$TRAVIS_COMMIT"" ""$TRAVIS_BRANCH""  > changedfiles.log
+    git diff --name-only ""$TRAVIS_COMMIT"" ""$TRAVIS_BRANCH""  > changedfiles.log   || echo Fail",,2017-06-21 12:04:16,https://api.github.com/repos/hyperledger/composer/pulls/comments/123212867,https://github.com/hyperledger/composer/pull/1351#discussion_r123212867,jt-nti
https://github.com/hyperledger/composer/pull/1318,https://github.com/hyperledger/composer/pull/1318,Why is this logic not in this.participant.validate()?,7bc534102c794fe5a8c13b8db311271696483df5,2017-06-19 20:35:15,122817037,"@@ -112,17 +112,27 @@ class AclRule {
         const foundVerbs = {};
         this.verbs.forEach((verb) => {
             if (foundVerbs[verb]) {
-                throw new Error(`The verb '${verb}' has been specified more than once in the ACL rule '${this.name}'`);
+                throw new IllegalModelException(`The verb '${verb}' has been specified more than once in the ACL rule '${this.name}'`);
             }
             foundVerbs[verb] = true;
         });
 
         if(this.participant) {
             this.participant.validate();
+
+            let participantClassDeclaration = this.participant.getClassDeclaration();",13,2017-06-20 10:57:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/122817037,https://github.com/hyperledger/composer/pull/1318#discussion_r122817037,dselman
https://github.com/hyperledger/composer/pull/1318,https://github.com/hyperledger/composer/pull/1318,Why is this logic not in this.transaction.validate()?,7bc534102c794fe5a8c13b8db311271696483df5,2017-06-19 20:35:36,122817106,"@@ -112,17 +112,27 @@ class AclRule {
         const foundVerbs = {};
         this.verbs.forEach((verb) => {
             if (foundVerbs[verb]) {
-                throw new Error(`The verb '${verb}' has been specified more than once in the ACL rule '${this.name}'`);
+                throw new IllegalModelException(`The verb '${verb}' has been specified more than once in the ACL rule '${this.name}'`);
             }
             foundVerbs[verb] = true;
         });
 
         if(this.participant) {
             this.participant.validate();
+
+            let participantClassDeclaration = this.participant.getClassDeclaration();
+            if (participantClassDeclaration && participantClassDeclaration.constructor.name !== 'ParticipantDeclaration') {
+                throw new IllegalModelException(`The participant '${participantClassDeclaration.getName()}' must be a participant`);
+            }
         }
 
         if(this.transaction) {
             this.transaction.validate();
+
+            let transactionClassDeclaration = this.transaction.getClassDeclaration();",22,2017-06-20 10:57:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/122817106,https://github.com/hyperledger/composer/pull/1318#discussion_r122817106,dselman
https://github.com/hyperledger/composer/pull/1318,https://github.com/hyperledger/composer/pull/1318,What does this do? What happened to the Glob?,7bc534102c794fe5a8c13b8db311271696483df5,2017-06-19 20:38:45,122818019,"@@ -1436,17 +1440,18 @@ Binding
 }
 
 BindingNoInstance
-  = qualifiedName:QualifiedName
+  = qualifiedName:(QualifiedName Glob?)
 {
   return {
     type: ""BindingNoInstance"",
-    qualifiedName: qualifiedName,
+    qualifiedName: qualifiedName.join(''),",24,2017-06-20 10:57:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/122818019,https://github.com/hyperledger/composer/pull/1318#discussion_r122818019,dselman
https://github.com/hyperledger/composer/pull/1318,https://github.com/hyperledger/composer/pull/1318,Typo `matchs`,7bc534102c794fe5a8c13b8db311271696483df5,2017-06-19 20:39:45,122818270,"@@ -44,16 +44,52 @@ class ModelUtil {
     }
 
     /**
-     * Returns true if the specified name is a wildcard.
+     * Returns true if the specified name is a wildcard
      * @param {string} fqn - the source string
-     * @return {boolean} true if the specified name is a wildcard.
+     * @return {boolean} true if the specified name is a wildcard
      * @private
      */
     static isWildcardName(fqn) {
         return ModelUtil.getShortName(fqn) === '*';
     }
 
     /**
+     * Returns true if the specified name is a recusive wildcard
+     * @param {string} fqn - the source string
+     * @return {boolean} true if the specified name is a recusive wildcard
+     * @private
+     */
+    static isRecursiveWildcardName(fqn) {
+        return ModelUtil.getShortName(fqn) === '**';
+    }
+
+    /**
+     * Returns true if a type matchs the required fully qualified name. The required",,2017-06-20 10:57:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/122818270,https://github.com/hyperledger/composer/pull/1318#discussion_r122818270,dselman
https://github.com/hyperledger/composer/pull/1318,https://github.com/hyperledger/composer/pull/1318,I don't think `Type` is correct here. Do you mean `Typed`?,7bc534102c794fe5a8c13b8db311271696483df5,2017-06-19 20:40:41,122818492,"@@ -44,16 +44,52 @@ class ModelUtil {
     }
 
     /**
-     * Returns true if the specified name is a wildcard.
+     * Returns true if the specified name is a wildcard
      * @param {string} fqn - the source string
-     * @return {boolean} true if the specified name is a wildcard.
+     * @return {boolean} true if the specified name is a wildcard
      * @private
      */
     static isWildcardName(fqn) {
         return ModelUtil.getShortName(fqn) === '*';
     }
 
     /**
+     * Returns true if the specified name is a recusive wildcard
+     * @param {string} fqn - the source string
+     * @return {boolean} true if the specified name is a recusive wildcard
+     * @private
+     */
+    static isRecursiveWildcardName(fqn) {
+        return ModelUtil.getShortName(fqn) === '**';
+    }
+
+    /**
+     * Returns true if a type matchs the required fully qualified name. The required
+     * name may be a wildcard or recursive wildcard
+     * @param {Type} type - the type to test",,2017-06-20 10:57:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/122818492,https://github.com/hyperledger/composer/pull/1318#discussion_r122818492,dselman
https://github.com/hyperledger/composer/pull/1318,https://github.com/hyperledger/composer/pull/1318,"This keeps the `.*` or `.**` globs as part of the qualified name, rather than returning them independently",7bc534102c794fe5a8c13b8db311271696483df5,2017-06-20 09:35:51,122926365,"@@ -1436,17 +1440,18 @@ Binding
 }
 
 BindingNoInstance
-  = qualifiedName:QualifiedName
+  = qualifiedName:(QualifiedName Glob?)
 {
   return {
     type: ""BindingNoInstance"",
-    qualifiedName: qualifiedName,
+    qualifiedName: qualifiedName.join(''),",24,2017-06-20 10:57:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/122926365,https://github.com/hyperledger/composer/pull/1318#discussion_r122926365,jt-nti
https://github.com/hyperledger/composer/pull/1318,https://github.com/hyperledger/composer/pull/1318,"Hmm, not 100% sure how that would work. The ModelBinding would need to know it's meant to be a participant. Might be possible looking at the AST?",7bc534102c794fe5a8c13b8db311271696483df5,2017-06-20 09:52:36,122930513,"@@ -112,17 +112,27 @@ class AclRule {
         const foundVerbs = {};
         this.verbs.forEach((verb) => {
             if (foundVerbs[verb]) {
-                throw new Error(`The verb '${verb}' has been specified more than once in the ACL rule '${this.name}'`);
+                throw new IllegalModelException(`The verb '${verb}' has been specified more than once in the ACL rule '${this.name}'`);
             }
             foundVerbs[verb] = true;
         });
 
         if(this.participant) {
             this.participant.validate();
+
+            let participantClassDeclaration = this.participant.getClassDeclaration();",13,2017-06-20 10:57:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/122930513,https://github.com/hyperledger/composer/pull/1318#discussion_r122930513,jt-nti
https://github.com/hyperledger/composer/pull/1318,https://github.com/hyperledger/composer/pull/1318,See above,7bc534102c794fe5a8c13b8db311271696483df5,2017-06-20 09:52:47,122930552,"@@ -112,17 +112,27 @@ class AclRule {
         const foundVerbs = {};
         this.verbs.forEach((verb) => {
             if (foundVerbs[verb]) {
-                throw new Error(`The verb '${verb}' has been specified more than once in the ACL rule '${this.name}'`);
+                throw new IllegalModelException(`The verb '${verb}' has been specified more than once in the ACL rule '${this.name}'`);
             }
             foundVerbs[verb] = true;
         });
 
         if(this.participant) {
             this.participant.validate();
+
+            let participantClassDeclaration = this.participant.getClassDeclaration();
+            if (participantClassDeclaration && participantClassDeclaration.constructor.name !== 'ParticipantDeclaration') {
+                throw new IllegalModelException(`The participant '${participantClassDeclaration.getName()}' must be a participant`);
+            }
         }
 
         if(this.transaction) {
             this.transaction.validate();
+
+            let transactionClassDeclaration = this.transaction.getClassDeclaration();",22,2017-06-20 10:57:28,https://api.github.com/repos/hyperledger/composer/pulls/comments/122930552,https://github.com/hyperledger/composer/pull/1318#discussion_r122930552,jt-nti
https://github.com/hyperledger/composer/pull/1307,https://github.com/hyperledger/composer/pull/1307,This doesn't need to be fakeAsync as you don't have a tick(),50f9922f347d8e1e56f3e6b34b4bf312e3fffe71,2017-06-19 08:13:29,122644153,"@@ -0,0 +1,191 @@
+/* tslint:disable:no-unused-variable */
+/* tslint:disable:no-unused-expression */
+/* tslint:disable:no-var-requires */
+/* tslint:disable:max-classes-per-file */
+import { ComponentFixture, TestBed, async, fakeAsync, tick, inject } from '@angular/core/testing';
+import { Component, Renderer, QueryList, ElementRef } from '@angular/core';
+import { By } from '@angular/platform-browser';
+
+import * as sinon from 'sinon';
+import * as chai from 'chai';
+import { ScrollToElementDirective } from './scroll-to-element.directive';
+
+let should = chai.should();
+
+@Component({
+    selector: 'editorFileList',
+    template: `
+    <div scroll-to-element [elementId]=""listItem"">
+      <ul>
+        <li #editorFileList id=""editorFileList0""><div>Item0</div></li>
+        <li #editorFileList id=""editorFileList1""><div>Item1</div></li>
+        <li #editorFileList id=""editorFileList2""><div>Item2</div></li>
+      </ul>
+    </div>`
+})
+
+class TestComponent {
+    listItem: string = 'editorFileList1';
+}
+
+describe('ScrollToElementDirective', () => {
+    let component: TestComponent;
+    let fixture: ComponentFixture<TestComponent>;
+
+    beforeEach(async(() => {
+        TestBed.configureTestingModule({
+            declarations: [TestComponent, ScrollToElementDirective],
+            providers: [Renderer]
+        })
+        .compileComponents();
+    }));
+
+    it('should create the directive', async(fakeAsync(() => {
+        fixture = TestBed.createComponent(TestComponent);
+        component = fixture.componentInstance;
+        fixture.detectChanges();
+
+        tick();
+
+        component.should.be.ok;
+    })));
+
+    describe('#retreiveSelectedItem', () => {
+
+        it('should return an array of nativeElement.id\'s that match the selected', async(fakeAsync(() => {",,2017-06-19 14:18:29,https://api.github.com/repos/hyperledger/composer/pulls/comments/122644153,https://github.com/hyperledger/composer/pull/1307#discussion_r122644153,cazfletch
https://github.com/hyperledger/composer/pull/1307,https://github.com/hyperledger/composer/pull/1307,you could just use tick() for this and give it a value to move it on a certain amount of time,50f9922f347d8e1e56f3e6b34b4bf312e3fffe71,2017-06-19 08:14:32,122644349,"@@ -0,0 +1,191 @@
+/* tslint:disable:no-unused-variable */
+/* tslint:disable:no-unused-expression */
+/* tslint:disable:no-var-requires */
+/* tslint:disable:max-classes-per-file */
+import { ComponentFixture, TestBed, async, fakeAsync, tick, inject } from '@angular/core/testing';
+import { Component, Renderer, QueryList, ElementRef } from '@angular/core';
+import { By } from '@angular/platform-browser';
+
+import * as sinon from 'sinon';
+import * as chai from 'chai';
+import { ScrollToElementDirective } from './scroll-to-element.directive';
+
+let should = chai.should();
+
+@Component({
+    selector: 'editorFileList',
+    template: `
+    <div scroll-to-element [elementId]=""listItem"">
+      <ul>
+        <li #editorFileList id=""editorFileList0""><div>Item0</div></li>
+        <li #editorFileList id=""editorFileList1""><div>Item1</div></li>
+        <li #editorFileList id=""editorFileList2""><div>Item2</div></li>
+      </ul>
+    </div>`
+})
+
+class TestComponent {
+    listItem: string = 'editorFileList1';
+}
+
+describe('ScrollToElementDirective', () => {
+    let component: TestComponent;
+    let fixture: ComponentFixture<TestComponent>;
+
+    beforeEach(async(() => {
+        TestBed.configureTestingModule({
+            declarations: [TestComponent, ScrollToElementDirective],
+            providers: [Renderer]
+        })
+        .compileComponents();
+    }));
+
+    it('should create the directive', async(fakeAsync(() => {
+        fixture = TestBed.createComponent(TestComponent);
+        component = fixture.componentInstance;
+        fixture.detectChanges();
+
+        tick();
+
+        component.should.be.ok;
+    })));
+
+    describe('#retreiveSelectedItem', () => {
+
+        it('should return an array of nativeElement.id\'s that match the selected', async(fakeAsync(() => {
+            let directiveEl = fixture.debugElement.query(By.directive(ScrollToElementDirective));
+            let directiveInstance = directiveEl.injector.get(ScrollToElementDirective);
+
+            let matchItem: ElementRef[] = directiveInstance.retreiveSelectedItem();
+            matchItem[0].nativeElement.id.should.equal('editorFileList1');
+        })));
+
+        it('should return an empty array if no matches for nativeElement.id\'s', () => {
+            let directiveEl = fixture.debugElement.query(By.directive(ScrollToElementDirective));
+            let directiveInstance = directiveEl.injector.get(ScrollToElementDirective);
+
+            directiveInstance.items = new QueryList<ElementRef>();
+
+            let emptyList = new QueryList<ElementRef>();
+            let matchItem: ElementRef[] = directiveInstance.retreiveSelectedItem();
+            matchItem.should.be.empty;
+        });
+    });
+
+    describe('#performScrollAction', () => {
+
+        it('should call stepVerticalScoll', async(fakeAsync(() => {
+            fixture = TestBed.createComponent(TestComponent);
+            component = fixture.componentInstance;
+            let directiveEl = fixture.debugElement.query(By.directive(ScrollToElementDirective));
+            let directiveInstance = directiveEl.injector.get(ScrollToElementDirective);
+            let stepSpy = sinon.spy(directiveInstance, 'stepVerticalScoll');
+
+            // Use fake timers
+            let clock = sinon.useFakeTimers();",,2017-06-19 14:18:29,https://api.github.com/repos/hyperledger/composer/pulls/comments/122644349,https://github.com/hyperledger/composer/pull/1307#discussion_r122644349,cazfletch
https://github.com/hyperledger/composer/pull/1307,https://github.com/hyperledger/composer/pull/1307,again you don't need fakeAsync,50f9922f347d8e1e56f3e6b34b4bf312e3fffe71,2017-06-19 08:15:08,122644468,"@@ -0,0 +1,191 @@
+/* tslint:disable:no-unused-variable */
+/* tslint:disable:no-unused-expression */
+/* tslint:disable:no-var-requires */
+/* tslint:disable:max-classes-per-file */
+import { ComponentFixture, TestBed, async, fakeAsync, tick, inject } from '@angular/core/testing';
+import { Component, Renderer, QueryList, ElementRef } from '@angular/core';
+import { By } from '@angular/platform-browser';
+
+import * as sinon from 'sinon';
+import * as chai from 'chai';
+import { ScrollToElementDirective } from './scroll-to-element.directive';
+
+let should = chai.should();
+
+@Component({
+    selector: 'editorFileList',
+    template: `
+    <div scroll-to-element [elementId]=""listItem"">
+      <ul>
+        <li #editorFileList id=""editorFileList0""><div>Item0</div></li>
+        <li #editorFileList id=""editorFileList1""><div>Item1</div></li>
+        <li #editorFileList id=""editorFileList2""><div>Item2</div></li>
+      </ul>
+    </div>`
+})
+
+class TestComponent {
+    listItem: string = 'editorFileList1';
+}
+
+describe('ScrollToElementDirective', () => {
+    let component: TestComponent;
+    let fixture: ComponentFixture<TestComponent>;
+
+    beforeEach(async(() => {
+        TestBed.configureTestingModule({
+            declarations: [TestComponent, ScrollToElementDirective],
+            providers: [Renderer]
+        })
+        .compileComponents();
+    }));
+
+    it('should create the directive', async(fakeAsync(() => {
+        fixture = TestBed.createComponent(TestComponent);
+        component = fixture.componentInstance;
+        fixture.detectChanges();
+
+        tick();
+
+        component.should.be.ok;
+    })));
+
+    describe('#retreiveSelectedItem', () => {
+
+        it('should return an array of nativeElement.id\'s that match the selected', async(fakeAsync(() => {
+            let directiveEl = fixture.debugElement.query(By.directive(ScrollToElementDirective));
+            let directiveInstance = directiveEl.injector.get(ScrollToElementDirective);
+
+            let matchItem: ElementRef[] = directiveInstance.retreiveSelectedItem();
+            matchItem[0].nativeElement.id.should.equal('editorFileList1');
+        })));
+
+        it('should return an empty array if no matches for nativeElement.id\'s', () => {
+            let directiveEl = fixture.debugElement.query(By.directive(ScrollToElementDirective));
+            let directiveInstance = directiveEl.injector.get(ScrollToElementDirective);
+
+            directiveInstance.items = new QueryList<ElementRef>();
+
+            let emptyList = new QueryList<ElementRef>();
+            let matchItem: ElementRef[] = directiveInstance.retreiveSelectedItem();
+            matchItem.should.be.empty;
+        });
+    });
+
+    describe('#performScrollAction', () => {
+
+        it('should call stepVerticalScoll', async(fakeAsync(() => {
+            fixture = TestBed.createComponent(TestComponent);
+            component = fixture.componentInstance;
+            let directiveEl = fixture.debugElement.query(By.directive(ScrollToElementDirective));
+            let directiveInstance = directiveEl.injector.get(ScrollToElementDirective);
+            let stepSpy = sinon.spy(directiveInstance, 'stepVerticalScoll');
+
+            // Use fake timers
+            let clock = sinon.useFakeTimers();
+
+            fixture.detectChanges();
+            directiveInstance.performScrollAction();
+
+            // Big fake step to ensure all setTimeout actinos completed
+            clock.tick(1000);
+
+            // Check initial call based on test information was correct
+            stepSpy.getCall(0).args[0].should.equal(0.08, 0);
+
+            // Restore system clocks
+            clock.restore();
+        })));
+
+        it('should not action if no items matched for selected element', async(fakeAsync(() => {",,2017-06-19 14:18:29,https://api.github.com/repos/hyperledger/composer/pulls/comments/122644468,https://github.com/hyperledger/composer/pull/1307#discussion_r122644468,cazfletch
https://github.com/hyperledger/composer/pull/1307,https://github.com/hyperledger/composer/pull/1307,do you need viewChild here?,50f9922f347d8e1e56f3e6b34b4bf312e3fffe71,2017-06-19 08:17:32,122644898,"@@ -1,4 +1,4 @@
-import { Component, OnInit, OnDestroy } from '@angular/core';
+import { Component, OnInit, OnDestroy, ViewChild } from '@angular/core';",,2017-06-19 14:18:29,https://api.github.com/repos/hyperledger/composer/pulls/comments/122644898,https://github.com/hyperledger/composer/pull/1307#discussion_r122644898,cazfletch
https://github.com/hyperledger/composer/pull/1302,https://github.com/hyperledger/composer/pull/1302,This should be using a utility method to validate the business network name. I think @davidkel added one.,46673b8debbc1bc06e942481d0f0cee3d55e814d,2017-06-19 20:24:03,122814121,"@@ -10,20 +9,13 @@ module.exports = yeoman.Base.extend({
     },
 
     prompting: function() {
-        console.log('Welcome to the business network skeleton generator');
+        console.log('Welcome to the business network generator');
 
         let questions = [
             {
-                type: 'confirm',
-                name: 'ismodel',
-                message: 'Do you only want to generate a model?',
-                store: true,
-                default: false
-            },
-            {
                 type: 'input',
                 name: 'appname',
-                message: 'What is the business network\'s name?',
+                message: 'Business network name:',
                 store: true,
                 validate: function(input) {
                     if(input !== null && input !== undefined && input !== '' && input.indexOf(' ') === -1 && input === input.toLowerCase()) {",,2017-06-20 10:23:34,https://api.github.com/repos/hyperledger/composer/pulls/comments/122814121,https://github.com/hyperledger/composer/pull/1302#discussion_r122814121,dselman
https://github.com/hyperledger/composer/pull/1302,https://github.com/hyperledger/composer/pull/1302,`.` is not valid in a business network name. Use a utility to validate. Default name should be org-acme-biznet.,46673b8debbc1bc06e942481d0f0cee3d55e814d,2017-06-19 20:25:05,122814482,"@@ -86,18 +78,32 @@ module.exports = yeoman.Base.extend({
                         return 'Licence cannot be null or empty.';
                     }
                 }
+            },
+            {
+                type: 'input',
+                name: 'namespace',
+                message: 'Namespace:',
+                default: 'org.acme.biznet',",,2017-06-20 10:23:34,https://api.github.com/repos/hyperledger/composer/pulls/comments/122814482,https://github.com/hyperledger/composer/pull/1302#discussion_r122814482,dselman
https://github.com/hyperledger/composer/pull/1302,https://github.com/hyperledger/composer/pull/1302,Typo - use a utility method for validation.,46673b8debbc1bc06e942481d0f0cee3d55e814d,2017-06-19 20:25:30,122814624,"@@ -86,18 +78,32 @@ module.exports = yeoman.Base.extend({
                         return 'Licence cannot be null or empty.';
                     }
                 }
+            },
+            {
+                type: 'input',
+                name: 'namespace',
+                message: 'Namespace:',
+                default: 'org.acme.biznet',
+                store: true,
+                validate: function(input) {
+                    if(input !== null && input !== undefined && input.match(/^(?:[a-z]\d*(?:\.[a-z])?)+$/)) {
+                        return true;
+                    } else {
+                        return 'Name must mactch: ^(?:[a-z]\d*(?:\.[a-z])?)+$';",,2017-06-20 10:23:34,https://api.github.com/repos/hyperledger/composer/pulls/comments/122814624,https://github.com/hyperledger/composer/pull/1302#discussion_r122814624,dselman
https://github.com/hyperledger/composer/pull/1302,https://github.com/hyperledger/composer/pull/1302,"Use a function, shared across the code base.",46673b8debbc1bc06e942481d0f0cee3d55e814d,2017-06-19 20:27:43,122815338,"@@ -28,133 +28,159 @@ module.exports = generators.Base.extend({
    * @returns {Object} List of questins to ask
    */
     prompting: function() {
-        console.log('Welcome to the CLI skeleton app generator');
-        const questions = [{
-            when: !this.options.appName,
-            type: 'input',
-            name: 'appName',
-            message: 'Your NPM library name:',
-            default: 'composer-sample-app',
-            store: false,
-            validate: function(input) {
-                if(input !== null && input !== undefined &&
+        console.log('Welcome to the CLI project generator');
+        const questions = [
+            {
+                when: !this.options.appName,
+                type: 'input',
+                name: 'appName',
+                message: 'Your NPM library name:',
+                default: 'cli-app',
+                store: false,
+                validate: function(input) {
+                    if(input !== null && input !== undefined &&
           input.match(/^[\w-]+$/)) {
-                    return true;
-                } else {
-                    return 'Name must only use lowercase letters, numbers and dashes: ^[a-z\-\d]+$';
+                        return true;
+                    } else {
+                        return 'Name must only use lowercase letters, numbers and dashes: ^[a-z\-\d]+$';",,2017-06-20 10:23:34,https://api.github.com/repos/hyperledger/composer/pulls/comments/122815338,https://github.com/hyperledger/composer/pull/1302#discussion_r122815338,dselman
https://github.com/hyperledger/composer/pull/1302,https://github.com/hyperledger/composer/pull/1302,Is the trailing `:` a typo?,46673b8debbc1bc06e942481d0f0cee3d55e814d,2017-06-19 20:28:45,122815621,"@@ -28,133 +28,159 @@ module.exports = generators.Base.extend({
    * @returns {Object} List of questins to ask
    */
     prompting: function() {
-        console.log('Welcome to the CLI skeleton app generator');
-        const questions = [{
-            when: !this.options.appName,
-            type: 'input',
-            name: 'appName',
-            message: 'Your NPM library name:',
-            default: 'composer-sample-app',
-            store: false,
-            validate: function(input) {
-                if(input !== null && input !== undefined &&
+        console.log('Welcome to the CLI project generator');
+        const questions = [
+            {
+                when: !this.options.appName,
+                type: 'input',
+                name: 'appName',
+                message: 'Your NPM library name:',
+                default: 'cli-app',
+                store: false,
+                validate: function(input) {
+                    if(input !== null && input !== undefined &&
           input.match(/^[\w-]+$/)) {
-                    return true;
-                } else {
-                    return 'Name must only use lowercase letters, numbers and dashes: ^[a-z\-\d]+$';
+                        return true;
+                    } else {
+                        return 'Name must only use lowercase letters, numbers and dashes: ^[a-z\-\d]+$';
+                    }
                 }
-            }
-        }, {
-            type: 'input',
-            name: 'appDescription',
-            message: 'Short description:',
-            default: 'Test Composer project',
-            store: false,
-            validate: function(input) {
-                if(input !== null && input !== undefined && input !== '') {
-                    return true;
-                } else {
-                    return 'Description cannot be null or empty.';
+            },
+            {
+                type: 'input',
+                name: 'appDescription',
+                message: 'Description:',
+                default: 'Hyperledger Composer CLI project',
+                store: false,
+                validate: function(input) {
+                    if(input !== null && input !== undefined && input !== '') {
+                        return true;
+                    } else {
+                        return 'Description cannot be null or empty.';
+                    }
                 }
-            }
-        }, {
-            type: 'input',
-            name: 'authorName',
-            message: 'Author name:',
-            store: true,
-            validate: function(input) {
-                if(input !== null && input !== undefined && input !== '') {
-                    return true;
-                } else {
-                    return 'Author name cannot be null or empty.';
+            },
+            {
+                type: 'input',
+                name: 'authorName',
+                message: 'Author name:',
+                store: true,
+                validate: function(input) {
+                    if(input !== null && input !== undefined && input !== '') {
+                        return true;
+                    } else {
+                        return 'Author name cannot be null or empty.';
+                    }
                 }
-            }
-        }, {
-            type: 'input',
-            name: 'authorEmail',
-            message: 'Author email:',
-            store: true,
-            validate: function(input) {
-                if(input !== null && input !== undefined && input !== '') {
-                    return true;
-                } else {
-                    return 'Author email cannot be null or empty.';
+            },
+            {
+                type: 'input',
+                name: 'authorEmail',
+                message: 'Author email:',
+                store: true,
+                validate: function(input) {
+                    if(input !== null && input !== undefined && input !== '') {
+                        return true;
+                    } else {
+                        return 'Author email cannot be null or empty.';
+                    }
                 }
-            }
-        },{
-            type: 'input',
-            name: 'npmNetworkDependancy',
-            message: 'NPM Module name of the Business Network to connect to:',
-            default: 'digitalproperty-network',
-            store: false,
-            validate: function(input) {
-                if(input !== null && input !== undefined && input !== '') {
-                    return true;
-                } else {
-                    return 'Network cannot be null or empty.';
+            },
+            {
+                type: 'input',
+                name: 'license',
+                message: 'License:',
+                default: 'Apache-2.0',
+                store: true,
+                validate: function(input) {
+                    if(input !== null && input !== undefined && input !== '') {
+                        return true;
+                    } else {
+                        return 'Licence cannot be null or empty.';
+                    }
                 }
-            }
-        }, {
-            type: 'confirm',
-            name: 'isNpmSameAsNetworkIdentifier',
-            message: 'Is the name in NPM registry the same as the Business Network Identifier?:',
-            default: true,
-            store: false
-        }, {
-            type: 'input',
-            name: 'networkIdentifier',
-            message: 'What is the Business Network Identifier?:',
-            store: false,
-            when: function(answers) {
-                return !answers.isNpmSameAsNetworkIdentifier;
             },
-            validate: function(input) {
-                if(input !== null && input !== undefined &&
+            {
+                type: 'input',
+                name: 'npmNetworkDependancy',
+                message: 'NPM business network module:',
+                default: 'digitalproperty-network',
+                store: false,
+                validate: function(input) {
+                    if(input !== null && input !== undefined && input !== '') {
+                        return true;
+                    } else {
+                        return 'Network cannot be null or empty.';
+                    }
+                }
+            },
+            {
+                type: 'confirm',
+                name: 'isNpmSameAsNetworkIdentifier',
+                message: 'Is the name in NPM registry the same as the Business Network Identifier?:',",,2017-06-20 10:23:34,https://api.github.com/repos/hyperledger/composer/pulls/comments/122815621,https://github.com/hyperledger/composer/pull/1302#discussion_r122815621,dselman
https://github.com/hyperledger/composer/pull/1302,https://github.com/hyperledger/composer/pull/1302,How many times!,46673b8debbc1bc06e942481d0f0cee3d55e814d,2017-06-19 20:29:13,122815703,"@@ -28,133 +28,159 @@ module.exports = generators.Base.extend({
    * @returns {Object} List of questins to ask
    */
     prompting: function() {
-        console.log('Welcome to the CLI skeleton app generator');
-        const questions = [{
-            when: !this.options.appName,
-            type: 'input',
-            name: 'appName',
-            message: 'Your NPM library name:',
-            default: 'composer-sample-app',
-            store: false,
-            validate: function(input) {
-                if(input !== null && input !== undefined &&
+        console.log('Welcome to the CLI project generator');
+        const questions = [
+            {
+                when: !this.options.appName,
+                type: 'input',
+                name: 'appName',
+                message: 'Your NPM library name:',
+                default: 'cli-app',
+                store: false,
+                validate: function(input) {
+                    if(input !== null && input !== undefined &&
           input.match(/^[\w-]+$/)) {
-                    return true;
-                } else {
-                    return 'Name must only use lowercase letters, numbers and dashes: ^[a-z\-\d]+$';
+                        return true;
+                    } else {
+                        return 'Name must only use lowercase letters, numbers and dashes: ^[a-z\-\d]+$';
+                    }
                 }
-            }
-        }, {
-            type: 'input',
-            name: 'appDescription',
-            message: 'Short description:',
-            default: 'Test Composer project',
-            store: false,
-            validate: function(input) {
-                if(input !== null && input !== undefined && input !== '') {
-                    return true;
-                } else {
-                    return 'Description cannot be null or empty.';
+            },
+            {
+                type: 'input',
+                name: 'appDescription',
+                message: 'Description:',
+                default: 'Hyperledger Composer CLI project',
+                store: false,
+                validate: function(input) {
+                    if(input !== null && input !== undefined && input !== '') {
+                        return true;
+                    } else {
+                        return 'Description cannot be null or empty.';
+                    }
                 }
-            }
-        }, {
-            type: 'input',
-            name: 'authorName',
-            message: 'Author name:',
-            store: true,
-            validate: function(input) {
-                if(input !== null && input !== undefined && input !== '') {
-                    return true;
-                } else {
-                    return 'Author name cannot be null or empty.';
+            },
+            {
+                type: 'input',
+                name: 'authorName',
+                message: 'Author name:',
+                store: true,
+                validate: function(input) {
+                    if(input !== null && input !== undefined && input !== '') {
+                        return true;
+                    } else {
+                        return 'Author name cannot be null or empty.';
+                    }
                 }
-            }
-        }, {
-            type: 'input',
-            name: 'authorEmail',
-            message: 'Author email:',
-            store: true,
-            validate: function(input) {
-                if(input !== null && input !== undefined && input !== '') {
-                    return true;
-                } else {
-                    return 'Author email cannot be null or empty.';
+            },
+            {
+                type: 'input',
+                name: 'authorEmail',
+                message: 'Author email:',
+                store: true,
+                validate: function(input) {
+                    if(input !== null && input !== undefined && input !== '') {
+                        return true;
+                    } else {
+                        return 'Author email cannot be null or empty.';
+                    }
                 }
-            }
-        },{
-            type: 'input',
-            name: 'npmNetworkDependancy',
-            message: 'NPM Module name of the Business Network to connect to:',
-            default: 'digitalproperty-network',
-            store: false,
-            validate: function(input) {
-                if(input !== null && input !== undefined && input !== '') {
-                    return true;
-                } else {
-                    return 'Network cannot be null or empty.';
+            },
+            {
+                type: 'input',
+                name: 'license',
+                message: 'License:',
+                default: 'Apache-2.0',
+                store: true,
+                validate: function(input) {
+                    if(input !== null && input !== undefined && input !== '') {
+                        return true;
+                    } else {
+                        return 'Licence cannot be null or empty.';
+                    }
                 }
-            }
-        }, {
-            type: 'confirm',
-            name: 'isNpmSameAsNetworkIdentifier',
-            message: 'Is the name in NPM registry the same as the Business Network Identifier?:',
-            default: true,
-            store: false
-        }, {
-            type: 'input',
-            name: 'networkIdentifier',
-            message: 'What is the Business Network Identifier?:',
-            store: false,
-            when: function(answers) {
-                return !answers.isNpmSameAsNetworkIdentifier;
             },
-            validate: function(input) {
-                if(input !== null && input !== undefined &&
+            {
+                type: 'input',
+                name: 'npmNetworkDependancy',
+                message: 'NPM business network module:',
+                default: 'digitalproperty-network',
+                store: false,
+                validate: function(input) {
+                    if(input !== null && input !== undefined && input !== '') {
+                        return true;
+                    } else {
+                        return 'Network cannot be null or empty.';
+                    }
+                }
+            },
+            {
+                type: 'confirm',
+                name: 'isNpmSameAsNetworkIdentifier',
+                message: 'Is the name in NPM registry the same as the Business Network Identifier?:',
+                default: true,
+                store: false
+            },
+            {
+                type: 'input',
+                name: 'networkIdentifier',
+                message: 'Business network identifier:',
+                store: false,
+                when: function(answers) {
+                    return !answers.isNpmSameAsNetworkIdentifier;
+                },
+                validate: function(input) {
+                    if(input !== null && input !== undefined &&
           input.match(/^[\/\@\w-]+$/)) {
-                    return true;
-                } else {
-                    return 'Name must only use lowercase letters, numbers and dashes: ^[a-z\-\d]+$';
+                        return true;
+                    } else {
+                        return 'Name must only use lowercase letters, numbers and dashes: ^[a-z\-\d]+$';",,2017-06-20 10:23:34,https://api.github.com/repos/hyperledger/composer/pulls/comments/122815703,https://github.com/hyperledger/composer/pull/1302#discussion_r122815703,dselman
https://github.com/hyperledger/composer/pull/1302,https://github.com/hyperledger/composer/pull/1302,Typo. Use shared library function.,46673b8debbc1bc06e942481d0f0cee3d55e814d,2017-06-19 20:30:31,122815953,"@@ -0,0 +1,129 @@
+'use strict';
+
+let yeoman = require('yeoman-generator');
+
+module.exports = yeoman.Base.extend({
+    constructor: function() {
+        yeoman.Base.apply(this, arguments);
+        this.options = this.env.options;
+    },
+
+    prompting: function() {
+        console.log('Welcome to the model generator');
+
+        let questions = [
+            {
+                type: 'input',
+                name: 'appname',
+                message: 'Model project name:',
+                store: true,
+                validate: function(input) {
+                    if(input !== null && input !== undefined && input !== '' && input.indexOf(' ') === -1 && input === input.toLowerCase()) {
+                        return true;
+                    } else {
+                        return 'Name cannot be null, empty or contain a space or uppercase character.';
+                    }
+                }
+            },
+            {
+                type: 'input',
+                name: 'appdescription',
+                message: 'Description:',
+                store: true,
+                validate: function(input) {
+                    if(input !== null && input !== undefined && input !== '') {
+                        return true;
+                    } else {
+                        return 'Description cannot be null or empty.';
+                    }
+                }
+            },
+            {
+                type: 'input',
+                name: 'appauthor',
+                message: 'Author name: ',
+                store: true,
+                validate: function(input) {
+                    if(input !== null && input !== undefined && input !== '') {
+                        return true;
+                    } else {
+                        return 'Author name cannot be null or empty.';
+                    }
+                }
+            },
+            {
+                type: 'input',
+                name: 'appemail',
+                message: 'Author email:',
+                store: true,
+                validate: function(input) {
+                    if(input !== null && input !== undefined && input !== '') {
+                        return true;
+                    }
+                    else {
+                        return 'Author email cannot be null or empty.';
+                    }
+                }
+            },
+            {
+                type: 'input',
+                name: 'applicense',
+                message: 'License:',
+                default: 'Apache-2.0',
+                store: true,
+                validate: function(input) {
+                    if(input !== null && input !== undefined && input !== '') {
+                        return true;
+                    } else {
+                        return 'Licence cannot be null or empty.';
+                    }
+                }
+            },
+            {
+                type: 'input',
+                name: 'namespace',
+                message: 'Namespace:',
+                default: 'org.acme.biznet',
+                store: true,
+                validate: function(input) {
+                    if(input !== null && input !== undefined && input.match(/^(?:[a-z]\d*(?:\.[a-z])?)+$/)) {
+                        return true;
+                    } else {
+                        return 'Name must mactch: ^(?:[a-z]\d*(?:\.[a-z])?)+$';",92,2017-06-20 10:23:34,https://api.github.com/repos/hyperledger/composer/pulls/comments/122815953,https://github.com/hyperledger/composer/pull/1302#discussion_r122815953,dselman
https://github.com/hyperledger/composer/pull/1302,https://github.com/hyperledger/composer/pull/1302,In the above though this is a namespace rather than a business network name so the `.` should still be valid,46673b8debbc1bc06e942481d0f0cee3d55e814d,2017-06-19 22:09:22,122837577,"@@ -86,18 +78,32 @@ module.exports = yeoman.Base.extend({
                         return 'Licence cannot be null or empty.';
                     }
                 }
+            },
+            {
+                type: 'input',
+                name: 'namespace',
+                message: 'Namespace:',
+                default: 'org.acme.biznet',",,2017-06-20 10:23:34,https://api.github.com/repos/hyperledger/composer/pulls/comments/122837577,https://github.com/hyperledger/composer/pull/1302#discussion_r122837577,davidkel
https://github.com/hyperledger/composer/pull/1302,https://github.com/hyperledger/composer/pull/1302,The utility method is in BusinessNetworkMetadata.js and may need to be pulled out into somewhere more common or perhaps made static.,46673b8debbc1bc06e942481d0f0cee3d55e814d,2017-06-19 22:09:26,122837591,"@@ -10,20 +9,13 @@ module.exports = yeoman.Base.extend({
     },
 
     prompting: function() {
-        console.log('Welcome to the business network skeleton generator');
+        console.log('Welcome to the business network generator');
 
         let questions = [
             {
-                type: 'confirm',
-                name: 'ismodel',
-                message: 'Do you only want to generate a model?',
-                store: true,
-                default: false
-            },
-            {
                 type: 'input',
                 name: 'appname',
-                message: 'What is the business network\'s name?',
+                message: 'Business network name:',
                 store: true,
                 validate: function(input) {
                     if(input !== null && input !== undefined && input !== '' && input.indexOf(' ') === -1 && input === input.toLowerCase()) {",,2017-06-20 10:23:34,https://api.github.com/repos/hyperledger/composer/pulls/comments/122837591,https://github.com/hyperledger/composer/pull/1302#discussion_r122837591,davidkel
https://github.com/hyperledger/composer/pull/1302,https://github.com/hyperledger/composer/pull/1302,Changelog version should be 0.8.0 ðŸ˜‰ ,46673b8debbc1bc06e942481d0f0cee3d55e814d,2017-06-20 01:19:48,122861721,"@@ -12,7 +12,10 @@
 # Note that the latest public API is documented using JSDocs and is available in api.txt.
 #
 
-Version 0.7.5 {b2c1c30d370b04c153426500a03c3061} 2017-06-07
+Version 0.7.5 {f8f86ee73c0bb2292b7d49d2997af8e1} 2017-06-14",,2017-06-20 10:23:34,https://api.github.com/repos/hyperledger/composer/pulls/comments/122861721,https://github.com/hyperledger/composer/pull/1302#discussion_r122861721,sstone1
https://github.com/hyperledger/composer/pull/1279,https://github.com/hyperledger/composer/pull/1279,Typo!,61568c5ae912ccb46ba18139d3bbd028c4751706,2017-06-16 07:39:40,122381626,"@@ -1,3 +1,11 @@
+# Contriburting to Composer",,2017-06-16 08:28:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/122381626,https://github.com/hyperledger/composer/pull/1279#discussion_r122381626,sstone1
https://github.com/hyperledger/composer/pull/1279,https://github.com/hyperledger/composer/pull/1279,Typo!,61568c5ae912ccb46ba18139d3bbd028c4751706,2017-06-16 07:39:46,122381641,"@@ -1,3 +1,10 @@
+# Contriburting to Composer",,2017-06-16 08:28:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/122381641,https://github.com/hyperledger/composer/pull/1279#discussion_r122381641,sstone1
https://github.com/hyperledger/composer/pull/1279,https://github.com/hyperledger/composer/pull/1279,Typo!,61568c5ae912ccb46ba18139d3bbd028c4751706,2017-06-16 07:40:21,122381730,"@@ -1,9 +1,20 @@
+# Contriburting to Composer ",,2017-06-16 08:28:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/122381730,https://github.com/hyperledger/composer/pull/1279#discussion_r122381730,sstone1
https://github.com/hyperledger/composer/pull/1279,https://github.com/hyperledger/composer/pull/1279,Typo!,61568c5ae912ccb46ba18139d3bbd028c4751706,2017-06-16 07:40:29,122381755,"@@ -1,6 +1,83 @@
+# Contriburting to Composer",,2017-06-16 08:28:12,https://api.github.com/repos/hyperledger/composer/pulls/comments/122381755,https://github.com/hyperledger/composer/pull/1279#discussion_r122381755,sstone1
https://github.com/hyperledger/composer/pull/1277,https://github.com/hyperledger/composer/pull/1277,"you must specify an identity which contains the userID `admin`
it's not so much containing the userid as the userid you choose containing the text 'admin'. ",0869e15907db5419d0a20726c7c8788f248f948d,2017-06-14 15:43:33,121985654,"@@ -16,11 +16,25 @@ Once the BNA file has been created it can be deployed to a runtime using the `co
 
 For example:
 
-        composer network deploy -p connectionProfileName -a <BusinessNetworkDefinition>.bna 
+        composer network deploy -p connectionProfileName -a <BusinessNetworkDefinition>.bna
            -i <Your EnrollmentID> -s <Your EnrollmentSecret>
 
 To update the definition of an already deployed business network use the `composer network update` CLI command.
 
+## Deploying business networks to {{site.data.conrefs.hlf_full}} Beta
+
+In {{site.data.conrefs.hlf_full}} Beta peers now enforce the concepts of admins and members. Admin user's identities and crypto material must be available to the peer at deployment. To make that identity and its crypto material available, your must import it to your local `keyValStore` directory before deploying the business network. To import the identity, use the [`composer identity import` command](../reference/composer.identity.import.html). When importing an identity, you do not assign it a secret, however the `composer network deploy` command requires a secret. If you are using an imported identity, you can enter any value for the secret.
+
+When connecting to the peer you must specify an identity which contains the userID `admin`, for example, `PeerAdmin`, `myadmin`, or `AdminPeer` are all valid userID's. Peers in different organizations may have different admin users. Only an admin user of peer's organization will be able to deploy a business network to their peers.",,2017-06-15 07:34:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/121985654,https://github.com/hyperledger/composer/pull/1277#discussion_r121985654,davidkel
https://github.com/hyperledger/composer/pull/1277,https://github.com/hyperledger/composer/pull/1277,"When a user deploys a business network to their peers, it will first install the business network then if the business network has never been instantiated before it will be instantiated. If later on someone deploys to another peer as the business network has already been instantiated it will only be installed to the peer and that peer will then be able to participate in the business network",0869e15907db5419d0a20726c7c8788f248f948d,2017-06-14 15:46:00,121986468,"@@ -16,11 +16,25 @@ Once the BNA file has been created it can be deployed to a runtime using the `co
 
 For example:
 
-        composer network deploy -p connectionProfileName -a <BusinessNetworkDefinition>.bna 
+        composer network deploy -p connectionProfileName -a <BusinessNetworkDefinition>.bna
            -i <Your EnrollmentID> -s <Your EnrollmentSecret>
 
 To update the definition of an already deployed business network use the `composer network update` CLI command.
 
+## Deploying business networks to {{site.data.conrefs.hlf_full}} Beta
+
+In {{site.data.conrefs.hlf_full}} Beta peers now enforce the concepts of admins and members. Admin user's identities and crypto material must be available to the peer at deployment. To make that identity and its crypto material available, your must import it to your local `keyValStore` directory before deploying the business network. To import the identity, use the [`composer identity import` command](../reference/composer.identity.import.html). When importing an identity, you do not assign it a secret, however the `composer network deploy` command requires a secret. If you are using an imported identity, you can enter any value for the secret.
+
+When connecting to the peer you must specify an identity which contains the userID `admin`, for example, `PeerAdmin`, `myadmin`, or `AdminPeer` are all valid userID's. Peers in different organizations may have different admin users. Only an admin user of peer's organization will be able to deploy a business network to their peers.
+
+Once a user has deployed a business network to one or more peers, they must also be the user to instantiate the business network. Any subsequent deploys requests will only install the business network on those peers.",,2017-06-15 07:34:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/121986468,https://github.com/hyperledger/composer/pull/1277#discussion_r121986468,davidkel
https://github.com/hyperledger/composer/pull/1277,https://github.com/hyperledger/composer/pull/1277,With composer moving to support hlfv1 beta. It will not be compatible with older versions of hlfv1,0869e15907db5419d0a20726c7c8788f248f948d,2017-06-14 15:47:06,121986753,"@@ -16,11 +16,25 @@ Once the BNA file has been created it can be deployed to a runtime using the `co
 
 For example:
 
-        composer network deploy -p connectionProfileName -a <BusinessNetworkDefinition>.bna 
+        composer network deploy -p connectionProfileName -a <BusinessNetworkDefinition>.bna
            -i <Your EnrollmentID> -s <Your EnrollmentSecret>
 
 To update the definition of an already deployed business network use the `composer network update` CLI command.
 
+## Deploying business networks to {{site.data.conrefs.hlf_full}} Beta
+
+In {{site.data.conrefs.hlf_full}} Beta peers now enforce the concepts of admins and members. Admin user's identities and crypto material must be available to the peer at deployment. To make that identity and its crypto material available, your must import it to your local `keyValStore` directory before deploying the business network. To import the identity, use the [`composer identity import` command](../reference/composer.identity.import.html). When importing an identity, you do not assign it a secret, however the `composer network deploy` command requires a secret. If you are using an imported identity, you can enter any value for the secret.
+
+When connecting to the peer you must specify an identity which contains the userID `admin`, for example, `PeerAdmin`, `myadmin`, or `AdminPeer` are all valid userID's. Peers in different organizations may have different admin users. Only an admin user of peer's organization will be able to deploy a business network to their peers.
+
+Once a user has deployed a business network to one or more peers, they must also be the user to instantiate the business network. Any subsequent deploys requests will only install the business network on those peers.
+
+These security changes mean that {{site.data.conrefs.hlf_full}} Beta is not compatible with any fabric that is running an older version.",,2017-06-15 07:34:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/121986753,https://github.com/hyperledger/composer/pull/1277#discussion_r121986753,davidkel
https://github.com/hyperledger/composer/pull/1277,https://github.com/hyperledger/composer/pull/1277,Do we really want to replicate this again ?,0869e15907db5419d0a20726c7c8788f248f948d,2017-06-14 15:47:52,121986961,"@@ -42,6 +42,22 @@ docker images -aq | xargs docker rmi -f
 
     By default, the Web Browser connection profile is in use (for developing and testing in browser memory).  To connect instead to the {{site.data.conrefs.hlf_full}} instance created in the previous step, click the globe icon in the top right of the UI to visit the Connection Profiles panel and change your active profile to 'hlfabric'.
 
+## Connecting to a {{site.data.conrefs.hlf_full}} Beta
+
+
+In {{site.data.conrefs.hlf_full}} Beta peers now enforce the concepts of admins and members. Admin user's identities and crypto material must be available to the peer at deployment. To make that identity and its crypto material available, your must import it to your local `keyValStore` directory before deploying the business network. To import the identity, use the [`composer identity import` command](../reference/composer.identity.import.html). When importing an identity, you do not assign it a secret, however the `composer network deploy` command requires a secret. If you are using an imported identity, you can enter any value for the secret.",,2017-06-15 07:34:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/121986961,https://github.com/hyperledger/composer/pull/1277#discussion_r121986961,davidkel
https://github.com/hyperledger/composer/pull/1277,https://github.com/hyperledger/composer/pull/1277,"The simplified version defines the ""ca"" as a single line. This will only work if the ca has no name defined. If it does then you will have to use the more complex definition of a ca
```
            ""ca"": {
                      ""url:"" ""http://"",
                      ""name"": """"
              },
```",0869e15907db5419d0a20726c7c8788f248f948d,2017-06-14 15:50:41,121987781,"@@ -69,8 +70,10 @@ A Connection Profile is used by {{site.data.conrefs.composer_full}} to connect t
             ""keyValStore"": ""/YOUR_HOME_DIR/.hfc-key-store"",
             ""channel"": ""mychannel"",
             ""mspID"": ""Org1MSP"",
-            ""deployWaitTime"": ""300"",
-            ""invokeWaitTime"": ""100""
+            ""timeout"": 300,
+            ""globalcert"": """",
+            ""maxSendSize"": 10,
+            ""maxRecvSize"": 15
         }
 
     If you are connecting to {{site.data.conrefs.hlf_full}} v1.0 and are not using TLS or if you don't need the trustedRoots and verify options of the Certificate Authority definition you can use the following simplified connection profile:",20,2017-06-15 07:34:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/121987781,https://github.com/hyperledger/composer/pull/1277#discussion_r121987781,davidkel
https://github.com/hyperledger/composer/pull/1277,https://github.com/hyperledger/composer/pull/1277,"The comment 
*Please note: If you are connecting to an instance of {{site.data.conrefs.hlf_full}} v1.0 the `keyValStore` property must be `home/.hfc-key-store`*

can now be removed, thank goodness.",0869e15907db5419d0a20726c7c8788f248f948d,2017-06-14 15:51:45,121988092,"@@ -108,7 +113,8 @@ A Connection Profile is used by {{site.data.conrefs.composer_full}} to connect t
 
 
   - `mspid` is the Membership Service Provider ID of your organization. It is associated with the enrollment id that you will use to interact with the business network.
-  - `deployWaitTime` is an optional property which sets a wait time for a response before timing out when attempting to deploy your business network.
-  - `invokeWaitTime` is an optional property which sets a wait time for a response before timing out when invoking a transaction or making a query request.
+  - `timeout` is an optional property which controls the timeout for each request made to peers and orderers. Please note, some commands may make several sequential requests and the timeout will be applied individually to each request.
+  - `maxSendSize` is an optional property which defines the size limit of outbound grpc messages being send to orderers and peers. The value is defined in megabytes. If this is not set, grpc sets a default. Setting this property to `-1` results in no size restriction.
+  - `maxRecvSize` is an optional property which defines the size limit of inbound grpc messages being received from orderers and peers. The value is defined in megabytes. If this is not set, grpc sets a default. Setting this property to `-1` results in no size restriction.
 
   *Please note: If you are connecting to an instance of {{site.data.conrefs.hlf_full}} v1.0 the `keyValStore` property must be `home/.hfc-key-store`*",,2017-06-15 07:34:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/121988092,https://github.com/hyperledger/composer/pull/1277#discussion_r121988092,davidkel
https://github.com/hyperledger/composer/pull/1277,https://github.com/hyperledger/composer/pull/1277,Changed,0869e15907db5419d0a20726c7c8788f248f948d,2017-06-15 06:12:34,122126414,"@@ -16,11 +16,25 @@ Once the BNA file has been created it can be deployed to a runtime using the `co
 
 For example:
 
-        composer network deploy -p connectionProfileName -a <BusinessNetworkDefinition>.bna 
+        composer network deploy -p connectionProfileName -a <BusinessNetworkDefinition>.bna
            -i <Your EnrollmentID> -s <Your EnrollmentSecret>
 
 To update the definition of an already deployed business network use the `composer network update` CLI command.
 
+## Deploying business networks to {{site.data.conrefs.hlf_full}} Beta
+
+In {{site.data.conrefs.hlf_full}} Beta peers now enforce the concepts of admins and members. Admin user's identities and crypto material must be available to the peer at deployment. To make that identity and its crypto material available, your must import it to your local `keyValStore` directory before deploying the business network. To import the identity, use the [`composer identity import` command](../reference/composer.identity.import.html). When importing an identity, you do not assign it a secret, however the `composer network deploy` command requires a secret. If you are using an imported identity, you can enter any value for the secret.
+
+When connecting to the peer you must specify an identity which contains the userID `admin`, for example, `PeerAdmin`, `myadmin`, or `AdminPeer` are all valid userID's. Peers in different organizations may have different admin users. Only an admin user of peer's organization will be able to deploy a business network to their peers.",,2017-06-15 07:34:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/122126414,https://github.com/hyperledger/composer/pull/1277#discussion_r122126414,EdProsser
https://github.com/hyperledger/composer/pull/1277,https://github.com/hyperledger/composer/pull/1277,Changed,0869e15907db5419d0a20726c7c8788f248f948d,2017-06-15 06:12:40,122126421,"@@ -16,11 +16,25 @@ Once the BNA file has been created it can be deployed to a runtime using the `co
 
 For example:
 
-        composer network deploy -p connectionProfileName -a <BusinessNetworkDefinition>.bna 
+        composer network deploy -p connectionProfileName -a <BusinessNetworkDefinition>.bna
            -i <Your EnrollmentID> -s <Your EnrollmentSecret>
 
 To update the definition of an already deployed business network use the `composer network update` CLI command.
 
+## Deploying business networks to {{site.data.conrefs.hlf_full}} Beta
+
+In {{site.data.conrefs.hlf_full}} Beta peers now enforce the concepts of admins and members. Admin user's identities and crypto material must be available to the peer at deployment. To make that identity and its crypto material available, your must import it to your local `keyValStore` directory before deploying the business network. To import the identity, use the [`composer identity import` command](../reference/composer.identity.import.html). When importing an identity, you do not assign it a secret, however the `composer network deploy` command requires a secret. If you are using an imported identity, you can enter any value for the secret.
+
+When connecting to the peer you must specify an identity which contains the userID `admin`, for example, `PeerAdmin`, `myadmin`, or `AdminPeer` are all valid userID's. Peers in different organizations may have different admin users. Only an admin user of peer's organization will be able to deploy a business network to their peers.
+
+Once a user has deployed a business network to one or more peers, they must also be the user to instantiate the business network. Any subsequent deploys requests will only install the business network on those peers.",,2017-06-15 07:34:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/122126421,https://github.com/hyperledger/composer/pull/1277#discussion_r122126421,EdProsser
https://github.com/hyperledger/composer/pull/1277,https://github.com/hyperledger/composer/pull/1277,Changed.,0869e15907db5419d0a20726c7c8788f248f948d,2017-06-15 06:20:41,122127245,"@@ -16,11 +16,25 @@ Once the BNA file has been created it can be deployed to a runtime using the `co
 
 For example:
 
-        composer network deploy -p connectionProfileName -a <BusinessNetworkDefinition>.bna 
+        composer network deploy -p connectionProfileName -a <BusinessNetworkDefinition>.bna
            -i <Your EnrollmentID> -s <Your EnrollmentSecret>
 
 To update the definition of an already deployed business network use the `composer network update` CLI command.
 
+## Deploying business networks to {{site.data.conrefs.hlf_full}} Beta
+
+In {{site.data.conrefs.hlf_full}} Beta peers now enforce the concepts of admins and members. Admin user's identities and crypto material must be available to the peer at deployment. To make that identity and its crypto material available, your must import it to your local `keyValStore` directory before deploying the business network. To import the identity, use the [`composer identity import` command](../reference/composer.identity.import.html). When importing an identity, you do not assign it a secret, however the `composer network deploy` command requires a secret. If you are using an imported identity, you can enter any value for the secret.
+
+When connecting to the peer you must specify an identity which contains the userID `admin`, for example, `PeerAdmin`, `myadmin`, or `AdminPeer` are all valid userID's. Peers in different organizations may have different admin users. Only an admin user of peer's organization will be able to deploy a business network to their peers.
+
+Once a user has deployed a business network to one or more peers, they must also be the user to instantiate the business network. Any subsequent deploys requests will only install the business network on those peers.
+
+These security changes mean that {{site.data.conrefs.hlf_full}} Beta is not compatible with any fabric that is running an older version.",,2017-06-15 07:34:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/122127245,https://github.com/hyperledger/composer/pull/1277#discussion_r122127245,EdProsser
https://github.com/hyperledger/composer/pull/1277,https://github.com/hyperledger/composer/pull/1277,Changed,0869e15907db5419d0a20726c7c8788f248f948d,2017-06-15 06:40:09,122129297,"@@ -69,8 +70,10 @@ A Connection Profile is used by {{site.data.conrefs.composer_full}} to connect t
             ""keyValStore"": ""/YOUR_HOME_DIR/.hfc-key-store"",
             ""channel"": ""mychannel"",
             ""mspID"": ""Org1MSP"",
-            ""deployWaitTime"": ""300"",
-            ""invokeWaitTime"": ""100""
+            ""timeout"": 300,
+            ""globalcert"": """",
+            ""maxSendSize"": 10,
+            ""maxRecvSize"": 15
         }
 
     If you are connecting to {{site.data.conrefs.hlf_full}} v1.0 and are not using TLS or if you don't need the trustedRoots and verify options of the Certificate Authority definition you can use the following simplified connection profile:",20,2017-06-15 07:34:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/122129297,https://github.com/hyperledger/composer/pull/1277#discussion_r122129297,EdProsser
https://github.com/hyperledger/composer/pull/1277,https://github.com/hyperledger/composer/pull/1277,Removed. :),0869e15907db5419d0a20726c7c8788f248f948d,2017-06-15 06:40:55,122129373,"@@ -108,7 +113,8 @@ A Connection Profile is used by {{site.data.conrefs.composer_full}} to connect t
 
 
   - `mspid` is the Membership Service Provider ID of your organization. It is associated with the enrollment id that you will use to interact with the business network.
-  - `deployWaitTime` is an optional property which sets a wait time for a response before timing out when attempting to deploy your business network.
-  - `invokeWaitTime` is an optional property which sets a wait time for a response before timing out when invoking a transaction or making a query request.
+  - `timeout` is an optional property which controls the timeout for each request made to peers and orderers. Please note, some commands may make several sequential requests and the timeout will be applied individually to each request.
+  - `maxSendSize` is an optional property which defines the size limit of outbound grpc messages being send to orderers and peers. The value is defined in megabytes. If this is not set, grpc sets a default. Setting this property to `-1` results in no size restriction.
+  - `maxRecvSize` is an optional property which defines the size limit of inbound grpc messages being received from orderers and peers. The value is defined in megabytes. If this is not set, grpc sets a default. Setting this property to `-1` results in no size restriction.
 
   *Please note: If you are connecting to an instance of {{site.data.conrefs.hlf_full}} v1.0 the `keyValStore` property must be `home/.hfc-key-store`*",,2017-06-15 07:34:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/122129373,https://github.com/hyperledger/composer/pull/1277#discussion_r122129373,EdProsser
https://github.com/hyperledger/composer/pull/1277,https://github.com/hyperledger/composer/pull/1277,"For the time being. Next week will implement some steps explaining how and what to do, but for something which came in so late in the day...",0869e15907db5419d0a20726c7c8788f248f948d,2017-06-15 07:33:12,122136793,"@@ -42,6 +42,22 @@ docker images -aq | xargs docker rmi -f
 
     By default, the Web Browser connection profile is in use (for developing and testing in browser memory).  To connect instead to the {{site.data.conrefs.hlf_full}} instance created in the previous step, click the globe icon in the top right of the UI to visit the Connection Profiles panel and change your active profile to 'hlfabric'.
 
+## Connecting to a {{site.data.conrefs.hlf_full}} Beta
+
+
+In {{site.data.conrefs.hlf_full}} Beta peers now enforce the concepts of admins and members. Admin user's identities and crypto material must be available to the peer at deployment. To make that identity and its crypto material available, your must import it to your local `keyValStore` directory before deploying the business network. To import the identity, use the [`composer identity import` command](../reference/composer.identity.import.html). When importing an identity, you do not assign it a secret, however the `composer network deploy` command requires a secret. If you are using an imported identity, you can enter any value for the secret.",,2017-06-15 07:34:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/122136793,https://github.com/hyperledger/composer/pull/1277#discussion_r122136793,EdProsser
https://github.com/hyperledger/composer/pull/1225,https://github.com/hyperledger/composer/pull/1225,"Typo - ""Hyperleder""",575e756cf41462ad39bb7efd2f2f6812e6618898,2017-06-09 06:22:58,121056102,"@@ -70,5 +90,13 @@ case ""$(uname)"" in
           ;;
 esac
 
+echo
+echo ""--------------------------------------------------------------------------------------""
+echo ""Hyperledger Fabric and Hyperleder Composer installed, and Composer Playground launched""",,2017-06-09 09:25:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/121056102,https://github.com/hyperledger/composer/pull/1225#discussion_r121056102,sstone1
https://github.com/hyperledger/composer/pull/1225,https://github.com/hyperledger/composer/pull/1225,"Minor, but there's a double space here.",575e756cf41462ad39bb7efd2f2f6812e6618898,2017-06-09 06:24:53,121056307,"@@ -70,5 +90,13 @@ case ""$(uname)"" in
           ;;
 esac
 
+echo
+echo ""--------------------------------------------------------------------------------------""
+echo ""Hyperledger Fabric and Hyperleder Composer installed, and Composer Playground launched""
+echo ""Please use  'composer.sh' to re-start""",,2017-06-09 09:25:49,https://api.github.com/repos/hyperledger/composer/pulls/comments/121056307,https://github.com/hyperledger/composer/pull/1225#discussion_r121056307,sstone1
https://github.com/hyperledger/composer/pull/1023,https://github.com/hyperledger/composer/pull/1023,this should be {{}},13a48d75224885902cca583fbb5559e58aa34ba1,2017-05-17 12:27:47,116985137,"@@ -0,0 +1,27 @@
+<div class=""delete"" tabindex=""-1"">
+  <div class=""modal-header"">
+    <svg class=""ibm-icon"" aria-hidden=""true"">
+      <use xlink:href=""#icon-warn_32""></use>
+    </svg>
+    <h1 [innerHTML]=""headerMessage""></h1>",,2017-05-17 15:46:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/116985137,https://github.com/hyperledger/composer/pull/1023#discussion_r116985137,cazfletch
https://github.com/hyperledger/composer/pull/1023,https://github.com/hyperledger/composer/pull/1023,this should also be {{}},13a48d75224885902cca583fbb5559e58aa34ba1,2017-05-17 12:28:48,116985309,"@@ -0,0 +1,27 @@
+<div class=""delete"" tabindex=""-1"">
+  <div class=""modal-header"">
+    <svg class=""ibm-icon"" aria-hidden=""true"">
+      <use xlink:href=""#icon-warn_32""></use>
+    </svg>
+    <h1 [innerHTML]=""headerMessage""></h1>
+    <button class=""icon modal-exit"" (click)=""activeModal.close(false)"">
+      <svg class=""ibm-icon"" aria-hidden=""true"">
+        <use xlink:href=""#icon-close_new""></use>
+      </svg>
+    </button>
+  </div>
+  <section class=""modal-body"">
+    <section class=""information"">
+        <p><b>You are about to delete:</b></p>
+        <section class=""items"">
+            <div class=""item""><b>{{fileType}}</b></div>
+            <div class=""item""><i>{{fileName}}</i></div>
+        </section>
+        <p [innerHTML]=""deleteMessage""></p>",,2017-05-17 15:46:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/116985309,https://github.com/hyperledger/composer/pull/1023#discussion_r116985309,cazfletch
https://github.com/hyperledger/composer/pull/1023,https://github.com/hyperledger/composer/pull/1023,you could use activeModal.dismiss() here rather than close,13a48d75224885902cca583fbb5559e58aa34ba1,2017-05-17 12:29:34,116985439,"@@ -0,0 +1,27 @@
+<div class=""delete"" tabindex=""-1"">
+  <div class=""modal-header"">
+    <svg class=""ibm-icon"" aria-hidden=""true"">
+      <use xlink:href=""#icon-warn_32""></use>
+    </svg>
+    <h1 [innerHTML]=""headerMessage""></h1>
+    <button class=""icon modal-exit"" (click)=""activeModal.close(false)"">
+      <svg class=""ibm-icon"" aria-hidden=""true"">
+        <use xlink:href=""#icon-close_new""></use>
+      </svg>
+    </button>
+  </div>
+  <section class=""modal-body"">
+    <section class=""information"">
+        <p><b>You are about to delete:</b></p>
+        <section class=""items"">
+            <div class=""item""><b>{{fileType}}</b></div>
+            <div class=""item""><i>{{fileName}}</i></div>
+        </section>
+        <p [innerHTML]=""deleteMessage""></p>
+    </section>
+  </section>
+  <footer>
+    <button type=""button"" class=""secondary"" (click)=""activeModal.close(false)"">Cancel</button>",,2017-05-17 15:46:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/116985439,https://github.com/hyperledger/composer/pull/1023#discussion_r116985439,cazfletch
https://github.com/hyperledger/composer/pull/1023,https://github.com/hyperledger/composer/pull/1023,this should use a variable i think 2rem (32px) is $space-large,13a48d75224885902cca583fbb5559e58aa34ba1,2017-05-17 12:30:15,116985601,"@@ -0,0 +1,27 @@
+@import '../../assets/styles/base/_colors.scss';
+
+.delete {
+
+
+  .modal-header {
+    svg {
+      fill: $error-colour-1
+    }
+  }
+
+  .information {
+      display: flex;
+      flex-direction: column;
+      align-content: flex-start;
+      margin-left: 2rem;",,2017-05-17 15:46:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/116985601,https://github.com/hyperledger/composer/pull/1023#discussion_r116985601,cazfletch
https://github.com/hyperledger/composer/pull/1023,https://github.com/hyperledger/composer/pull/1023,This should use a variable too think 1rem  (16px) is $space-medium,13a48d75224885902cca583fbb5559e58aa34ba1,2017-05-17 12:30:54,116985779,"@@ -0,0 +1,27 @@
+@import '../../assets/styles/base/_colors.scss';
+
+.delete {
+
+
+  .modal-header {
+    svg {
+      fill: $error-colour-1
+    }
+  }
+
+  .information {
+      display: flex;
+      flex-direction: column;
+      align-content: flex-start;
+      margin-left: 2rem;
+  }
+
+  .items {
+     border-left: solid $first-highlight;
+
+     .item{
+        margin-left: 1rem;",,2017-05-17 15:46:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/116985779,https://github.com/hyperledger/composer/pull/1023#discussion_r116985779,cazfletch
https://github.com/hyperledger/composer/pull/1023,https://github.com/hyperledger/composer/pull/1023,should NgbActiveModal be mocked or do you use it in the tests?,13a48d75224885902cca583fbb5559e58aa34ba1,2017-05-17 12:32:40,116986374,"@@ -0,0 +1,63 @@
+/* tslint:disable:no-unused-variable */
+/* tslint:disable:no-unused-expression */
+/* tslint:disable:no-var-requires */
+/* tslint:disable:max-classes-per-file */
+import { async, ComponentFixture, TestBed, fakeAsync, tick } from '@angular/core/testing';
+import { By } from '@angular/platform-browser';
+import { DebugElement } from '@angular/core';
+import { DeleteComponent } from './delete-confirm.component';
+import { NgbActiveModal } from '@ng-bootstrap/ng-bootstrap';
+
+describe('DeleteComponent', () => {
+    let component: DeleteComponent;
+    let fixture: ComponentFixture<DeleteComponent>;
+
+    beforeEach(() => {
+        TestBed.configureTestingModule({
+            declarations: [DeleteComponent],
+            providers: [NgbActiveModal]",,2017-05-17 15:46:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/116986374,https://github.com/hyperledger/composer/pull/1023#discussion_r116986374,cazfletch
https://github.com/hyperledger/composer/pull/1023,https://github.com/hyperledger/composer/pull/1023,the style bits should be in the scss file,13a48d75224885902cca583fbb5559e58aa34ba1,2017-05-17 12:34:31,116986828,"@@ -60,6 +60,13 @@ <h1 class=""margin-right"">{{deployedPackageName}}</h1>
           </svg>
         </button>
       </div>
+      <div *ngIf=""deletableFile"" style=""flex-shrink:1;align-self:center; margin-left: auto"">",,2017-05-17 15:46:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/116986828,https://github.com/hyperledger/composer/pull/1023#discussion_r116986828,cazfletch
https://github.com/hyperledger/composer/pull/1023,https://github.com/hyperledger/composer/pull/1023,tick,13a48d75224885902cca583fbb5559e58aa34ba1,2017-05-17 12:40:59,116988271,"@@ -0,0 +1,27 @@
+<div class=""delete"" tabindex=""-1"">
+  <div class=""modal-header"">
+    <svg class=""ibm-icon"" aria-hidden=""true"">
+      <use xlink:href=""#icon-warn_32""></use>
+    </svg>
+    <h1 [innerHTML]=""headerMessage""></h1>",,2017-05-17 15:46:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/116988271,https://github.com/hyperledger/composer/pull/1023#discussion_r116988271,nklincoln
https://github.com/hyperledger/composer/pull/1023,https://github.com/hyperledger/composer/pull/1023,tick,13a48d75224885902cca583fbb5559e58aa34ba1,2017-05-17 12:41:11,116988307,"@@ -0,0 +1,27 @@
+<div class=""delete"" tabindex=""-1"">
+  <div class=""modal-header"">
+    <svg class=""ibm-icon"" aria-hidden=""true"">
+      <use xlink:href=""#icon-warn_32""></use>
+    </svg>
+    <h1 [innerHTML]=""headerMessage""></h1>
+    <button class=""icon modal-exit"" (click)=""activeModal.close(false)"">
+      <svg class=""ibm-icon"" aria-hidden=""true"">
+        <use xlink:href=""#icon-close_new""></use>
+      </svg>
+    </button>
+  </div>
+  <section class=""modal-body"">
+    <section class=""information"">
+        <p><b>You are about to delete:</b></p>
+        <section class=""items"">
+            <div class=""item""><b>{{fileType}}</b></div>
+            <div class=""item""><i>{{fileName}}</i></div>
+        </section>
+        <p [innerHTML]=""deleteMessage""></p>",,2017-05-17 15:46:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/116988307,https://github.com/hyperledger/composer/pull/1023#discussion_r116988307,nklincoln
https://github.com/hyperledger/composer/pull/1023,https://github.com/hyperledger/composer/pull/1023,tick,13a48d75224885902cca583fbb5559e58aa34ba1,2017-05-17 12:41:26,116988363,"@@ -0,0 +1,27 @@
+<div class=""delete"" tabindex=""-1"">
+  <div class=""modal-header"">
+    <svg class=""ibm-icon"" aria-hidden=""true"">
+      <use xlink:href=""#icon-warn_32""></use>
+    </svg>
+    <h1 [innerHTML]=""headerMessage""></h1>
+    <button class=""icon modal-exit"" (click)=""activeModal.close(false)"">
+      <svg class=""ibm-icon"" aria-hidden=""true"">
+        <use xlink:href=""#icon-close_new""></use>
+      </svg>
+    </button>
+  </div>
+  <section class=""modal-body"">
+    <section class=""information"">
+        <p><b>You are about to delete:</b></p>
+        <section class=""items"">
+            <div class=""item""><b>{{fileType}}</b></div>
+            <div class=""item""><i>{{fileName}}</i></div>
+        </section>
+        <p [innerHTML]=""deleteMessage""></p>
+    </section>
+  </section>
+  <footer>
+    <button type=""button"" class=""secondary"" (click)=""activeModal.close(false)"">Cancel</button>",,2017-05-17 15:46:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/116988363,https://github.com/hyperledger/composer/pull/1023#discussion_r116988363,nklincoln
https://github.com/hyperledger/composer/pull/1023,https://github.com/hyperledger/composer/pull/1023,"sure - the $space items appear to all be in px sizing, but change made",13a48d75224885902cca583fbb5559e58aa34ba1,2017-05-17 12:42:36,116988611,"@@ -0,0 +1,27 @@
+@import '../../assets/styles/base/_colors.scss';
+
+.delete {
+
+
+  .modal-header {
+    svg {
+      fill: $error-colour-1
+    }
+  }
+
+  .information {
+      display: flex;
+      flex-direction: column;
+      align-content: flex-start;
+      margin-left: 2rem;",,2017-05-17 15:46:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/116988611,https://github.com/hyperledger/composer/pull/1023#discussion_r116988611,nklincoln
https://github.com/hyperledger/composer/pull/1023,https://github.com/hyperledger/composer/pull/1023,"they are, they need updating",13a48d75224885902cca583fbb5559e58aa34ba1,2017-05-17 12:44:14,116988977,"@@ -0,0 +1,27 @@
+@import '../../assets/styles/base/_colors.scss';
+
+.delete {
+
+
+  .modal-header {
+    svg {
+      fill: $error-colour-1
+    }
+  }
+
+  .information {
+      display: flex;
+      flex-direction: column;
+      align-content: flex-start;
+      margin-left: 2rem;",,2017-05-17 15:46:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/116988977,https://github.com/hyperledger/composer/pull/1023#discussion_r116988977,cazfletch
https://github.com/hyperledger/composer/pull/787,https://github.com/hyperledger/composer/pull/787,We can also remove sourcemap.v1 as it is there as it is a dependency of otto.,b36e97093d8172473be85e1cce75587344c34dc2,2017-04-29 12:11:13,114052375,"@@ -5,9 +5,9 @@
 [submodule ""packages/composer-runtime-hlf/vendor/gopkg.in/sourcemap.v1""]",1,2017-04-29 21:00:04,https://api.github.com/repos/hyperledger/composer/pulls/comments/114052375,https://github.com/hyperledger/composer/pull/787#discussion_r114052375,sstone1
https://github.com/hyperledger/composer/pull/695,https://github.com/hyperledger/composer/pull/695,Looks like an accidental typo here. It will need to be changed back to `getForm(id:any): Promise<any>{` ,b6f295527815ab38c6b0d6f34c2efc4b353bf18a,2017-04-18 09:59:53,111915200,"@@ -95,22 +101,24 @@ export class <%= currentAsset.name %>Component implements OnInit {
     };
 
 
-    return this.service<%= currentAsset.name %>.updateAsset(this.asset.<%=assetIdentifier%>,this.asset);
+    return this.service<%= currentAsset.name %>.updateAsset(this.asset.<%=assetIdentifier%>,this.asset).toPromise();
   }
 
 
   deleteAsset(): Promise<any> {
 
-    return this.service<%= currentAsset.name %>.deleteAsset(this.currentId);
+    return this.service<%= currentAsset.name %>.deleteAsset(this.currentId).toPromise();
   }
 
-  setId(id:any):void{
+  setId(id: any): void{
     this.currentId = id;
   }
 
-  getForm(id:any):Promise<any>{
+  getForm(id: gany): Promise<any>{",,2017-04-21 14:38:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/111915200,https://github.com/hyperledger/composer/pull/695#discussion_r111915200,Jakeeyturner
https://github.com/hyperledger/composer/pull/695,https://github.com/hyperledger/composer/pull/695,Shouldn't this just return to the app component?,b6f295527815ab38c6b0d6f34c2efc4b353bf18a,2017-04-18 10:29:27,111920803,"@@ -6,6 +6,7 @@ import { <%= assetComponentNames[x] %> } from './<%= assetList[x].name %>/<%= as
 
 const routes: Routes = [
     // { path: 'transaction', component: TransactionComponent },
+    {path: '', redirectTo: '<%= assetComponentNames[0] %>', pathMatch: 'full'},",4,2017-04-21 14:38:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/111920803,https://github.com/hyperledger/composer/pull/695#discussion_r111920803,Jakeeyturner
https://github.com/hyperledger/composer/pull/695,https://github.com/hyperledger/composer/pull/695,Oops,b6f295527815ab38c6b0d6f34c2efc4b353bf18a,2017-04-19 06:25:17,112123457,"@@ -95,22 +101,24 @@ export class <%= currentAsset.name %>Component implements OnInit {
     };
 
 
-    return this.service<%= currentAsset.name %>.updateAsset(this.asset.<%=assetIdentifier%>,this.asset);
+    return this.service<%= currentAsset.name %>.updateAsset(this.asset.<%=assetIdentifier%>,this.asset).toPromise();
   }
 
 
   deleteAsset(): Promise<any> {
 
-    return this.service<%= currentAsset.name %>.deleteAsset(this.currentId);
+    return this.service<%= currentAsset.name %>.deleteAsset(this.currentId).toPromise();
   }
 
-  setId(id:any):void{
+  setId(id: any): void{
     this.currentId = id;
   }
 
-  getForm(id:any):Promise<any>{
+  getForm(id: gany): Promise<any>{",,2017-04-21 14:38:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/112123457,https://github.com/hyperledger/composer/pull/695#discussion_r112123457,opiepj
https://github.com/hyperledger/composer/pull/695,https://github.com/hyperledger/composer/pull/695,"The app component would be the parent with the `router-outlet`, giving an error if we try to route to it. We need to default to at least one generated page, alternatively, we can create a home component",b6f295527815ab38c6b0d6f34c2efc4b353bf18a,2017-04-19 06:26:12,112123539,"@@ -6,6 +6,7 @@ import { <%= assetComponentNames[x] %> } from './<%= assetList[x].name %>/<%= as
 
 const routes: Routes = [
     // { path: 'transaction', component: TransactionComponent },
+    {path: '', redirectTo: '<%= assetComponentNames[0] %>', pathMatch: 'full'},",4,2017-04-21 14:38:06,https://api.github.com/repos/hyperledger/composer/pulls/comments/112123539,https://github.com/hyperledger/composer/pull/695#discussion_r112123539,opiepj
